def test_set_keytab(self):
    import base64
    config_file = 'stacks/2.2/configs/default.json'
    with open(config_file, 'r') as f:
        json_data = json.load(f)
    json_data['kerberosCommandParams'] = []
    json_data['kerberosCommandParams'].append({'keytab_file_configuration': 'hdfs-site/dfs.web.authentication.kerberos.keytab', 'service': 'HDFS', 'keytab_content_base64': 'BQIAAABbAAIAC0VYQU1QTEUuQ09NAARIVFRQABdjNjUwMS5hbWJhcmkuYXBhY2hlLm9yZwAAAAFUodgKAQASACA5N4gKUJsizCzwRD11Q/6sdZhJjlJmuuMeMKw/WefIbgAAAFMAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABAAGLA3huUxDmRK2da5Z7WPZ+zTbdnBkXCrKgAAAEsAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABcAEIT0yzbx1fnhmuaG5qtg444AAABDAAIAC0VYQU1QTEUuQ09NAARIVFRQABdjNjUwMS5hbWJhcmkuYXBhY2hlLm9yZwAAAAFUodgKAQADAAiov1LleuaMgwAAAEsAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABEAECBTe9uCaSiPxnoGRldhAks=', 'keytab_file_group_access': 'r', 'hostname': 'c6501.ambari.apache.org', 'component': 'NAMENODE', 'keytab_file_owner_name': 'root', 'keytab_file_path': '/etc/security/keytabs/spnego.service.keytab', 'principal_configuration': 'hdfs-site/dfs.web.authentication.kerberos.principal', 'keytab_file_owner_access': 'r', 'keytab_file_group_name': 'hadoop', 'principal': 'HTTP/_HOST@EXAMPLE.COM', })
    json_data['kerberosCommandParams'].append({'keytab_file_configuration': 'cluster-env/smokeuser_keytab', 'service': 'HDFS', 'keytab_content_base64': 'BQIAAABHAAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEgAg3OBDOecGoznTHZiPwmlmK4TI6bdRdrl/6qTV8Kml2TAAAAA/AAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEAAYzqEjkX/xDoO8ij0cJmc3ZG7Qfzgl/SN2AAAANwABAAtFWEFNUExFLkNPTQAJYW1iYXJpLXFhAAAAAVSh2AoBABcAEHzLG1kfqxhEoTe4erUldvQAAAAvAAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAAwAIOPK6UkwyUSMAAAA3AAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEQAQVqISRJwXIQnG28lI34mfeA==', 'keytab_file_group_access': '', 'hostname': 'c6501.ambari.apache.org', 'component': 'NAMENODE', 'keytab_file_owner_name': 'ambari-qa', 'keytab_file_path': '/etc/security/keytabs/smokeuser.headless.keytab', 'principal_configuration': 'cluster-env/smokeuser_principal_name', 'keytab_file_owner_access': 'r', 'keytab_file_group_name': 'hadoop', 'principal': 'ambari-qa@EXAMPLE.COM', })
    self.executeScript((self.COMMON_SERVICES_PACKAGE_DIR + '/scripts/kerberos_client.py'), classname='KerberosClient', command='set_keytab', config_dict=json_data, stack_version=self.STACK_VERSION, target=RMFTestCase.TARGET_COMMON_SERVICES)
    self.assertResourceCalled('Directory', '/etc/security/keytabs', owner='root', group='root', mode=493, create_parents=True)
    self.assertResourceCalled('File', '/etc/security/keytabs/spnego.service.keytab', owner='root', group='hadoop', mode=288, content=CallFunctionMock(call_result=base64.b64decode('BQIAAABbAAIAC0VYQU1QTEUuQ09NAARIVFRQABdjNjUwMS5hbWJhcmkuYXBhY2hlLm9yZwAAAAFUodgKAQASACA5N4gKUJsizCzwRD11Q/6sdZhJjlJmuuMeMKw/WefIbgAAAFMAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABAAGLA3huUxDmRK2da5Z7WPZ+zTbdnBkXCrKgAAAEsAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABcAEIT0yzbx1fnhmuaG5qtg444AAABDAAIAC0VYQU1QTEUuQ09NAARIVFRQABdjNjUwMS5hbWJhcmkuYXBhY2hlLm9yZwAAAAFUodgKAQADAAiov1LleuaMgwAAAEsAAgALRVhBTVBMRS5DT00ABEhUVFAAF2M2NTAxLmFtYmFyaS5hcGFjaGUub3JnAAAAAVSh2AoBABEAECBTe9uCaSiPxnoGRldhAks=')))
    self.assertResourceCalled('Directory', '/etc/security/keytabs', owner='root', group='root', mode=493, create_parents=True)
    self.assertResourceCalled('File', '/etc/security/keytabs/smokeuser.headless.keytab', owner='ambari-qa', group='hadoop', mode=256, content=CallFunctionMock(call_result=base64.b64decode('BQIAAABHAAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEgAg3OBDOecGoznTHZiPwmlmK4TI6bdRdrl/6qTV8Kml2TAAAAA/AAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEAAYzqEjkX/xDoO8ij0cJmc3ZG7Qfzgl/SN2AAAANwABAAtFWEFNUExFLkNPTQAJYW1iYXJpLXFhAAAAAVSh2AoBABcAEHzLG1kfqxhEoTe4erUldvQAAAAvAAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAAwAIOPK6UkwyUSMAAAA3AAEAC0VYQU1QTEUuQ09NAAlhbWJhcmktcWEAAAABVKHYCgEAEQAQVqISRJwXIQnG28lI34mfeA==')))
