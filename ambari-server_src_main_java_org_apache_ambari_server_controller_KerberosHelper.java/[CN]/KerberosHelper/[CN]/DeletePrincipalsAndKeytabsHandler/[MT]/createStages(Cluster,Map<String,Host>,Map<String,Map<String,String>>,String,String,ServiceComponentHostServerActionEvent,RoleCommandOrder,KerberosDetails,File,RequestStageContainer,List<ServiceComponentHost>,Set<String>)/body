{
  if (kerberosDetails.manageIdentities()) {
    if (requestStageContainer == null) {
      requestStageContainer=new RequestStageContainer(actionManager.getNextRequestId(),null,requestFactory,actionManager);
    }
    Map<String,String> commandParameters=new HashMap<String,String>();
    commandParameters.put(KerberosServerAction.AUTHENTICATED_USER_NAME,ambariManagementController.getAuthName());
    commandParameters.put(KerberosServerAction.DATA_DIRECTORY,dataDirectory.getAbsolutePath());
    commandParameters.put(KerberosServerAction.DEFAULT_REALM,kerberosDetails.getDefaultRealm());
    commandParameters.put(KerberosServerAction.KDC_TYPE,kerberosDetails.getKdcType().name());
    commandParameters.put(KerberosServerAction.ADMINISTRATOR_CREDENTIAL,getEncryptedAdministratorCredentials(cluster));
    addDestroyPrincipalsStage(cluster,clusterHostInfoJson,hostParamsJson,event,commandParameters,roleCommandOrder,requestStageContainer);
    addDeleteKeytabFilesStage(cluster,serviceComponentHosts,clusterHostInfoJson,hostParamsJson,commandParameters,roleCommandOrder,requestStageContainer,hostsWithValidKerberosClient);
  }
  return requestStageContainer.getLastStageId();
}
