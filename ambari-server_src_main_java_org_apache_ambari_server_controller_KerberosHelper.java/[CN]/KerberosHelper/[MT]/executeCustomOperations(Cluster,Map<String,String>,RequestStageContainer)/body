{
  if (requestProperties != null) {
    for (    SupportedCustomOperation operation : SupportedCustomOperation.values()) {
      if (requestProperties.containsKey(operation.name().toLowerCase())) {
        String value=requestProperties.get(operation.name().toLowerCase());
switch (operation) {
case REGENERATE_KEYTABS:
          if (cluster.getSecurityType() != SecurityType.KERBEROS) {
            throw new AmbariException(String.format("Custom operation %s can only be requested with the security type cluster property: %s",operation.name(),SecurityType.KERBEROS.name()));
          }
        try {
          if ("true".equalsIgnoreCase(value) || "all".equalsIgnoreCase(value)) {
            requestStageContainer=handle(cluster,getKerberosDetails(cluster),null,null,requestStageContainer,new CreatePrincipalsAndKeytabsHandler(true));
          }
 else           if ("missing".equalsIgnoreCase(value)) {
            requestStageContainer=handle(cluster,getKerberosDetails(cluster),null,null,requestStageContainer,new CreatePrincipalsAndKeytabsHandler(false));
          }
 else {
            throw new AmbariException(String.format("Unexpected directive value: %s",value));
          }
        }
 catch (        KerberosInvalidConfigurationException e) {
          throw new IllegalArgumentException(e.getMessage(),e);
        }
      break;
default :
    throw new AmbariException(String.format("Custom operation not supported: %s",operation.name()));
}
}
}
}
return requestStageContainer;
}
