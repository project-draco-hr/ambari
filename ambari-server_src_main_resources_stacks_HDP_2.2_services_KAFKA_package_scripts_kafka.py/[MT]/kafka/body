def kafka():
    import params
    Directory([params.log_dir, params.pid_dir, params.conf_dir], owner=params.kafka_user, group=params.user_group, recursive=True)
    brokerid = str(sorted(params.kafka_hosts).index(params.hostname))
    kafka_server_config = mutable_config_dict(params.config['configurations']['kafka-broker'])
    kafka_server_config['broker.id'] = brokerid
    kafka_server_config['hostname'] = params.hostname
    conf_dir = params.conf_dir
    properties_config('server.properties', conf_dir=params.conf_dir, configurations=kafka_server_config, owner=params.kafka_user, group=params.user_group, brokerid=brokerid)
    File(format('{conf_dir}/kafka-env.sh'), owner=params.kafka_user, content=InlineTemplate(params.kafka_env_sh_template))
    if (params.log4j_props != None):
        File(format('{conf_dir}/log4j.properties'), mode=420, group=params.user_group, owner=params.kafka_user, content=params.log4j_props)
