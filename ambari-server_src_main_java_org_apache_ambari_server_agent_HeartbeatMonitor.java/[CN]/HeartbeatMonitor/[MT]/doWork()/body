{
  List<Host> allHosts=fsm.getHosts();
  long now=System.currentTimeMillis();
  for (  Host hostObj : allHosts) {
    String host=hostObj.getHostName();
    HostState hostState=hostObj.getState();
    String hostname=hostObj.getHostName();
    long lastHeartbeat=0;
    try {
      lastHeartbeat=fsm.getHost(host).getLastHeartbeatTime();
    }
 catch (    AmbariException e) {
      LOG.warn("Exception in getting host object; Is it fatal?",e);
    }
    if (lastHeartbeat + 5 * threadWakeupInterval < now) {
      LOG.warn("Hearbeat lost from host " + host);
      hostObj.handleEvent(new HostHeartbeatLostEvent(host));
      actionQueue.dequeueAll(host);
      actionManager.handleLostHost(host);
    }
    if (hostState == HostState.WAITING_FOR_HOST_STATUS_UPDATES) {
      long timeSpentInState=hostObj.getTimeInState();
      if (timeSpentInState + 5 * threadWakeupInterval < now) {
        LOG.warn("timeSpentInState + 5*threadWakeupInterval < now, Go back to init");
        hostObj.setState(HostState.INIT);
      }
    }
    List<StatusCommand> cmds=generateStatusCommands(hostname);
    if (cmds.isEmpty()) {
    }
 else {
      for (      StatusCommand command : cmds) {
        actionQueue.enqueue(hostname,command);
      }
    }
  }
}
