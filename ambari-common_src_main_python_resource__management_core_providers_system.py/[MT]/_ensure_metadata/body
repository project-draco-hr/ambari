def _ensure_metadata(path, user, group, mode=None):
    stat = os.stat(path)
    if mode:
        existing_mode = (stat.st_mode & 4095)
        if (existing_mode != mode):
            Logger.info(('Changing permission for %s from %o to %o' % (path, existing_mode, mode)))
            sudo.chmod(path, mode)
    if user:
        uid = _coerce_uid(user)
        if (stat.st_uid != uid):
            Logger.info(('Changing owner for %s from %d to %s' % (path, stat.st_uid, user)))
            sudo.chown(path, user, None)
    if group:
        gid = _coerce_gid(group)
        if (stat.st_gid != gid):
            Logger.info(('Changing group for %s from %d to %s' % (path, stat.st_gid, group)))
            sudo.chown(path, None, group)
