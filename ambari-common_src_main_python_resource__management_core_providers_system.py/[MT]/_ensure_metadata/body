def _ensure_metadata(path, user, group, mode=None, cd_access=None):
    stat = sudo.stat(path)
    user_entity = group_entity = None
    if user:
        _user_entity = pwd.getpwnam(user)
        if (stat.st_uid != _user_entity.pw_uid):
            user_entity = _user_entity
            Logger.info(('Changing owner for %s from %d to %s' % (path, stat.st_uid, user)))
    if group:
        _group_entity = grp.getgrnam(group)
        if (stat.st_gid != _group_entity.gr_gid):
            group_entity = _group_entity
            Logger.info(('Changing group for %s from %d to %s' % (path, stat.st_gid, group)))
    sudo.chown(path, user_entity, group_entity)
    if mode:
        if (stat.st_mode != mode):
            Logger.info(('Changing permission for %s from %o to %o' % (path, stat.st_mode, mode)))
            sudo.chmod(path, mode)
    if cd_access:
        if (not re.match('^[ugoa]+$', cd_access)):
            raise Fail(("'cd_acess' value '%s' is not valid" % cd_access))
        dir_path = path
        while (dir_path != os.sep):
            if sudo.path_isdir(dir_path):
                sudo.chmod_extended(dir_path, (cd_access + '+x'))
            dir_path = os.path.split(dir_path)[0]
