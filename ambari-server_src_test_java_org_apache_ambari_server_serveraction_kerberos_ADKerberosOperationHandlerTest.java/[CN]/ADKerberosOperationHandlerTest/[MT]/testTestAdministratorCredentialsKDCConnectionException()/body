{
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).createNiceMock();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andAnswer(new IAnswer<LdapContext>(){
    @Override public LdapContext answer() throws Throwable {
      throw new CommunicationException();
    }
  }
).once();
  replayAll();
  handler.open(new KerberosCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD,null),DEFAULT_REALM,"invalid",DEFAULT_PRINCIPAL_CONTAINER_DN);
  handler.testAdministratorCredentials();
  handler.close();
}
