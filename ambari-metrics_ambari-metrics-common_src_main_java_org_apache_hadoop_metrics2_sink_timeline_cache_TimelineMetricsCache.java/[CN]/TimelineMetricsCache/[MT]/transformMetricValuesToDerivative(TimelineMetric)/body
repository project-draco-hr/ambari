{
  String metricName=timelineMetric.getMetricName();
  double firstValue=timelineMetric.getMetricValues().size() > 0 ? timelineMetric.getMetricValues().entrySet().iterator().next().getValue() : 0;
  double previousValue=Optional.fromNullable(counterMetricLastValue.get(metricName)).or(firstValue);
  Map<Long,Double> metricValues=timelineMetric.getMetricValues();
  Map<Long,Double> newMetricValues=new TreeMap<Long,Double>();
  for (  Map.Entry<Long,Double> entry : metricValues.entrySet()) {
    newMetricValues.put(entry.getKey(),entry.getValue() - previousValue);
    previousValue=entry.getValue();
  }
  timelineMetric.setMetricValues(newMetricValues);
  counterMetricLastValue.put(metricName,previousValue);
}
