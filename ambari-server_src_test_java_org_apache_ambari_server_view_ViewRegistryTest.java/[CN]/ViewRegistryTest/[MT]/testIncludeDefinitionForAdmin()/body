{
  ViewRegistry viewRegistry=ViewRegistry.getInstance();
  ViewEntity viewEntity=createNiceMock(ViewEntity.class);
  SecurityHelper securityHelper=createNiceMock(SecurityHelper.class);
  AmbariGrantedAuthority adminAuthority=createNiceMock(AmbariGrantedAuthority.class);
  PrivilegeEntity privilegeEntity=createNiceMock(PrivilegeEntity.class);
  PermissionEntity permissionEntity=createNiceMock(PermissionEntity.class);
  viewRegistry.setSecurityHelper(securityHelper);
  Collection<GrantedAuthority> authorities=new ArrayList<GrantedAuthority>();
  authorities.add(adminAuthority);
  securityHelper.getCurrentAuthorities();
  EasyMock.expectLastCall().andReturn(authorities);
  expect(adminAuthority.getPrivilegeEntity()).andReturn(privilegeEntity);
  expect(privilegeEntity.getPermission()).andReturn(permissionEntity);
  expect(permissionEntity.getId()).andReturn(PermissionEntity.AMBARI_ADMIN_PERMISSION);
  replay(securityHelper,adminAuthority,privilegeEntity,permissionEntity);
  Assert.assertTrue(viewRegistry.includeDefinition(viewEntity));
  verify(securityHelper,adminAuthority,privilegeEntity,permissionEntity);
}
