{
  ViewDAO viewDAO=createNiceMock(ViewDAO.class);
  ViewInstanceDAO viewInstanceDAO=createNiceMock(ViewInstanceDAO.class);
  UserDAO userDAO=createNiceMock(UserDAO.class);
  MemberDAO memberDAO=createNiceMock(MemberDAO.class);
  PrivilegeDAO privilegeDAO=createNiceMock(PrivilegeDAO.class);
  SecurityHelper securityHelper=createNiceMock(SecurityHelper.class);
  ViewRegistry.init(viewDAO,viewInstanceDAO,userDAO,memberDAO,privilegeDAO,securityHelper);
  ViewRegistry registry=ViewRegistry.getInstance();
  ViewInstanceEntity viewInstanceEntity=ViewInstanceEntityTest.getViewInstanceEntity();
  viewInstanceEntity.putInstanceData("foo","value");
  ViewInstanceDataEntity dataEntity=viewInstanceEntity.getInstanceData("foo");
  viewInstanceDAO.removeData(dataEntity);
  expect(viewInstanceDAO.merge(viewInstanceEntity)).andReturn(viewInstanceEntity);
  replay(viewDAO,viewInstanceDAO,securityHelper);
  registry.removeInstanceData(viewInstanceEntity,"foo");
  Assert.assertNull(viewInstanceEntity.getInstanceData("foo"));
  verify(viewDAO,viewInstanceDAO,securityHelper);
}
