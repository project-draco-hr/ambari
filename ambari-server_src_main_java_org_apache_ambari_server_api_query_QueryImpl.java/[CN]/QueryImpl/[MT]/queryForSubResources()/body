{
  for (  Map.Entry<String,QueryImpl> entry : requestedSubResources.entrySet()) {
    QueryImpl subResource=entry.getValue();
    Resource.Type resourceType=subResource.getResourceDefinition().getType();
    Request request=subResource.createRequest();
    Set<Resource> providerResourceSet=new HashSet<Resource>();
    for (    QueryResult queryResult : queryResults.values()) {
      for (      Resource resource : queryResult.getProviderResourceSet()) {
        if (resource.getPopulateRequiredFlag()) {
          Map<Resource.Type,String> map=getKeyValueMap(resource,queryResult.getKeyValueMap());
          Predicate queryPredicate=subResource.createPredicate(map,subResource.processedPredicate);
          Set<Resource> resourceSet=new LinkedHashSet<Resource>();
          try {
            Set<Resource> queryResources=subResource.doQuery(resourceType,request,queryPredicate,null,null);
            providerResourceSet.addAll(queryResources);
            resourceSet.addAll(queryResources);
          }
 catch (          NoSuchResourceException e) {
          }
          subResource.queryResults.put(resource,new QueryResult(request,queryPredicate,subResourcePredicate,map,resourceSet));
        }
      }
    }
    clusterController.populateResources(resourceType,providerResourceSet,request,null);
    subResource.queryForSubResources();
  }
}
