{
  Map<Resource.Type,String> resourceKeyValueMap=new HashMap<Resource.Type,String>(keyValueMap.size());
  for (  Map.Entry<Resource.Type,String> resourceIdEntry : keyValueMap.entrySet()) {
    Resource.Type type=resourceIdEntry.getKey();
    String value=resourceIdEntry.getValue();
    if (value == null) {
      Object o=resource.getPropertyValue(clusterController.getSchema(type).getKeyPropertyId(type));
      value=o == null ? null : o.toString();
    }
    if (value != null) {
      resourceKeyValueMap.put(type,value);
    }
  }
  String resourceKeyProp=clusterController.getSchema(resource.getType()).getKeyPropertyId(resource.getType());
  resourceKeyValueMap.put(resource.getType(),resource.getPropertyValue(resourceKeyProp).toString());
  return resourceKeyValueMap;
}
