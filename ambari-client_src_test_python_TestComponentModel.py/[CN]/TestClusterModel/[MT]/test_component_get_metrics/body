def test_component_get_metrics(self):
    http_client_mock = MagicMock()
    expected_path = '//clusters/cl1/hosts/myhost/host_components/DATANODE?fields=metrics'
    expected_json_output = {u'HostRoles': {u'cluster_name': u'cl1', u'host_name': u'myhost', u'component_name': u'DATANODE', }, u'metrics': {u'load': {u'load_one': 0.0125555555556, u'load_five': 0.0592777777778, u'load_fifteen': 0.0692222222222, }, u'ugi': {u'loginSuccess_avg_time': 0.0, u'loginFailure_avg_time': 0.0, u'loginSuccess_num_ops': 0.0, u'loginFailure_num_ops': 0.0, }, u'network': {u'bytes_in': 30989.8874167, u'pkts_in': 44.9822222222, u'pkts_out': 214.358916667, u'bytes_out': 98799.6742778, }, u'process': {u'proc_total': 682.397222222, u'proc_run': 2.0, }, u'dfs': {u'datanode': {u'replaceBlockOp_num_ops': 0.0, u'replaceBlockOp_avg_time': 0.0, u'blockChecksumOp_avg_time': 0.0, u'copyBlockOp_avg_time': 0.0, u'copyBlockOp_num_ops': 0.0, u'heartBeats_avg_time': 1.69166666667, u'writes_from_local_client': 0.0, u'blockReports_avg_time': 6.0, u'blocks_written': 0.0, u'writeBlockOp_num_ops': 0.0, u'bytes_read': 0.0, u'writeBlockOp_avg_time': 13.8969072165, u'writes_from_remote_client': 0.0, u'blocks_read': 0.0, u'readBlockOp_avg_time': 0.0, u'reads_from_remote_client': 0.0, u'block_verification_failures': 0.0, u'reads_from_local_client': 0.0, u'blocks_removed': 0.0, u'blocks_get_local_pathinfo': 0.0, u'blockReports_num_ops': 0.0, u'heartBeats_num_ops': 0.336481481481, u'blocks_verified': 0.0, u'bytes_written': 0.0, u'readBlockOp_num_ops': 0.0, u'blocks_replicated': 0.0, u'blockChecksumOp_num_ops': 0.0, }, u'FSNamesystem': {u'VolumeInfo': u'{"/hadoop/hdfs/data/current":{"freeSpace":495195869184,"usedSpace":345120768,"reservedSpace":1073741824}}', u'HttpPort': None, u'RpcPort': u'8010', u'NamenodeAddress': u'{"myhost":"BP-442795920-192.168.64.101-1383132565020"}', u'Version': u'2.2.0.2.0.6.0-76', }, }, u'rpc': {u'NumOpenConnections': 0.0, u'RpcProcessingTime_avg_time': 0.0, u'rpcAuthorizationFailures': 0.0, u'callQueueLen': 0.0, u'RpcProcessingTime_num_ops': 0.0, u'RpcQueueTime_avg_time': 0.0, u'rpcAuthorizationSuccesses': 0.0, u'rpcAuthenticationSuccesses': 0.0, u'rpcAuthenticationFailures': 0.0, u'ReceivedBytes': 0.0, u'RpcQueueTime_num_ops': 0.0, u'SentBytes': 0.0, }, u'boottime': 1383131209.0, u'jvm': {u'NonHeapMemoryMax': 136314880, u'logWarn': 0.0, u'gcCount': 0.0111111111111, u'threadsRunnable': 8.04166666667, u'memHeapCommittedM': 28.5625, u'threadsWaiting': 18.0, u'NonHeapMemoryUsed': 30798600, u'threadsTimedWaiting': 8.91666666667, u'threadsNew': 0.0, u'HeapMemoryUsed': 11395264, u'memHeapUsedM': 11.7175731111, u'memNonHeapUsedM': 29.36007675, u'threadsTerminated': 0.0, u'logInfo': 0.0, u'logError': 0.0, u'HeapMemoryMax': 1037959168, u'threadsBlocked': 0.0, u'logFatal': 0.0, u'memNonHeapCommittedM': 29.625, u'gcTimeMillis': 388, }, u'memory': {u'mem_cached': 160191.855556, u'swap_free': 2593920.0, u'mem_free': 183983.855556, u'mem_buffers': 23914.2666667, u'mem_shared': 0.0, u'swap_total': 2621432.0, u'mem_total': 1922680.0, }, u'disk': {u'disk_total': 525.79, u'disk_free': 495.645, u'part_max_used': 11.6, }, u'cpu': {u'cpu_idle': 85.73, u'cpu_num': 1.0, u'cpu_wio': 0.00416666666667, u'cpu_user': 7.42888888889, u'cpu_aidle': 0.0, u'cpu_system': 6.84583333333, u'cpu_speed': 2967.0, u'cpu_nice': 0.0, }, }, u'host': {u'href': u'http://192.168.64.101:8080/api/v1/clusters/cl1/hosts/myhost', }, u'href': u'http://192.168.64.101:8080/api/v1/clusters/cl1/hosts/myhost/host_components/DATANODE?fields=metrics', }
    component = self.create_component(http_client_mock)
    metrics_json = component.get_metrics()
    self.assertEqual(expected_json_output, metrics_json)
    http_client_mock.invoke.assert_called_with('GET', expected_path, headers=None, payload=None)
    pass
