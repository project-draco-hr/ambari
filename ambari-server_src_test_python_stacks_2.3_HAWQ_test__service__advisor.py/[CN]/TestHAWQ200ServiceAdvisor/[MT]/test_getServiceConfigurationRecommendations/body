def test_getServiceConfigurationRecommendations(self):
    configurations = {'hawq-sysctl-env': {'properties': {'vm.overcommit_memory': '1', }, }, }
    services = {'services': [{'StackServices': {'service_name': 'HAWQ', 'service_version': '2.0', 'stack_name': 'HDP', 'stack_version': '2.3', }, 'components': [{'StackServiceComponents': {'component_name': 'HAWQMASTER', 'hostnames': ['c6401.ambari.apache.org'], }, }, {'StackServiceComponents': {'component_name': 'HAWQSEGMENT', 'hostnames': ['c6402.ambari.apache.org', 'c6404.ambari.apache.org'], }, }], }], 'configurations': configurations, }
    hosts = {'items': [{'Hosts': {'host_name': 'c6401.ambari.apache.org', 'total_mem': 33554432, }, }, {'Hosts': {'host_name': 'c6402.ambari.apache.org', 'total_mem': 33554433, }, }, {'Hosts': {'host_name': 'c6403.ambari.apache.org', 'total_mem': 33554434, }, }, {'Hosts': {'host_name': 'c6404.ambari.apache.org', 'total_mem': 33554435, }, }], }
    self.serviceAdvisor.getServiceConfigurationRecommendations(self.stackAdvisor, configurations, None, services, hosts)
    self.assertEquals(configurations['hawq-sysctl-env']['properties']['vm.overcommit_memory'], '2')
    hosts['items'][0]['Hosts']['total_mem'] = 33554431
    self.serviceAdvisor.getServiceConfigurationRecommendations(self.stackAdvisor, configurations, None, services, hosts)
    self.assertEquals(configurations['hawq-sysctl-env']['properties']['vm.overcommit_memory'], '1')
