@patch('ambari_agent.HeartbeatStopHandler_linux')
@patch('os._exit')
@patch('os.getpid')
@patch.object(ProcessHelper, 'stopAgent')
def test_signal_handler(self, stopAgent_mock, os_getpid_mock, os_exit_mock, heartbeat_handler_mock):
    main.agentPid = 4444
    os_getpid_mock.return_value = 5555
    main.signal_handler('signum', 'frame')
    heartbeat_handler_mock.set_stop.assert_called()
    os_exit_mock.reset_mock()
    os_getpid_mock.return_value = main.agentPid
    main.signal_handler('signum', 'frame')
    heartbeat_handler_mock.set_stop.assert_called()
