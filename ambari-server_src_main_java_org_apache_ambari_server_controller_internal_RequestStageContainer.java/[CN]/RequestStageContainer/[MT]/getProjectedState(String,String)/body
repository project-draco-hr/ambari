{
  RoleCommand lastCommand=null;
  ListIterator<Stage> iterator=stages.listIterator(stages.size());
  while (lastCommand == null && iterator.hasPrevious()) {
    Stage stage=iterator.previous();
    HostRoleCommand hostRoleCommand=stage.getHostRoleCommand(host,component);
    if (hostRoleCommand != null && hostRoleCommand.getRoleCommand() != RoleCommand.SERVICE_CHECK) {
      lastCommand=hostRoleCommand.getRoleCommand();
    }
  }
  State resultingState=null;
  if (lastCommand != null) {
switch (lastCommand) {
case INSTALL:
case STOP:
      resultingState=State.INSTALLED;
    break;
case START:
  resultingState=State.STARTED;
break;
case UNINSTALL:
resultingState=State.INIT;
break;
default :
resultingState=State.UNKNOWN;
}
}
return resultingState;
}
