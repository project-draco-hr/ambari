{
  Set<String> ids=getRequestPropertyIds(request,predicate);
  Set<String> unsupportedIds=new HashSet<String>();
  String componentName=(String)resource.getPropertyValue(componentNamePropertyId);
  if (getComponentMetrics().get(componentName) == null) {
    return resource;
  }
  for (  String id : ids) {
    if (request.getTemporalInfo(id) != null) {
      unsupportedIds.add(id);
    }
    if (!isSupportedPropertyId(componentName,id)) {
      unsupportedIds.add(id);
    }
  }
  ids.removeAll(unsupportedIds);
  if (ids.isEmpty()) {
    return resource;
  }
  if (statePropertyId != null) {
    String state=(String)resource.getPropertyValue(statePropertyId);
    if (state != null && !healthyStates.contains(state)) {
      return resource;
    }
  }
  String clusterName=(String)resource.getPropertyValue(clusterNamePropertyId);
  String port=getPort(clusterName,componentName);
  if (port == null) {
    LOG.warn("Unable to get JMX metrics.  No port value for " + componentName);
    return resource;
  }
  String hostName=getHost(resource,clusterName,componentName);
  if (hostName == null) {
    LOG.warn("Unable to get JMX metrics.  No host name for " + componentName);
    return resource;
  }
  String protocol=getJMXProtocol(clusterName,componentName);
  try {
    InputStream in=streamProvider.readFrom(getSpec(protocol,hostName,port,componentName));
    try {
      if (null == componentName || !componentName.equals(STORM_REST_API)) {
        getHadoopMetricValue(in,ids,resource,request);
      }
 else {
        getStormMetricValue(in,ids,resource);
      }
    }
  finally {
      in.close();
    }
  }
 catch (  IOException e) {
    logException(e);
  }
  return resource;
}
