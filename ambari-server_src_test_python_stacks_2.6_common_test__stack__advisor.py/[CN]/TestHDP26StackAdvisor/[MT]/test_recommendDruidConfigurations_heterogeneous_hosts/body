def test_recommendDruidConfigurations_heterogeneous_hosts(self):
    hosts = {'items': [{'href': '/api/v1/hosts/c6401.ambari.apache.org', 'Hosts': {'cpu_count': 4, 'total_mem': 50331648, 'disk_info': [{'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }, {'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }], 'public_host_name': 'c6401.ambari.apache.org', 'host_name': 'c6401.ambari.apache.org', }, }, {'href': '/api/v1/hosts/c6402.ambari.apache.org', 'Hosts': {'cpu_count': 1, 'total_mem': 1922680, 'disk_info': [{'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }, {'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }], 'public_host_name': 'c6402.ambari.apache.org', 'host_name': 'c6402.ambari.apache.org', }, }, {'href': '/api/v1/hosts/c6403.ambari.apache.org', 'Hosts': {'cpu_count': 3, 'total_mem': 3845360, 'disk_info': [{'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }, {'mountpoint': '/', }, {'mountpoint': '/dev/shm', }, {'mountpoint': '/vagrant', }], 'public_host_name': 'c6403.ambari.apache.org', 'host_name': 'c6403.ambari.apache.org', }, }], }
    services = {'Versions': {'parent_stack_version': '2.5', 'stack_name': 'HDP', 'stack_version': '2.6', 'stack_hierarchy': {'stack_name': 'HDP', 'stack_versions': ['2.5', '2.4', '2.3', '2.2', '2.1', '2.0.6'], }, }, 'services': [{'StackServices': {'service_name': 'DRUID', }, 'components': [{'StackServiceComponents': {'component_name': 'DRUID_COORDINATOR', 'hostnames': ['c6401.ambari.apache.org'], }, }, {'StackServiceComponents': {'component_name': 'DRUID_OVERLORD', 'hostnames': ['c6401.ambari.apache.org'], }, }, {'StackServiceComponents': {'component_name': 'DRUID_BROKER', 'hostnames': ['c6402.ambari.apache.org', 'c6403.ambari.apache.org'], }, }, {'StackServiceComponents': {'component_name': 'DRUID_HISTORICAL', 'hostnames': ['c6401.ambari.apache.org', 'c6403.ambari.apache.org'], }, }, {'StackServiceComponents': {'component_name': 'DRUID_MIDDLEMANAGER', 'hostnames': ['c6401.ambari.apache.org'], }, }], }], 'configurations': {'druid-common': {'properties': {'database_name': 'druid', 'metastore_hostname': 'c6401.ambari.apache.org', 'druid.metadata.storage.type': 'derby', 'druid.extensions.loadList': '["mysql-metadata-storage"]', 'druid.extensions.pullList': '[]', }, }, }, }
    clusterData = {}
    configurations = {}
    self.stackAdvisor.recommendDruidConfigurations(configurations, clusterData, services, hosts)
    self.assertEquals(configurations, {'druid-historical': {'properties': {'druid.processing.numThreads': '2', 'druid.server.http.numThreads': '40', }, }, 'druid-broker': {'properties': {'druid.processing.numThreads': '1', 'druid.server.http.numThreads': '40', }, }, 'druid-common': {'properties': {'druid.extensions.loadList': '[]', 'druid.metadata.storage.connector.port': '1527', 'druid.metadata.storage.connector.connectURI': 'jdbc:derby://c6401.ambari.apache.org:1527/druid;create=true', 'druid.zk.service.host': '', 'druid.extensions.pullList': '[]', }, }, 'druid-env': {'properties': {}, 'property_attributes': {'druid.coordinator.jvm.heap.memory': {'maximum': '49152', }, 'druid.overlord.jvm.heap.memory': {'maximum': '49152', }, 'druid.middlemanager.jvm.heap.memory': {'maximum': '49152', }, 'druid.historical.jvm.heap.memory': {'maximum': '3755', }, 'druid.broker.jvm.heap.memory': {'maximum': '1877', }, }, }, })
