{
  AmbariMetaInfo metaInfo=createMock(AmbariMetaInfo.class);
  ServiceInfo service=new ServiceInfo();
  service.setName("service1");
  List<PropertyInfo> serviceProperties=new ArrayList<PropertyInfo>();
  PropertyInfo prop=new PropertyInfo();
  prop.setFilename("core-site.xml");
  prop.setName("super.secret.password");
  prop.setRequireInput(true);
  Set<PropertyInfo.PropertyType> propertyTypes=new HashSet<PropertyInfo.PropertyType>();
  propertyTypes.add(PropertyInfo.PropertyType.PASSWORD);
  prop.setPropertyTypes(propertyTypes);
  prop.setValue(null);
  serviceProperties.add(prop);
  service.getProperties().addAll(serviceProperties);
  service.getProperties().addAll(serviceProperties);
  BlueprintEntity entity=new BlueprintEntity();
  entity.setStack(stackEntity);
  Collection<BlueprintConfigEntity> configurations=new HashSet<BlueprintConfigEntity>();
  BlueprintConfigEntity configEntity=new BlueprintConfigEntity();
  configEntity.setBlueprintEntity(entity);
  configEntity.setBlueprintName("blueprint");
  configEntity.setType("core-site");
  Map<String,String> configData=new HashMap<String,String>();
  configData.put("foo","val1");
  configData.put("bar","val2");
  configData.put("super.secret.password","password");
  configEntity.setConfigData(new Gson().toJson(configData));
  configurations.add(configEntity);
  entity.setConfigurations(configurations);
  Collection<HostGroupEntity> hostGroupEntities=new HashSet<HostGroupEntity>();
  HostGroupEntity hostGroupEntity=new HostGroupEntity();
  hostGroupEntity.setName("group1");
  Collection<HostGroupComponentEntity> hostGroupComponents=new HashSet<HostGroupComponentEntity>();
  HostGroupComponentEntity componentEntity=new HostGroupComponentEntity();
  componentEntity.setName("component1");
  componentEntity.setBlueprintName("blueprint");
  componentEntity.setHostGroupEntity(hostGroupEntity);
  componentEntity.setHostGroupName("group1");
  hostGroupComponents.add(componentEntity);
  hostGroupEntity.setComponents(hostGroupComponents);
  hostGroupEntity.setConfigurations(Collections.<HostGroupConfigEntity>emptyList());
  hostGroupEntities.add(hostGroupEntity);
  entity.setHostGroups(hostGroupEntities);
  expect(metaInfo.getComponentToService("HDP","2.0.6","component1")).andReturn("service1");
  expect(metaInfo.getService("HDP","2.0.6","service1")).andReturn(service);
  replay(metaInfo);
  Map<String,Map<String,Collection<String>>> missingProps=entity.validateConfigurations(metaInfo,true);
  assertTrue(missingProps.isEmpty());
  verify(metaInfo);
}
