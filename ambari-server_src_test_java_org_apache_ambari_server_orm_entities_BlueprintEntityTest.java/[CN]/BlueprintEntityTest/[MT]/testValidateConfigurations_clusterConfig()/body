{
  AmbariMetaInfo metaInfo=createMock(AmbariMetaInfo.class);
  Map<String,PropertyInfo> requiredProps=new HashMap<String,PropertyInfo>();
  PropertyInfo prop=new PropertyInfo();
  prop.setFilename("core-site.xml");
  prop.setName("super.secret.password");
  prop.setRequireInput(true);
  prop.setType(PropertyInfo.PropertyType.PASSWORD);
  prop.setValue(null);
  requiredProps.put("service1",prop);
  BlueprintEntity entity=new BlueprintEntity();
  entity.setStackName("stackName");
  entity.setStackVersion("version");
  Collection<BlueprintConfigEntity> configurations=new HashSet<BlueprintConfigEntity>();
  BlueprintConfigEntity configEntity=new BlueprintConfigEntity();
  configEntity.setBlueprintEntity(entity);
  configEntity.setBlueprintName("blueprint");
  configEntity.setType("core-site");
  Map<String,String> configData=new HashMap<String,String>();
  configData.put("foo","val1");
  configData.put("bar","val2");
  configData.put("super.secret.password","password");
  configEntity.setConfigData(new Gson().toJson(configData));
  configurations.add(configEntity);
  entity.setConfigurations(configurations);
  Collection<HostGroupEntity> hostGroupEntities=new HashSet<HostGroupEntity>();
  HostGroupEntity hostGroupEntity=new HostGroupEntity();
  Collection<HostGroupComponentEntity> hostGroupComponents=new HashSet<HostGroupComponentEntity>();
  HostGroupComponentEntity componentEntity=new HostGroupComponentEntity();
  componentEntity.setName("component1");
  componentEntity.setBlueprintName("blueprint");
  componentEntity.setHostGroupEntity(hostGroupEntity);
  componentEntity.setHostGroupName("group1");
  hostGroupComponents.add(componentEntity);
  hostGroupEntity.setComponents(hostGroupComponents);
  hostGroupEntity.setConfigurations(Collections.<HostGroupConfigEntity>emptyList());
  hostGroupEntities.add(hostGroupEntity);
  entity.setHostGroups(hostGroupEntities);
  expect(metaInfo.getComponentToService("stackName","version","component1")).andReturn("service1");
  expect(metaInfo.getRequiredProperties("stackName","version","service1")).andReturn(requiredProps);
  replay(metaInfo);
  Map<String,Map<String,Collection<String>>> missingProps=entity.validateConfigurations(metaInfo,PropertyInfo.PropertyType.PASSWORD);
  assertTrue(missingProps.isEmpty());
  verify(metaInfo);
}
