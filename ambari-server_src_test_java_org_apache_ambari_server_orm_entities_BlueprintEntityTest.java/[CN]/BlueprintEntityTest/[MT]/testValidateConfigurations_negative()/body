{
  AmbariMetaInfo metaInfo=createMock(AmbariMetaInfo.class);
  Map<String,PropertyInfo> requiredProps=new HashMap<String,PropertyInfo>();
  PropertyInfo prop=new PropertyInfo();
  prop.setFilename("core-site.xml");
  prop.setName("super.secret.password");
  prop.setRequireInput(true);
  Set<PropertyInfo.PropertyType> propertyTypes=new HashSet<PropertyInfo.PropertyType>();
  propertyTypes.add(PropertyInfo.PropertyType.PASSWORD);
  prop.setPropertyTypes(propertyTypes);
  prop.setValue(null);
  PropertyInfo prop2=new PropertyInfo();
  prop2.setFilename("global.xml");
  prop2.setName("another.super.secret.password");
  prop2.setRequireInput(true);
  Set<PropertyInfo.PropertyType> propertyTypes2=new HashSet<PropertyInfo.PropertyType>();
  propertyTypes2.add(PropertyInfo.PropertyType.PASSWORD);
  prop2.setPropertyTypes(propertyTypes2);
  prop2.setValue(" ");
  requiredProps.put("super.secret.password",prop);
  requiredProps.put("another.super.secret.password",prop2);
  BlueprintEntity entity=new BlueprintEntity();
  entity.setStackName("stackName");
  entity.setStackVersion("version");
  Collection<BlueprintConfigEntity> configurations=new HashSet<BlueprintConfigEntity>();
  BlueprintConfigEntity configEntity=new BlueprintConfigEntity();
  configEntity.setBlueprintEntity(entity);
  configEntity.setBlueprintName("blueprint");
  configEntity.setType("core-site");
  Map<String,String> configData=new HashMap<String,String>();
  configData.put("foo","val1");
  configData.put("bar","val2");
  configData.put("some.other.secret.password","password");
  configEntity.setConfigData(new Gson().toJson(configData));
  configurations.add(configEntity);
  entity.setConfigurations(configurations);
  Collection<HostGroupEntity> hostGroupEntities=new HashSet<HostGroupEntity>();
  HostGroupEntity hostGroupEntity=new HostGroupEntity();
  hostGroupEntity.setName("hg1");
  Collection<HostGroupComponentEntity> hostGroupComponents=new HashSet<HostGroupComponentEntity>();
  HostGroupComponentEntity componentEntity=new HostGroupComponentEntity();
  componentEntity.setName("component1");
  componentEntity.setBlueprintName("blueprint");
  componentEntity.setHostGroupEntity(hostGroupEntity);
  componentEntity.setHostGroupName("hg1");
  hostGroupComponents.add(componentEntity);
  hostGroupEntity.setComponents(hostGroupComponents);
  hostGroupEntity.setConfigurations(Collections.<HostGroupConfigEntity>emptyList());
  hostGroupEntities.add(hostGroupEntity);
  entity.setHostGroups(hostGroupEntities);
  expect(metaInfo.getComponentToService("stackName","version","component1")).andReturn("service1");
  expect(metaInfo.getRequiredProperties("stackName","version","service1")).andReturn(requiredProps);
  replay(metaInfo);
  Map<String,Map<String,Collection<String>>> missingProps=entity.validateConfigurations(metaInfo,true);
  assertEquals(1,missingProps.size());
  Map<String,Collection<String>> typeProps=missingProps.get("hg1");
  assertEquals(2,typeProps.size());
  assertEquals(1,typeProps.get("global").size());
  assertEquals(1,typeProps.get("core-site").size());
  assertTrue(typeProps.get("core-site").contains("super.secret.password"));
  assertTrue(typeProps.get("global").contains("another.super.secret.password"));
  verify(metaInfo);
}
