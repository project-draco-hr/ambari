def setup_atlas_hive(configuration_directory=None):
    import params
    if params.has_atlas:
        if (configuration_directory is None):
            configuration_directory = format('{hive_config_dir}')
        if (not params.host_sys_prepped):
            Package((params.atlas_ubuntu_plugin_package if OSCheck.is_ubuntu_family() else params.atlas_plugin_package), retry_on_repo_unavailability=params.agent_stack_retry_on_unavailability, retry_count=params.agent_stack_retry_count)
        PropertiesFile(format('{configuration_directory}/{atlas_conf_file}'), properties=params.atlas_props, owner=params.hive_user, group=params.user_group, mode=420)
