def setup_usersync():
    import params
    Directory(params.ranger_pid_dir, mode=488, owner=params.unix_user, group=params.unix_group)
    Directory(params.usersync_log_dir, owner=params.unix_user, group=params.unix_group)
    XmlConfig('ranger-ugsync-site.xml', conf_dir=params.ranger_ugsync_conf, configurations=params.config['configurations']['ranger-ugsync-site'], configuration_attributes=params.config['configuration_attributes']['ranger-ugsync-site'], owner=params.unix_user, group=params.unix_group, mode=420)
    cred_lib = os.path.join(params.usersync_home, 'lib', '*')
    cred_setup = format('python {ranger_home}/ranger_credential_helper.py -l "{cred_lib}" -f {ugsync_jceks_path} -k "usersync.ssl.key.password" -v "{ranger_usersync_keystore_password!p}" -c 1')
    Execute(cred_setup, environment={'RANGER_ADMIN_HOME': params.ranger_home, 'JAVA_HOME': params.java_home, }, logoutput=True)
    cred_setup = format('python {ranger_home}/ranger_credential_helper.py -l "{cred_lib}" -f {ugsync_jceks_path} -k "ranger.usersync.ldap.bindalias" -v "{ranger_usersync_ldap_ldapbindpassword!p}" -c 1')
    Execute(cred_setup, environment={'RANGER_ADMIN_HOME': params.ranger_home, 'JAVA_HOME': params.java_home, }, logoutput=True)
    cred_setup = format('python {ranger_home}/ranger_credential_helper.py -l "{cred_lib}" -f {ugsync_jceks_path} -k "usersync.ssl.truststore.password" -v "{ranger_usersync_truststore_password!p}" -c 1')
    Execute(cred_setup, environment={'RANGER_ADMIN_HOME': params.ranger_home, 'JAVA_HOME': params.java_home, }, logoutput=True)
    File(params.ugsync_jceks_path, owner=params.unix_user, group=params.unix_group)
    File([params.usersync_start, params.usersync_stop], owner=params.unix_user, group=params.unix_group)
    File(params.usersync_services_file, mode=493)
    Execute(('ln', '-sf', format('{usersync_services_file}'), '/usr/bin/ranger-usersync'), not_if=format('ls /usr/bin/ranger-usersync'), only_if=format('ls {usersync_services_file}'), sudo=True)
    if (not os.path.isfile(params.ranger_usersync_keystore_file)):
        cmd = format("{java_home}/bin/keytool -genkeypair -keyalg RSA -alias selfsigned -keystore '{ranger_usersync_keystore_file}' -keypass '{ranger_usersync_keystore_password!p}' -storepass '{ranger_usersync_keystore_password!p}' -validity 3600 -keysize 2048 -dname '{default_dn_name}'")
        Execute(cmd, logoutput=True)
        File(params.ranger_usersync_keystore_file, owner=params.unix_user, group=params.unix_group)
