{
  URLStreamProvider streamProvider=createNiceMock(URLStreamProvider.class);
  HttpURLConnection urlConnection=createNiceMock(HttpURLConnection.class);
  InputStream inputStream=createNiceMock(InputStream.class);
  Map<String,String> headers=new HashMap<String,String>();
  headers.put("header","headerValue");
  Map<String,List<String>> headerMap=new HashMap<String,List<String>>();
  headerMap.put("header",Collections.singletonList("headerValue"));
  expect(streamProvider.processURL("spec","requestMethod","params",headerMap)).andReturn(urlConnection);
  expect(urlConnection.getInputStream()).andReturn(inputStream);
  replay(streamProvider,urlConnection,inputStream);
  ViewContextImpl.ViewURLStreamProvider viewURLStreamProvider=new ViewContextImpl.ViewURLStreamProvider(streamProvider);
  Assert.assertEquals(inputStream,viewURLStreamProvider.readFrom("spec","requestMethod","params",headers));
  verify(streamProvider,urlConnection,inputStream);
}
