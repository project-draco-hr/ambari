def test_hostname_override(self):
    tmpname = tempfile.mkstemp(text=True)[1]
    os.chmod(tmpname, (os.stat(tmpname).st_mode | stat.S_IXUSR))
    tmpfile = file(tmpname, 'w+')
    try:
        tmpfile.write("#!/bin/sh\n\necho 'test.example.com'")
        tmpfile.close()
        config = AmbariConfig().getConfig()
        config.set('agent', 'hostname_script', tmpname)
        self.assertEquals(hostname.hostname(), 'test.example.com', "expected hostname 'test.example.com'")
    finally:
        os.remove(tmpname)
    pass
