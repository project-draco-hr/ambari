{
  HdfsApi api=null;
  Thread.currentThread().setContextClassLoader(null);
  ConfigurationBuilder configurationBuilder=new ConfigurationBuilder(context);
  AuthConfigurationBuilder authConfigurationBuilder=new AuthConfigurationBuilder(context);
  Map<String,String> authParams=authConfigurationBuilder.build();
  configurationBuilder.setAuthParams(authParams);
  try {
    api=new HdfsApi(configurationBuilder,getHdfsUsername(context));
    LOG.info("HdfsApi connected OK");
  }
 catch (  IOException e) {
    String message="HDFS040 Couldn't open connection to HDFS";
    LOG.error(message);
    throw new HdfsApiException(message,e);
  }
catch (  InterruptedException e) {
    String message="HDFS041 Couldn't open connection to HDFS";
    LOG.error(message);
    throw new HdfsApiException(message,e);
  }
  return api;
}
