{
  checkLoaded();
  if (hosts.containsKey(hostname)) {
    throw new AmbariException(MessageFormat.format("Duplicate entry for Host {0}",hostname));
  }
  w.lock();
  try {
    HostEntity hostEntity=new HostEntity();
    hostEntity.setHostName(hostname);
    hostEntity.setClusterEntities(new ArrayList<ClusterEntity>());
    Host host=hostFactory.create(hostEntity,false);
    host.setAgentVersion(new AgentVersion(""));
    List<DiskInfo> emptyDiskList=new ArrayList<DiskInfo>();
    host.setDisksInfo(emptyDiskList);
    host.setHealthStatus(new HostHealthStatus(HealthStatus.UNKNOWN,""));
    host.setHostAttributes(new HashMap<String,String>());
    host.setState(HostState.INIT);
    hosts.put(hostname,host);
    hostClusterMap.put(hostname,Collections.newSetFromMap(new ConcurrentHashMap<Cluster,Boolean>()));
    if (LOG.isDebugEnabled()) {
      LOG.debug("Adding a host to Clusters" + ", hostname=" + hostname);
    }
  }
  finally {
    w.unlock();
  }
  HostRegisteredEvent event=new HostRegisteredEvent(hostname);
  eventPublisher.publish(event);
}
