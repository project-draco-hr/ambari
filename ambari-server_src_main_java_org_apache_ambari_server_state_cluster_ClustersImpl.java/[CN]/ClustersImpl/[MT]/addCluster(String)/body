{
  if (clusters.containsKey(clusterName)) {
    throw new AmbariException("Duplicate entry for Cluster" + ", clusterName= " + clusterName);
  }
  ClusterEntity clusterEntity=new ClusterEntity();
  clusterEntity.setClusterName(clusterName);
  clusterEntity.setDesiredStackVersion(gson.toJson(new StackId()));
  try {
    clusterDAO.create(clusterEntity);
    clusterEntity=clusterDAO.merge(clusterEntity);
    Cluster cluster=clusterFactory.create(clusterEntity);
    clusters.put(clusterName,cluster);
    clustersById.put(cluster.getClusterId(),cluster);
    clusterHostMap.put(clusterName,new HashSet<Host>());
  }
 catch (  RollbackException e) {
    LOG.warn("Unable to create cluster " + clusterName,e);
    throw new AmbariException("Unable to create cluster " + clusterName,e);
  }
}
