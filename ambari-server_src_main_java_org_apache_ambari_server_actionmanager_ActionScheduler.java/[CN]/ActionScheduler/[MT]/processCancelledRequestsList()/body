{
synchronized (requestsToBeCancelled) {
    for (    Long requestId : requestsToBeCancelled) {
      List<HostRoleCommand> tasksToDequeue=db.getRequestTasks(requestId);
      String reason=requestCancelReasons.get(requestId);
      cancelHostRoleCommands(tasksToDequeue,reason);
      List<Stage> stages=db.getAllStages(requestId);
      for (      Stage stage : stages) {
        abortOperationsForStage(stage);
      }
    }
    requestsToBeCancelled.clear();
    requestCancelReasons.clear();
  }
}
