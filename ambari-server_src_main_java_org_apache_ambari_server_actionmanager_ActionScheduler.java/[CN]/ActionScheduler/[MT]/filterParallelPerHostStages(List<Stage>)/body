{
  List<Stage> retVal=new ArrayList<Stage>();
  Set<String> affectedHosts=new HashSet<String>();
  for (  Stage s : stages) {
    for (    String host : s.getHosts()) {
      if (!affectedHosts.contains(host)) {
        if (!isStageHasBackgroundCommandsOnly(s,host)) {
          affectedHosts.add(host);
        }
        retVal.add(s);
      }
    }
  }
  return retVal;
}
