{
  ClusterDAO clusterDAO=injector.getInstance(ClusterDAO.class);
  List<Long> clusterIds=new ArrayList<Long>();
  List<ClusterEntity> clusterEntities=clusterDAO.findAll();
  if (clusterEntities != null && !clusterEntities.isEmpty()) {
    for (    ClusterEntity entity : clusterEntities) {
      clusterIds.add(entity.getClusterId());
      String stackIdString=entity.getDesiredStackVersion();
      entity.setDesiredStackVersion(getStackIdString(stackIdString,stackName,stackVersion));
      clusterDAO.merge(entity);
    }
  }
  ClusterStateDAO clusterStateDAO=injector.getInstance(ClusterStateDAO.class);
  for (  Long clusterId : clusterIds) {
    ClusterStateEntity clusterStateEntity=clusterStateDAO.findByPK(clusterId);
    String currentStackVersion=clusterStateEntity.getCurrentStackVersion();
    clusterStateEntity.setCurrentStackVersion(getStackIdString(currentStackVersion,stackName,stackVersion));
    clusterStateDAO.merge(clusterStateEntity);
  }
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  List<HostComponentStateEntity> hcEntities=hostComponentStateDAO.findAll();
  if (hcEntities != null) {
    for (    HostComponentStateEntity hc : hcEntities) {
      String currentStackVersion=hc.getCurrentStackVersion();
      hc.setCurrentStackVersion(getStackIdString(currentStackVersion,stackName,stackVersion));
      hostComponentStateDAO.merge(hc);
    }
  }
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  List<HostComponentDesiredStateEntity> hcdEntities=hostComponentDesiredStateDAO.findAll();
  if (hcdEntities != null) {
    for (    HostComponentDesiredStateEntity hcd : hcdEntities) {
      String desiredStackVersion=hcd.getDesiredStackVersion();
      hcd.setDesiredStackVersion(getStackIdString(desiredStackVersion,stackName,stackVersion));
      hostComponentDesiredStateDAO.merge(hcd);
    }
  }
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  List<ServiceComponentDesiredStateEntity> scdEntities=serviceComponentDesiredStateDAO.findAll();
  if (scdEntities != null) {
    for (    ServiceComponentDesiredStateEntity scd : scdEntities) {
      String desiredStackVersion=scd.getDesiredStackVersion();
      scd.setDesiredStackVersion(getStackIdString(desiredStackVersion,stackName,stackVersion));
      serviceComponentDesiredStateDAO.merge(scd);
    }
  }
  ServiceDesiredStateDAO serviceDesiredStateDAO=injector.getInstance(ServiceDesiredStateDAO.class);
  List<ServiceDesiredStateEntity> sdEntities=serviceDesiredStateDAO.findAll();
  if (sdEntities != null) {
    for (    ServiceDesiredStateEntity sd : sdEntities) {
      String desiredStackVersion=sd.getDesiredStackVersion();
      sd.setDesiredStackVersion(getStackIdString(desiredStackVersion,stackName,stackVersion));
      serviceDesiredStateDAO.merge(sd);
    }
  }
}
