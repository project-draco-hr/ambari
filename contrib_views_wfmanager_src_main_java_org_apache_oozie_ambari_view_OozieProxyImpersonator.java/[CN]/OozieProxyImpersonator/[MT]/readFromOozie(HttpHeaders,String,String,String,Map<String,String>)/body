{
  URLStreamProvider streamProvider=viewContext.getURLStreamProvider();
  Map<String,String> newHeaders=getHeaders(headers);
  newHeaders.put(USER_NAME_HEADER,USER_OOZIE_SUPER);
  newHeaders.put(DO_AS_HEADER,viewContext.getUsername());
  newHeaders.put("Accept",MediaType.APPLICATION_JSON);
  if (customHeaders != null) {
    newHeaders.putAll(customHeaders);
  }
  LOGGER.info(String.format("Proxy request for url: [%s] %s",method,urlToRead));
  boolean securityEnabled=isSecurityEnabled();
  LOGGER.debug(String.format("IS security enabled:[%b]",securityEnabled));
  InputStream stream=null;
  try {
    if (securityEnabled) {
      stream=streamProvider.readAsCurrent(urlToRead,method,body,newHeaders);
    }
 else {
      stream=streamProvider.readFrom(urlToRead,method,body,newHeaders);
    }
  }
 catch (  IOException e) {
    LOGGER.error("error talking to oozie",e);
    throw new RuntimeException(e);
  }
  return stream;
}
