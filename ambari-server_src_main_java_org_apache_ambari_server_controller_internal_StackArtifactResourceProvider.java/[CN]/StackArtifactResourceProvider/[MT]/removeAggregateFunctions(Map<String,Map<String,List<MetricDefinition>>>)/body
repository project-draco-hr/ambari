{
  Map<String,Map<String,List<MetricDefinition>>> filteredServiceMetrics=null;
  if (serviceMetrics != null) {
    Cloner cloner=new Cloner();
    filteredServiceMetrics=cloner.deepClone(serviceMetrics);
    for (    Map<String,List<MetricDefinition>> componentMetricDef : filteredServiceMetrics.values()) {
      for (      Map.Entry<String,List<MetricDefinition>> metricDefEntry : componentMetricDef.entrySet()) {
        for (        MetricDefinition metricDefinition : metricDefEntry.getValue()) {
          if (metricDefinition.getType().equals("ganglia")) {
            for (            Map<String,Metric> metricByCategory : metricDefinition.getMetricsByCategory().values()) {
              Iterator<Map.Entry<String,Metric>> iterator=metricByCategory.entrySet().iterator();
              while (iterator.hasNext()) {
                Map.Entry<String,Metric> entry=iterator.next();
                String metricName=entry.getKey();
                if (PropertyHelper.hasAggregateFunctionSuffix(metricName)) {
                  iterator.remove();
                }
              }
            }
          }
        }
      }
    }
  }
  return filteredServiceMetrics;
}
