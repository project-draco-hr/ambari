{
  Set<Resource> resources=new HashSet<Resource>();
  for (  Map<String,Object> properties : getPropertyMaps(predicate)) {
    String artifactName=(String)properties.get(ARTIFACT_NAME_PROPERTY_ID);
    if (artifactName == null || artifactName.equals(THEME_ARTIFACT_NAME)) {
      String stackName=(String)properties.get(STACK_NAME_PROPERTY_ID);
      String stackVersion=(String)properties.get(STACK_VERSION_PROPERTY_ID);
      String stackService=(String)properties.get(STACK_SERVICE_NAME_PROPERTY_ID);
      StackInfo stackInfo;
      try {
        stackInfo=getManagementController().getAmbariMetaInfo().getStack(stackName,stackVersion);
      }
 catch (      AmbariException e) {
        throw new NoSuchParentResourceException(String.format("Parent stack resource doesn't exist: stackName='%s', stackVersion='%s'",stackName,stackVersion));
      }
      List<ServiceInfo> serviceInfoList=new ArrayList<ServiceInfo>();
      if (stackService == null) {
        serviceInfoList.addAll(stackInfo.getServices());
      }
 else {
        ServiceInfo service=stackInfo.getService(stackService);
        if (service == null) {
          throw new NoSuchParentResourceException(String.format("Parent stack/service resource doesn't exist: stackName='%s', stackVersion='%s', serviceName='%s'",stackName,stackVersion,stackService));
        }
        serviceInfoList.add(service);
      }
      for (      ServiceInfo serviceInfo : serviceInfoList) {
        ThemeInfo themeInfo=serviceInfo.getThemeInfo();
        LOG.info("Theme for stackName={}, stackVersion={}, serviceName={}, themeInfo={}",stackName,stackVersion,stackService,themeInfo);
        if (themeInfo != null) {
          Map<String,Object> themeMap=serviceInfo.getThemeInfo().getThemeMap();
          if (themeMap != null) {
            Resource resource=new ResourceImpl(Resource.Type.StackArtifact);
            Set<String> requestedIds=getRequestPropertyIds(request,predicate);
            setResourceProperty(resource,ARTIFACT_NAME_PROPERTY_ID,THEME_ARTIFACT_NAME,requestedIds);
            setResourceProperty(resource,ARTIFACT_DATA_PROPERTY_ID,themeMap,requestedIds);
            setResourceProperty(resource,STACK_NAME_PROPERTY_ID,stackName,requestedIds);
            setResourceProperty(resource,STACK_VERSION_PROPERTY_ID,stackVersion,requestedIds);
            setResourceProperty(resource,STACK_SERVICE_NAME_PROPERTY_ID,serviceInfo.getName(),requestedIds);
            resources.add(resource);
          }
        }
      }
    }
  }
  return resources;
}
