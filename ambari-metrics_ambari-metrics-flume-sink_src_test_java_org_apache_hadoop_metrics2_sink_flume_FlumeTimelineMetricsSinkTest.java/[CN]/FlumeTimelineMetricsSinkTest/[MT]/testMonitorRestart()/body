{
  FlumeTimelineMetricsSink flumeTimelineMetricsSink=new FlumeTimelineMetricsSink();
  TimelineMetricsCache timelineMetricsCache=getTimelineMetricsCache(flumeTimelineMetricsSink);
  flumeTimelineMetricsSink.setPollFrequency(1);
  HttpClient httpClient=EasyMock.createNiceMock(HttpClient.class);
  flumeTimelineMetricsSink.setHttpClient(httpClient);
  mockStatic(JMXPollUtil.class);
  EasyMock.expect(JMXPollUtil.getAllMBeans()).andReturn(Collections.singletonMap("component1",Collections.singletonMap("key1","42"))).once();
  flumeTimelineMetricsSink.start();
  flumeTimelineMetricsSink.stop();
  replay(JMXPollUtil.class,timelineMetricsCache,httpClient);
  flumeTimelineMetricsSink.start();
  Thread.sleep(5);
  flumeTimelineMetricsSink.stop();
  verifyAll();
}
