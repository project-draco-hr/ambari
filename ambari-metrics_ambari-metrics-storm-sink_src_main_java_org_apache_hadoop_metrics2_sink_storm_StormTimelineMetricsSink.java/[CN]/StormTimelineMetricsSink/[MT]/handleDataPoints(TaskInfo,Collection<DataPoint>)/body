{
  List<TimelineMetric> metricList=new ArrayList<TimelineMetric>();
  for (  DataPoint dataPoint : dataPoints) {
    if (dataPoint.value != null && NumberUtils.isNumber(dataPoint.value.toString())) {
      LOG.debug(dataPoint.name + " = " + dataPoint.value);
      TimelineMetric timelineMetric=createTimelineMetric(taskInfo.timestamp,taskInfo.srcComponentId,dataPoint.name,dataPoint.value.toString());
      metricsCache.putTimelineMetric(timelineMetric);
      TimelineMetric cachedMetric=metricsCache.getTimelineMetric(dataPoint.name);
      if (cachedMetric != null) {
        metricList.add(cachedMetric);
      }
    }
  }
  if (!metricList.isEmpty()) {
    TimelineMetrics timelineMetrics=new TimelineMetrics();
    timelineMetrics.setMetrics(metricList);
    try {
      emitMetrics(timelineMetrics);
    }
 catch (    UnableToConnectException uce) {
      LOG.warn("Unable to send metrics to collector by address:" + uce.getConnectUrl());
    }
catch (    IOException e) {
      LOG.error("Unexpected error",e);
    }
  }
}
