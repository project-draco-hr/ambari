{
  requestId=stageEntity.getRequestId();
  stageId=stageEntity.getStageId();
  logDir=stageEntity.getLogInfo();
  long clusterId=stageEntity.getClusterId().longValue();
  if (-1L != clusterId) {
    try {
      clusterName=clusters.getClusterById(clusterId).getClusterName();
    }
 catch (    Exception e) {
      String message=String.format("Could not load cluster with id %s",Long.valueOf(clusterId));
      LOG.error(message);
      throw new RuntimeException(message,e);
    }
  }
  requestContext=stageEntity.getRequestContext();
  clusterHostInfo=stageEntity.getClusterHostInfo();
  List<Long> taskIds=hostRoleCommandDAO.findTaskIdsByStage(requestId,stageId);
  Collection<HostRoleCommand> commands=dbAccessor.getTasks(taskIds);
  for (  HostRoleCommand command : commands) {
    String hostname=command.getHostName();
    if (!hostRoleCommands.containsKey(hostname)) {
      hostRoleCommands.put(hostname,new LinkedHashMap<String,HostRoleCommand>());
    }
    hostRoleCommands.get(hostname).put(command.getRole().toString(),command);
  }
  for (  RoleSuccessCriteriaEntity successCriteriaEntity : stageEntity.getRoleSuccessCriterias()) {
    successFactors.put(successCriteriaEntity.getRole(),successCriteriaEntity.getSuccessFactor().floatValue());
  }
}
