{
  Set<Resource> resources;
  ResourceProvider provider=ensureResourceProvider(type);
  ensurePropertyProviders(type);
  if (provider == null) {
    resources=Collections.emptySet();
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Using resource provider " + provider.getClass().getName() + " for request type "+ type.toString());
    }
    checkProperties(type,request,predicate);
    resources=provider.getResources(request,predicate);
    Iterable<Resource> resourceIterable=resources;
    if ((pageRequest != null) || (sortRequest != null)) {
      PageResponse page=getPage(type,resources,request,predicate,pageRequest,sortRequest);
      resourceIterable=page.getIterable();
    }
    for (    Resource resource : resourceIterable) {
      resource.setPopulateRequiredFlag(true);
    }
  }
  return resources;
}
