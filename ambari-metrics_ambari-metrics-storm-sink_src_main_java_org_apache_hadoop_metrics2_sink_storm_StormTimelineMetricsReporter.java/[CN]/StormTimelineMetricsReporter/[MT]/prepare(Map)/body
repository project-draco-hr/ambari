{
  LOG.info("Preparing Storm Metrics Reporter");
  try {
    try {
      hostname=InetAddress.getLocalHost().getHostName();
      if ((hostname == null) || (!hostname.contains("."))) {
        hostname=InetAddress.getLocalHost().getCanonicalHostName();
      }
    }
 catch (    UnknownHostException e) {
      LOG.error("Could not identify hostname.");
      throw new RuntimeException("Could not identify hostname.",e);
    }
    Validate.notNull(conf.get(METRICS_COLLECTOR),METRICS_COLLECTOR + " can not be null");
    Map cf=(Map)conf.get(METRICS_COLLECTOR);
    Map stormConf=Utils.readStormConfig();
    this.nimbusClient=NimbusClient.getConfiguredClient(stormConf);
    String collectorHostname=cf.get(COLLECTOR_HOST).toString();
    String port=cf.get(COLLECTOR_PORT).toString();
    timeoutSeconds=cf.get(METRICS_POST_TIMEOUT_SECONDS) != null ? Integer.parseInt(cf.get(METRICS_POST_TIMEOUT_SECONDS).toString()) : DEFAULT_POST_TIMEOUT_SECONDS;
    applicationId=cf.get(APP_ID).toString();
    collectorUri="http://" + collectorHostname + ":"+ port+ "/ws/v1/timeline/metrics";
  }
 catch (  Exception e) {
    LOG.warn("Could not initialize metrics collector, please specify host, " + "port under $STORM_HOME/conf/config.yaml ",e);
  }
}
