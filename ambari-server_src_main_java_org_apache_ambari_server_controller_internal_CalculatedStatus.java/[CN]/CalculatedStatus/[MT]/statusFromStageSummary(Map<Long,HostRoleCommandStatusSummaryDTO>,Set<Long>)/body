{
  Collection<HostRoleStatus> stageStatuses=new HashSet<HostRoleStatus>();
  Collection<HostRoleStatus> taskStatuses=new ArrayList<HostRoleStatus>();
  for (  Long stageId : stageIds) {
    if (!stageDto.containsKey(stageId)) {
      continue;
    }
    HostRoleCommandStatusSummaryDTO summary=stageDto.get(stageId);
    HostRoleStatus stageStatus=calculateSummaryStatus(summary.getCounts(),summary.getTaskTotal(),summary.isStageSkippable());
    stageStatuses.add(stageStatus);
    taskStatuses.addAll(summary.getTaskStatuses());
  }
  HostRoleStatus status=calculateSummaryStatus(calculateStatusCounts(stageStatuses),stageStatuses.size(),false);
  double progressPercent=calculateProgressPercent(calculateStatusCounts(taskStatuses),taskStatuses.size());
  return new CalculatedStatus(status,progressPercent);
}
