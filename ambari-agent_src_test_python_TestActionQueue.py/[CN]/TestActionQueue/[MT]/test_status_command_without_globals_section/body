@patch.object(StackVersionsFileHandler, 'read_stack_version')
@patch.object(ActionQueue, 'stopped')
def test_status_command_without_globals_section(self, stopped_method, read_stack_version_method):
    config = AmbariConfig().getConfig()
    config.set('agent', 'prefix', TestStackVersionsFileHandler.dummyVersionsFile)
    queue = ActionQueue(config)
    statusCommand = {'serviceName': 'HDFS', 'commandType': 'STATUS_COMMAND', 'clusterName': '', 'componentName': 'DATANODE', 'configurations': {}, }
    queue.stopped = stopped_method
    stopped_method.side_effect = [False, False, True, True, True]
    read_stack_version_method.return_value = '1.3.0'
    queue.IDLE_SLEEP_TIME = 0.001
    queue.put(statusCommand)
    queue.run()
    returned_result = queue.resultQueue.get()
    returned_result[1]['status'] = 'INSTALLED'
    self.assertEquals(returned_result, ('STATUS_COMMAND', {'clusterName': '', 'componentName': 'DATANODE', 'msg': '', 'serviceName': 'HDFS', 'stackVersion': '1.3.0', 'status': 'INSTALLED', }))
