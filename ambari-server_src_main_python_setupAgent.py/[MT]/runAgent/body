def runAgent(passPhrase, expected_hostname, user_run_as, verbose):
    os.environ[AMBARI_PASSPHRASE_VAR] = passPhrase
    vo = ''
    if verbose:
        vo = ' -v'
    cmd = "su - {0} -c '/usr/sbin/ambari-agent restart --expected-hostname={1} {2}'".format(user_run_as, expected_hostname, vo)
    agent_retcode = subprocess.call(cmd, shell=True)
    for i in range(3):
        time.sleep(1)
        ret = execOsCommand(['tail', '-20', '/var/log/ambari-agent/ambari-agent.log'])
        if ((not (ret is None)) and (0 == ret['exitstatus'])):
            try:
                log = ret['log']
            except Exception:
                log = 'Log not found'
            print log
            return agent_retcode
    return agent_retcode
