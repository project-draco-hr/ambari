def runAgent(passPhrase, expected_hostname):
    os.environ[AMBARI_PASSPHRASE_VAR] = passPhrase
    agent_retcode = subprocess.call(('/usr/sbin/ambari-agent restart --expected-hostname=' + expected_hostname), shell=True)
    time.sleep(1)
    try:
        ret = execOsCommand(['tail', '-20', '/var/log/ambari-agent/ambari-agent.log'])
        try:
            log = ret['log']
        except Exception:
            log = 'Log not found'
        print log
        if (not (0 == ret['exitstatus'])):
            return ret['exitstatus']
        return agent_retcode
    except Exception as e:
        return 1
