def runAgent(passPhrase, expected_hostname, user_run_as, verbose):
    os.environ[AMBARI_PASSPHRASE_VAR] = passPhrase
    vo = ''
    if verbose:
        vo = ' -v'
    cmd = ("su - %1s -c '/usr/sbin/ambari-agent restart --expected-hostname=%2s %3s'" % (user_run_as, expected_hostname, vo))
    log = ''
    p = subprocess.Popen(cmd, stdout=subprocess.PIPE, shell=True)
    p.communicate()
    agent_retcode = p.returncode
    for i in range(3):
        time.sleep(1)
        ret = execOsCommand(['tail', '-20', '/var/log/ambari-agent/ambari-agent.log'])
        if (0 == ret['exitstatus']):
            try:
                log = ret['log']
            except Exception:
                log = 'Log not found'
            print log
            break
    return {'exitstatus': agent_retcode, 'log': log, }
