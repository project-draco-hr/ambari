def runAgent(passPhrase, expected_hostname):
    os.environ[AMBARI_PASSPHRASE_VAR] = passPhrase
    agent_retcode = subprocess.call('/usr/sbin/ambari-agent start --expected-hostname={0}'.format(expected_hostname), shell=True)
    try:
        ret = execOsCommand(['tail', '-20', '/var/log/ambari-agent/ambari-agent.log'])
        try:
            print ret['log']
        except KeyError:
            pass
        if (not (0 == ret['exitstatus'])):
            return ret['exitstatus']
        return agent_retcode
    except Exception as e:
        return 1
