def main(argv=None):
    scriptDir = os.path.realpath(os.path.dirname(argv[0]))
    onlyargs = argv[1:]
    expected_hostname = onlyargs[0]
    passPhrase = onlyargs[1]
    hostname = onlyargs[2]
    projectVersion = None
    server_port = 8080
    if (len(onlyargs) > 3):
        projectVersion = onlyargs[3]
    if (len(onlyargs) > 4):
        server_port = onlyargs[4]
    try:
        server_port = int(server_port)
    except Exception as e:
        server_port = 8080
    checkServerReachability(hostname, server_port)
    if ((projectVersion is None) or (projectVersion == 'null')):
        projectVersion = getOptimalVersion('')
    elif ((projectVersion != '') and (projectVersion != '{ambariVersion}')):
        projectVersion = ('-' + projectVersion)
    elif (projectVersion == '{ambariVersion}'):
        projectVersion = ''
    if is_suse():
        ret = installAgentSuse(projectVersion)
        if (not (ret['exitstatus'] == 0)):
            sys.exit(ret)
    else:
        ret = installAgent(projectVersion)
        if (not (ret['exitstatus'] == 0)):
            sys.exit(ret)
    configureAgent(hostname)
    sys.exit(runAgent(passPhrase, expected_hostname))
