def _create_agent_symlink(symlinkPath, agentInstallDir, ret):
    ret = _ret_init(ret)
    symLinkCreationAttempts = 0
    while (symLinkCreationAttempts < 1000):
        try:
            os.rmdir(symlinkPath)
        except OSError:
            pass
        try:
            os.symlink(agentInstallDir, symlinkPath)
            if (os.readlink(symlinkPath) == agentInstallDir):
                break
        except OSError:
            pass
        symLinkCreationAttempts += 1
    if (symLinkCreationAttempts == 1000):
        _ret_merge(ret, 1000, '', 'Failed creating the symbolic link {0} because of contention.'.format(AMBARI_AGENT_INSTALL_SYMLINK))
    return ret
