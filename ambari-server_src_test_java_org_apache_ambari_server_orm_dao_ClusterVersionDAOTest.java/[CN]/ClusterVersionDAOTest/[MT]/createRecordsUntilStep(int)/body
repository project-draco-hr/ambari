{
  if (currStep >= 1 && lastStep <= 0) {
    clusterId=helper.createCluster();
    cluster=clusterDAO.findById(clusterId);
    cvA=new ClusterVersionEntity(cluster,"HDP","2.2.0.0-995",ClusterVersionState.CURRENT,System.currentTimeMillis(),System.currentTimeMillis(),"admin");
    clusterVersionDAO.create(cvA);
    cvAId=cvA.getId();
  }
 else {
    cluster=clusterDAO.findById(clusterId);
    cvA=clusterVersionDAO.findByPK(cvAId);
  }
  if (currStep >= 2) {
    if (lastStep <= 1) {
      cvB=new ClusterVersionEntity(cluster,"HDP","2.2.0.1-998",ClusterVersionState.INSTALLED,System.currentTimeMillis(),System.currentTimeMillis(),"admin");
      clusterVersionDAO.create(cvB);
      cvBId=cvB.getId();
    }
 else {
      cvB=clusterVersionDAO.findByPK(cvBId);
    }
  }
  if (currStep >= 3 && lastStep <= 2) {
    cvA.setState(ClusterVersionState.INSTALLED);
    cvB.setState(ClusterVersionState.CURRENT);
    clusterVersionDAO.merge(cvA);
    clusterVersionDAO.merge(cvB);
  }
  if (currStep >= 4) {
    if (lastStep <= 3) {
      cvC=new ClusterVersionEntity(cluster,"HDP","2.2.1.0-100",ClusterVersionState.UPGRADING,System.currentTimeMillis(),"admin");
      clusterVersionDAO.create(cvC);
      cvCId=cvC.getId();
    }
 else {
      cvC=clusterVersionDAO.findByPK(cvCId);
    }
  }
  if (currStep >= 5 && lastStep <= 4) {
    cvC.setState(ClusterVersionState.UPGRADE_FAILED);
    cvC.setEndTime(System.currentTimeMillis());
    clusterVersionDAO.merge(cvC);
  }
  if (currStep >= 6 && lastStep <= 5) {
    cvC.setState(ClusterVersionState.UPGRADING);
    cvC.setEndTime(0L);
    clusterVersionDAO.merge(cvC);
  }
  if (currStep >= 7 && lastStep <= 6) {
    cvC.setState(ClusterVersionState.CURRENT);
    cvC.setEndTime(System.currentTimeMillis());
    clusterVersionDAO.merge(cvC);
    cvA.setState(ClusterVersionState.INSTALLED);
    cvB.setState(ClusterVersionState.INSTALLED);
    clusterVersionDAO.merge(cvA);
    clusterVersionDAO.merge(cvB);
  }
  this.lastStep=currStep;
}
