{
  createRecordsUntilStep(1);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(2);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(3);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(4);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(5);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(6);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
  createRecordsUntilStep(7);
  Assert.assertEquals(1,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.CURRENT).size());
  Assert.assertEquals(2,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.INSTALLED).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADING).size());
  Assert.assertEquals(0,clusterVersionDAO.findByClusterAndState(cluster.getClusterName(),ClusterVersionState.UPGRADE_FAILED).size());
}
