{
  if (LOG.isDebugEnabled()) {
    LOG.debug("readFrom spec:" + spec);
  }
  HttpURLConnection connection=spec.startsWith("https") ? (HttpURLConnection)getSSLConnection(spec) : (HttpURLConnection)getConnection(spec);
  String appCookie=appCookieManager.getCachedAppCookie(spec);
  if (appCookie != null) {
    LOG.debug("Using cached app cookie for URL:" + spec);
    connection.setRequestProperty(COOKIE,appCookie);
  }
  connection.setConnectTimeout(connTimeout);
  connection.setReadTimeout(readTimeout);
  connection.setDoOutput(true);
  connection.setRequestMethod(requestMethod);
  if (headers != null) {
    for (    Map.Entry<String,List<String>> entry : headers.entrySet()) {
      String paramValue=entry.getValue().toString();
      connection.setRequestProperty(entry.getKey(),paramValue.substring(1,paramValue.length() - 1));
    }
  }
  if (params != null) {
    byte[] info;
    if (params instanceof InputStream) {
      info=IOUtils.toByteArray((InputStream)params);
    }
 else {
      info=((String)params).getBytes();
    }
    connection.getOutputStream().write(info);
  }
  int statusCode=connection.getResponseCode();
  if (statusCode == HttpStatus.SC_UNAUTHORIZED) {
    String wwwAuthHeader=connection.getHeaderField(WWW_AUTHENTICATE);
    if (LOG.isInfoEnabled()) {
      LOG.info("Received WWW-Authentication header:" + wwwAuthHeader + ", for URL:"+ spec);
    }
    if (wwwAuthHeader != null && wwwAuthHeader.trim().startsWith(NEGOTIATE)) {
      connection=spec.startsWith("https") ? (HttpURLConnection)getSSLConnection(spec) : (HttpURLConnection)getConnection(spec);
      appCookie=appCookieManager.getAppCookie(spec,true);
      connection.setRequestProperty(COOKIE,appCookie);
      connection.setConnectTimeout(connTimeout);
      connection.setReadTimeout(readTimeout);
      connection.setDoOutput(true);
      return connection;
    }
 else {
      LOG.error("Unsupported WWW-Authentication header:" + wwwAuthHeader + ", for URL:"+ spec);
      return connection;
    }
  }
 else {
    return connection;
  }
}
