{
  populateActionDB(db,hostName);
  Stage stage=db.getAction(StageUtils.getActionId(requestId,stageId));
  assertEquals(HostRoleStatus.PENDING,stage.getHostRoleStatus(hostName,Role.HBASE_MASTER.toString()));
  List<HostRoleCommandEntity> entities=hostRoleCommandDAO.findByHostRole(hostName,requestId,stageId,Role.HBASE_MASTER);
  assertEquals(HostRoleStatus.PENDING,entities.get(0).getStatus());
  stage.setHostRoleStatus(hostName,Role.HBASE_MASTER.toString(),HostRoleStatus.QUEUED);
  entities=hostRoleCommandDAO.findByHostRole(hostName,requestId,stageId,Role.HBASE_MASTER);
  assertEquals(HostRoleStatus.QUEUED,stage.getHostRoleStatus(hostName,Role.HBASE_MASTER.toString()));
  assertEquals(HostRoleStatus.PENDING,entities.get(0).getStatus());
  db.hostRoleScheduled(stage,hostName,Role.HBASE_MASTER.toString());
  entities=hostRoleCommandDAO.findByHostRole(hostName,requestId,stageId,Role.HBASE_MASTER);
  assertEquals(HostRoleStatus.QUEUED,entities.get(0).getStatus());
}
