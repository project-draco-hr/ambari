@patch.object(ambari_server, 'get_master_key_ispersisted')
@patch.object(ambari_server, 'update_properties')
@patch.object(ambari_server, 'save_master_key')
@patch.object(ambari_server, 'get_validated_string_input')
@patch.object(ambari_server, 'get_YN_input')
@patch.object(ambari_server, 'get_ambari_properties')
@patch.object(ambari_server, 'search_file')
def test_setup_master_key_already_persisted(self, search_file_message, get_ambari_properties_method, get_YN_input_method, get_validated_string_input_method, save_master_key_method, update_properties_method, get_master_key_ispersisted_method):
    out = StringIO.StringIO()
    sys.stdout = out
    configs = {ambari_server.SECURITY_MASTER_KEY_LOCATION: 'filepath', ambari_server.SECURITY_KEYS_DIR: tempfile.gettempdir(), ambari_server.SECURITY_KEY_IS_PERSISTED: 'true', }
    get_ambari_properties_method.return_value = configs
    get_master_key_ispersisted_method.return_value = True
    search_file_message.return_value = 'filepath'
    ambari_server.setup_master_key(False)
    self.assertFalse(save_master_key_method.called)
    self.assertFalse(get_YN_input_method.called)
    self.assertFalse(get_validated_string_input_method.called)
    self.assertFalse(update_properties_method.called)
    sys.stdout = sys.__stdout__
