{
  final PrintWriter spoolWriter=mock(PrintWriter.class);
  spoolWriter.println("log event");
  spoolWriter.flush();
  spoolWriter.close();
  File spoolFile=new File(spoolDirectory,SOURCE_FILENAME_PREFIX + FILE_SUFFIX);
  LogSpoolerContext logSpoolerContext=new LogSpoolerContext(spoolFile);
  expect(rolloverCondition.shouldRollover(cmp(logSpoolerContext,new LogSpoolerFileComparator(),LogicalOperator.EQUAL))).andReturn(true);
  rolloverHandler.handleRollover(spoolFile);
  replay(spoolWriter,rolloverCondition,rolloverHandler);
  LogSpooler logSpooler=new LogSpooler(spoolDirectory,SOURCE_FILENAME_PREFIX,rolloverCondition,rolloverHandler){
    @Override protected PrintWriter initializeSpoolWriter(    File spoolFile) throws IOException {
      return spoolWriter;
    }
    @Override protected String getCurrentFileName(){
      return SOURCE_FILENAME_PREFIX + FILE_SUFFIX;
    }
  }
;
  logSpooler.add("log event");
  verify(spoolWriter);
}
