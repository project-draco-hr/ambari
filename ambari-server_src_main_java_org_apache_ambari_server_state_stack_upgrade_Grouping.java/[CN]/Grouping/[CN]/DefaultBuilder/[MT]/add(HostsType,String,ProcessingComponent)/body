{
  if (null != pc.preTasks && pc.preTasks.size() > 0) {
    List<TaskWrapper> preTasks=TaskWrapperBuilder.getTaskList(service,pc.name,hostsType,pc.preTasks);
    Set<String> preTasksEffectiveHosts=TaskWrapperBuilder.getEffectiveHosts(preTasks);
    StageWrapper stage=new StageWrapper(StageWrapper.Type.RU_TASKS,getStageText("Preparing",pc.name,preTasksEffectiveHosts),preTasks);
    stages.add(stage);
  }
  if (null != pc.tasks && 1 == pc.tasks.size()) {
    Task t=pc.tasks.get(0);
    if (RestartTask.class.isInstance(t)) {
      for (      String hostName : hostsType.hosts) {
        StageWrapper stage=new StageWrapper(StageWrapper.Type.RESTART,getStageText("Restarting",pc.name,Collections.singleton(hostName)),new TaskWrapper(service,pc.name,Collections.singleton(hostName),t));
        stages.add(stage);
      }
    }
  }
  if (null != pc.postTasks && pc.postTasks.size() > 0) {
    List<TaskWrapper> postTasks=TaskWrapperBuilder.getTaskList(service,pc.name,hostsType,pc.postTasks);
    Set<String> postTasksEffectiveHosts=TaskWrapperBuilder.getEffectiveHosts(postTasks);
    StageWrapper stage=new StageWrapper(StageWrapper.Type.RU_TASKS,getStageText("Completing",pc.name,postTasksEffectiveHosts),postTasks);
    stages.add(stage);
  }
  serviceChecks.add(service);
}
