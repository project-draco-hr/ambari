{
  MockSnmpDispatcher dispatcher=new MockSnmpDispatcher();
  List<AlertNoticeEntity> notices=getSingleMockNotice(dispatcher.getType());
  AlertNoticeEntity notice=notices.get(0);
  EasyMock.expect(m_dao.findPendingNotices()).andReturn(getSnmpMockNotices()).once();
  EasyMock.expect(m_dao.merge(notice)).andReturn(notice).atLeastOnce();
  EasyMock.expect(m_dispatchFactory.getDispatcher("SNMP")).andReturn(dispatcher).atLeastOnce();
  EasyMock.replay(m_dao,m_dispatchFactory);
  AlertNoticeDispatchService service=m_injector.getInstance(AlertNoticeDispatchService.class);
  service.startUp();
  service.setExecutor(new MockExecutor());
  service.runOneIteration();
  EasyMock.verify(m_dao,m_dispatchFactory);
  List<Notification> notifications=dispatcher.getNotifications();
  assertEquals(2,notifications.size());
}
