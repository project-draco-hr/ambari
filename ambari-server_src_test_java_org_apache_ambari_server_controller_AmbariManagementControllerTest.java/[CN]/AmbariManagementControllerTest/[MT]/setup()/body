{
  InMemoryDefaultTestModule module=new InMemoryDefaultTestModule();
  backingProperties=module.getProperties();
  injector=Guice.createInjector(module);
  injector.getInstance(GuiceJpaInitializer.class);
  entityManager=injector.getInstance(EntityManager.class);
  clusters=injector.getInstance(Clusters.class);
  actionDB=injector.getInstance(ActionDBAccessor.class);
  controller=injector.getInstance(AmbariManagementController.class);
  serviceFactory=injector.getInstance(ServiceFactory.class);
  serviceComponentFactory=injector.getInstance(ServiceComponentFactory.class);
  serviceComponentHostFactory=injector.getInstance(ServiceComponentHostFactory.class);
  ambariMetaInfo=injector.getInstance(AmbariMetaInfo.class);
  ambariMetaInfo.init();
  users=injector.getInstance(Users.class);
  configuration=injector.getInstance(Configuration.class);
  configHelper=injector.getInstance(ConfigHelper.class);
  configGroupFactory=injector.getInstance(ConfigGroupFactory.class);
  helper=injector.getInstance(OrmTestHelper.class);
  stageFactory=injector.getInstance(StageFactory.class);
  hostDAO=injector.getInstance(HostDAO.class);
  topologyHostInfoDAO=injector.getInstance(TopologyHostInfoDAO.class);
  hostRoleCommandDAO=injector.getInstance(HostRoleCommandDAO.class);
  topologyManager=injector.getInstance(TopologyManager.class);
  StageUtils.setTopologyManager(topologyManager);
  ActionManager.setTopologyManager(topologyManager);
  EasyMock.replay(injector.getInstance(AuditLogger.class));
}
