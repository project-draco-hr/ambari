{
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  String host3="h3";
  addHost(host1,clusterName);
  addHost(host2,clusterName);
  addHost(host3,clusterName);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host3,null);
  installService(clusterName,serviceName,false,false);
  Cluster cluster=clusters.getCluster(clusterName);
  Service s=cluster.getService(serviceName);
  ServiceComponent sc3=s.getServiceComponent(componentName3);
  for (  ServiceComponentHost sch : sc3.getServiceComponentHosts().values()) {
    if (sch.getHostName().equals(host3)) {
      sch.setState(State.INSTALL_FAILED);
    }
  }
  long requestId=startService(clusterName,serviceName,false,true);
  List<Stage> stages=actionDB.getAllStages(requestId);
  HostRoleCommand clientReinstallCmd=null;
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getHostName().equals(host3) && hrc.getRole().toString().equals("HDFS_CLIENT")) {
        clientReinstallCmd=hrc;
        break;
      }
    }
  }
  Assert.assertNotNull(clientReinstallCmd);
}
