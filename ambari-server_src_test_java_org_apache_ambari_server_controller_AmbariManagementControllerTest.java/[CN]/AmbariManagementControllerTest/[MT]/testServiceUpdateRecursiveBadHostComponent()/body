{
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.2"));
  String serviceName1="HDFS";
  createService(clusterName,serviceName1,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName1,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName3,State.INIT);
  String host1="h1";
  clusters.addHost(host1);
  clusters.getHost("h1").setOsType("centos5");
  clusters.getHost("h1").persist();
  clusters.mapHostToCluster(host1,clusterName);
  Set<ServiceComponentHostRequest> set1=new HashSet<ServiceComponentHostRequest>();
  ServiceComponentHostRequest r1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,null,State.INIT.toString());
  ServiceComponentHostRequest r2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName2,host1,null,State.INIT.toString());
  ServiceComponentHostRequest r3=new ServiceComponentHostRequest(clusterName,serviceName1,componentName3,host1,null,State.INIT.toString());
  set1.add(r1);
  set1.add(r2);
  set1.add(r3);
  controller.createHostComponents(set1);
  Cluster c1=clusters.getCluster(clusterName);
  Service s1=c1.getService(serviceName1);
  ServiceComponent sc1=s1.getServiceComponent(componentName1);
  ServiceComponent sc2=s1.getServiceComponent(componentName2);
  ServiceComponent sc3=s1.getServiceComponent(componentName3);
  ServiceComponentHost sch1=sc1.getServiceComponentHost(host1);
  ServiceComponentHost sch2=sc2.getServiceComponentHost(host1);
  ServiceComponentHost sch3=sc3.getServiceComponentHost(host1);
  s1.setDesiredState(State.INSTALLED);
  sc1.setDesiredState(State.STARTED);
  sc2.setDesiredState(State.INIT);
  sc3.setDesiredState(State.INSTALLED);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setDesiredState(State.INSTALLED);
  sch3.setDesiredState(State.INSTALLED);
  sch1.setState(State.INSTALLED);
  sch2.setState(State.UNKNOWN);
  sch3.setState(State.INSTALLED);
  ServiceRequest req=new ServiceRequest(clusterName,serviceName1,null,State.INSTALLED.toString());
  ServiceResourceProviderTest.updateServices(controller,Collections.singleton(req),Collections.<String,String>emptyMap(),true,false);
}
