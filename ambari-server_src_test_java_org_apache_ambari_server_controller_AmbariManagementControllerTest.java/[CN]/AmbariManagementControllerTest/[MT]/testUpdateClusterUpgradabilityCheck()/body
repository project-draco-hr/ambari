{
  String clusterName="foo1";
  StackId currentStackId=new StackId("HDP-0.2");
  createCluster(clusterName);
  Cluster c=clusters.getCluster(clusterName);
  c.setDesiredStackVersion(currentStackId);
  ClusterRequest r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.3",null);
  try {
    controller.updateCluster(r);
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("Illegal request to upgrade to"));
  }
  StackId unsupportedStackId=new StackId("HDP-0.0.1");
  c.setDesiredStackVersion(unsupportedStackId);
  c.setCurrentStackVersion(unsupportedStackId);
  c.refresh();
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  try {
    controller.updateCluster(r);
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("Upgrade is not allowed from"));
  }
}
