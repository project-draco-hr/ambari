{
  clusters.addHost("h1");
  clusters.addHost("h2");
  clusters.addHost("h3");
  clusters.addCluster("c1",new StackId("HDP-0.1"));
  Cluster c=clusters.getCluster("c1");
  StackId stackID=new StackId("HDP-0.1");
  c.setDesiredStackVersion(stackID);
  c.setCurrentStackVersion(stackID);
  helper.getOrCreateRepositoryVersion(stackID,stackID.getStackVersion());
  c.createClusterVersion(stackID,stackID.getStackVersion(),"admin",RepositoryVersionState.INSTALLING);
  setOsFamily(clusters.getHost("h1"),"redhat","5.9");
  setOsFamily(clusters.getHost("h2"),"redhat","5.9");
  setOsFamily(clusters.getHost("h3"),"redhat","5.9");
  clusters.getHost("h1").persist();
  clusters.getHost("h2").persist();
  clusters.getHost("h3").persist();
  String clusterName="c1";
  HostRequest r1=new HostRequest("h1",clusterName,null);
  HostRequest r2=new HostRequest("h2",clusterName,null);
  HostRequest r3=new HostRequest("h3",null,null);
  Set<HostRequest> set1=new HashSet<HostRequest>();
  set1.add(r1);
  set1.add(r2);
  set1.add(r3);
  HostResourceProviderTest.createHosts(controller,set1);
  Assert.assertEquals(1,clusters.getClustersForHost("h1").size());
  Assert.assertEquals(1,clusters.getClustersForHost("h2").size());
  Assert.assertEquals(0,clusters.getClustersForHost("h3").size());
}
