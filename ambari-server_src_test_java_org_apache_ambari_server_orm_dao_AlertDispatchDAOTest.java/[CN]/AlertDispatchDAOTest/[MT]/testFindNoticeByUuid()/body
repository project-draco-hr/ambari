{
  List<AlertDefinitionEntity> definitions=createDefinitions();
  AlertDefinitionEntity definition=definitions.get(0);
  AlertHistoryEntity history=new AlertHistoryEntity();
  history.setServiceName(definition.getServiceName());
  history.setClusterId(clusterId);
  history.setAlertDefinition(definition);
  history.setAlertLabel("Label");
  history.setAlertState(AlertState.OK);
  history.setAlertText("Alert Text");
  history.setAlertTimestamp(System.currentTimeMillis());
  alertsDao.create(history);
  AlertTargetEntity target=helper.createAlertTarget();
  AlertNoticeEntity notice=new AlertNoticeEntity();
  notice.setUuid(UUID.randomUUID().toString());
  notice.setAlertTarget(target);
  notice.setAlertHistory(history);
  notice.setNotifyState(NotificationState.PENDING);
  dao.create(notice);
  AlertNoticeEntity actual=dao.findNoticeByUuid(notice.getUuid());
  assertEquals(notice.getNotificationId(),actual.getNotificationId());
  assertNull(dao.findNoticeByUuid("DEADBEEF"));
}
