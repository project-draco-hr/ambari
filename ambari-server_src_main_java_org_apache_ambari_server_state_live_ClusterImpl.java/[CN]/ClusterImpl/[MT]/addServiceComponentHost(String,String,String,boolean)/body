{
  List<Cluster> cs=clusters.getClustersForHost(hostname);
  boolean clusterFound=false;
  for (  Cluster c : cs) {
    if (c.getClusterId() == this.clusterId) {
      clusterFound=true;
      break;
    }
  }
  if (!clusterFound) {
    throw new AmbariException("Host does not belong this cluster" + ", hostname=" + hostname + ", clusterName="+ clusterName+ ", clusterId="+ clusterId);
  }
  if (!serviceComponentHosts.containsKey(serviceName)) {
    serviceComponentHosts.put(serviceName,new HashMap<String,Map<String,ServiceComponentHost>>());
  }
  if (!serviceComponentHosts.get(serviceName).containsKey(componentName)) {
    serviceComponentHosts.get(serviceName).put(componentName,new HashMap<String,ServiceComponentHost>());
  }
  if (serviceComponentHosts.get(serviceName).get(componentName).containsKey(hostname)) {
    throw new AmbariException("Duplicate entry for ServiceComponentHost" + ", serviceName=" + serviceName + ", serviceComponentName"+ componentName+ ", hostname= "+ hostname);
  }
  if (!serviceComponentHostsByHost.containsKey(hostname)) {
    serviceComponentHostsByHost.put(hostname,new HashMap<String,Map<String,ServiceComponentHost>>());
  }
  if (!serviceComponentHostsByHost.get(hostname).containsKey(serviceName)) {
    serviceComponentHostsByHost.get(hostname).put(serviceName,new HashMap<String,ServiceComponentHost>());
  }
  ServiceComponentHost impl=new ServiceComponentHostImpl(clusterId,serviceName,componentName,hostname,isClient);
  serviceComponentHosts.get(serviceName).get(componentName).put(hostname,impl);
  serviceComponentHostsByHost.get(hostname).get(serviceName).put(componentName,impl);
}
