def run(self):
    id = '-1'
    if (self.credential != None):
        auth_handler = urllib2.HTTPBasicAuthHandler()
        auth_handler.add_password(realm='Controller', uri=self.url, user=self.credential['user'], passwd=self.credential['password'])
        opener = urllib2.build_opener(auth_handler)
        urllib2.install_opener(opener)
    retry = False
    while True:
        try:
            if (retry == False):
                data = json.dumps(self.heartbeat.build(id))
                logger.info(data)
            req = urllib2.Request(self.url, data, {'Content-Type': 'application/json', })
            f = urllib2.urlopen(req)
            response = f.read()
            f.close()
            data = json.loads(response)
            id = int(data['responseId'])
            self.actionQueue.put(data)
            retry = False
        except Exception as err:
            retry = True
            if ('code' in err):
                logger.error(err.code)
            else:
                logger.error(('Unable to connect to: ' + self.url))
                traceback.print_exc()
        if self.actionQueue.isIdle():
            time.sleep(30)
        else:
            time.sleep(1)
