def work_in_or_mode(hostnames, ignored_hosts, command_line, custom_env, empty_check_result):
    check_result = empty_check_result
    for hostname in hostnames:
        concrete_command_line = map((lambda x: (hostname if (x == HOSTNAME_PLACEHOLDER) else x)), command_line)
        try:
            returncode = 0
            real_retcode = None
            message = check_output(concrete_command_line, env=custom_env)
        except subprocess.CalledProcessError as e:
            if (hostname not in ignored_hosts):
                returncode = e.returncode
            else:
                real_retcode = e.returncode
            message = e.output
        really_positive_result = ((hostname not in ignored_hosts) and (returncode == 0))
        if ((check_result.get('retcode') <= returncode) or really_positive_result):
            check_result = {'message': message, 'retcode': returncode, 'real_retcode': real_retcode, }
        if really_positive_result:
            break
    return check_result
