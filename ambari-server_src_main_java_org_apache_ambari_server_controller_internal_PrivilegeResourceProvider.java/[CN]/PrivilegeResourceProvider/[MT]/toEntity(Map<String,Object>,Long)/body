{
  PrivilegeEntity entity=new PrivilegeEntity();
  String permissionName=(String)properties.get(PERMISSION_NAME_PROPERTY_ID);
  entity.setPermission(permissionDAO.findPermissionByName(permissionName));
  entity.setResource(resourceDAO.findById(resourceId));
  String principalName=(String)properties.get(PRINCIPAL_NAME_PROPERTY_ID);
  String principalType=(String)properties.get(PRINCIPAL_TYPE_PROPERTY_ID);
  if (PrincipalTypeEntity.GROUP_PRINCIPAL_TYPE_NAME.equalsIgnoreCase(principalType)) {
    GroupEntity groupEntity=groupDAO.findGroupByName(principalName);
    entity.setPrincipal(principalDAO.findById(groupEntity.getPrincipal().getId()));
  }
 else   if (PrincipalTypeEntity.USER_PRINCIPAL_TYPE_NAME.equalsIgnoreCase(principalType)) {
    UserEntity userEntity=userDAO.findLocalUserByName(principalName);
    entity.setPrincipal(principalDAO.findById(userEntity.getPrincipal().getId()));
  }
  return entity;
}
