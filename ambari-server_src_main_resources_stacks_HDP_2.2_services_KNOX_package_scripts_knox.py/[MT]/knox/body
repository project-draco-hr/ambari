def knox():
    import params
    Directory(params.knox_conf_dir, owner=params.knox_user, group=params.knox_group, recursive=True)
    XmlConfig('gateway-site.xml', conf_dir=params.knox_conf_dir, configurations=params.config['configurations']['gateway-site'], configuration_attributes=params.config['configuration_attributes']['gateway-site'], owner=params.knox_user, group=params.knox_group)
    File(format('{params.knox_conf_dir}/gateway-log4j.properties'), mode=420, group=params.knox_group, owner=params.knox_user, content=params.gateway_log4j)
    File(format('{params.knox_conf_dir}/topologies/default.xml'), group=params.knox_group, owner=params.knox_user, content=InlineTemplate(params.topology_template))
    if params.security_enabled:
        TemplateConfig(format('{knox_conf_dir}/krb5JAASLogin.conf'), owner=params.knox_user, template_tag=None)
    cmd = format('{knox_client_bin} create-master --master {knox_master_secret!p}')
    Execute(cmd, user=params.knox_user, environment={'JAVA_HOME': params.java_home, }, not_if=format('test -f {knox_master_secret_path}'))
