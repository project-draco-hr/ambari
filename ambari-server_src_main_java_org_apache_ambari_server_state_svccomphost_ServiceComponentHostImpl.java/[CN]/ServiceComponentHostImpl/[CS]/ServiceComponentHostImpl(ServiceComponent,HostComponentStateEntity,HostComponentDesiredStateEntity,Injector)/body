{
  injector.injectMembers(this);
  this.serviceComponent=serviceComponent;
  this.clusterGlobalLock=serviceComponent.getClusterGlobalLock();
  this.desiredStateEntity=desiredStateEntity;
  this.stateEntity=stateEntity;
  if (serviceComponent.isClientComponent()) {
    this.stateMachine=clientStateMachineFactory.make(this);
  }
 else {
    this.stateMachine=daemonStateMachineFactory.make(this);
  }
  this.stateMachine.setCurrentState(stateEntity.getCurrentState());
  try {
    this.host=clusters.getHost(stateEntity.getHostName());
  }
 catch (  AmbariException e) {
    LOG.error("Host '{}' was not found " + stateEntity.getHostName());
    throw new RuntimeException(e);
  }
  desiredConfigs=new HashMap<String,String>();
  configs=new HashMap<String,String>();
  for (  HostComponentDesiredConfigMappingEntity entity : desiredStateEntity.getHostComponentDesiredConfigMappingEntities()) {
    desiredConfigs.put(entity.getConfigType(),entity.getVersionTag());
  }
  persisted=true;
}
