{
  HostEntity hostEntity=hostDAO.findByName(getHostName());
  hostEntity.addHostComponentStateEntity(stateEntity);
  hostEntity.addHostComponentDesiredStateEntity(desiredStateEntity);
  ServiceComponentDesiredStateEntityPK dpk=new ServiceComponentDesiredStateEntityPK();
  dpk.setClusterId(serviceComponent.getClusterId());
  dpk.setServiceName(serviceComponent.getServiceName());
  dpk.setComponentName(serviceComponent.getName());
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(dpk);
  serviceComponentDesiredStateEntity.getHostComponentDesiredStateEntities().add(desiredStateEntity);
  desiredStateEntity.setServiceComponentDesiredStateEntity(serviceComponentDesiredStateEntity);
  desiredStateEntity.setHostEntity(hostEntity);
  stateEntity.setServiceComponentDesiredStateEntity(serviceComponentDesiredStateEntity);
  stateEntity.setHostEntity(hostEntity);
  hostComponentStateDAO.create(stateEntity);
  hostComponentDesiredStateDAO.create(desiredStateEntity);
  HostComponentStateEntity stateEntity=hostComponentStateDAO.findByIndex(serviceComponent.getClusterId(),serviceComponent.getServiceName(),serviceComponent.getName(),hostEntity.getHostId());
  hostComponentStateId=stateEntity.getId();
  serviceComponentDesiredStateDAO.merge(serviceComponentDesiredStateEntity);
  hostDAO.merge(hostEntity);
}
