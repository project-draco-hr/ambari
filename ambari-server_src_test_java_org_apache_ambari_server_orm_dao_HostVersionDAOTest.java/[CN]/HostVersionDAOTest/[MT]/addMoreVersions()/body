{
  ClusterEntity clusterEntity=clusterDAO.findByName("test_cluster1");
  if (clusterEntity.getClusterVersionEntities() != null && clusterEntity.getClusterVersionEntities().size() > 0) {
    ClusterVersionEntity installedClusterVersion=clusterVersionDAO.findByClusterAndStateCurrent(clusterEntity.getClusterName());
    installedClusterVersion.setState(ClusterVersionState.INSTALLED);
    clusterVersionDAO.merge(installedClusterVersion);
  }
 else {
    Assert.fail("Cluster is expected to have at least one cluster version");
  }
  ClusterVersionEntity newClusterVersionEntity=new ClusterVersionEntity(clusterEntity,"HDP","2.2.0.1-996",ClusterVersionState.CURRENT,System.currentTimeMillis(),System.currentTimeMillis(),"admin");
  clusterEntity.addClusterVersionEntity(newClusterVersionEntity);
  clusterVersionDAO.create(newClusterVersionEntity);
  HostEntity[] hostEntities=clusterEntity.getHostEntities().toArray(new HostEntity[clusterEntity.getHostEntities().size()]);
  Arrays.sort(hostEntities);
  for (  HostEntity host : hostEntities) {
    HostVersionEntity hostVersionEntity=new HostVersionEntity(host.getHostName(),"HDP","2.2.0.1-996",UpgradeState.NONE);
    hostVersionEntity.setHostEntity(host);
    hostVersionDAO.create(hostVersionEntity);
  }
  for (int i=0; i < hostEntities.length; i++) {
    UpgradeState desiredState=UpgradeState.NONE;
    if (i % 3 == 0) {
      desiredState=UpgradeState.PENDING;
    }
    if (i % 3 == 1) {
      desiredState=UpgradeState.IN_PROGRESS;
    }
    if (i % 3 == 2) {
      desiredState=UpgradeState.FAILED;
    }
    HostVersionEntity hostVersionEntity=new HostVersionEntity(hostEntities[i].getHostName(),"HDP","2.2.1.0-500",desiredState);
    hostVersionEntity.setHostEntity(hostEntities[i]);
    hostVersionDAO.create(hostVersionEntity);
  }
}
