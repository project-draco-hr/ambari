@patch('os.path.islink')
def test_start_default(self, islink_mock):
    self.executeScript((self.COMMON_SERVICES_PACKAGE_DIR + '/scripts/knox_gateway.py'), classname='KnoxGateway', command='start', config_file='default.json', hdp_stack_version=self.STACK_VERSION, target=RMFTestCase.TARGET_COMMON_SERVICES)
    self.assertResourceCalled('Directory', '/usr/hdp/current/knox-server/data/', owner='knox', group='knox', create_parents=True, mode=493, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('Directory', '/var/log/knox', owner='knox', group='knox', create_parents=True, mode=493, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('Directory', '/var/run/knox', owner='knox', group='knox', create_parents=True, mode=493, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('Directory', '/usr/hdp/current/knox-server/conf', owner='knox', group='knox', create_parents=True, mode=493, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('Directory', '/usr/hdp/current/knox-server/conf/topologies', owner='knox', group='knox', create_parents=True, mode=493, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('XmlConfig', 'gateway-site.xml', owner='knox', group='knox', conf_dir='/usr/hdp/current/knox-server/conf', configurations=self.getConfig()['configurations']['gateway-site'], configuration_attributes=self.getConfig()['configuration_attributes']['gateway-site'])
    self.assertResourceCalled('File', '/usr/hdp/current/knox-server/conf/gateway-log4j.properties', mode=420, group='knox', owner='knox', content=self.getConfig()['configurations']['gateway-log4j']['content'])
    self.assertResourceCalled('File', '/usr/hdp/current/knox-server/conf/topologies/default.xml', group='knox', owner='knox', content=InlineTemplate(self.getConfig()['configurations']['topology']['content']))
    self.assertResourceCalled('File', '/usr/hdp/current/knox-server/conf/topologies/admin.xml', group='knox', owner='knox', content=InlineTemplate(self.getConfig()['configurations']['admin-topology']['content']))
    self.assertResourceCalled('Execute', '/usr/hdp/current/knox-server/bin/knoxcli.sh create-master --master sa', environment={'JAVA_HOME': u'/usr/jdk64/jdk1.7.0_45', }, not_if="ambari-sudo.sh su knox -l -s /bin/bash -c '[RMF_EXPORT_PLACEHOLDER]test -f /usr/hdp/current/knox-server/data/security/master'", user='knox')
    self.assertResourceCalled('Execute', '/usr/hdp/current/knox-server/bin/knoxcli.sh create-cert --hostname c6401.ambari.apache.org', environment={'JAVA_HOME': u'/usr/jdk64/jdk1.7.0_45', }, not_if="ambari-sudo.sh su knox -l -s /bin/bash -c '[RMF_EXPORT_PLACEHOLDER]test -f /usr/hdp/current/knox-server/data/security/keystores/gateway.jks'", user='knox')
    self.assertResourceCalled('File', '/usr/hdp/current/knox-server/conf/ldap-log4j.properties', mode=420, group='knox', owner='knox', content=self.getConfig()['configurations']['ldap-log4j']['content'])
    self.assertResourceCalled('File', '/usr/hdp/current/knox-server/conf/users.ldif', mode=420, group='knox', owner='knox', content=self.getConfig()['configurations']['users-ldif']['content'])
    self.assertResourceCalled('Link', '/usr/hdp/current/knox-server/pids', to='/var/run/knox')
    self.assertResourceCalled('Directory', '/var/log/knox', owner='knox', mode=493, group='knox', create_parents=True, cd_access='a', recursive_ownership=True)
    self.assertResourceCalled('Execute', '/usr/hdp/current/knox-server/bin/gateway.sh start', environment={'JAVA_HOME': u'/usr/jdk64/jdk1.7.0_45', }, not_if=u'ls /var/run/knox/gateway.pid >/dev/null 2>&1 && ps -p `cat /var/run/knox/gateway.pid` >/dev/null 2>&1', user=u'knox')
    self.assertTrue(islink_mock.called)
    self.assertNoMoreResources()
