{
  if (null == user)   throw new NullPointerException("User must be specified.");
  HostConfigMappingEntity exist=getDesiredConfigEntity(clusterId,config.getType());
  if (null != exist && exist.getVersion().equals(config.getVersionTag())) {
    if (!selected) {
      exist.setSelected(0);
      hostConfigMappingDAO.merge(exist);
    }
    return false;
  }
  writeLock.lock();
  try {
    for (    HostConfigMappingEntity e : hostConfigMappingDAO.findByType(clusterId,hostEntity.getHostName(),config.getType())) {
      e.setSelected(0);
      hostConfigMappingDAO.merge(e);
    }
    HostConfigMappingEntity entity=new HostConfigMappingEntity();
    entity.setClusterId(Long.valueOf(clusterId));
    entity.setCreateTimestamp(Long.valueOf(System.currentTimeMillis()));
    entity.setHostName(hostEntity.getHostName());
    entity.setSelected(1);
    entity.setUser(user);
    entity.setType(config.getType());
    entity.setVersion(config.getVersionTag());
    hostConfigMappingDAO.create(entity);
  }
  finally {
    writeLock.unlock();
  }
  hostDAO.merge(hostEntity);
  return true;
}
