{
  stateMachine=stateMachineFactory.make(this);
  rwLock=new ReentrantReadWriteLock();
  readLock=rwLock.readLock();
  writeLock=rwLock.writeLock();
  this.hostEntity=hostEntity;
  this.persisted=persisted;
  hostDAO=injector.getInstance(HostDAO.class);
  hostStateDAO=injector.getInstance(HostStateDAO.class);
  hostVersionDAO=injector.getInstance(HostVersionDAO.class);
  gson=injector.getInstance(Gson.class);
  clusterDAO=injector.getInstance(ClusterDAO.class);
  clusters=injector.getInstance(Clusters.class);
  hostConfigMappingDAO=injector.getInstance(HostConfigMappingDAO.class);
  HostImpl.topologyManager=injector.getInstance(TopologyManager.class);
  hostStateEntity=hostEntity.getHostStateEntity();
  if (hostStateEntity == null) {
    hostStateEntity=new HostStateEntity();
    hostStateEntity.setHostEntity(hostEntity);
    hostEntity.setHostStateEntity(hostStateEntity);
    hostStateEntity.setHealthStatus(gson.toJson(new HostHealthStatus(HealthStatus.UNKNOWN,"")));
    if (persisted) {
      hostStateDAO.create(hostStateEntity);
    }
  }
 else {
    stateMachine.setCurrentState(hostStateEntity.getCurrentState());
  }
}
