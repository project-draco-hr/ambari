{
  m_cluster=ctx.getCluster();
  m_metaInfo=ctx.getAmbariMetaInfo();
  List<StageWrapper> result=new ArrayList<StageWrapper>();
  if (ctx.getDirection().isDowngrade()) {
    return result;
  }
  Map<String,Service> serviceMap=m_cluster.getServices();
  Set<String> clusterServices=new LinkedHashSet<String>(serviceMap.keySet());
  for (  String service : ServiceCheckGrouping.this.priorityServices) {
    if (checkServiceValidity(service,serviceMap)) {
      StageWrapper wrapper=new StageWrapper(StageWrapper.Type.SERVICE_CHECK,"Service Check " + ctx.getServiceDisplay(service),new TaskWrapper(service,"",Collections.<String>emptySet(),new ServiceCheckTask()));
      result.add(wrapper);
      clusterServices.remove(service);
    }
  }
  for (  String service : clusterServices) {
    if (checkServiceValidity(service,serviceMap)) {
      StageWrapper wrapper=new StageWrapper(StageWrapper.Type.SERVICE_CHECK,"Service Check " + ctx.getServiceDisplay(service),new TaskWrapper(service,"",Collections.<String>emptySet(),new ServiceCheckTask()));
      result.add(wrapper);
    }
  }
  return result;
}
