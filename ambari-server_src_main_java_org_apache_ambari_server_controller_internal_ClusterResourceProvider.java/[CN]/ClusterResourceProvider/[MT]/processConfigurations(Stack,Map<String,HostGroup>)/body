{
  Set<String> services=getServicesToDeploy(stack,blueprintHostGroups);
  for (  String service : services) {
    Collection<String> configTypes=stack.getConfigurationTypes(service);
    for (    String type : configTypes) {
      Map<String,String> properties=stack.getConfigurationProperties(service,type);
      for (      Map.Entry<String,String> entry : properties.entrySet()) {
        String propName=entry.getKey();
        String value=entry.getValue();
        Map<String,String> typeProps=mapClusterConfigurations.get(type);
        if (typeProps == null) {
          typeProps=new HashMap<String,String>();
          mapClusterConfigurations.put(type,typeProps);
        }
        if (!typeProps.containsKey(propName)) {
          PropertyUpdater propertyUpdater=propertyUpdaters.get(propName);
          if (propertyUpdater != null) {
            value=propertyUpdater.update(blueprintHostGroups,entry.getValue());
          }
          typeProps.put(propName,value);
        }
      }
    }
  }
  Map<String,String> globalProperties=mapClusterConfigurations.get("global.xml");
  if (globalProperties == null) {
    globalProperties=new HashMap<String,String>();
    mapClusterConfigurations.put("global.xml",globalProperties);
  }
  globalProperties.put("user_group","hadoop");
  globalProperties.put("smokeuser","ambari-qa");
  globalProperties.put("nagios_contact","default@REPLACEME.NOWHERE");
  globalProperties.put("nagios_web_password","admin");
}
