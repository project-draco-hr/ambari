{
  List<BlueprintServiceConfigRequest> listofConfigRequests=new LinkedList<BlueprintServiceConfigRequest>();
  Collection<String> encounteredConfigTypes=new HashSet<String>();
  for (  String service : getServicesToDeploy(stack,blueprintHostGroups)) {
    BlueprintServiceConfigRequest blueprintConfigRequest=new BlueprintServiceConfigRequest(service);
    for (    String serviceConfigType : stack.getConfigurationTypes(service)) {
      if (encounteredConfigTypes.add(serviceConfigType)) {
        if (!serviceConfigType.equals("cluster-env")) {
          if (mapClusterConfigurations.containsKey(serviceConfigType)) {
            blueprintConfigRequest.addConfigElement(serviceConfigType,mapClusterConfigurations.get(serviceConfigType),mapClusterAttributes.get(serviceConfigType));
          }
        }
      }
    }
    listofConfigRequests.add(blueprintConfigRequest);
  }
  BlueprintServiceConfigRequest globalConfigRequest=new BlueprintServiceConfigRequest("GLOBAL-CONFIG");
  globalConfigRequest.addConfigElement("cluster-env",mapClusterConfigurations.get("cluster-env"),mapClusterAttributes.get("cluster-env"));
  listofConfigRequests.add(globalConfigRequest);
  try {
    setConfigurationsOnCluster(clusterName,listofConfigRequests);
  }
 catch (  AmbariException e) {
    throw new SystemException("Unable to set configurations on cluster.",e);
  }
}
