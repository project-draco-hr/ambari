{
  Exception lastException=null;
  for (int retries=0; retries < RETRY; retries++) {
    try {
      Map<String,Long> memoryData=solrJmxAdapter.getMemoryData();
      addMetric("jvm.JvmMetrics.MemHeapUsedM","Long",memoryData.get("heapMemoryUsed").doubleValue() / 1024 / 1024);
      addMetric("jvm.JvmMetrics.MemHeapCommittedM","Long",memoryData.get("heapMemoryCommitted").doubleValue() / 1024 / 1024);
      addMetric("jvm.JvmMetrics.MemHeapMaxM","Long",memoryData.get("heapMemoryMax").doubleValue() / 1024 / 1024);
      addMetric("jvm.JvmMetrics.MemNonHeapUsedM","Long",memoryData.get("nonHeapMemoryUsed").doubleValue() / 1024 / 1024);
      addMetric("jvm.JvmMetrics.MemNonHeapCommittedM","Long",memoryData.get("nonHeapMemoryCommitted").doubleValue() / 1024 / 1024);
      addMetric("jvm.JvmMetrics.MemNonHeapMaxM","Long",memoryData.get("nonHeapMemoryMax").doubleValue() / 1024 / 1024);
      return;
    }
 catch (    MalformedObjectNameException e) {
      lastException=e;
      try {
        solrJmxAdapter.reConnect();
      }
 catch (      IOException e1) {
      }
    }
  }
  LOG.info("Could not load solr heap memory usage metric, last exception:",lastException);
}
