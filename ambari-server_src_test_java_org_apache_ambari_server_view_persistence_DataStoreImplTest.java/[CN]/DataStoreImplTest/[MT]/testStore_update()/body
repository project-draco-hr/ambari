{
  DynamicClassLoader classLoader=new DynamicClassLoader(DataStoreImplTest.class.getClassLoader());
  JpaEntityManager jpaEntityManager=createMock(JpaEntityManager.class);
  ServerSession session=createMock(ServerSession.class);
  DatabaseLogin databaseLogin=createMock(DatabaseLogin.class);
  EntityManagerFactory entityManagerFactory=createMock(EntityManagerFactory.class);
  EntityManager entityManager=createMock(EntityManager.class);
  JPADynamicHelper jpaDynamicHelper=createNiceMock(JPADynamicHelper.class);
  SchemaManager schemaManager=createNiceMock(SchemaManager.class);
  EntityTransaction transaction=createMock(EntityTransaction.class);
  DynamicEntity dynamicEntity=createMock(DynamicEntity.class);
  DynamicEntity dynamicSubEntity=createMock(DynamicEntity.class);
  PowerMock.mockStatic(JpaHelper.class);
  expect(JpaHelper.getEntityManager(entityManager)).andReturn(jpaEntityManager).anyTimes();
  PowerMock.replay(JpaHelper.class);
  expect(jpaEntityManager.getServerSession()).andReturn(session).anyTimes();
  expect(session.getLogin()).andReturn(databaseLogin).anyTimes();
  Capture<Sequence> sequenceCapture=new Capture<Sequence>();
  databaseLogin.addSequence(capture(sequenceCapture));
  EasyMock.expectLastCall().anyTimes();
  Capture<DynamicType> typeCapture=new Capture<DynamicType>();
  Capture<DynamicType> typeCapture2=new Capture<DynamicType>();
  jpaDynamicHelper.addTypes(eq(true),eq(true),capture(typeCapture),capture(typeCapture2));
  expect(entityManagerFactory.createEntityManager()).andReturn(entityManager).anyTimes();
  expect(entityManager.getTransaction()).andReturn(transaction).anyTimes();
  Capture<Class> entityClassCapture=new Capture<Class>();
  expect(entityManager.find(capture(entityClassCapture),eq(100))).andReturn(dynamicEntity);
  Capture<Class> entityClassCapture2=new Capture<Class>();
  expect(entityManager.find(capture(entityClassCapture2),eq(99))).andReturn(dynamicSubEntity);
  entityManager.close();
  expect(dynamicEntity.set("DS_id",100)).andReturn(dynamicEntity);
  expect(dynamicEntity.set("DS_name","foo")).andReturn(dynamicEntity);
  expect(dynamicSubEntity.set("DS_id",99)).andReturn(dynamicSubEntity);
  expect(dynamicSubEntity.set("DS_name","bar")).andReturn(dynamicSubEntity);
  Capture<DynamicEntity> subEntityCapture=new Capture<DynamicEntity>();
  expect(dynamicEntity.set(eq("DS_subEntity"),capture(subEntityCapture))).andReturn(dynamicSubEntity);
  expect(dynamicEntity.get("DS_id")).andReturn(100);
  expect(dynamicEntity.get("DS_name")).andReturn("foo");
  expect(dynamicEntity.get("DS_subEntity")).andReturn(dynamicSubEntity);
  expect(dynamicEntity.get("DS_class")).andReturn(dynamicEntity.getClass());
  expect(dynamicSubEntity.get("DS_id")).andReturn(99);
  expect(dynamicSubEntity.get("DS_name")).andReturn("bar");
  transaction.begin();
  transaction.commit();
  replay(entityManagerFactory,entityManager,jpaDynamicHelper,transaction,schemaManager,dynamicEntity,jpaEntityManager,session,databaseLogin,dynamicSubEntity);
  DataStoreImpl dataStore=getDataStore(entityManagerFactory,jpaDynamicHelper,classLoader,schemaManager);
  dataStore.store(new TestEntity(100,"foo",new TestSubEntity(99,"bar")));
  Assert.assertEquals(entityClassCapture.getValue(),typeCapture.getValue().getJavaClass());
  Assert.assertEquals(entityClassCapture2.getValue(),typeCapture2.getValue().getJavaClass());
  verify(entityManagerFactory,entityManager,jpaDynamicHelper,transaction,schemaManager,dynamicEntity,jpaEntityManager,session,databaseLogin,dynamicSubEntity);
}
