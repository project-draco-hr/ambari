{
  DynamicClassLoader classLoader=new DynamicClassLoader(DataStoreImplTest.class.getClassLoader());
  JpaEntityManager jpaEntityManager=createMock(JpaEntityManager.class);
  ServerSession session=createMock(ServerSession.class);
  DatabaseLogin databaseLogin=createMock(DatabaseLogin.class);
  EntityManagerFactory entityManagerFactory=createMock(EntityManagerFactory.class);
  EntityManager entityManager=createMock(EntityManager.class);
  JPADynamicHelper jpaDynamicHelper=createNiceMock(JPADynamicHelper.class);
  SchemaManager schemaManager=createNiceMock(SchemaManager.class);
  DynamicEntity dynamicEntity1=createMock(DynamicEntity.class);
  DynamicEntity dynamicEntity2=createMock(DynamicEntity.class);
  DynamicEntity dynamicEntity3=createMock(DynamicEntity.class);
  Query query=createMock(Query.class);
  PowerMock.mockStatic(JpaHelper.class);
  expect(JpaHelper.getEntityManager(entityManager)).andReturn(jpaEntityManager).anyTimes();
  PowerMock.replay(JpaHelper.class);
  expect(jpaEntityManager.getServerSession()).andReturn(session).anyTimes();
  expect(session.getLogin()).andReturn(databaseLogin).anyTimes();
  Capture<Sequence> sequenceCapture=new Capture<Sequence>();
  databaseLogin.addSequence(capture(sequenceCapture));
  EasyMock.expectLastCall().anyTimes();
  Capture<DynamicType> typeCapture=new Capture<DynamicType>();
  Capture<DynamicType> typeCapture2=new Capture<DynamicType>();
  jpaDynamicHelper.addTypes(eq(true),eq(true),capture(typeCapture),capture(typeCapture2));
  expect(entityManagerFactory.createEntityManager()).andReturn(entityManager).anyTimes();
  expect(entityManager.createQuery("SELECT e FROM DS_DataStoreImplTest$TestEntity_1 e WHERE e.DS_name='foo'")).andReturn(query);
  entityManager.close();
  List<DynamicEntity> entityList=new LinkedList<DynamicEntity>();
  entityList.add(dynamicEntity1);
  entityList.add(dynamicEntity2);
  entityList.add(dynamicEntity3);
  expect(query.getResultList()).andReturn(entityList);
  expect(dynamicEntity1.get("DS_id")).andReturn(99);
  expect(dynamicEntity1.get("DS_name")).andReturn("foo");
  TestSubEntity subEntity1=new TestSubEntity("bar");
  expect(dynamicEntity1.get("DS_subEntity")).andReturn(subEntity1);
  expect(dynamicEntity2.get("DS_id")).andReturn(100);
  expect(dynamicEntity2.get("DS_name")).andReturn("foo");
  TestSubEntity subEntity2=new TestSubEntity("bar");
  expect(dynamicEntity2.get("DS_subEntity")).andReturn(subEntity2);
  expect(dynamicEntity3.get("DS_id")).andReturn(101);
  expect(dynamicEntity3.get("DS_name")).andReturn("foo");
  TestSubEntity subEntity3=new TestSubEntity("bar");
  expect(dynamicEntity3.get("DS_subEntity")).andReturn(subEntity3);
  replay(entityManagerFactory,entityManager,jpaDynamicHelper,dynamicEntity1,dynamicEntity2,dynamicEntity3,query,schemaManager,jpaEntityManager,session,databaseLogin);
  DataStoreImpl dataStore=getDataStore(entityManagerFactory,jpaDynamicHelper,classLoader,schemaManager);
  Collection<TestEntity> entities=dataStore.findAll(TestEntity.class,"name='foo'");
  Assert.assertEquals(3,entities.size());
  for (  TestEntity entity : entities) {
    Assert.assertEquals("foo",entity.getName());
  }
  verify(entityManagerFactory,entityManager,jpaDynamicHelper,dynamicEntity1,dynamicEntity2,dynamicEntity3,query,schemaManager,jpaEntityManager,session,databaseLogin);
}
