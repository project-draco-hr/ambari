{
  Set<Resource> resources=new HashSet<Resource>();
  Resource.Type resourceType=getResourceDefinition().getType();
  Predicate predicate=getPredicate();
  Request request=createRequest();
  if (LOG.isDebugEnabled()) {
    LOG.debug("Executing resource query: " + request + " where "+ predicate);
  }
  if (m_setQueryProperties.isEmpty() && m_mapQuerySubResources.isEmpty()) {
    m_mapQuerySubResources.putAll(ensureSubResources());
  }
  Iterable<Resource> iterResource=getClusterController().getResources(resourceType,request,predicate);
  for (  Resource resource : iterResource) {
    resources.add(resource);
  }
  return new QueryResult(resources,queryForSubResources(this,resources),this);
}
