{
  Map<Resource.Type,String> mapParentIds=getIds();
  Map<Resource.Type,String> mapResourceIds=new HashMap<Resource.Type,String>(mapParentIds.size());
  ClusterController controller=getClusterController();
  for (  Map.Entry<Resource.Type,String> resourceIdEntry : mapParentIds.entrySet()) {
    Resource.Type type=resourceIdEntry.getKey();
    String value=resourceIdEntry.getValue();
    if (value == null) {
      Object o=resource.getPropertyValue(controller.getSchema(type).getKeyPropertyId(type));
      value=o == null ? null : o.toString();
    }
    if (value != null) {
      mapResourceIds.put(type,value);
    }
  }
  String resourceKeyProp=controller.getSchema(resource.getType()).getKeyPropertyId(resource.getType());
  mapResourceIds.put(resource.getType(),resource.getPropertyValue(resourceKeyProp).toString());
  subResourceInstance.setIds(mapResourceIds);
}
