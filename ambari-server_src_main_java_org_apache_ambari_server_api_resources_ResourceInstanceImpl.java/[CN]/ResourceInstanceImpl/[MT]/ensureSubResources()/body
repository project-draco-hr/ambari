{
  if (m_mapSubResources == null) {
    m_mapSubResources=new HashMap<String,ResourceInstanceImpl>();
    Set<SubResourceDefinition> setSubResourceDefs=getResourceDefinition().getSubResourceDefinitions();
    for (    SubResourceDefinition subResDef : setSubResourceDefs) {
      Map<Resource.Type,String> mapIds=getIds();
      ResourceInstanceImpl resource=new ResourceInstanceImpl(mapIds,ResourceInstanceFactoryImpl.createResourceDefinition(subResDef.getType(),mapIds),m_controller);
      resource.getQuery().addLocalProperty(getClusterController().getSchema(subResDef.getType()).getKeyPropertyId(subResDef.getType()));
      for (      Resource.Type fkType : subResDef.getAdditionalForeignKeys()) {
        resource.getQuery().addLocalProperty(getClusterController().getSchema(subResDef.getType()).getKeyPropertyId(fkType));
      }
      String subResourceName=subResDef.isCollection() ? resource.getResourceDefinition().getPluralName() : resource.getResourceDefinition().getSingularName();
      m_mapSubResources.put(subResourceName,resource);
    }
  }
  return m_mapSubResources;
}
