{
  Map<Resource.Type,QueryResult> subResourceMap=new HashMap<Resource.Type,QueryResult>();
  Map<String,Predicate> predicateMap=getSubResourcePredicates(resources);
  for (  Map.Entry<String,ResourceInstanceImpl> entry : m_mapQuerySubResources.entrySet()) {
    ResourceInstanceImpl subResource=entry.getValue();
    Set<Resource> subResources=new LinkedHashSet<Resource>();
    prepForQuery();
    for (    Resource resource : subResource.doQuery(predicateMap.get(entry.getKey()))) {
      subResources.add(resource);
    }
    subResourceMap.put(subResource.getResourceDefinition().getType(),new QueryResult(subResources,subResource.queryForSubResources(subResources),subResource));
  }
  return subResourceMap;
}
