{
  LdapServerProperties ldapServerProperties=configuration.getLdapServerProperties();
  String baseDn=ldapServerProperties.getBaseDN().toLowerCase();
  String groupBase=ldapServerProperties.getGroupBase().toLowerCase();
  String groupObjectClass=ldapServerProperties.getGroupObjectClass();
  String groupMembershipAttr=ldapServerProperties.getGroupMembershipAttr();
  String adminGroupMappingRules=ldapServerProperties.getAdminGroupMappingRules();
  final String groupNamingAttribute=ldapServerProperties.getGroupNamingAttr();
  String groupSearchFilter=ldapServerProperties.getGroupSearchFilter();
  int indexOfBaseDn=groupBase.indexOf(baseDn);
  groupBase=indexOfBaseDn <= 0 ? "" : groupBase.substring(0,indexOfBaseDn - 1);
  StringBuilder filterBuilder=new StringBuilder();
  filterBuilder.append("(&(");
  filterBuilder.append(groupMembershipAttr);
  filterBuilder.append("=");
  filterBuilder.append(user.getNameInNamespace());
  if ((groupSearchFilter == null) || groupSearchFilter.equals("")) {
    filterBuilder.append(")(objectclass=");
    filterBuilder.append(groupObjectClass);
    filterBuilder.append(")(|");
    String[] adminGroupMappingRegexs=adminGroupMappingRules.split(",");
    for (    String adminGroupMappingRegex : adminGroupMappingRegexs) {
      filterBuilder.append("(");
      filterBuilder.append(groupNamingAttribute);
      filterBuilder.append("=");
      filterBuilder.append(adminGroupMappingRegex);
      filterBuilder.append(")");
    }
    filterBuilder.append(")");
  }
 else {
    filterBuilder.append(")");
    filterBuilder.append(groupSearchFilter);
  }
  filterBuilder.append(")");
  AttributesMapper attributesMapper=new AttributesMapper(){
    public Object mapFromAttributes(    Attributes attrs) throws NamingException {
      return attrs.get(groupNamingAttribute).get();
    }
  }
;
  LdapTemplate ldapTemplate=new LdapTemplate((getContextSource()));
  ldapTemplate.setIgnorePartialResultException(true);
  ldapTemplate.setIgnoreNameNotFoundException(true);
  List<String> ambariAdminGroups=ldapTemplate.search(groupBase,filterBuilder.toString(),attributesMapper);
  if (ambariAdminGroups.size() > 0) {
    user.setAttributeValue(AMBARI_ADMIN_LDAP_ATTRIBUTE_KEY,true);
  }
  return user;
}
