{
  if (null == m_version) {
    return hostsType;
  }
  try {
    org.apache.ambari.server.state.Service svc=m_cluster.getService(service);
    ServiceComponent sc=svc.getServiceComponent(component);
    Set<String> toUpgrade=new LinkedHashSet<String>();
    for (    String host : hostsType.hosts) {
      ServiceComponentHost sch=sc.getServiceComponentHost(host);
      if (null == sch.getVersion() || !sch.getVersion().equals(m_version)) {
        toUpgrade.add(host);
      }
    }
    if (toUpgrade.isEmpty()) {
      return null;
    }
 else {
      hostsType.hosts=toUpgrade;
      return hostsType;
    }
  }
 catch (  AmbariException e) {
    LOG.warn("Could not determine host components to upgrade. Defaulting to saved hosts.",e);
    return hostsType;
  }
}
