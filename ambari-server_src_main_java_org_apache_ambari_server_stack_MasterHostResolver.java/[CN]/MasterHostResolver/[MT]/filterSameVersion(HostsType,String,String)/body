{
  try {
    org.apache.ambari.server.state.Service svc=m_cluster.getService(service);
    ServiceComponent sc=svc.getServiceComponent(component);
    List<ServiceComponentHost> unhealthy=new ArrayList<ServiceComponentHost>();
    Set<String> toUpgrade=new LinkedHashSet<String>();
    for (    String host : hostsType.hosts) {
      ServiceComponentHost sch=sc.getServiceComponentHost(host);
      if (HostState.HEALTHY != sch.getHostState() && !sc.isMasterComponent()) {
        unhealthy.add(sch);
      }
 else       if (null == m_version || null == sch.getVersion() || !sch.getVersion().equals(m_version)) {
        toUpgrade.add(host);
      }
    }
    hostsType.unhealthy=unhealthy;
    hostsType.hosts=toUpgrade;
    return hostsType;
  }
 catch (  AmbariException e) {
    LOG.warn("Could not determine host components to upgrade. Defaulting to saved hosts.",e);
    return hostsType;
  }
}
