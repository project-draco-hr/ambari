{
  ResourceTypeEntity resourceTypeEntity=new ResourceTypeEntity();
  resourceTypeEntity.setId(10);
  resourceTypeEntity.setName("MY_VIEW{1.0.0}");
  ViewEntity viewDefinition=ViewEntityTest.getViewEntity();
  viewDefinition.setResourceType(resourceTypeEntity);
  expect(configuration.getViewExtractionThreadPoolCoreSize()).andReturn(2).anyTimes();
  expect(configuration.getViewExtractionThreadPoolMaxSize()).andReturn(3).anyTimes();
  expect(configuration.getViewExtractionThreadPoolTimeout()).andReturn(10000L).anyTimes();
  expect(viewArchive.getAbsolutePath()).andReturn("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}").anyTimes();
  expect(archiveDir.exists()).andReturn(false);
  expect(archiveDir.getAbsolutePath()).andReturn("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}").anyTimes();
  expect(archiveDir.mkdir()).andReturn(true);
  expect(archiveDir.toURI()).andReturn(new URI("file:./"));
  expect(viewJarFile.entries()).andReturn(enumeration);
  expect(viewJarFile.getInputStream(jarEntry)).andReturn(is);
  expect(enumeration.hasMoreElements()).andReturn(true);
  expect(enumeration.hasMoreElements()).andReturn(false);
  expect(enumeration.nextElement()).andReturn(jarEntry);
  expect(jarEntry.getName()).andReturn("view.xml");
  expect(is.available()).andReturn(1);
  expect(is.available()).andReturn(0);
  expect(is.read()).andReturn(10);
  fos.write(10);
  fos.close();
  is.close();
  expect(classesDir.exists()).andReturn(true);
  expect(classesDir.toURI()).andReturn(new URI("file:./"));
  expect(libDir.exists()).andReturn(true);
  expect(libDir.listFiles()).andReturn(new File[]{fileEntry});
  expect(fileEntry.toURI()).andReturn(new URI("file:./"));
  replay(extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,viewJarFile,jarEntry,is,fos,configuration,viewDir,enumeration,fileEntry,viewDAO);
  ViewExtractor viewExtractor=getViewExtractor(viewDefinition);
  viewExtractor.extractViewArchive(viewDefinition,viewArchive,archiveDir);
  verify(extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,viewJarFile,jarEntry,is,fos,configuration,viewDir,enumeration,fileEntry,viewDAO);
}
