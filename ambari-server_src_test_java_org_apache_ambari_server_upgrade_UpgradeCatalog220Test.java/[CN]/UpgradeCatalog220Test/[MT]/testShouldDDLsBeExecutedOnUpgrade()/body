{
  Injector mockedInjector=mocksControl.createMock(Injector.class);
  DBAccessor mockedDbAccessor=mocksControl.createMock(DBAccessor.class);
  DaoUtils mockedDaoUtils=mocksControl.createMock(DaoUtils.class);
  Configuration mockedConfiguration=mocksControl.createMock(Configuration.class);
  StackUpgradeUtil mockedStackUpgradeUtil=mocksControl.createMock(StackUpgradeUtil.class);
  Capture<String> capturedTableName=EasyMock.newCapture();
  Capture<String> capturedPKColumn=EasyMock.newCapture();
  Capture<List<DBAccessor.DBColumnInfo>> capturedColumns=EasyMock.newCapture();
  Capture<DBAccessor.DBColumnInfo> capturedColumn=EasyMock.newCapture();
  Capture<DBAccessor.DBColumnInfo> capturedHostRoleCommandColumn=EasyMock.newCapture();
  Capture<String> capturedBlueprintTableName=EasyMock.newCapture();
  Capture<DBAccessor.DBColumnInfo> capturedNewBlueprintColumn1=EasyMock.newCapture();
  Capture<DBAccessor.DBColumnInfo> capturedNewBlueprintColumn2=EasyMock.newCapture();
  Capture<DBAccessor.DBColumnInfo> stageSkipColumnCapture=EasyMock.newCapture();
  EasyMock.expect(mockedInjector.getInstance(DaoUtils.class)).andReturn(mockedDaoUtils);
  mockedInjector.injectMembers(anyObject(UpgradeCatalog.class));
  EasyMock.expect(mockedConfiguration.getDatabaseType()).andReturn(Configuration.DatabaseType.POSTGRES).anyTimes();
  EasyMock.expect(mockedConfiguration.getDatabaseUser()).andReturn("ambari");
  EasyMock.expect(mockedConfiguration.getServerJDBCPostgresSchemaName()).andReturn("fo");
  mockedDbAccessor.executeQuery("ALTER SCHEMA fo OWNER TO \"ambari\";");
  mockedDbAccessor.executeQuery("ALTER ROLE \"ambari\" SET search_path to 'fo';");
  mockedDbAccessor.addColumn(eq("upgrade"),capture(capturedColumn));
  mockedDbAccessor.addColumn(eq("upgrade"),capture(capturedColumn));
  mockedDbAccessor.addColumn(eq("upgrade"),capture(capturedColumn));
  mockedDbAccessor.createTable(capture(capturedTableName),capture(capturedColumns),capture(capturedPKColumn));
  mockedDbAccessor.alterColumn(eq("host_role_command"),capture(capturedHostRoleCommandColumn));
  mockedDbAccessor.addColumn(capture(capturedBlueprintTableName),capture(capturedNewBlueprintColumn1));
  mockedDbAccessor.addColumn(capture(capturedBlueprintTableName),capture(capturedNewBlueprintColumn2));
  mockedDbAccessor.addColumn(eq("stage"),capture(stageSkipColumnCapture));
  mocksControl.replay();
  UpgradeCatalog220 testSubject=new UpgradeCatalog220(mockedInjector);
  EasyMockSupport.injectMocks(testSubject);
  testSubject.stackUpgradeUtil=mockedStackUpgradeUtil;
  testSubject.dbAccessor=mockedDbAccessor;
  testSubject.configuration=mockedConfiguration;
  testSubject.upgradeSchema();
  Assert.assertEquals("The table name is wrong!","kerberos_descriptor",capturedTableName.getValue());
  Assert.assertEquals("The primary key is wrong!","kerberos_descriptor_name",capturedPKColumn.getValue());
  Assert.assertTrue("Ther number of columns is wrong!",capturedColumns.getValue().size() == 2);
  Assert.assertEquals("The table name is wrong!","blueprint",capturedBlueprintTableName.getValue());
  Assert.assertEquals("The column name is wrong!","security_type",capturedNewBlueprintColumn1.getValue().getName());
  Assert.assertEquals("The column name is wrong!","security_descriptor_reference",capturedNewBlueprintColumn2.getValue().getName());
  Assert.assertEquals("The column name is wrong!","supports_auto_skip_failure",stageSkipColumnCapture.getValue().getName());
}
