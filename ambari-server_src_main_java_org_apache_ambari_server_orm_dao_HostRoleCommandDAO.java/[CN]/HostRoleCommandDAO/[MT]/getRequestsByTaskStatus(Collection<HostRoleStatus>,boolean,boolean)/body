{
  List<Long> results=null;
  StringBuilder queryStr=new StringBuilder();
  queryStr.append("SELECT DISTINCT command.requestId ").append("FROM HostRoleCommandEntity command ");
  if (statuses != null && !statuses.isEmpty()) {
    queryStr.append("WHERE ");
    if (checkAllTasks) {
      queryStr.append("command.requestId ");
      if (!match) {
        queryStr.append("NOT ");
      }
      queryStr.append("IN (").append("SELECT c.requestId ").append("FROM HostRoleCommandEntity c ").append("WHERE c.requestId = command.requestId ").append("AND c.status IN ?1) ");
    }
 else {
      queryStr.append("command.status ");
      if (!match) {
        queryStr.append("NOT ");
      }
      queryStr.append("IN ?1 ");
    }
  }
  queryStr.append("ORDER BY command.requestId DESC");
  TypedQuery<Long> query=entityManagerProvider.get().createQuery(queryStr.toString(),Long.class);
  query.setMaxResults(REQUESTS_RESULT_LIMIT);
  if (statuses != null && !statuses.isEmpty()) {
    results=daoUtils.selectList(query,statuses);
  }
 else {
    results=daoUtils.selectList(query);
  }
  return results;
}
