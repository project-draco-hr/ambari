{
  boolean added=components.add(component);
  if (stack.isMasterComponent(component)) {
    containsMasterComponent=true;
  }
  if (added) {
    String service=stack.getServiceForComponent(component);
    if (service != null) {
      Set<String> serviceComponents=componentsForService.get(service);
      if (serviceComponents == null) {
        serviceComponents=new HashSet<String>();
        componentsForService.put(service,serviceComponents);
      }
      serviceComponents.add(component);
    }
  }
  return added;
}
