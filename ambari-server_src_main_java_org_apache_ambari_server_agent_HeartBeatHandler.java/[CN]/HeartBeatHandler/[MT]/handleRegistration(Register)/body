{
  String hostname=register.getHostname();
  long now=System.currentTimeMillis();
  if (clusterFsm.getHost(hostname) == null) {
    clusterFsm.addHost(hostname);
  }
  Host hostObject=clusterFsm.getHost(hostname);
  List<StatusCommand> cmds=new ArrayList<StatusCommand>();
  for (  Cluster cl : clusterFsm.getClustersForHost(hostname)) {
    List<ServiceComponentHost> roleList=cl.getServiceComponentHosts(hostname);
    List<String> roles=new ArrayList<String>();
    for (    ServiceComponentHost sch : roleList) {
      roles.add(sch.getServiceComponentName());
    }
    StatusCommand statusCmd=new StatusCommand();
    statusCmd.setRoles(roles);
    cmds.add(statusCmd);
  }
  hostObject.handleEvent(new HostRegistrationRequestEvent(hostname,new AgentVersion("v1"),now,register.getHardwareProfile()));
  RegistrationResponse response=new RegistrationResponse();
  if (cmds.isEmpty()) {
    hostObject.handleEvent(new HostStatusUpdatesReceivedEvent(hostname,now));
  }
 else {
    response.setCommand(cmds);
  }
  return response;
}
