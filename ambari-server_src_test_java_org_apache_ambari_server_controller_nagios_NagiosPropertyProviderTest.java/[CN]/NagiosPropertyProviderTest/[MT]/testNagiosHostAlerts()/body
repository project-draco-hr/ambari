{
  Cluster cluster=clusters.getCluster("c1");
  Service service=cluster.addService("NAGIOS");
  service.setDesiredStackVersion(new StackId("HDP-2.0.5"));
  service.persist();
  ServiceComponent sc=service.addServiceComponent("NAGIOS_SERVER");
  sc.setDesiredStackVersion(new StackId("HDP-2.0.5"));
  sc.addServiceComponentHost(HOST);
  sc.persist();
  TestStreamProvider streamProvider=new TestStreamProvider("nagios_alerts.txt");
  NagiosPropertyProvider npp=new NagiosPropertyProvider(Resource.Type.Host,streamProvider,"Hosts/cluster_name","Hosts/host_name");
  npp.forceReset();
  Resource resource=new ResourceImpl(Resource.Type.Service);
  resource.setProperty("Hosts/cluster_name","c1");
  resource.setProperty("Hosts/host_name","c6403.ambari.apache.org");
  Request request=PropertyHelper.getReadRequest(Collections.<String>emptySet(),new HashMap<String,TemporalInfo>());
  Set<Resource> set=npp.populateResources(Collections.singleton(resource),request,null);
  Assert.assertEquals(1,set.size());
  Resource res=set.iterator().next();
  Map<String,Map<String,Object>> values=res.getPropertiesMap();
  Assert.assertTrue(values.containsKey("alerts"));
  Assert.assertTrue(values.containsKey("alerts/summary"));
  Assert.assertTrue(values.get("alerts").containsKey("detail"));
  Assert.assertTrue(List.class.isInstance(values.get("alerts").get("detail")));
  List<?> list=(List<?>)values.get("alerts").get("detail");
  Assert.assertTrue(7 == list.size());
  for (  Object o : list) {
    Assert.assertTrue(Map.class.isInstance(o));
    Map<?,?> map=(Map<?,?>)o;
    Assert.assertTrue(map.containsKey("host_name"));
    String host=map.get("host_name").toString();
    Assert.assertTrue("expected c6403.ambari.apache.org",host.equals("c6403.ambari.apache.org"));
  }
  Map<String,Object> summary=values.get("alerts/summary");
  Assert.assertTrue(summary.containsKey("OK"));
  Assert.assertTrue(summary.containsKey("WARNING"));
  Assert.assertTrue(summary.containsKey("CRITICAL"));
  Assert.assertTrue(summary.get("OK").equals(Integer.valueOf(6)));
  Assert.assertTrue(summary.get("WARNING").equals(Integer.valueOf(0)));
  Assert.assertTrue(summary.get("CRITICAL").equals(Integer.valueOf(1)));
}
