def test_heartbeat_with_status_multiple(self):
    AmbariConfig.config.set('services', 'serviceToPidMapFile', self.dictPath)
    actionQueue = ActionQueue(AmbariConfig.AmbariConfig().getConfig())
    actionQueue.IDLE_SLEEP_TIME = 0.01
    heartbeat = Heartbeat(actionQueue)
    actionQueue.start()
    max_number_of_status_entries = 0
    for i in range(1, 5):
        statusCommand = {'serviceName': 'HDFS', 'commandType': 'STATUS_COMMAND', 'clusterName': '', 'componentName': 'DATANODE', }
        actionQueue.put(statusCommand)
        time.sleep(0.1)
        result = heartbeat.build(101)
        number_of_status_entries = len(result['componentStatus'])
        if (max_number_of_status_entries < number_of_status_entries):
            max_number_of_status_entries = number_of_status_entries
    actionQueue.stop()
    actionQueue.join()
    NUMBER_OF_COMPONENTS = 1
    self.assertEquals((max_number_of_status_entries == NUMBER_OF_COMPONENTS), True)
