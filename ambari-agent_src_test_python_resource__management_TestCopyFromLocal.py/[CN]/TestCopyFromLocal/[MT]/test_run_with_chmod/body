@patch('resource_management.libraries.providers.execute_hadoop.ExecuteHadoopProvider')
def test_run_with_chmod(self, execute_hadoop_mock):
    with Environment() as env:
        CopyFromLocal('/user/testdir/*.files', mode=429, owner='user1', group='hdfs', dest_dir='/apps/test/', kinnit_if_needed='', hdfs_user='hdfs')
        self.assertEqual(execute_hadoop_mock.call_count, 3)
        call_arg_list = execute_hadoop_mock.call_args_list
        self.assertEqual('fs -copyFromLocal /user/testdir/*.files /apps/test/', call_arg_list[0][0][0].command)
        self.assertEquals({'not_if': "su - user1 -c ' hadoop fs -ls /apps/test//*.files' >/dev/null 2>&1", 'user': 'user1', 'bin_dir': '/usr/bin', 'conf_dir': '/etc/hadoop/conf', }, call_arg_list[0][0][0].arguments)
        self.assertEquals('fs -chown user1:hdfs /apps/test//*.files', call_arg_list[1][0][0].command)
        self.assertEquals({'user': 'hdfs', 'bin_dir': '/usr/bin', 'conf_dir': '/etc/hadoop/conf', }, call_arg_list[1][0][0].arguments)
