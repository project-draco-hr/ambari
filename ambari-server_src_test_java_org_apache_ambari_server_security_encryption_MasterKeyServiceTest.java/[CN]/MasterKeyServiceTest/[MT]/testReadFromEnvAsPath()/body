{
  MasterKeyService ms=new MasterKeyServiceImpl("ThisisSomePassPhrase",fileDir + File.separator + "master",true);
  Assert.assertTrue(ms.isMasterKeyInitialized());
  File f=new File(fileDir + File.separator + "master");
  Assert.assertTrue(f.exists());
  Map<String,String> mapRet=new HashMap<String,String>();
  mapRet.put(Configuration.MASTER_KEY_LOCATION,f.getAbsolutePath());
  mockStatic(System.class);
  expect(System.getenv()).andReturn(mapRet);
  replayAll();
  ms=new MasterKeyServiceImpl();
  verifyAll();
  Assert.assertTrue(ms.isMasterKeyInitialized());
  Assert.assertNotNull(ms.getMasterSecret());
  Assert.assertEquals("ThisisSomePassPhrase",new String(ms.getMasterSecret()));
  Assert.assertFalse(f.exists());
}
