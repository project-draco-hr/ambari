@patch('time.sleep')
@patch('subprocess.Popen')
def test_post_rolling_restart_nodemanager_not_ready(self, process_mock, time_mock):
    process_output = '\n      c9999.ambari.apache.org:45454  RUNNING  c9999.ambari.apache.org:8042  0\n    '
    process = MagicMock()
    process.communicate.return_value = [process_output]
    process.returncode = 0
    process_mock.return_value = process
    try:
        self.executeScript('2.0.6/services/YARN/package/scripts/nodemanager.py', classname='Nodemanager', command='post_rolling_restart', config_file='default.json')
        self.fail('Missing NodeManager should have caused a failure')
    except Fail as fail:
        self.assertTrue(process_mock.called)
        self.assertEqual(process_mock.call_count, 12)
