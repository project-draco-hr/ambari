{
  Resource.Type type=Resource.Type.Request;
  Capture<ExecuteActionRequest> actionRequest=newCapture();
  Capture<HashMap<String,String>> propertyMap=newCapture();
  Cluster cluster=createMock(Cluster.class);
  expect(cluster.getClusterId()).andReturn(2L).anyTimes();
  expect(cluster.getResourceId()).andReturn(4L).anyTimes();
  Clusters clusters=createMock(Clusters.class);
  expect(clusters.getCluster("c1")).andReturn(cluster).anyTimes();
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  RequestStatusResponse response=createNiceMock(RequestStatusResponse.class);
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(managementController.createAction(capture(actionRequest),capture(propertyMap))).andReturn(response).anyTimes();
  expect(response.getMessage()).andReturn("Message").anyTimes();
  replay(cluster,clusters,managementController,response);
  SecurityContextHolder.getContext().setAuthentication(authentication);
  Set<Map<String,Object>> propertySet=new LinkedHashSet<Map<String,Object>>();
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  String c1="c1";
  String host_component="HOST_COMPONENT";
  String service_id="HDFS";
  String hostcomponent_id="Namenode";
  String host_name="host1";
  properties.put(RequestResourceProvider.REQUEST_CLUSTER_NAME_PROPERTY_ID,c1);
  Set<Map<String,Object>> filterSet=new HashSet<Map<String,Object>>();
  Map<String,Object> filterMap=new HashMap<String,Object>();
  filterMap.put(RequestResourceProvider.SERVICE_ID,service_id);
  filterMap.put(RequestResourceProvider.HOSTS_ID,host_name);
  filterSet.add(filterMap);
  properties.put(RequestResourceProvider.REQUEST_RESOURCE_FILTER_ID,filterSet);
  propertySet.add(properties);
  Map<String,String> requestInfoProperties=new HashMap<String,String>();
  requestInfoProperties.put(RequestResourceProvider.COMMAND_ID,"RESTART");
  requestInfoProperties.put(RequestOperationLevel.OPERATION_LEVEL_ID,host_component);
  requestInfoProperties.put(RequestOperationLevel.OPERATION_CLUSTER_ID,c1);
  requestInfoProperties.put(RequestOperationLevel.OPERATION_SERVICE_ID,service_id);
  requestInfoProperties.put(RequestOperationLevel.OPERATION_HOSTCOMPONENT_ID,hostcomponent_id);
  requestInfoProperties.put(RequestOperationLevel.OPERATION_HOST_NAME,host_name);
  Request request=PropertyHelper.getCreateRequest(propertySet,requestInfoProperties);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  requestInfoProperties.put(RequestOperationLevel.OPERATION_CLUSTER_ID,c1);
  provider.createResources(request);
  Assert.assertTrue(actionRequest.hasCaptured());
  ExecuteActionRequest capturedRequest=actionRequest.getValue();
  RequestOperationLevel level=capturedRequest.getOperationLevel();
  Assert.assertEquals(level.getLevel().toString(),"HostComponent");
  Assert.assertEquals(level.getClusterName(),c1);
  Assert.assertEquals(level.getServiceName(),service_id);
  Assert.assertEquals(level.getHostComponentName(),hostcomponent_id);
  Assert.assertEquals(level.getHostName(),host_name);
}
