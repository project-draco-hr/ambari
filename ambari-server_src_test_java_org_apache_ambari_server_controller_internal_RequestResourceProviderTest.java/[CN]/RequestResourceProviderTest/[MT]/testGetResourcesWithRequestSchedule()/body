{
  Resource.Type type=Resource.Type.Request;
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  ActionManager actionManager=createNiceMock(ActionManager.class);
  HostRoleCommand hostRoleCommand=createNiceMock(HostRoleCommand.class);
  Stage stage=createNiceMock(Stage.class);
  List<HostRoleCommand> hostRoleCommands=new LinkedList<HostRoleCommand>();
  hostRoleCommands.add(hostRoleCommand);
  Collection<Stage> stages=new HashSet<Stage>();
  stages.add(stage);
  org.apache.ambari.server.actionmanager.Request requestMock=createNiceMock(org.apache.ambari.server.actionmanager.Request.class);
  expect(requestMock.getCommands()).andReturn(hostRoleCommands).anyTimes();
  expect(requestMock.getStages()).andReturn(stages).anyTimes();
  expect(requestMock.getRequestContext()).andReturn("this is a context").anyTimes();
  expect(requestMock.getRequestId()).andReturn(100L).anyTimes();
  expect(requestMock.getRequestScheduleId()).andReturn(11L).anyTimes();
  expect(stage.getOrderedHostRoleCommands()).andReturn(hostRoleCommands).anyTimes();
  Capture<Collection<Long>> requestIdsCapture=new Capture<Collection<Long>>();
  expect(managementController.getActionManager()).andReturn(actionManager);
  expect(actionManager.getRequests(capture(requestIdsCapture))).andReturn(Collections.singletonList(requestMock)).anyTimes();
  expect(hostRoleCommand.getRequestId()).andReturn(100L).anyTimes();
  expect(hostRoleCommand.getStatus()).andReturn(HostRoleStatus.IN_PROGRESS).anyTimes();
  replay(managementController,actionManager,hostRoleCommand,requestMock,stage);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add(RequestResourceProvider.REQUEST_ID_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_SOURCE_SCHEDULE);
  Predicate predicate=new PredicateBuilder().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("100").toPredicate();
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals(100L,(long)(Long)resource.getPropertyValue(RequestResourceProvider.REQUEST_ID_PROPERTY_ID));
    Assert.assertEquals("IN_PROGRESS",resource.getPropertyValue(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID));
    Assert.assertEquals(11L,(long)(Long)resource.getPropertyValue(RequestResourceProvider.REQUEST_SOURCE_SCHEDULE_ID));
  }
  verify(managementController,actionManager,hostRoleCommand,stage);
}
