{
  String clusterName=actionExecutionContext.getClusterName();
  String componentName=actionMetadata.getClient(resourceFilter.getServiceName());
  String serviceName=resourceFilter.getServiceName();
  String smokeTestRole=actionExecutionContext.getActionName();
  long nowTimestamp=System.currentTimeMillis();
  Map<String,String> actionParameters=actionExecutionContext.getParameters();
  String hostName;
  if (componentName != null) {
    Map<String,ServiceComponentHost> components=clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName).getServiceComponentHosts();
    if (components.isEmpty()) {
      throw new AmbariException("Hosts not found, component=" + componentName + ", service = "+ serviceName+ ", cluster = "+ clusterName);
    }
    List<String> candidateHosts=resourceFilter.getHostNames();
    if (candidateHosts != null && !candidateHosts.isEmpty()) {
      hostName=managementController.getHealthyHost(new HashSet<String>(candidateHosts));
      if (hostName == null) {
        LOG.info("Unable to find a healthy host amongst the provided set of " + "hosts. " + candidateHosts);
      }
    }
 else {
      hostName=managementController.getHealthyHost(components.keySet());
    }
  }
 else {
    Map<String,ServiceComponent> components=clusters.getCluster(clusterName).getService(serviceName).getServiceComponents();
    if (components.isEmpty()) {
      throw new AmbariException("Components not found, service = " + serviceName + ", cluster = "+ clusterName);
    }
    ServiceComponent serviceComponent=components.values().iterator().next();
    if (serviceComponent.getServiceComponentHosts().isEmpty()) {
      throw new AmbariException("Hosts not found, component=" + serviceComponent.getName() + ", service = "+ serviceName+ ", cluster = "+ clusterName);
    }
    hostName=serviceComponent.getServiceComponentHosts().keySet().iterator().next();
  }
  addServiceCheckAction(stage,hostName,smokeTestRole,nowTimestamp,serviceName,componentName,actionParameters,hostLevelParams);
}
