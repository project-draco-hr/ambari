{
  try {
    String stackName=(String)getRequestProperty(request,STACK_NAME_PROPERTY_ID);
    String stackVersion=(String)getRequestProperty(request,STACK_VERSION_PROPERTY_ID);
    List<String> hosts=(List<String>)getRequestProperty(request,"hosts");
    List<String> services=(List<String>)getRequestProperty(request,"services");
    RecommendationRequest recommendationRequest=RecommendationRequestBuilder.forStack(stackName,stackVersion).forHosts(hosts).forServices(services).build();
    return recommendationRequest;
  }
 catch (  Exception e) {
    LOG.warn("Error occured during preparation of recommendation request",e);
    Response response=Response.status(Status.BAD_REQUEST).entity("Hosts and services must not be empty").build();
    throw new WebApplicationException(response);
  }
}
