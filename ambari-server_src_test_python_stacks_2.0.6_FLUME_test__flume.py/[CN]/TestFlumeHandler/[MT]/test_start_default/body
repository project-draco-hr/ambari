@patch('os.path.isfile')
@patch('flume.cmd_target_names')
def test_start_default(self, cmd_target_names_mock, os_path_isfile_mock):
    os_path_isfile_mock.side_effect = [True, False]
    cmd_target_names_mock.return_value = ['a1']
    self.executeScript('2.0.6/services/FLUME/package/scripts/flume_handler.py', classname='FlumeHandler', command='start', config_file='default.json')
    self.assert_configure_default()
    self.assertResourceCalled('Execute', format('su -s /bin/bash flume -c "export JAVA_HOME=/usr/jdk64/jdk1.7.0_45; /usr/bin/flume-ng agent --name a1 --conf /etc/flume/conf/a1 --conf-file /etc/flume/conf/a1/flume.conf -Dflume.monitoring.type=ganglia -Dflume.monitoring.hosts=c6401.ambari.apache.org:8655"'), wait_for_finish=False)
    self.assertResourceCalled('Execute', 'pgrep -o -u flume -f ^/usr/jdk64/jdk1.7.0_45.*a1.* > /var/run/flume/a1.pid', logoutput=True, tries=10, try_sleep=1)
    self.assertNoMoreResources()
