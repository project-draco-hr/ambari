{
  ActionManager am=getMockActionManager();
  Cluster cluster=getDummyCluster();
  @SuppressWarnings("serial") Set<String> hostNames=new HashSet<String>(){
{
      add(DummyHostname1);
    }
  }
;
  clusters.mapHostsToCluster(hostNames,DummyCluster);
  Service hdfs=cluster.addService(HDFS);
  hdfs.persist();
  hdfs.addServiceComponent(DATANODE).persist();
  hdfs.addServiceComponent(NAMENODE).persist();
  hdfs.addServiceComponent(SECONDARY_NAMENODE).persist();
  ActionQueue aq=new ActionQueue();
  HeartBeatHandler handler=getHeartBeatHandler(am,aq);
  HeartBeat hb=new HeartBeat();
  hb.setTimestamp(System.currentTimeMillis());
  hb.setResponseId(0);
  hb.setHostname(DummyHostname1);
  hb.setNodeStatus(new HostStatus(Status.HEALTHY,DummyHostStatus));
  hb.setReports(new ArrayList<CommandReport>());
  ArrayList<ComponentStatus> componentStatuses=new ArrayList<ComponentStatus>();
  hb.setComponentStatus(componentStatuses);
  HeartBeatResponse resp=handler.handleHeartBeat(hb);
  Assert.assertFalse(resp.hasMappedComponents());
  hdfs.getServiceComponent(DATANODE).addServiceComponentHost(DummyHostname1).persist();
  ServiceComponentHost serviceComponentHost1=clusters.getCluster(DummyCluster).getService(HDFS).getServiceComponent(DATANODE).getServiceComponentHost(DummyHostname1);
  serviceComponentHost1.setState(State.INIT);
  hb=new HeartBeat();
  hb.setTimestamp(System.currentTimeMillis());
  hb.setResponseId(1);
  hb.setHostname(DummyHostname1);
  hb.setNodeStatus(new HostStatus(Status.HEALTHY,DummyHostStatus));
  hb.setReports(new ArrayList<CommandReport>());
  hb.setComponentStatus(componentStatuses);
  resp=handler.handleHeartBeat(hb);
  Assert.assertTrue(resp.hasMappedComponents());
}
