{
  if (!this.clusterExists(clusterName)) {
    String msg="Cluster [" + clusterName + "] does not exist";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.NOT_FOUND)).get());
  }
  Cluster cls=this.getClusterByName(clusterName);
  String stackName=cls.getClusterDefinition(-1).getStackName();
  int stackRevision=Integer.parseInt(cls.getClusterDefinition(-1).getStackRevision());
  Stack bp;
  if (!expanded) {
    bp=stacks.getStack(stackName,stackRevision);
  }
 else {
    bp=this.flattener.flattenStack(stackName,stackRevision);
  }
  return bp;
}
