{
  if (cdef.getName() == null || cdef.getName().equals("")) {
    String msg="Cluster Name must be specified and must be non-empty string";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.BAD_REQUEST)).get());
  }
synchronized (operational_clusters) {
    if (operational_clusters.containsKey(cdef.getName())) {
      String msg="Cluster [" + cdef.getName() + "] already exists";
      throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.CONFLICT)).get());
    }
    Date requestTime=new Date();
    Cluster cls=new Cluster();
    ClusterState clsState=new ClusterState();
    clsState.setCreationTime(requestTime);
    clsState.setLastUpdateTime(requestTime);
    clsState.setDeployTime((Date)null);
    clsState.setState(ClusterState.CLUSTER_STATE_INACTIVE);
    cls.setID(UUID.randomUUID().toString());
    cls.addClusterDefinition(cdef);
    cls.setClusterState(clsState);
    if (cdef.getNodeRangeExpressions() != null) {
      updateClusterNodesReservation(cls.getID(),cdef);
    }
    if (cdef.getRoleToNodesMap() != null) {
      updateNodeToRolesAssociation(cdef.getNodeRangeExpressions(),cdef.getRoleToNodesMap());
    }
 else {
    }
    this.operational_clusters.put(cdef.getName(),cls);
    this.operational_clusters_id_to_name.put(cls.getID(),cdef.getName());
    if (cdef.getGoalState().equals(ClusterState.CLUSTER_STATE_ACTIVE)) {
      org.apache.ambari.resource.statemachine.ClusterFSM cs=StateMachineInvoker.createCluster(cls);
    }
  }
  return cdef;
}
