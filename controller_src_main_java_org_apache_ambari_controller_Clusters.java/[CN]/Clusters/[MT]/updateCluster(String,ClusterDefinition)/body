{
  if (c.getName() == null || c.getName().equals("") || !c.getName().equals(clusterName)) {
    String msg="Cluster name in resource URI [" + clusterName + "] does not match with one specified in update request element";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.BAD_REQUEST)).get());
  }
  if (!this.operational_clusters.containsKey(clusterName)) {
    String msg="Cluster [" + clusterName + "] does not exits";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.NOT_FOUND)).get());
  }
  Cluster cls=this.operational_clusters.get(clusterName);
synchronized (cls.getClusterDefinition()) {
    if (c.getBlueprintName() != null)     cls.getClusterDefinition().setBlueprintName(c.getBlueprintName());
    if (c.getBlueprintRevision() != null)     cls.getClusterDefinition().setBlueprintRevision(c.getBlueprintRevision());
    if (c.getDescription() != null)     cls.getClusterDefinition().setDescription(c.getDescription());
    if (c.getGoalState() != null)     cls.getClusterDefinition().setGoalState(c.getGoalState());
    if (c.getActiveServices() != null)     cls.getClusterDefinition().setActiveServices(c.getActiveServices());
    if (c.getNodeRangeExpressions() != null) {
      cls.getClusterDefinition().setNodeRangeExpressions(c.getNodeRangeExpressions());
      updateClusterNodesReservation(cls,c.getNodeRangeExpressions());
    }
    if (c.getRoleToNodesMap() != null) {
      cls.getClusterDefinition().setRoleToNodesMap(c.getRoleToNodesMap());
      updateNodeToRolesAssociation(cls.getClusterDefinition(),c.getRoleToNodesMap());
    }
    cls.getClusterState().setLastUpdateTime(new Date());
    cls.setRevision(cls.getRevision() + 1);
  }
  return cls.getClusterDefinition();
}
