{
  if (c.getName() == null || c.getName().equals("") || !c.getName().equals(clusterName)) {
    String msg="Cluster name in resource URI [" + clusterName + "] does not match with one specified in update request element";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.BAD_REQUEST)).get());
  }
  if (!this.operational_clusters.containsKey(clusterName)) {
    String msg="Cluster [" + clusterName + "] does not exits";
    throw new WebApplicationException((new ExceptionResponse(msg,Response.Status.NOT_FOUND)).get());
  }
  Cluster cls=this.operational_clusters.get(clusterName);
  ClusterDefinition newcd=new ClusterDefinition();
synchronized (cls.getClusterDefinitionRevisionsList()) {
    if (c.getBlueprintName() != null) {
      newcd.setBlueprintName(c.getBlueprintName());
    }
 else {
      newcd.setBlueprintName(cls.getLatestClusterDefinition().getBlueprintName());
    }
    if (c.getBlueprintRevision() != null) {
      newcd.setBlueprintRevision(c.getBlueprintRevision());
    }
 else {
      newcd.setBlueprintRevision(cls.getLatestClusterDefinition().getBlueprintRevision());
    }
    if (c.getDescription() != null) {
      newcd.setDescription(c.getDescription());
    }
 else {
      newcd.setDescription(cls.getLatestClusterDefinition().getDescription());
    }
    if (c.getGoalState() != null) {
      newcd.setGoalState(c.getGoalState());
    }
 else {
      newcd.setGoalState(cls.getLatestClusterDefinition().getGoalState());
    }
    if (c.getActiveServices() != null) {
      newcd.setActiveServices(c.getActiveServices());
    }
 else {
      newcd.setActiveServices(cls.getLatestClusterDefinition().getActiveServices());
    }
    if (c.getNodeRangeExpressions() != null) {
      newcd.setNodeRangeExpressions(c.getNodeRangeExpressions());
      updateClusterNodesReservation(cls.getID(),c);
    }
 else {
      newcd.setNodeRangeExpressions(cls.getLatestClusterDefinition().getNodeRangeExpressions());
    }
    if (c.getRoleToNodesMap() != null) {
      newcd.setRoleToNodesMap(c.getRoleToNodesMap());
      updateNodeToRolesAssociation(newcd.getNodeRangeExpressions(),c.getRoleToNodesMap());
    }
    cls.getClusterState().setLastUpdateTime(new Date());
    cls.addClusterDefinition(newcd);
  }
  return cls.getLatestClusterDefinition();
}
