def wait_until_not_locked(self, cmd, is_checked=True, **kwargs):
    func = (shell.checked_call if is_checked else shell.call)
    for i in range(self.resource.locked_tries):
        is_last_time = (i == (self.resource.locked_tries - 1))
        try:
            (code, out) = func(cmd, **kwargs)
        except Fail as ex:
            if ((not self.is_locked_output(str(ex))) or is_last_time):
                raise
            Logger.info(PACKAGE_MANAGER_LOCK_ACQUIRED.format(self.resource.locked_try_sleep, str(ex)))
        else:
            if ((not code) or (not self.is_locked_output(out))):
                break
            Logger.info(PACKAGE_MANAGER_LOCK_ACQUIRED.format(self.resource.locked_try_sleep, str(out)))
        time.sleep(self.resource.locked_try_sleep)
    return (code, out)
