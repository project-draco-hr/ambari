{
  String tempDirectoryPath=configuration.getProperty(Configuration.SERVER_TMP_DIR.getKey());
  if ((tempDirectoryPath == null) || tempDirectoryPath.isEmpty()) {
    tempDirectoryPath=System.getProperty("java.io.tmpdir");
  }
  try {
    if (tempDirectoryPath == null) {
      throw new IOException("The System property 'java.io.tmpdir' does not specify a temporary directory");
    }
    File directory;
    int tries=0;
    long now=System.currentTimeMillis();
    do {
      directory=new File(tempDirectoryPath,String.format("%s%d-%d.d",KerberosServerAction.DATA_DIRECTORY_PREFIX,now,tries));
      if ((directory.exists()) || !directory.mkdirs()) {
        directory=null;
      }
 else {
        LOG.debug("Created temporary directory: {}",directory.getAbsolutePath());
      }
    }
 while ((directory == null) && (++tries < 100));
    if (directory == null) {
      throw new IOException(String.format("Failed to create a temporary directory in %s",tempDirectoryPath));
    }
    return directory;
  }
 catch (  IOException e) {
    String message="Failed to create the temporary data directory.";
    LOG.error(message,e);
    throw new AmbariException(message,e);
  }
}
