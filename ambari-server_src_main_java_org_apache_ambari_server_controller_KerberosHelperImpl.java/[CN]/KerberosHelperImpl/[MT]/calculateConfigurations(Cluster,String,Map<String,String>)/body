{
  Map<String,Map<String,String>> configurations=new HashMap<String,Map<String,String>>();
  Map<String,Map<String,String>> configurationTags=ambariManagementController.findConfigurationTagsWithOverrides(cluster,hostname);
  if (configurationTags.get(Configuration.GLOBAL_CONFIG_TAG) != null) {
    configHelper.applyCustomConfig(configurations,Configuration.GLOBAL_CONFIG_TAG,Configuration.RCA_ENABLED_PROPERTY,"false",false);
  }
  Map<String,Map<String,String>> configProperties=configHelper.getEffectiveConfigProperties(cluster,configurationTags);
  for (  Map.Entry<String,Map<String,String>> entry : configProperties.entrySet()) {
    String type=entry.getKey();
    Map<String,String> allLevelMergedConfig=entry.getValue();
    Map<String,String> configuration=configurations.get(type);
    if (configuration == null) {
      configuration=new HashMap<String,String>(allLevelMergedConfig);
    }
 else {
      Map<String,String> mergedConfig=configHelper.getMergedConfig(allLevelMergedConfig,configuration);
      configuration.clear();
      configuration.putAll(mergedConfig);
    }
    configurations.put(type,configuration);
  }
  Map<String,String> generalProperties=configurations.get("");
  if (generalProperties == null) {
    generalProperties=new HashMap<String,String>();
    configurations.put("",generalProperties);
  }
  if (kerberosDescriptorProperties != null) {
    generalProperties.putAll(kerberosDescriptorProperties);
  }
  generalProperties.put("host",hostname);
  generalProperties.put("hostname",hostname);
  generalProperties.put("cluster_name",cluster.getClusterName());
  Map<String,Set<String>> clusterHostInfo=StageUtils.getClusterHostInfo(cluster);
  if (clusterHostInfo != null) {
    Map<String,String> componentHosts=new HashMap<String,String>();
    clusterHostInfo=StageUtils.substituteHostIndexes(clusterHostInfo);
    for (    Map.Entry<String,Set<String>> entry : clusterHostInfo.entrySet()) {
      componentHosts.put(entry.getKey(),StringUtils.join(entry.getValue(),","));
    }
    configurations.put("clusterHostInfo",componentHosts);
  }
  return configurations;
}
