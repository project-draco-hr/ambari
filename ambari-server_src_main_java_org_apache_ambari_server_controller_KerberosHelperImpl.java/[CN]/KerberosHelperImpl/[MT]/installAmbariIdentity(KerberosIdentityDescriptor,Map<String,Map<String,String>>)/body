{
  KerberosPrincipalDescriptor principalDescriptor=ambariServerIdentity.getPrincipalDescriptor();
  if (principalDescriptor != null) {
    String principal=variableReplacementHelper.replaceVariables(principalDescriptor.getValue(),configurations);
    KerberosPrincipalEntity ambariServerPrincipalEntity=kerberosPrincipalDAO.find(principal);
    if (ambariServerPrincipalEntity != null) {
      KerberosKeytabDescriptor keytabDescriptor=ambariServerIdentity.getKeytabDescriptor();
      if (keytabDescriptor != null) {
        String keytabFilePath=variableReplacementHelper.replaceVariables(keytabDescriptor.getFile(),configurations);
        injector.getInstance(ConfigureAmbariIdentitiesServerAction.class).installAmbariServerIdentity(principal,ambariServerPrincipalEntity.getCachedKeytabPath(),keytabFilePath,null);
      }
    }
  }
}
