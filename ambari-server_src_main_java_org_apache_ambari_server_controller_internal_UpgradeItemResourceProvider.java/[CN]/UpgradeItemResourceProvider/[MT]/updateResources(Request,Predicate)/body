{
  Iterator<Map<String,Object>> iterator=request.getProperties().iterator();
  if (iterator.hasNext()) {
    Map<String,Object> updateProperties=iterator.next();
    String statusPropertyId=STAGE_MAPPED_IDS.get(StageResourceProvider.STAGE_STATUS);
    String stageStatus=(String)updateProperties.get(statusPropertyId);
    if (stageStatus != null) {
      HostRoleStatus desiredStatus=HostRoleStatus.valueOf(stageStatus);
      Set<Resource> resources=getResources(PropertyHelper.getReadRequest(),predicate);
      for (      Resource resource : resources) {
        Long requestId=(Long)resource.getPropertyValue(UPGRADE_REQUEST_ID);
        Long stageId=(Long)resource.getPropertyValue(UPGRADE_ITEM_STAGE_ID);
        StageResourceProvider.updateStageStatus(requestId,stageId,desiredStatus,getManagementController());
      }
    }
  }
  notifyUpdate(Resource.Type.UpgradeItem,request,predicate);
  return getRequestStatus(null);
}
