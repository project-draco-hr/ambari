{
  long requestId=upgrade.getRequestId().longValue();
  long stageId=item.getStageId().longValue();
  List<HostRoleCommand> commands=getManagementController().getActionManager().getRequestTasks(requestId);
  int pending=0;
  int complete=0;
  int in_progress=0;
  int failed=0;
  for (  HostRoleCommand command : commands) {
    if (stageId != command.getStageId()) {
      continue;
    }
    HostRoleStatus status=command.getStatus();
    if (status.isFailedState()) {
      failed++;
    }
 else {
switch (status) {
case COMPLETED:
        complete++;
      break;
case IN_PROGRESS:
    in_progress++;
  break;
case PENDING:
pending++;
break;
case QUEUED:
in_progress++;
break;
case FAILED:
case ABORTED:
case TIMEDOUT:
failed++;
break;
default :
break;
}
}
}
if (failed > 0) {
return UpgradeState.FAILED;
}
 else if (in_progress > 0) {
return UpgradeState.IN_PROGRESS;
}
 else if (pending > 0) {
return UpgradeState.PENDING;
}
 else if (complete > 0) {
return UpgradeState.COMPLETE;
}
return UpgradeState.NONE;
}
