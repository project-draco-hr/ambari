{
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  eventPublisher=injector.getInstance(AmbariEventPublisher.class);
  EventBus synchronizedBus=new EventBus();
  synchronizedBus.register(injector.getInstance(AlertLifecycleListener.class));
  synchronizedBus.register(injector.getInstance(AlertStateChangedListener.class));
  synchronizedBus.register(injector.getInstance(AlertServiceStateListener.class));
  Field field=AmbariEventPublisher.class.getDeclaredField("m_eventBus");
  field.setAccessible(true);
  field.set(eventPublisher,synchronizedBus);
  dispatchDao=injector.getInstance(AlertDispatchDAO.class);
  definitionDao=injector.getInstance(AlertDefinitionDAO.class);
  alertsDao=injector.getInstance(AlertsDAO.class);
  clusters=injector.getInstance(Clusters.class);
  serviceFactory=injector.getInstance(ServiceFactory.class);
  ormHelper=injector.getInstance(OrmTestHelper.class);
  aggregateMapping=injector.getInstance(AggregateDefinitionMapping.class);
  metaInfo=injector.getInstance(AmbariMetaInfo.class);
  metaInfo.init();
  clusterName="foo";
  clusters.addCluster(clusterName);
  cluster=clusters.getCluster(clusterName);
  cluster.setDesiredStackVersion(new StackId("HDP","2.0.6"));
  Assert.assertNotNull(cluster);
}
