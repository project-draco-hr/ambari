{
  if (viewInstanceEntity == null) {
    return null;
  }
 else {
    Map<String,String> properties=viewInstanceEntity.getPropertyMap();
    for (    Entry<String,String> entry : properties.entrySet()) {
      ParameterConfig parameterConfig=null;
      for (      ParameterConfig paramConfig : viewEntity.getConfiguration().getParameters()) {
        if (StringUtils.equals(paramConfig.getName(),entry.getKey())) {
          parameterConfig=paramConfig;
          break;
        }
      }
      if (parameterConfig == null || !parameterConfig.isMasked()) {
        properties.put(entry.getKey(),entry.getValue());
      }
 else {
        try {
          properties.put(entry.getKey(),masker.unmask(entry.getValue()));
        }
 catch (        MaskException e) {
          LOG.error("Failed to unmask view property",e);
        }
      }
    }
    String rawValue;
    for (    String key : properties.keySet()) {
      rawValue=properties.get(key);
      try {
        properties.put(key,parameterize(rawValue));
      }
 catch (      ParseErrorException ex) {
        LOG.warn(String.format("Error during parsing '%s' parameter. Leaving original value.",key));
      }
    }
    return Collections.unmodifiableMap(properties);
  }
}
