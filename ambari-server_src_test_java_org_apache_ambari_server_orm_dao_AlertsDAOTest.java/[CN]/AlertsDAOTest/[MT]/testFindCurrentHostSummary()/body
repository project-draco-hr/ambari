{
  AlertHostSummaryDTO summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(0,summary.getWarningCount());
  assertEquals(0,summary.getCriticalCount());
  assertEquals(0,summary.getUnknownCount());
  assertEquals(1,summary.getOkCount());
  AlertHistoryEntity h1=m_dao.findCurrentByCluster(m_cluster.getClusterId()).get(1).getAlertHistory();
  h1.setAlertState(AlertState.WARNING);
  m_dao.merge(h1);
  summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(1,summary.getWarningCount());
  assertEquals(0,summary.getCriticalCount());
  assertEquals(0,summary.getUnknownCount());
  assertEquals(0,summary.getOkCount());
  h1.setAlertState(AlertState.CRITICAL);
  m_dao.merge(h1);
  summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(0,summary.getWarningCount());
  assertEquals(1,summary.getCriticalCount());
  assertEquals(0,summary.getUnknownCount());
  assertEquals(0,summary.getOkCount());
  AlertHistoryEntity h2=m_dao.findCurrentByCluster(m_cluster.getClusterId()).get(2).getAlertHistory();
  h2.setHostName(h2.getHostName() + "-foo");
  m_dao.merge(h2);
  summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(0,summary.getWarningCount());
  assertEquals(1,summary.getCriticalCount());
  assertEquals(0,summary.getUnknownCount());
  assertEquals(1,summary.getOkCount());
  AlertHistoryEntity h3=m_dao.findCurrentByCluster(m_cluster.getClusterId()).get(3).getAlertHistory();
  h3.setHostName(h3.getHostName() + "-bar");
  m_dao.merge(h3);
  summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(0,summary.getWarningCount());
  assertEquals(1,summary.getCriticalCount());
  assertEquals(0,summary.getUnknownCount());
  assertEquals(2,summary.getOkCount());
  AlertHistoryEntity h4=m_dao.findCurrentByCluster(m_cluster.getClusterId()).get(4).getAlertHistory();
  h4.setHostName(h4.getHostName() + "-baz");
  h4.setAlertState(AlertState.UNKNOWN);
  m_dao.merge(h3);
  summary=m_dao.findCurrentHostCounts(m_cluster.getClusterId());
  assertEquals(0,summary.getWarningCount());
  assertEquals(1,summary.getCriticalCount());
  assertEquals(1,summary.getUnknownCount());
  assertEquals(2,summary.getOkCount());
}
