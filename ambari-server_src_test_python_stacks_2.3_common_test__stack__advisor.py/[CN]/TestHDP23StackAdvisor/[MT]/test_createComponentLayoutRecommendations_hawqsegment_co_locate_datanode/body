def test_createComponentLayoutRecommendations_hawqsegment_co_locate_datanode(self):
    ' Test that HAWQSegment gets recommended on same host group which has DATANODE'
    services = {'services': [{'StackServices': {'service_name': 'HDFS', }, 'components': [{'StackServiceComponents': {'cardinality': '1+', 'component_category': 'SLAVE', 'component_name': 'DATANODE', 'hostnames': ['c6401.ambari.apache.org'], }, }], }, {'StackServices': {'service_name': 'HAWQ', }, 'components': [{'StackServiceComponents': {'cardinality': '1+', 'component_category': 'SLAVE', 'component_name': 'HAWQSEGMENT', 'hostnames': [], }, }], }], }
    hosts = self.prepareHosts(['c6401.ambari.apache.org', 'c6402.ambari.apache.org'])
    recommendations = self.stackAdvisor.createComponentLayoutRecommendations(services, hosts)
    "\n    Recommendations is as below:\n                                  {\n                                    'blueprint':{\n                                      'host_groups':[\n                                        {\n                                          'name':'host-group-1',\n                                          'components':[ ]\n                                        },\n                                        {\n                                          'name':'host-group-2',\n                                          'components':[\n                                            {\n                                              'name':'DATANODE'\n                                            },\n                                            {\n                                              'name':'HAWQSEGMENT'\n                                            }\n                                          ]\n                                        }\n                                      ]\n                                    },\n                                      'blueprint_cluster_binding':{\n                                        'host_groups':[\n                                          {\n                                            'hosts':[\n                                              {\n                                                'fqdn':'c6402.ambari.apache.org'\n                                              }\n                                            ],\n                                            'name':'host-group-1'\n                                          },\n                                          {\n                                            'hosts':[\n                                              {\n                                                'fqdn':'c6401.ambari.apache.org'\n                                              }\n                                            ],\n                                            'name':'host-group-2'\n                                          }\n                                        ]\n                                      }\n                                    }\n    "
    for hostgroup in recommendations['blueprint']['host_groups']:
        component_names = [component['name'] for component in hostgroup['components']]
        if ('DATANODE' in component_names):
            self.assertTrue(('HAWQSEGMENT' in component_names))
        if ('DATANODE' not in component_names):
            self.assertTrue(('HAWQSEGMENT' not in component_names))
    services['services'][0]['components'][0]['StackServiceComponents']['hostnames'] = []
    recommendations = self.stackAdvisor.createComponentLayoutRecommendations(services, hosts)
    for hostgroup in recommendations['blueprint']['host_groups']:
        component_names = [component['name'] for component in hostgroup['components']]
        self.assertTrue(('HAWQSEGMENT' in component_names))
        self.assertTrue(('DATANODE' in component_names))
