{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Update HostRoleState: " + "HostName " + hostname + " requestId "+ requestId+ " stageId "+ stageId+ " role "+ role+ " report "+ report);
  }
  long now=System.currentTimeMillis();
  List<HostRoleCommandEntity> commands=hostRoleCommandDAO.findByHostRole(hostname,requestId,stageId,role);
  for (  HostRoleCommandEntity command : commands) {
    command.setStatus(HostRoleStatus.valueOf(report.getStatus()));
    command.setStdOut(report.getStdOut().getBytes());
    command.setStdError(report.getStdErr().getBytes());
    command.setStructuredOut(report.getStructuredOut() == null ? null : report.getStructuredOut().getBytes());
    if (command.getStatus() == HostRoleStatus.COMPLETED || command.getStatus() == HostRoleStatus.ABORTED || command.getStatus() == HostRoleStatus.FAILED) {
      command.setEndTime(now);
    }
    command.setExitcode(report.getExitCode());
    hostRoleCommandDAO.merge(command);
  }
}
