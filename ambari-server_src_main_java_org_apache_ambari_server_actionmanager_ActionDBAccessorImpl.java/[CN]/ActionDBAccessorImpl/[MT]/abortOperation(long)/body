{
  long now=System.currentTimeMillis();
  endRequest(requestId);
  List<HostRoleCommandEntity> commands=hostRoleCommandDAO.findByRequest(requestId);
  for (  HostRoleCommandEntity command : commands) {
    if (command.getStatus() == HostRoleStatus.QUEUED || command.getStatus() == HostRoleStatus.IN_PROGRESS || command.getStatus() == HostRoleStatus.PENDING) {
      command.setStatus(HostRoleStatus.ABORTED);
      command.setEndTime(now);
      LOG.info("Aborting command. Hostname " + command.getHostName() + " role "+ command.getRole()+ " requestId "+ command.getRequestId()+ " taskId "+ command.getTaskId()+ " stageId "+ command.getStageId());
      auditLog(command,requestId);
    }
  }
  if (!commands.isEmpty()) {
    hostRoleCommandDAO.mergeAll(commands);
  }
}
