{
  if (!tasksForRequest.containsKey(requestId)) {
    tasksForRequest.put(requestId,new HashMap<Long,HostRoleStatus>());
  }
  tasksForRequest.get(requestId).put(commandEntity.getTaskId(),commandEntity.getStatus());
  HostRoleStatus calculatedStatus=CalculatedStatus.calculateSummaryStatusOfStage(CalculatedStatus.calculateStatusCounts(tasksForRequest.get(requestId).values()),tasksForRequest.get(requestId).size(),false);
  boolean hasInProgress=false;
  for (  HostRoleStatus hrcs : tasksForRequest.get(requestId).values()) {
    if (!hrcs.isCompletedState()) {
      hasInProgress=true;
      break;
    }
  }
  if (!hasInProgress) {
    tasksForRequest.remove(requestId);
  }
  return calculatedStatus;
}
