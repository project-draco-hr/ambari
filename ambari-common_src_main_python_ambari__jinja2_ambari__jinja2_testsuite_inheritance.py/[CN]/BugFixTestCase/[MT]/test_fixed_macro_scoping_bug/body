def test_fixed_macro_scoping_bug(self):
    assert (Environment(loader=DictLoader({'test.html': "        {% extends 'details.html' %}\n\n        {% macro my_macro() %}\n        my_macro\n        {% endmacro %}\n\n        {% block inner_box %}\n            {{ my_macro() }}\n        {% endblock %}\n            ", 'details.html': "        {% extends 'standard.html' %}\n\n        {% macro my_macro() %}\n        my_macro\n        {% endmacro %}\n\n        {% block content %}\n            {% block outer_box %}\n                outer_box\n                {% block inner_box %}\n                    inner_box\n                {% endblock %}\n            {% endblock %}\n        {% endblock %}\n        ", 'standard.html': '\n        {% block content %}&nbsp;{% endblock %}\n        ', })).get_template('test.html').render().split() == [u'outer_box', u'my_macro'])
