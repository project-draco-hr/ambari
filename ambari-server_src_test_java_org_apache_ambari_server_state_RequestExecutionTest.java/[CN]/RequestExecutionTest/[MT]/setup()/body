{
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  clusters=injector.getInstance(Clusters.class);
  metaInfo=injector.getInstance(AmbariMetaInfo.class);
  requestExecutionFactory=injector.getInstance(RequestExecutionFactory.class);
  requestScheduleDAO=injector.getInstance(RequestScheduleDAO.class);
  clusterName="foo";
  clusters.addCluster(clusterName);
  cluster=clusters.getCluster(clusterName);
  cluster.setDesiredStackVersion(new StackId("HDP-0.1"));
  Assert.assertNotNull(cluster);
  clusters.addHost("h1");
  clusters.addHost("h2");
  clusters.addHost("h3");
  Assert.assertNotNull(clusters.getHost("h1"));
  Assert.assertNotNull(clusters.getHost("h2"));
  Assert.assertNotNull(clusters.getHost("h3"));
  clusters.getHost("h1").persist();
  clusters.getHost("h2").persist();
  clusters.getHost("h3").persist();
}
