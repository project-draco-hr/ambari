{
  ActionQueue aq=new ActionQueue();
  Clusters fsm=mock(Clusters.class);
  Cluster oneClusterMock=mock(Cluster.class);
  when(fsm.getCluster(anyString())).thenReturn(oneClusterMock);
  ActionDBAccessor db=mock(ActionDBAccessor.class);
  List<Stage> stages=new ArrayList<Stage>();
  Stage s=new Stage(1,"/bogus","clusterName");
  s.setStageId(977);
  stages.add(s);
  String hostname="ahost.ambari.apache.org";
  HostAction ha=new HostAction(hostname);
  HostRoleCommand hrc=new HostRoleCommand(hostname,Role.DATANODE,RoleCommand.START,null);
  ha.addHostRoleCommand(hrc);
  ha.setManifest("1-977-manifest");
  s.addHostAction(hostname,ha);
  when(db.getPendingStages()).thenReturn(stages);
  ActionScheduler scheduler=new ActionScheduler(100,100,db,aq,fsm,3);
  scheduler.start();
  Thread.sleep(500);
  verify(db,atLeastOnce()).timeoutHostRole(1,977,Role.DATANODE);
}
