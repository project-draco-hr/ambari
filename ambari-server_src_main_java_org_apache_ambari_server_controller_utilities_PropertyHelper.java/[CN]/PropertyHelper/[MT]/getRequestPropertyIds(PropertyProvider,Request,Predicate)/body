{
  Set<PropertyId> requestPropertyIds=new HashSet<PropertyId>(request.getPropertyIds());
  Set<PropertyId> providerPropertyIds=new HashSet<PropertyId>(provider.getPropertyIds());
  if (requestPropertyIds == null || requestPropertyIds.isEmpty()) {
    return providerPropertyIds;
  }
  if (predicate != null) {
    requestPropertyIds.addAll(PredicateHelper.getPropertyIds(predicate));
  }
  requestPropertyIds.retainAll(providerPropertyIds);
  return requestPropertyIds;
}
