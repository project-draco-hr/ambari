{
  Set<PropertyId> propertyIds=request.getPropertyIds();
  Set<PropertyId> requestPropertyIds=propertyIds == null ? null : new HashSet<PropertyId>(propertyIds);
  providerPropertyIds=new HashSet<PropertyId>(providerPropertyIds);
  if (requestPropertyIds == null || requestPropertyIds.isEmpty()) {
    return providerPropertyIds;
  }
  if (predicate != null) {
    requestPropertyIds.addAll(PredicateHelper.getPropertyIds(predicate));
  }
  requestPropertyIds.retainAll(providerPropertyIds);
  return requestPropertyIds;
}
