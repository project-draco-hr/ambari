{
  NodeImpl node=new NodeImpl();
  registerNode(node);
  verifyNode(node);
  long counter=0;
  sendHealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.HEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  sendHealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.HEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.HEALTHY,node.getHealthStatus().getHealthStatus());
  sendUnhealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.UNHEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNHEALTHY,node.getHealthStatus().getHealthStatus());
  sendUnhealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.UNHEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNHEALTHY,node.getHealthStatus().getHealthStatus());
  sendHealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.HEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.HEALTHY,node.getHealthStatus().getHealthStatus());
  timeoutNode(node);
  verifyNodeState(node,NodeState.HEARTBEAT_LOST);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNKNOWN,node.getHealthStatus().getHealthStatus());
  timeoutNode(node);
  verifyNodeState(node,NodeState.HEARTBEAT_LOST);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNKNOWN,node.getHealthStatus().getHealthStatus());
  sendUnhealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.UNHEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNHEALTHY,node.getHealthStatus().getHealthStatus());
  timeoutNode(node);
  verifyNodeState(node,NodeState.HEARTBEAT_LOST);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.UNKNOWN,node.getHealthStatus().getHealthStatus());
  sendHealthyHeartbeat(node,++counter);
  verifyNodeState(node,NodeState.HEALTHY);
  Assert.assertEquals(counter,node.getLastHeartbeatTime());
  Assert.assertEquals(HealthStatus.HEALTHY,node.getHealthStatus().getHealthStatus());
}
