{
  String urlToRead="http://foo.com";
  String requestMethod="GET";
  URL url=new URL(urlToRead);
  HttpURLConnection conn1=(HttpURLConnection)url.openConnection();
  conn1=this.viewContext.getHttpImpersonator().doAs(conn1,requestMethod);
  Assert.assertEquals(requestMethod,conn1.getRequestMethod());
  Assert.assertEquals(username,conn1.getRequestProperty("doAs"));
  HttpURLConnection conn2=(HttpURLConnection)url.openConnection();
  conn2=this.viewContext.getHttpImpersonator().doAs(conn1,requestMethod,"admin","username");
  Assert.assertEquals(requestMethod,conn1.getRequestMethod());
  Assert.assertEquals("admin",conn1.getRequestProperty("username"));
}
