{
  AmbariManagementController ambariManagementController=injector.getInstance(AmbariManagementController.class);
  Clusters clusters=ambariManagementController.getClusters();
  Map<String,Cluster> clusterMap=getCheckedClusterMap(clusters);
  for (  final Cluster cluster : clusterMap.values()) {
    Config capacityScheduler=cluster.getDesiredConfigByType(CAPACITY_SCHEDULER_CONFIG);
    if (capacityScheduler != null) {
      Map<String,String> capacitySchedulerProperties=capacityScheduler.getProperties();
      Set<String> leafQueues;
      leafQueues=getCapacitySchedulerLeafQueues(capacitySchedulerProperties);
      Set<String> installedServices=cluster.getServices().keySet();
      if (leafQueues == null || leafQueues.isEmpty()) {
        LOG.warn("There is no leafQueues in capacity-scheduler");
        return;
      }
      if (installedServices.contains(cluster.getServiceByConfigType(WEBHCAT_SITE_CONFIG)) && !isQueueNameValid(cluster,leafQueues,WEBHCAT_SITE_QUEUE_NAME,WEBHCAT_SITE_CONFIG)) {
        updateQueueName(cluster,leafQueues,WEBHCAT_SITE_QUEUE_NAME,WEBHCAT_SITE_CONFIG);
      }
      if (installedServices.contains(cluster.getServiceByConfigType(TEZ_SITE_CONFIG)) && !isQueueNameValid(cluster,leafQueues,TEZ_SITE_QUEUE_NAME,TEZ_SITE_CONFIG)) {
        updateQueueName(cluster,leafQueues,TEZ_SITE_QUEUE_NAME,TEZ_SITE_CONFIG);
      }
      if (installedServices.contains(cluster.getServiceByConfigType(YARN_ENV_CONFIG)) && !isQueueNameValid(cluster,leafQueues,YARN_ENV_QUEUE_NAME,YARN_ENV_CONFIG)) {
        updateQueueName(cluster,leafQueues,YARN_ENV_QUEUE_NAME,YARN_ENV_CONFIG);
      }
      if (installedServices.contains(cluster.getServiceByConfigType(MAPRED_SITE_CONFIG)) && !isQueueNameValid(cluster,leafQueues,MAPRED_SITE_QUEUE_NAME,MAPRED_SITE_CONFIG)) {
        updateQueueName(cluster,leafQueues,MAPRED_SITE_QUEUE_NAME,MAPRED_SITE_CONFIG);
      }
    }
  }
}
