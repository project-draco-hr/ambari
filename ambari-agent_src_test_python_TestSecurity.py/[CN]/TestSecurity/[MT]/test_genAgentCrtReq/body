@patch('subprocess.Popen')
@patch('subprocess.Popen.communicate')
def test_genAgentCrtReq(self, communicate_mock, popen_mock):
    man = CertificateManager(self.config)
    p = MagicMock(spec=subprocess.Popen)
    p.communicate = communicate_mock
    popen_mock.return_value = p
    man.genAgentCrtReq()
    self.assertTrue(popen_mock.called)
    self.assertTrue(communicate_mock.called)
