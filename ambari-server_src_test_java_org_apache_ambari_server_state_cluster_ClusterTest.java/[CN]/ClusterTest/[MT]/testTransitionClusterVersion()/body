{
  createDefaultCluster();
  String stack="HDP";
  String version="0.2";
  StackId stackId=new StackId(stack,version);
  helper.getOrCreateRepositoryVersion(stackId,version);
  c1.createClusterVersion(stackId,version,"admin",RepositoryVersionState.INSTALLING);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.INSTALLING);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADING,RepositoryVersionState.INSTALLING);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADED,RepositoryVersionState.INSTALLING);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADE_FAILED,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALL_FAILED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADING,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADED,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADE_FAILED,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.OUT_OF_SYNC,RepositoryVersionState.INSTALL_FAILED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLING);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADE_FAILED,RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.INSTALLED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.OUT_OF_SYNC);
  checkStackVersionState(stackId,version,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADING,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADED,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADE_FAILED,RepositoryVersionState.OUT_OF_SYNC);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLING);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.UPGRADING);
  checkStackVersionState(stackId,version,RepositoryVersionState.UPGRADING);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.UPGRADING);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.UPGRADING);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.UPGRADING);
  assertStateException(stackId,version,RepositoryVersionState.OUT_OF_SYNC,RepositoryVersionState.UPGRADING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.UPGRADE_FAILED);
  checkStackVersionState(stackId,version,RepositoryVersionState.UPGRADE_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.UPGRADE_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.UPGRADE_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.UPGRADE_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADED,RepositoryVersionState.UPGRADE_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.OUT_OF_SYNC,RepositoryVersionState.UPGRADE_FAILED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.UPGRADING);
  checkStackVersionState(stackId,version,RepositoryVersionState.UPGRADING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.UPGRADED);
  checkStackVersionState(stackId,version,RepositoryVersionState.UPGRADED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.UPGRADED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.UPGRADED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADING,RepositoryVersionState.UPGRADED);
  assertStateException(stackId,version,RepositoryVersionState.UPGRADE_FAILED,RepositoryVersionState.UPGRADED);
  assertStateException(stackId,version,RepositoryVersionState.OUT_OF_SYNC,RepositoryVersionState.UPGRADED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.CURRENT);
  checkStackVersionState(stackId,version,RepositoryVersionState.CURRENT);
  checkStackVersionState(new StackId("HDP","0.1"),"0.1",RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.CURRENT);
}
