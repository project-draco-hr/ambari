{
  createDefaultCluster();
  String stack="HDP";
  String version="0.2";
  StackId stackId=new StackId(stack,version);
  helper.getOrCreateRepositoryVersion(stackId,version);
  c1.createClusterVersion(stackId,version,"admin",RepositoryVersionState.INSTALLING);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALL_FAILED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.INSTALL_FAILED);
  assertStateException(stackId,version,RepositoryVersionState.OUT_OF_SYNC,RepositoryVersionState.INSTALL_FAILED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLING);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.INSTALLED);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.OUT_OF_SYNC);
  checkStackVersionState(stackId,version,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.CURRENT,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.OUT_OF_SYNC);
  assertStateException(stackId,version,RepositoryVersionState.INSTALL_FAILED,RepositoryVersionState.OUT_OF_SYNC);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLING);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLING);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.INSTALLED);
  checkStackVersionState(stackId,version,RepositoryVersionState.INSTALLED);
  c1.setDesiredStackVersion(stackId);
  c1.transitionClusterVersion(stackId,version,RepositoryVersionState.CURRENT);
  checkStackVersionState(stackId,version,RepositoryVersionState.CURRENT);
  checkStackVersionState(new StackId("HDP","0.1"),"0.1",RepositoryVersionState.INSTALLED);
  assertStateException(stackId,version,RepositoryVersionState.INSTALLED,RepositoryVersionState.CURRENT);
}
