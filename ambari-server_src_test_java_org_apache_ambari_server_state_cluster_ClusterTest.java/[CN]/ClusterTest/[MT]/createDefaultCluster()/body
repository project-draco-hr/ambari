{
  clusters.addCluster("c1");
  c1=clusters.getCluster("c1");
  Assert.assertEquals("c1",c1.getClusterName());
  Assert.assertEquals(1,c1.getClusterId());
  clusters.addHost("h1");
  clusters.addHost("h2");
  Host host1=clusters.getHost("h1");
  host1.setIPv4("ipv4");
  host1.setIPv6("ipv6");
  Host host2=clusters.getHost("h2");
  host2.setIPv4("ipv4");
  host2.setIPv6("ipv6");
  Map<String,String> hostAttributes=new HashMap<String,String>();
  hostAttributes.put("os_family","redhat");
  hostAttributes.put("os_release_version","5.9");
  host1.setHostAttributes(hostAttributes);
  host2.setHostAttributes(hostAttributes);
  host1.persist();
  host2.persist();
  StackId stackId=new StackId("HDP-0.1");
  c1.setDesiredStackVersion(stackId);
  helper.getOrCreateRepositoryVersion(stackId.getStackName(),stackId.getStackVersion());
  c1.createClusterVersion(stackId.getStackName(),stackId.getStackVersion(),"admin",RepositoryVersionState.UPGRADING);
  c1.transitionClusterVersion(stackId.getStackName(),stackId.getStackVersion(),RepositoryVersionState.CURRENT);
  clusters.mapHostToCluster("h1","c1");
  clusters.mapHostToCluster("h2","c1");
  ClusterVersionDAOMock.failOnCurrentVersionState=false;
}
