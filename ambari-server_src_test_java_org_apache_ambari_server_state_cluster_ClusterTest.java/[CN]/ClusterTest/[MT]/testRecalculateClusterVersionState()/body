{
  Host h1=clusters.getHost("h1");
  h1.setState(HostState.HEALTHY);
  StackId stackId=new StackId("HDP-0.1");
  RepositoryVersionEntity repositoryVersionEntity=helper.getOrCreateRepositoryVersion(stackId.getStackId(),"1.0-1000");
  c1.createClusterVersion(stackId.getStackId(),"1.0-1000","admin",RepositoryVersionState.INSTALLING);
  c1.setCurrentStackVersion(stackId);
  c1.recalculateClusterVersionState("1.0-1000");
  checkStackVersionState(stackId.getStackId(),"1.0-1000",RepositoryVersionState.OUT_OF_SYNC);
  helper.createHostVersion("h1",repositoryVersionEntity,RepositoryVersionState.INSTALLING);
  c1.recalculateClusterVersionState("1.0-1000");
  checkStackVersionState(stackId.getStackId(),"1.0-1000",RepositoryVersionState.INSTALLING);
  h1.setState(HostState.UNHEALTHY);
  c1.recalculateClusterVersionState("1.0-1000");
  checkStackVersionState(stackId.getStackId(),"1.0-1000",RepositoryVersionState.OUT_OF_SYNC);
  c1.recalculateClusterVersionState("1.0-2086");
  checkStackVersionState(stackId.getStackId(),"1.0-2086",RepositoryVersionState.CURRENT);
}
