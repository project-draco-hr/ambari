{
  if (wadlXmlRepresentation == null) {
    if (application.getResources().getBase() == null) {
      application.getResources().setBase(uriInfo.getBaseUri().toString());
    }
    try {
      final Marshaller marshaller=wadlContext.getJAXBContext().createMarshaller();
      marshaller.setProperty(XML_HEADERS,"<?xml-stylesheet type='text/xsl' href='/wadl.xsl'?>");
      marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT,true);
      final ByteArrayOutputStream os=new ByteArrayOutputStream();
      marshaller.marshal(application,os);
      wadlXmlRepresentation=os.toByteArray();
      os.close();
    }
 catch (    Exception e) {
      LOG.warn("Could not marshal wadl Application.");
      return javax.ws.rs.core.Response.ok(application).build();
    }
  }
  return Response.ok(new ByteArrayInputStream(wadlXmlRepresentation)).build();
}
