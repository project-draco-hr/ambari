def test_recommendRangerConfigurations(self):
    clusterData = {}
    services = {'Versions': {'stack_version': '2.2', }, 'services': [{'StackServices': {'service_name': 'RANGER', }, 'components': [{'StackServiceComponents': {'component_name': 'RANGER_ADMIN', 'hostnames': ['host1'], }, }], }], 'configurations': {'admin-properties': {'properties': {'DB_FLAVOR': 'NOT_EXISTING', }, }, 'ranger-admin-site': {'properties': {'ranger.service.http.port': '7777', 'ranger.service.http.enabled': 'true', }, }, }, }
    expected = {'admin-properties': {'properties': {'SQL_CONNECTOR_JAR': '/usr/share/java/mysql-connector-java.jar', 'policymgr_external_url': 'http://host1:7777', }, }, }
    recommendedConfigurations = {}
    self.stackAdvisor.recommendRangerConfigurations(recommendedConfigurations, clusterData, services, None)
    self.assertEquals(recommendedConfigurations, expected)
    configurations = {'admin-properties': {'properties': {'DB_FLAVOR': 'POSTGRES', }, }, 'ranger-admin-site': {'properties': {'ranger.service.https.port': '7777', 'ranger.service.http.enabled': 'false', }, }, }
    services['configurations'] = configurations
    expected = {'admin-properties': {'properties': {'SQL_CONNECTOR_JAR': '/usr/share/java/postgresql.jar', 'policymgr_external_url': 'https://host1:7777', }, }, }
    recommendedConfigurations = {}
    self.stackAdvisor.recommendRangerConfigurations(recommendedConfigurations, clusterData, services, None)
    self.assertEquals(recommendedConfigurations, expected)
    configurations = {'admin-properties': {'properties': {'DB_FLAVOR': 'ORACLE', }, }, 'ranger-site': {'properties': {'http.enabled': 'false', 'https.service.port': '8888', }, }, }
    services['configurations'] = configurations
    expected = {'admin-properties': {'properties': {'SQL_CONNECTOR_JAR': '/usr/share/java/ojdbc6.jar', 'policymgr_external_url': 'https://host1:8888', }, }, }
    recommendedConfigurations = {}
    self.stackAdvisor.recommendRangerConfigurations(recommendedConfigurations, clusterData, services, None)
    self.assertEquals(recommendedConfigurations, expected)
    services['ambari-server-properties'] = {'ambari.ldap.isConfigured': 'true', 'authentication.ldap.bindAnonymously': 'false', 'authentication.ldap.baseDn': 'dc=apache,dc=org', 'authentication.ldap.groupNamingAttr': 'cn', 'authentication.ldap.primaryUrl': 'c6403.ambari.apache.org:389', 'authentication.ldap.userObjectClass': 'posixAccount', 'authentication.ldap.secondaryUrl': 'c6403.ambari.apache.org:389', 'authentication.ldap.usernameAttribute': 'uid', 'authentication.ldap.dnAttribute': 'dn', 'authentication.ldap.useSSL': 'false', 'authentication.ldap.managerPassword': '/etc/ambari-server/conf/ldap-password.dat', 'authentication.ldap.groupMembershipAttr': 'memberUid', 'authentication.ldap.groupObjectClass': 'posixGroup', 'authentication.ldap.managerDn': 'uid=hdfs,ou=people,ou=dev,dc=apache,dc=org', }
    services['configurations'] = {}
    expected = {'admin-properties': {'properties': {'policymgr_external_url': 'http://host1:6080', }, }, 'usersync-properties': {'properties': {'SYNC_LDAP_URL': 'c6403.ambari.apache.org:389', 'SYNC_LDAP_BIND_DN': 'uid=hdfs,ou=people,ou=dev,dc=apache,dc=org', 'SYNC_LDAP_USER_OBJECT_CLASS': 'posixAccount', 'SYNC_LDAP_USER_NAME_ATTRIBUTE': 'uid', }, }, }
    recommendedConfigurations = {}
    self.stackAdvisor.recommendRangerConfigurations(recommendedConfigurations, clusterData, services, None)
    self.assertEquals(recommendedConfigurations, expected)
