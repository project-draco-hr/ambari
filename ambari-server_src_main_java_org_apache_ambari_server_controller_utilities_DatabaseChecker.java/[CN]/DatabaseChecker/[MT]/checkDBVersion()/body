{
  LOG.info("Checking DB store version");
  if (ambariMetaInfo == null) {
    ambariMetaInfo=injector.getInstance(AmbariMetaInfo.class);
  }
  if (metainfoDAO == null) {
    metainfoDAO=injector.getInstance(MetainfoDAO.class);
  }
  MetainfoEntity schemaVersionEntity=metainfoDAO.findByKey(Configuration.SERVER_VERSION_KEY);
  String schemaVersion=null;
  String serverVersion=null;
  if (schemaVersionEntity != null) {
    schemaVersion=schemaVersionEntity.getMetainfoValue();
    serverVersion=ambariMetaInfo.getServerVersion();
  }
  if (schemaVersionEntity == null || VersionUtils.compareVersions(schemaVersion,serverVersion,3) != 0) {
    String error="Current database store version is not compatible with " + "current server version" + ", serverVersion=" + serverVersion + ", schemaVersion="+ schemaVersion;
    LOG.warn(error);
    throw new AmbariException(error);
  }
  LOG.info("DB store version is compatible");
}
