{
  Map<String,Map<String,RoleStateTracker>> entrySet=componentAndRoleStates.getAllRoles(clusterIdAndRev);
  for (  Map.Entry<String,Map<String,RoleStateTracker>> entry : entrySet.entrySet()) {
    String componentName=entry.getKey();
    Set<Map.Entry<String,RoleStateTracker>> roleSet=entry.getValue().entrySet();
    for (    Map.Entry<String,RoleStateTracker> entryVal : roleSet) {
      String roleName=entryVal.getKey();
      if (forceUninstall) {
        addAction(getStopRoleAction(clusterIdAndRev.getClusterId(),clusterIdAndRev.getRevision(),componentName,roleName),allActions);
        addAction(getUninstallRoleAction(clusterIdAndRev.getClusterId(),clusterIdAndRev.getRevision(),componentName,roleName),allActions);
      }
 else {
        RoleStateTracker stateTracker=entryVal.getValue();
        if (stateTracker.continueRunning)         continue;
        addAction(getStopRoleAction(clusterIdAndRev.getClusterId(),clusterIdAndRev.getRevision(),componentName,roleName),allActions);
        if (stateTracker.uninstall)         addAction(getUninstallRoleAction(clusterIdAndRev.getClusterId(),clusterIdAndRev.getRevision(),componentName,roleName),allActions);
      }
    }
  }
}
