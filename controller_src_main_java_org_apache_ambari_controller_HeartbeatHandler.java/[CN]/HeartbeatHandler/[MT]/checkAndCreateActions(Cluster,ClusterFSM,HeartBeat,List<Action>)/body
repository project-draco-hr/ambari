{
  for (  ServiceFSM service : clusterFsm.getServices()) {
    if (service.getServiceState() == ServiceState.STARTED) {
      ComponentPlugin plugin=cluster.getComponentDefinition(service.getServiceName());
      String role=plugin.runCheckRole();
      boolean checker=agentPlayingRole(heartbeat,role);
      if (checker) {
        String id=getActionIDForServiceAvailability(cluster,service);
        boolean serviceActivated=false;
        for (        ActionResult result : heartbeat.getActionResults()) {
          if (result.getId().equals(id)) {
            if (result.getCommandResult().getExitCode() == 0) {
              StateMachineInvoker.getAMBARIEventHandler().handle(new ServiceEvent(ServiceEventType.AVAILABLE_CHECK_SUCCESS,service));
              serviceActivated=true;
            }
            break;
          }
        }
        if (!serviceActivated) {
          Action action=plugin.checkService(cluster.getName(),role);
          fillActionDetails(action,cluster.getID(),cluster.getLatestRevision(),service.getServiceName(),role);
          action.setId(id);
          action.setKind(Action.Kind.RUN_ACTION);
          allActions.add(action);
        }
      }
    }
  }
}
