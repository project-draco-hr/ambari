{
  Matcher m=HOSTGROUP_REGEX.matcher(origValue);
  if (m.find()) {
    String hostGroupName=m.group(1);
    HostGroup hostGroup=hostGroups.get(hostGroupName);
    return origValue.replace(m.group(0),hostGroup.getHostInfo().iterator().next());
  }
 else {
    Collection<HostGroup> matchingGroups=getHostGroupsForComponent(component,hostGroups.values());
    if (matchingGroups.size() == 1) {
      return origValue.replace("localhost",matchingGroups.iterator().next().getHostInfo().iterator().next());
    }
 else {
      Cardinality cardinality=stackDefinition.getCardinality(component);
      if (matchingGroups.isEmpty() && cardinality.isValidCount(0)) {
        return origValue;
      }
 else {
        if (isNameNodeHAEnabled(properties) && isComponentNameNode() && (matchingGroups.size() == 2)) {
          if (properties.containsKey("core-site") && properties.get("core-site").get("fs.defaultFS").equals(origValue)) {
            return origValue;
          }
          if (properties.containsKey("hbase-site") && properties.get("hbase-site").get("hbase.rootdir").equals(origValue)) {
            return origValue;
          }
          if (properties.containsKey("accumulo-site") && properties.get("accumulo-site").get("instance.volumes").equals(origValue)) {
            return origValue;
          }
          if (!origValue.contains("localhost")) {
            return origValue;
          }
        }
        if (isNameNodeHAEnabled(properties) && isComponentSecondaryNameNode() && (matchingGroups.isEmpty())) {
          return origValue;
        }
        if (isYarnResourceManagerHAEnabled(properties) && isComponentResourceManager() && (matchingGroups.size() == 2)) {
          if (!origValue.contains("localhost")) {
            return origValue;
          }
        }
        if ((isOozieServerHAEnabled(properties)) && isComponentOozieServer() && (matchingGroups.size() > 1)) {
          if (!origValue.contains("localhost")) {
            return origValue;
          }
        }
        if ((isHiveServerHAEnabled(properties)) && isComponentHiveServer() && (matchingGroups.size() > 1)) {
          if (!origValue.contains("localhost")) {
            return origValue;
          }
        }
        if ((isComponentHiveMetaStoreServer()) && matchingGroups.size() > 1) {
          if (!origValue.contains("localhost")) {
            return origValue;
          }
        }
        throw new IllegalArgumentException("Unable to update configuration property " + "'" + propertyName + "'"+ " with topology information. "+ "Component '"+ component+ "' is not mapped to any host group or is mapped to multiple groups.");
      }
    }
  }
}
