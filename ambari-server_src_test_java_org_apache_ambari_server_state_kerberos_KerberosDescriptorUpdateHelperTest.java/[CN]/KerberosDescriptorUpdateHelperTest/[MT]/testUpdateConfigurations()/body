{
  KerberosDescriptor oldValue=KERBEROS_DESCRIPTOR_FACTORY.createInstance("{\n" + "  \"configurations\": [\n" + "    {\n"+ "      \"core-site\": {\n"+ "        \"hadoop.security.authentication\": \"kerberos\",\n"+ "        \"hadoop.security.authorization\": \"true\",\n"+ "        \"hadoop.proxyuser.HTTP.groups\": \"${hadoop-env/proxyuser_group}\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"some-site\": {\n"+ "        \"property.unchanged\": \"value 1\",\n"+ "        \"property.removed\": \"removed value\",\n"+ "        \"property.altered\": \"old value\"\n,"+ "        \"property.property.changed.in.new\": \"orig value\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"old-site\": {\n"+ "        \"property\": \"value\"\n"+ "      }\n"+ "    }\n"+ "  ]\n"+ "}\n");
  KerberosDescriptor newValue=KERBEROS_DESCRIPTOR_FACTORY.createInstance("{\n" + "  \"configurations\": [\n" + "    {\n"+ "      \"core-site\": {\n"+ "        \"hadoop.security.authentication\": \"kerberos\",\n"+ "        \"hadoop.security.authorization\": \"true\",\n"+ "        \"hadoop.proxyuser.HTTP.groups\": \"${hadoop-env/proxyuser_group}\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"some-site\": {\n"+ "        \"property.unchanged\": \"value 1\",\n"+ "        \"property.added\": \"added value\",\n"+ "        \"property.altered\": \"new value\",\n"+ "        \"property.changed.in.new\": \"new value\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"new-site\": {\n"+ "        \"property.for.new.site\": \"value\"\n"+ "      }\n"+ "    }\n"+ "  ]\n"+ "}\n");
  KerberosDescriptor userValue=KERBEROS_DESCRIPTOR_FACTORY.createInstance("{\n" + "  \"configurations\": [\n" + "    {\n"+ "      \"core-site\": {\n"+ "        \"hadoop.security.authentication\": \"kerberos\",\n"+ "        \"hadoop.security.authorization\": \"true\",\n"+ "        \"hadoop.proxyuser.HTTP.groups\": \"${hadoop-env/proxyuser_group}\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"some-site\": {\n"+ "        \"property.unchanged\": \"value 1\",\n"+ "        \"property.removed\": \"changed removed value\",\n"+ "        \"property.altered\": \"custom value\"\n,"+ "        \"property.property.changed.in.new\": \"orig value\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"old-site\": {\n"+ "        \"property\": \"value\"\n"+ "      }\n"+ "    }\n"+ "  ]\n"+ "}\n");
  KerberosDescriptor updatedUserValue=KerberosDescriptorUpdateHelper.updateUserKerberosDescriptor(oldValue,newValue,userValue);
  Assert.assertEquals(GSON.toJson(KERBEROS_DESCRIPTOR_FACTORY.createInstance("{\n" + "  \"configurations\": [\n" + "    {\n"+ "      \"core-site\": {\n"+ "        \"hadoop.security.authentication\": \"kerberos\",\n"+ "        \"hadoop.security.authorization\": \"true\",\n"+ "        \"hadoop.proxyuser.HTTP.groups\": \"${hadoop-env/proxyuser_group}\"\n"+ "      }\n"+ "    },\n"+ "    {\n"+ "      \"some-site\": {\n"+ "        \"property.unchanged\": \"value 1\",\n"+ "        \"property.added\": \"added value\",\n"+ "        \"property.altered\": \"custom value\",\n"+ "        \"property.changed.in.new\": \"new value\"\n"+ "      }\n"+ "    }\n"+ "  ]\n"+ "}\n").toMap()),GSON.toJson(updatedUserValue.toMap()));
}
