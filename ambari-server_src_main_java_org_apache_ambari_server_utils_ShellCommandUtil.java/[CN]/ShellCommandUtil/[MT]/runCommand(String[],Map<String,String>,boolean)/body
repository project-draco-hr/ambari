{
  String[] processArgs;
  if (sudo) {
    processArgs=new String[args.length + 1];
    processArgs[0]=AMBARI_SUDO;
    System.arraycopy(args,0,processArgs,1,args.length);
  }
 else {
    processArgs=args;
  }
  ProcessBuilder builder=new ProcessBuilder(processArgs);
  if (vars != null) {
    Map<String,String> env=builder.environment();
    env.putAll(vars);
  }
  Process process;
  if (WINDOWS) {
synchronized (WindowsProcessLaunchLock) {
      process=builder.start();
    }
  }
 else {
    process=builder.start();
  }
  process.waitFor();
  String stdout=streamToString(process.getInputStream());
  String stderr=streamToString(process.getErrorStream());
  int exitCode=process.exitValue();
  return new Result(exitCode,stdout,stderr);
}
