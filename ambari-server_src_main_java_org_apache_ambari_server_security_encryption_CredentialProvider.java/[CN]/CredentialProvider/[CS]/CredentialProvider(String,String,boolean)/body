{
  if (masterKeyLocation == null)   throw new IllegalArgumentException("Master key location needed for " + "Credential Provider initialization.");
  MasterKeyService masterKeyService;
  if (masterKey != null) {
    masterKeyService=new MasterKeyServiceImpl(masterKey);
  }
 else {
    masterKeyService=new MasterKeyServiceImpl(masterKeyLocation,isMasterKeyPersisted);
  }
  if (!masterKeyService.isMasterKeyInitialized()) {
    throw new AmbariException("Master key initialization failed.");
  }
  String storeDir=masterKeyLocation.substring(0,masterKeyLocation.indexOf(Configuration.MASTER_KEY_FILENAME_DEFAULT));
  this.keystoreService=new CredentialStoreServiceImpl(storeDir);
  this.keystoreService.setMasterKeyService(masterKeyService);
}
