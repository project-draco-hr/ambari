{
  ClusterServiceDAO clusterServiceDAO=injector.getInstance(ClusterServiceDAO.class);
  ClusterDAO clusterDAO=injector.getInstance(ClusterDAO.class);
  ClusterEntity cluster=clusterDAO.findByName(clusterName);
  ClusterServiceEntity clusterServiceEntity=new ClusterServiceEntity();
  clusterServiceEntity.setClusterEntity(cluster);
  clusterServiceEntity.setServiceName(serviceName);
  cluster.getClusterServiceEntities().add(clusterServiceEntity);
  clusterServiceDAO.create(clusterServiceEntity);
  clusterDAO.merge(cluster);
  clusterServiceEntity=clusterServiceDAO.findByClusterAndServiceNames(clusterName,serviceName);
  assertNotNull(clusterServiceEntity);
  ServiceConfigEntity serviceConfigEntity=new ServiceConfigEntity();
  serviceConfigEntity.setConfigSnapshotTime(currentTime);
  serviceConfigEntity.setClusterServiceEntity(clusterServiceEntity);
  List<ServiceConfigEntity> list=clusterServiceEntity.getServiceConfigEntities();
  list.add(serviceConfigEntity);
  clusterServiceEntity.setServiceConfigEntities(list);
  ServiceConfigDAO serviceConfigDAO=injector.getInstance(ServiceConfigDAO.class);
  serviceConfigDAO.create(serviceConfigEntity);
  clusterServiceDAO.merge(clusterServiceEntity);
}
