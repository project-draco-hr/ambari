{
  List<Map<String,Map<String,Map<String,?>>>> configList=new ArrayList<Map<String,Map<String,Map<String,?>>>>();
  Map<String,Object> desiredConfigMap=clusterNode.getObject().getPropertiesMap().get("Clusters/desired_configs");
  TreeNode<Resource> configNode=clusterNode.getChild("configurations");
  for (  TreeNode<Resource> config : configNode.getChildren()) {
    Configuration configuration=new Configuration(config);
    DesiredConfig desiredConfig=(DesiredConfig)desiredConfigMap.get(configuration.getType());
    if (desiredConfig != null && desiredConfig.getTag().equals(configuration.getTag())) {
      Map<String,Map<String,String>> properties=Collections.singletonMap(configuration.getType(),configuration.getProperties());
      BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(properties);
      properties=updater.doUpdateForBlueprintExport(hostGroups);
      Map<String,Map<String,?>> typeMap=new HashMap<String,Map<String,?>>();
      typeMap.put("properties",properties.get(configuration.getType()));
      if ((configuration.getPropertyAttributes() != null) && !configuration.getPropertyAttributes().isEmpty()) {
        typeMap.put("properties_attributes",configuration.getPropertyAttributes());
      }
      configList.add(Collections.singletonMap(configuration.getType(),typeMap));
    }
  }
  return configList;
}
