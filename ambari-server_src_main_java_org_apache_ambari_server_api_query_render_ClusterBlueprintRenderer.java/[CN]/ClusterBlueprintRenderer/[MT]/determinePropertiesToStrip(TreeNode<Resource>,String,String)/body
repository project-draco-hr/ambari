{
  AmbariMetaInfo ambariMetaInfo=getController().getAmbariMetaInfo();
  StackInfo stack;
  try {
    stack=ambariMetaInfo.getStack(stackName,stackVersion);
  }
 catch (  AmbariException e) {
    throw new RuntimeException("Unexpected exception occurred while generating a blueprint. " + "The stack '" + stackName + ":"+ stackVersion+ "' does not exist");
  }
  Map<String,PropertyInfo> requiredStackProperties=stack.getRequiredProperties();
  updatePropertiesToStrip(requiredStackProperties);
  for (  TreeNode<Resource> serviceNode : servicesNode.getChildren()) {
    String name=(String)serviceNode.getObject().getPropertyValue("ServiceInfo/service_name");
    ServiceInfo service;
    try {
      service=ambariMetaInfo.getService(stackName,stackVersion,name);
    }
 catch (    AmbariException e) {
      throw new RuntimeException("Unexpected exception occurred while generating a blueprint.  The service '" + name + "' was not found in the stack: '"+ stackName+ ":"+ stackVersion);
    }
    Map<String,PropertyInfo> requiredProperties=service.getRequiredProperties();
    updatePropertiesToStrip(requiredProperties);
  }
}
