{
  AmbariMetaInfo stackInfo=getController().getAmbariMetaInfo();
  for (  TreeNode<Resource> service : servicesNode.getChildren()) {
    String name=(String)service.getObject().getPropertyValue("ServiceInfo/service_name");
    Map<String,PropertyInfo> requiredProperties=stackInfo.getRequiredProperties(stackName,stackVersion,name);
    for (    Map.Entry<String,PropertyInfo> entry : requiredProperties.entrySet()) {
      String propertyName=entry.getKey();
      PropertyInfo propertyInfo=entry.getValue();
      String configCategory=propertyInfo.getFilename();
      if (configCategory.endsWith(".xml")) {
        configCategory=configCategory.substring(0,configCategory.indexOf(".xml"));
      }
      Collection<String> categoryProperties=propertiesToStrip.get(configCategory);
      if (categoryProperties == null) {
        categoryProperties=new ArrayList<String>();
        propertiesToStrip.put(configCategory,categoryProperties);
      }
      categoryProperties.add(propertyName);
    }
  }
}
