def public_hostname():
    config = AmbariConfig.config
    out = ''
    err = ''
    try:
        if config.has_option('agent', 'public_hostname_script'):
            scriptname = config.get('agent', 'public_hostname_script')
            output = subprocess.Popen([scriptname], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
            (out, err) = output.communicate()
            if ((0 == output.returncode) and (0 != len(out.strip()))):
                return out.strip()
    except:
        trace_info = traceback.format_exc()
        logger.info(((((('Error using the scriptname:' + trace_info) + ' :out ') + out) + ' :err ') + err))
        logger.info('Defaulting to fqdn.')
    try:
        handle = urllib2.urlopen('http://169.254.169.254/latest/meta-data/public-hostname', '', 2)
        str = handle.read()
        handle.close()
        return str
    except Exception as e:
        return socket.getfqdn()
