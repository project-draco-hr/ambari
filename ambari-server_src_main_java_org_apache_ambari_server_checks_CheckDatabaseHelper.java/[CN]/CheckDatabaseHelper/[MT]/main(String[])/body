{
  CheckDatabaseHelper checkDatabaseHelper=null;
  try {
    LOG.info("******************************* Check database started *******************************");
    Injector injector=Guice.createInjector(new CheckHelperControllerModule(),new CheckHelperAuditModule());
    checkDatabaseHelper=injector.getInstance(CheckDatabaseHelper.class);
    checkDatabaseHelper.startPersistenceService();
    checkDatabaseHelper.init();
    checkDatabaseHelper.checkForNotMappedConfigsToCluster();
    checkDatabaseHelper.checkForConfigsSelectedMoreThanOnce();
    checkDatabaseHelper.checkForHostsWithoutState();
    checkDatabaseHelper.checkHostComponentStatesCountEqualsHostComponentsDesiredStates();
    checkDatabaseHelper.checkServiceConfigs();
    checkDatabaseHelper.stopPersistenceService();
    LOG.info("******************************* Check database completed *******************************");
  }
 catch (  Throwable e) {
    if (e instanceof AmbariException) {
      LOG.error("Exception occurred during database check:",e);
      throw (AmbariException)e;
    }
 else {
      LOG.error("Unexpected error, database check failed",e);
      throw new Exception("Unexpected error, database check failed",e);
    }
  }
 finally {
    if (checkDatabaseHelper != null) {
      checkDatabaseHelper.closeConnection();
      if (checkDatabaseHelper.isErrorAvailable() || checkDatabaseHelper.isWarningAvailable()) {
        System.out.print("Some error(s) or/and warning(s) was(were) found. Please check ambari-server-check-database.log for problem(s).");
      }
 else {
        System.out.print("No erros were found.");
      }
    }
  }
}
