{
  log.info("Get roles for user " + username + " from local DB");
  UserEntity user=null;
  user=userDAO.findLdapUserByName(username);
  if (user == null) {
    log.info("User " + username + " not present in local DB - creating");
    UserEntity newUser=new UserEntity();
    newUser.setLdapUser(true);
    newUser.setUserName(username);
    addRole(newUser,configuration.getConfigsMap().get(Configuration.USER_ROLE_NAME_KEY));
  }
  user=userDAO.findLdapUserByName(username);
  Boolean isAdmin=(Boolean)userData.getObjectAttribute(AMBARI_ADMIN_LDAP_ATTRIBUTE_KEY);
  if ((isAdmin != null) && isAdmin) {
    log.info("Adding admin role to LDAP user " + username);
    addRole(user,configuration.getConfigsMap().get(Configuration.ADMIN_ROLE_NAME_KEY));
  }
 else {
    removeRole(user,configuration.getConfigsMap().get(Configuration.ADMIN_ROLE_NAME_KEY));
  }
  user=userDAO.findLdapUserByName(username);
  return authorizationHelper.convertRolesToAuthorities(user.getRoleEntities());
}
