{
  PrincipalTypeEntity principalTypeEntity=principalTypeDAO.findById(PrincipalTypeEntity.USER_PRINCIPAL_TYPE);
  if (principalTypeEntity == null) {
    principalTypeEntity=new PrincipalTypeEntity();
    principalTypeEntity.setId(PrincipalTypeEntity.USER_PRINCIPAL_TYPE);
    principalTypeEntity.setName(PrincipalTypeEntity.USER_PRINCIPAL_TYPE_NAME);
    principalTypeDAO.create(principalTypeEntity);
  }
  PrincipalEntity principalEntity=new PrincipalEntity();
  principalEntity.setPrincipalType(principalTypeEntity);
  principalDAO.create(principalEntity);
  UserEntity newUser=new UserEntity();
  newUser.setLdapUser(true);
  newUser.setUserName(username);
  newUser.setPrincipal(principalEntity);
  userDAO.create(newUser);
  addRole(newUser,configuration.getConfigsMap().get(Configuration.USER_ROLE_NAME_KEY));
}
