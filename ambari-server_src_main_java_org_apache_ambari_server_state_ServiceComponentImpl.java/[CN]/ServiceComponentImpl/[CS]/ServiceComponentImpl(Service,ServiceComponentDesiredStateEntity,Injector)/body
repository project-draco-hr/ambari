{
  injector.injectMembers(this);
  clusterGlobalLock=service.getClusterGlobalLock();
  this.service=service;
  desiredStateEntity=serviceComponentDesiredStateEntity;
  hostComponents=new HashMap<String,ServiceComponentHost>();
  for (  HostComponentStateEntity hostComponentStateEntity : desiredStateEntity.getHostComponentStateEntities()) {
    HostComponentDesiredStateEntityPK pk=new HostComponentDesiredStateEntityPK();
    pk.setClusterId(hostComponentStateEntity.getClusterId());
    pk.setServiceName(hostComponentStateEntity.getServiceName());
    pk.setComponentName(hostComponentStateEntity.getComponentName());
    pk.setHostId(hostComponentStateEntity.getHostId());
    HostComponentDesiredStateEntity hostComponentDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(pk);
    try {
      hostComponents.put(hostComponentStateEntity.getHostName(),serviceComponentHostFactory.createExisting(this,hostComponentStateEntity,hostComponentDesiredStateEntity));
    }
 catch (    ProvisionException ex) {
      StackId stackId=service.getCluster().getCurrentStackVersion();
      LOG.error(String.format("Can not get host component info: stackName=%s, stackVersion=%s, serviceName=%s, componentName=%s, hostname=%s",stackId.getStackName(),stackId.getStackVersion(),service.getName(),serviceComponentDesiredStateEntity.getComponentName(),hostComponentStateEntity.getHostName()));
      ex.printStackTrace();
    }
  }
  StackId stackId=service.getDesiredStackVersion();
  try {
    ComponentInfo compInfo=ambariMetaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),service.getName(),getName());
    isClientComponent=compInfo.isClient();
    isMasterComponent=compInfo.isMaster();
  }
 catch (  ObjectNotFoundException e) {
    throw new AmbariException("Trying to create a ServiceComponent" + " not recognized in stack info" + ", clusterName=" + service.getCluster().getClusterName() + ", serviceName="+ service.getName()+ ", componentName="+ getName()+ ", stackInfo="+ stackId.getStackId());
  }
  persisted=true;
}
