{
  if (!persisted) {
    ClusterServiceEntityPK pk=new ClusterServiceEntityPK();
    pk.setClusterId(service.getClusterId());
    pk.setServiceName(service.getName());
    ClusterServiceEntity serviceEntity=clusterServiceDAO.findByPK(pk);
    desiredStateEntity.setClusterServiceEntity(serviceEntity);
    serviceComponentDesiredStateDAO.create(desiredStateEntity);
    clusterServiceDAO.merge(serviceEntity);
    desiredStateEntity=serviceComponentDesiredStateDAO.merge(desiredStateEntity);
    service.refresh();
    persisted=true;
  }
 else {
    saveIfPersisted();
  }
}
