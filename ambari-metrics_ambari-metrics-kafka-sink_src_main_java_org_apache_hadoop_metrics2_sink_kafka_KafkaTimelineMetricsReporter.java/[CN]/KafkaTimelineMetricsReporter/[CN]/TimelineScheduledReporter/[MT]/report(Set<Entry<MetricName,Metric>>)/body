{
  final List<TimelineMetric> metricsList=new ArrayList<TimelineMetric>();
  try {
    for (    Entry<MetricName,Metric> entry : metrics) {
      final MetricName metricName=entry.getKey();
      final Metric metric=entry.getValue();
      Context context=new Context(){
        public List<TimelineMetric> getTimelineMetricList(){
          return metricsList;
        }
      }
;
      metric.processWith(this,metricName,context);
    }
  }
 catch (  Throwable t) {
    LOG.error("Exception processing Kafka metric",t);
  }
  if (LOG.isTraceEnabled()) {
    LOG.trace("Metrics List size: " + metricsList.size());
    LOG.trace("Metics Set size: " + metrics.size());
  }
  if (!metricsList.isEmpty()) {
    TimelineMetrics timelineMetrics=new TimelineMetrics();
    timelineMetrics.setMetrics(metricsList);
    try {
      emitMetrics(timelineMetrics);
    }
 catch (    IOException e) {
      LOG.error("Unexpected error",e);
    }
catch (    Throwable t) {
      LOG.error("Exception emitting metrics",t);
    }
  }
}
