{
  LOG.info("Initializing the stack manager...");
  validateStackDirectory(stackRoot);
  validateCommonServicesDirectory(commonServicesRoot);
  stackMap=new HashMap<String,StackInfo>();
  stackContext=new StackContext(metaInfoDAO,actionMetadata,osFamily);
  Map<String,ServiceModule> commonServiceModules=parseCommonServicesDirectory(commonServicesRoot);
  Map<String,StackModule> stackModules=parseStackDirectory(stackRoot);
  fullyResolveCommonServices(stackModules,commonServiceModules);
  fullyResolveStacks(stackModules,commonServiceModules);
  Collection<StackInfo> stacks=getStacks();
  for (  StackInfo stack : stacks) {
    String stackName=stack.getName();
    String stackVersion=stack.getVersion();
    if (stackDao.find(stackName,stackVersion) == null) {
      LOG.info("Adding stack {}-{} to the database",stackName,stackVersion);
      StackEntity stackEntity=new StackEntity();
      stackEntity.setStackName(stackName);
      stackEntity.setStackVersion(stackVersion);
      stackDao.create(stackEntity);
    }
  }
}
