{
  if (stage == null) {
    throw new IllegalArgumentException("Null stage");
  }
  graph=new TreeMap<String,RoleGraphNode>();
  initialStage=stage;
  Map<String,List<ExecutionCommand>> execCommands=stage.getExecutionCommands();
  for (  String host : execCommands.keySet()) {
    for (    ExecutionCommand exec : execCommands.get(host)) {
      String role=exec.getRole().toString();
      RoleGraphNode rgn;
      if (graph.get(role) == null) {
        rgn=new RoleGraphNode(exec.getRole(),exec.getRoleCommand());
        graph.put(role,rgn);
      }
      rgn=graph.get(role);
      rgn.addHost(host);
    }
  }
  for (  String roleI : graph.keySet()) {
    for (    String roleJ : graph.keySet()) {
      if (roleI.equals(roleJ)) {
        continue;
      }
 else {
        RoleGraphNode rgnI=graph.get(roleI);
        RoleGraphNode rgnJ=graph.get(roleJ);
        int order=roleDependencies.order(rgnI,rgnJ);
        if (order == -1) {
          rgnI.addEdge(rgnJ);
        }
 else         if (order == 1) {
          rgnJ.addEdge(rgnI);
        }
      }
    }
  }
}
