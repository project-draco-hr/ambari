{
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  Configuration configuration=createNiceMock(Configuration.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  Capture<DBAccessor.DBColumnInfo> provisioningStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<List<DBAccessor.DBColumnInfo>> operationLevelEntityColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<DBAccessor.DBColumnInfo> labelColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> descriptionColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> visibleColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewIconColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewIcon64ColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> instanceIconColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> instanceIcon64ColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  setClustersConfigExpectations(dbAccessor,provisioningStateColumnCapture);
  setOperationLevelEntityConfigExpectations(dbAccessor,operationLevelEntityColumnCapture);
  setViewExpectations(dbAccessor,viewIconColumnCapture,viewIcon64ColumnCapture);
  dbAccessor.addColumn(eq("viewinstance"),anyObject(DBAccessor.DBColumnInfo.class));
  setViewInstanceExpectations(dbAccessor,labelColumnCapture,descriptionColumnCapture,visibleColumnCapture,instanceIconColumnCapture,instanceIcon64ColumnCapture);
  dbAccessor.getConnection();
  expectLastCall().andReturn(connection).anyTimes();
  connection.createStatement();
  expectLastCall().andReturn(statement).anyTimes();
  statement.executeQuery(anyObject(String.class));
  expectLastCall().andReturn(resultSet).anyTimes();
  resultSet.next();
  expectLastCall().andReturn(false).anyTimes();
  resultSet.close();
  expectLastCall().anyTimes();
  replay(dbAccessor,configuration,resultSet,statement,connection);
  AbstractUpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  upgradeCatalog.executeDDLUpdates();
  verify(dbAccessor,configuration,resultSet,statement,connection);
  assertClusterColumns(provisioningStateColumnCapture);
  assertOperationLevelEntityColumns(operationLevelEntityColumnCapture);
  assertViewColumns(viewIconColumnCapture,viewIcon64ColumnCapture);
  assertViewInstanceColumns(labelColumnCapture,descriptionColumnCapture,visibleColumnCapture,instanceIconColumnCapture,instanceIcon64ColumnCapture);
}
