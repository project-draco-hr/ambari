{
  StackId stackId=new StackId("HDP-0.1");
  VersionEventPublisher publisher=createNiceMock(VersionEventPublisher.class);
  Cluster cluster=createNiceMock(Cluster.class);
  ServiceComponentHost sch=createNiceMock(ServiceComponentHost.class);
  expect(cluster.getClusterId()).andReturn(99L);
  expect(cluster.getDesiredStackVersion()).andReturn(stackId);
  cluster.recalculateClusterVersionState(stackId,"1.0.0");
  EasyMock.expectLastCall().atLeastOnce();
  expect(sch.recalculateHostVersionState()).andReturn("1.0.0").atLeastOnce();
  replay(cluster,sch);
  HostComponentVersionEvent event=new HostComponentVersionEvent(cluster,sch);
  StackVersionListener listener=new StackVersionListener(publisher);
  listener.onAmbariEvent(event);
  verify(cluster,sch);
}
