{
  VersionEventPublisher publisher=createNiceMock(VersionEventPublisher.class);
  Cluster cluster=createNiceMock(Cluster.class);
  ServiceComponentHost sch=createNiceMock(ServiceComponentHost.class);
  expect(cluster.getClusterId()).andReturn(99L);
  cluster.recalculateClusterVersionState("1.0.0");
  expect(sch.recalculateHostVersionState()).andReturn("1.0.0").anyTimes();
  replay(cluster,sch);
  HostComponentVersionEvent event=new HostComponentVersionEvent(cluster,sch);
  StackVersionListener listener=new StackVersionListener(publisher);
  listener.onAmbariEvent(event);
  verify(cluster,sch);
}
