{
  expect(sch.getVersion()).andReturn(VALID_PREVIOUS_VERSION);
  expect(sch.getUpgradeState()).andReturn(UpgradeState.VERSION_MISMATCH);
  expect(cluster.getUpgradeEntity()).andReturn(DUMMY_UPGRADE_ENTITY);
  expect(serviceComponent.getDesiredVersion()).andStubReturn(VALID_NEW_VERSION);
  sch.setUpgradeState(UpgradeState.COMPLETE);
  expectLastCall().once();
  replayAll();
  sendEventAndVerify(VALID_NEW_VERSION);
}
