{
  ClusterEntity clusterEntity=clusterDAO.findById(cluster.getClusterId());
  ClusterConfigEntity entity=new ClusterConfigEntity();
  entity.setClusterEntity(clusterEntity);
  entity.setClusterId(cluster.getClusterId());
  entity.setType(getType());
  entity.setVersion(getVersion());
  entity.setTag(getTag());
  entity.setTimestamp(new Date().getTime());
  entity.setStack(clusterEntity.getDesiredStack());
  entity.setData(gson.toJson(getProperties()));
  if (null != getPropertiesAttributes()) {
    entity.setAttributes(gson.toJson(getPropertiesAttributes()));
  }
  clusterDAO.createConfig(entity);
  clusterEntity.getClusterConfigEntities().add(entity);
  clusterDAO.merge(clusterEntity);
  cluster.refresh();
}
