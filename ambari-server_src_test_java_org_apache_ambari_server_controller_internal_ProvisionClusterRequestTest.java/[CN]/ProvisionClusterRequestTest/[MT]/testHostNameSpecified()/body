{
  reset(hostResourceProvider);
  replay(hostResourceProvider);
  Map<String,Object> properties=createBlueprintRequestPropertiesNameOnly(CLUSTER_NAME,BLUEPRINT_NAME);
  ProvisionClusterRequest provisionClusterRequest=new ProvisionClusterRequest(properties,null);
  assertEquals(CLUSTER_NAME,provisionClusterRequest.getClusterName());
  assertEquals(TopologyRequest.Type.PROVISION,provisionClusterRequest.getType());
  assertEquals(String.format("Provision Cluster '%s'",CLUSTER_NAME),provisionClusterRequest.getDescription());
  assertSame(blueprint,provisionClusterRequest.getBlueprint());
  Map<String,HostGroupInfo> hostGroupInfo=provisionClusterRequest.getHostGroupInfo();
  assertEquals(1,hostGroupInfo.size());
  assertEquals(1,provisionClusterRequest.getTopologyValidators().size());
  HostGroupInfo group1Info=hostGroupInfo.get("group1");
  assertEquals("group1",group1Info.getHostGroupName());
  assertEquals(1,group1Info.getHostNames().size());
  assertTrue(group1Info.getHostNames().contains("host1.mydomain.com"));
  assertEquals(1,group1Info.getRequestedHostCount());
  assertNull(group1Info.getPredicate());
  Configuration group1Configuration=group1Info.getConfiguration();
  assertNull(group1Configuration.getParentConfiguration());
  assertEquals(1,group1Configuration.getProperties().size());
  Map<String,String> group1TypeProperties=group1Configuration.getProperties().get("foo-type");
  assertEquals(2,group1TypeProperties.size());
  assertEquals("prop1Value",group1TypeProperties.get("hostGroup1Prop1"));
  assertEquals("prop2Value",group1TypeProperties.get("hostGroup1Prop2"));
  assertTrue(group1Configuration.getAttributes().isEmpty());
  Configuration clusterScopeConfiguration=provisionClusterRequest.getConfiguration();
  assertSame(blueprintConfig,clusterScopeConfiguration.getParentConfiguration());
  assertEquals(1,clusterScopeConfiguration.getProperties().size());
  Map<String,String> clusterScopedProperties=clusterScopeConfiguration.getProperties().get("someType");
  assertEquals(1,clusterScopedProperties.size());
  assertEquals("someValue",clusterScopedProperties.get("property1"));
  Map<String,Map<String,Map<String,String>>> clusterScopedAttributes=clusterScopeConfiguration.getAttributes();
  assertEquals(1,clusterScopedAttributes.size());
  Map<String,Map<String,String>> clusterScopedTypeAttributes=clusterScopedAttributes.get("someType");
  assertEquals(1,clusterScopedTypeAttributes.size());
  Map<String,String> clusterScopedTypePropertyAttributes=clusterScopedTypeAttributes.get("property1");
  assertEquals(1,clusterScopedTypePropertyAttributes.size());
  assertEquals("someAttributePropValue",clusterScopedTypePropertyAttributes.get("attribute1"));
}
