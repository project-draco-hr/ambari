{
  if (condition.isEmpty()) {
    throw new IllegalArgumentException("Condition is empty.");
  }
  StringBuilder sb=new StringBuilder(GET_CLUSTER_AGGREGATE_SQL);
  sb.append(" WHERE ");
  sb.append(condition.getConditionClause());
  sb.append(" ORDER BY METRIC_NAME, SERVER_TIME");
  if (condition.getLimit() != null) {
    sb.append(" LIMIT ").append(condition.getLimit());
  }
  LOG.debug("SQL => " + sb.toString() + ", condition => "+ condition);
  PreparedStatement stmt=connection.prepareStatement(sb.toString());
  int pos=1;
  if (condition.getMetricNames() != null) {
    for (; pos <= condition.getMetricNames().size(); pos++) {
      stmt.setString(pos,condition.getMetricNames().get(pos - 1));
    }
  }
  if (condition.getAppId() != null) {
    stmt.setString(pos++,condition.getAppId().toLowerCase());
  }
  if (condition.getInstanceId() != null) {
    stmt.setString(pos++,condition.getInstanceId());
  }
  if (condition.getStartTime() != null) {
    stmt.setLong(pos++,condition.getStartTime());
  }
  if (condition.getEndTime() != null) {
    stmt.setLong(pos,condition.getEndTime());
  }
  return stmt;
}
