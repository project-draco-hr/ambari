{
  if (condition.isEmpty()) {
    throw new IllegalArgumentException("Condition is empty.");
  }
  String stmtStr;
  if (condition.getStatement() != null) {
    stmtStr=condition.getStatement();
  }
 else {
    stmtStr=String.format(GET_METRIC_SQL,getNaiveTimeRangeHint(condition.getStartTime(),NATIVE_TIME_RANGE_DELTA),METRICS_RECORD_TABLE_NAME);
  }
  StringBuilder sb=new StringBuilder(stmtStr);
  sb.append(" WHERE ");
  sb.append(condition.getConditionClause());
  String orderByClause=condition.getOrderByClause();
  if (orderByClause != null) {
    sb.append(orderByClause);
  }
 else {
    sb.append(" ORDER BY METRIC_NAME, SERVER_TIME ");
  }
  if (condition.getLimit() != null) {
    sb.append(" LIMIT ").append(condition.getLimit());
  }
  LOG.debug("SQL: " + sb.toString() + ", condition: "+ condition);
  PreparedStatement stmt=connection.prepareStatement(sb.toString());
  int pos=1;
  if (condition.getMetricNames() != null) {
    for (; pos <= condition.getMetricNames().size(); pos++) {
      LOG.debug("Setting pos: " + pos + ", value = "+ condition.getMetricNames().get(pos - 1));
      stmt.setString(pos,condition.getMetricNames().get(pos - 1));
    }
  }
  if (condition.getHostname() != null) {
    LOG.debug("Setting pos: " + pos + ", value: "+ condition.getHostname());
    stmt.setString(pos++,condition.getHostname());
  }
  if (condition.getAppId() != null) {
    LOG.debug("Setting pos: " + pos + ", value: "+ condition.getAppId());
    stmt.setString(pos++,condition.getAppId());
  }
  if (condition.getInstanceId() != null) {
    LOG.debug("Setting pos: " + pos + ", value: "+ condition.getInstanceId());
    stmt.setString(pos++,condition.getInstanceId());
  }
  if (condition.getStartTime() != null) {
    LOG.debug("Setting pos: " + pos + ", value: "+ condition.getStartTime());
    stmt.setLong(pos++,condition.getStartTime());
  }
  if (condition.getEndTime() != null) {
    LOG.debug("Setting pos: " + pos + ", value: "+ condition.getEndTime());
    stmt.setLong(pos,condition.getEndTime());
  }
  if (condition.getFetchSize() != null) {
    stmt.setFetchSize(condition.getFetchSize());
  }
  return stmt;
}
