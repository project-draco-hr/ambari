{
  m_injector=Guice.createInjector(new InMemoryDefaultTestModule());
  m_injector.getInstance(GuiceJpaInitializer.class);
  m_helper=m_injector.getInstance(OrmTestHelper.class);
  repoVersionDAO=m_injector.getInstance(RepositoryVersionDAO.class);
  clusters=m_injector.getInstance(Clusters.class);
  clusterVersionDAO=m_injector.getInstance(ClusterVersionDAO.class);
  hostVersionDAO=m_injector.getInstance(HostVersionDAO.class);
  hostDAO=m_injector.getInstance(HostDAO.class);
  hostRoleCommandFactory=m_injector.getInstance(HostRoleCommandFactory.class);
  serviceFactory=m_injector.getInstance(ServiceFactory.class);
  serviceComponentFactory=m_injector.getInstance(ServiceComponentFactory.class);
  serviceComponentHostFactory=m_injector.getInstance(ServiceComponentHostFactory.class);
  requestDAO=m_injector.getInstance(RequestDAO.class);
  upgradeDAO=m_injector.getInstance(UpgradeDAO.class);
  serviceComponentDesiredStateDAO=m_injector.getInstance(ServiceComponentDesiredStateDAO.class);
  hostComponentDesiredStateDAO=m_injector.getInstance(HostComponentDesiredStateDAO.class);
  hostComponentStateDAO=m_injector.getInstance(HostComponentStateDAO.class);
  amc=m_injector.getInstance(AmbariManagementController.class);
  stackDAO=m_injector.getInstance(StackDAO.class);
  ambariMetaInfo=m_injector.getInstance(AmbariMetaInfo.class);
  finalizeUpgradeAction=m_injector.getInstance(FinalizeUpgradeAction.class);
  Field field=AmbariServer.class.getDeclaredField("clusterController");
  field.setAccessible(true);
  field.set(null,amc);
}
