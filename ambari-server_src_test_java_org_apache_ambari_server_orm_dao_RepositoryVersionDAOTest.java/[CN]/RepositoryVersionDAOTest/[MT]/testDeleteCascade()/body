{
  long clusterId=helper.createCluster();
  ClusterEntity cluster=clusterDAO.findById(clusterId);
  createSingleRecord();
  final RepositoryVersionEntity entity=repositoryVersionDAO.findByStackAndVersion("stack","version");
  ClusterVersionEntity cvA=new ClusterVersionEntity(cluster,entity,RepositoryVersionState.INSTALLED,System.currentTimeMillis(),System.currentTimeMillis(),"admin");
  clusterVersionDAO.create(cvA);
  long cvAId=cvA.getId();
  cvA=clusterVersionDAO.findByPK(cvAId);
  Assert.assertNotNull(cvA.getRepositoryVersion());
  final RepositoryVersionEntity newEntity=repositoryVersionDAO.findByStackAndVersion("stack","version");
  try {
    repositoryVersionDAO.remove(newEntity);
  }
 catch (  Exception e) {
    Assert.assertNotNull(clusterVersionDAO.findByPK(cvAId));
  }
}
