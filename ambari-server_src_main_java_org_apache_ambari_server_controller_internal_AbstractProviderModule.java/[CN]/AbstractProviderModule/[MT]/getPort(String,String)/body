{
  Map<String,String> clusterJmxPorts=jmxPortMap.get(clusterName);
  if (clusterJmxPorts == null) {
synchronized (jmxPortMap) {
      clusterJmxPorts=jmxPortMap.get(clusterName);
      if (clusterJmxPorts == null) {
        clusterJmxPorts=new ConcurrentHashMap<String,String>();
        jmxPortMap.put(clusterName,clusterJmxPorts);
      }
    }
  }
  Service.Type service=componentServiceMap.get(componentName);
  if (service != null) {
    try {
      String currVersion=getDesiredConfigVersion(clusterName,serviceConfigTypes.get(service));
      String oldVersion=serviceConfigVersions.get(service);
      if (!currVersion.equals(oldVersion) || !clusterJmxPorts.containsKey(componentName)) {
        serviceConfigVersions.put(service,currVersion);
        Map<String,String> portMap=getDesiredConfigMap(clusterName,currVersion,serviceConfigTypes.get(service),serviceDesiredProperties.get(service));
        for (        String compName : portMap.keySet()) {
          String portString=getPortString(portMap.get(compName));
          if (null != portString)           clusterJmxPorts.put(compName,portString);
        }
      }
    }
 catch (    Exception e) {
      LOG.error("Exception initializing jmx port maps. " + e);
    }
  }
  LOG.debug("jmxPortMap -> " + jmxPortMap);
  return clusterJmxPorts.get(componentName);
}
