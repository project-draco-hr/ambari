{
synchronized (clusterVersionsMap) {
    clusterVersionsMap.clear();
    ResourceProvider provider=getResourceProvider(Resource.Type.Cluster);
    Request request=PropertyHelper.getReadRequest(CLUSTER_NAME_PROPERTY_ID,CLUSTER_VERSION_PROPERTY_ID);
    try {
      Set<Resource> clusters=provider.getResources(request,null);
      for (      Resource cluster : clusters) {
        String clusterVersion=(String)cluster.getPropertyValue(CLUSTER_VERSION_PROPERTY_ID);
        PropertyHelper.MetricsVersion version=PropertyHelper.MetricsVersion.HDP2;
        Matcher m=Pattern.compile("[0-9]+(\\.[0-9]+)+").matcher(clusterVersion);
        if (m.find()) {
          clusterVersion=m.group(0);
          if (clusterVersion.equals("1") || clusterVersion.startsWith("1.")) {
            version=PropertyHelper.MetricsVersion.HDP1;
          }
        }
        clusterVersionsMap.put((String)cluster.getPropertyValue(CLUSTER_NAME_PROPERTY_ID),version);
      }
    }
 catch (    Exception e) {
      if (LOG.isErrorEnabled()) {
        LOG.error("Caught exception while trying to get the cluster versions.",e);
      }
    }
  }
}
