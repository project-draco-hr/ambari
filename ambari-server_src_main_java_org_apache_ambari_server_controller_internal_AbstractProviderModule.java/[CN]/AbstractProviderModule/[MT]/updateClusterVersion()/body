{
synchronized (clusterVersionsMap) {
    clusterVersionsMap.clear();
    ResourceProvider provider=getResourceProvider(Resource.Type.Cluster);
    Request request=PropertyHelper.getReadRequest(CLUSTER_NAME_PROPERTY_ID,CLUSTER_VERSION_PROPERTY_ID);
    try {
      Set<Resource> clusters=provider.getResources(request,null);
      for (      Resource cluster : clusters) {
        String clusterVersion=(String)cluster.getPropertyValue(CLUSTER_VERSION_PROPERTY_ID);
        PropertyHelper.MetricsVersion version=clusterVersion.startsWith("HDP-1") ? PropertyHelper.MetricsVersion.HDP1 : PropertyHelper.MetricsVersion.HDP2;
        clusterVersionsMap.put((String)cluster.getPropertyValue(CLUSTER_NAME_PROPERTY_ID),version);
      }
    }
 catch (    Exception e) {
      if (LOG.isErrorEnabled()) {
        LOG.error("Caught exception while trying to get the cluster versions.",e);
      }
    }
  }
}
