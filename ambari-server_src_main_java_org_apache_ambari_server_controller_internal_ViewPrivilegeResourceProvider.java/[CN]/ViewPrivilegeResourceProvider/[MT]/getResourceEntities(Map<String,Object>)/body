{
  ViewRegistry viewRegistry=ViewRegistry.getInstance();
  String viewName=(String)properties.get(PRIVILEGE_VIEW_NAME_PROPERTY_ID);
  String viewVersion=(String)properties.get(PRIVILEGE_VIEW_VERSION_PROPERTY_ID);
  String instanceName=(String)properties.get(PRIVILEGE_INSTANCE_NAME_PROPERTY_ID);
  if (viewName != null && viewVersion != null && instanceName != null) {
    ViewInstanceEntity viewInstanceEntity=viewRegistry.getInstanceDefinition(viewName,viewVersion,instanceName);
    return Collections.singletonMap(viewInstanceEntity.getResource().getId(),viewInstanceEntity);
  }
  Set<ViewEntity> viewEntities=new HashSet<ViewEntity>();
  if (viewVersion != null) {
    ViewEntity viewEntity=viewRegistry.getDefinition(viewName,viewVersion);
    if (viewEntity != null) {
      viewEntities.add(viewEntity);
    }
  }
 else {
    for (    ViewEntity viewEntity : viewRegistry.getDefinitions()) {
      if (viewName == null || viewEntity.getCommonName().equals(viewName)) {
        viewEntities.add(viewEntity);
      }
    }
  }
  Map<Long,ViewInstanceEntity> resourceEntities=new HashMap<Long,ViewInstanceEntity>();
  for (  ViewEntity viewEntity : viewEntities) {
    for (    ViewInstanceEntity viewInstanceEntity : viewEntity.getInstances()) {
      resourceEntities.put(viewInstanceEntity.getResource().getId(),viewInstanceEntity);
    }
  }
  return resourceEntities;
}
