@patch.object(OSCheck, 'os_distribution', new=MagicMock(return_value=os_distro_value))
@patch.object(CachedHTTPConnection, 'create_connection', new=MagicMock())
@patch.object(CachedHTTPConnection, 'getresponse', new=MagicMock())
@patch.object(CachedHTTPConnection, 'request')
def testRetryFetchAndRoundRobin(self, request_mock):
    stop_handler = bind_signal_handlers()
    request_mock.return_value = MagicMock()
    config = Configuration()
    application_metric_map = ApplicationMetricMap('host', '10.10.10.10')
    application_metric_map.clear()
    application_metric_map.put_metric('APP1', {'metric1': 1, }, 1)
    emitter = Emitter(config, application_metric_map, stop_handler)
    emitter.RETRY_SLEEP_INTERVAL = 0.001
    emitter.submit_metrics()
    self.assertEqual(request_mock.call_count, 9)
    self.assertUrlData(request_mock)
