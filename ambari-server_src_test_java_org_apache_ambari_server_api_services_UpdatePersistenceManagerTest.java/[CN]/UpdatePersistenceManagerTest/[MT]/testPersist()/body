{
  ResourceDefinition resource=createMock(ResourceDefinition.class);
  ClusterController controller=createMock(ClusterController.class);
  Schema schema=createMock(Schema.class);
  org.apache.ambari.server.controller.spi.Request serverRequest=createStrictMock(org.apache.ambari.server.controller.spi.Request.class);
  Query query=createMock(Query.class);
  Predicate predicate=createMock(Predicate.class);
  Map<PropertyId,Object> mapProperties=new HashMap<PropertyId,Object>();
  mapProperties.put(PropertyHelper.getPropertyId("bar","foo"),"value");
  expect(resource.getType()).andReturn(Resource.Type.Component);
  expect(resource.getProperties()).andReturn(mapProperties);
  expect(resource.getQuery()).andReturn(query);
  expect(query.getInternalPredicate()).andReturn(predicate);
  expect(controller.updateResources(Resource.Type.Component,serverRequest,predicate)).andReturn(new RequestStatusImpl(null));
  replay(resource,controller,schema,serverRequest,query,predicate);
  new TestUpdatePersistenceManager(controller,mapProperties,serverRequest).persist(resource);
  verify(resource,controller,schema,serverRequest,query,predicate);
}
