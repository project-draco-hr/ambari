{
  final VersionDefinitionXml xml;
  final String xmlString;
  try {
    URL url=new URL(definitionUrl);
    xmlString=IOUtils.toString(url.openStream(),"UTF-8");
    xml=VersionDefinitionXml.load(xmlString);
  }
 catch (  Exception e) {
    String err=String.format("Could not load url from %s.  %s",definitionUrl,e.getMessage());
    throw new AmbariException(err,e);
  }
  RepositoryVersionEntity entity=new RepositoryVersionEntity();
  StackId stackId=new StackId(xml.release.stackId);
  StackEntity stackEntity=stackDAO.find(stackId.getStackName(),stackId.getStackVersion());
  entity.setStack(stackEntity);
  entity.setOperatingSystems(repositoryVersionHelper.serializeOperatingSystems(xml.repositoryInfo.getRepositories()));
  entity.setVersion(xml.release.version + "-" + StringUtils.stripToEmpty(xml.release.build));
  entity.setDisplayName(stackId.getStackName() + "-" + entity.getVersion());
  entity.setType(xml.release.repositoryType);
  entity.setVersionUrl(definitionUrl);
  entity.setVersionXml(xmlString);
  entity.setVersionXsd(xml.xsdLocation);
  return entity;
}
