def pre_upgrade_deregister():
    '\n  Runs the "hive --service hiveserver2 --deregister <version>" command to\n  de-provision the server in preparation for an upgrade. This will contact\n  ZooKeeper to remove the server so that clients that attempt to connect\n  will be directed to other servers automatically. Once all\n  clients have drained, the server will shutdown automatically; this process\n  could take a very long time.\n  This function will obtain the Kerberos ticket if security is enabled.\n  :return:\n  '
    import params
    Logger.info('HiveServer2 executing "deregister" command in preparation for upgrade...')
    if params.security_enabled:
        kinit_command = format('{kinit_path_local} -kt {smoke_user_keytab} {smokeuser_principal}; ')
        Execute(kinit_command, user=params.smokeuser)
    current_hiveserver_version = _get_current_hiveserver_version()
    if (current_hiveserver_version is None):
        raise Fail('Unable to determine the current HiveServer2 version to deregister.')
    hive_server_conf_dir = params.hive_server_conf_dir
    if (not os.path.exists(hive_server_conf_dir)):
        hive_server_conf_dir = '/etc/hive/conf.server'
    command = format(('hive --config {hive_server_conf_dir} --service hiveserver2 --deregister ' + current_hiveserver_version))
    Execute(command, user=params.hive_user, path=params.execute_path, tries=1)
