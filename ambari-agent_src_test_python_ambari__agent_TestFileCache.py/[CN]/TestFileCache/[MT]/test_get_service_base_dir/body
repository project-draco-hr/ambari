@patch('os.path.isdir')
def test_get_service_base_dir(self, isdir_mock):
    fileCache = FileCache(self.config)
    isdir_mock.return_value = True
    service_subpath = 'HDP/2.1.1/services/ZOOKEEPER/package'
    base = fileCache.get_service_base_dir(service_subpath)
    self.assertEqual(base, '/var/lib/ambari-agent/cache/stacks/HDP/2.1.1/services/ZOOKEEPER/package')
    isdir_mock.return_value = False
    try:
        fileCache.get_service_base_dir(service_subpath)
        self.fail('Should throw an exception')
    except AgentException:
        pass
