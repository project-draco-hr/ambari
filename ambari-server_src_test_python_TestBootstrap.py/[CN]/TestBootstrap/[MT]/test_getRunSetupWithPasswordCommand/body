@patch('os.environ')
def test_getRunSetupWithPasswordCommand(self, environ_mock):
    shared_state = SharedState('root', 'sshkey_file', 'scriptDir', 'bootdir', 'setupAgentFile', 'ambariServer', 'centos6', None, '8440')
    environ_mock.__getitem__.return_value = 'TEST_PASSPHRASE'
    bootstrap_obj = Bootstrap('hostname', shared_state)
    utime = 1234
    bootstrap_obj.getUtime = MagicMock(return_value=utime)
    ret = bootstrap_obj.getRunSetupWithPasswordCommand('hostname')
    expected = 'sudo -S python /tmp/setupAgent{0}.py hostname TEST_PASSPHRASE ambariServer  8440 < /tmp/host_pass{0}'.format(utime)
    self.assertEquals(ret, expected)
