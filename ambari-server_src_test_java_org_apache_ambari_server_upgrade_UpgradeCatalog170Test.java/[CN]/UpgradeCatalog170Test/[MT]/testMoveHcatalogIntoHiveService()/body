{
  UpgradeCatalog170 upgradeCatalog170=injector.getInstance(UpgradeCatalog170.class);
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  final ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,DESIRED_STACK_VERSION);
  final ClusterServiceEntity clusterServiceEntityHDFS=upgradeCatalogHelper.addService(injector,clusterEntity,"HDFS",DESIRED_STACK_VERSION);
  final ClusterServiceEntity clusterServiceEntityHIVE=upgradeCatalogHelper.addService(injector,clusterEntity,"HIVE",DESIRED_STACK_VERSION);
  final ClusterServiceEntity clusterServiceEntityHCATALOG=upgradeCatalogHelper.addService(injector,clusterEntity,"HCATALOG",DESIRED_STACK_VERSION);
  final ClusterServiceEntity clusterServiceEntityWEBHCAT=upgradeCatalogHelper.addService(injector,clusterEntity,"WEBHCAT",DESIRED_STACK_VERSION);
  final HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,HOST_NAME);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHDFS,hostEntity,"NAMENODE",DESIRED_STACK_VERSION);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHIVE,hostEntity,"HIVE_SERVER",DESIRED_STACK_VERSION);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHCATALOG,hostEntity,"HCAT",DESIRED_STACK_VERSION);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityWEBHCAT,hostEntity,"WEBHCAT_SERVER",DESIRED_STACK_VERSION);
  upgradeCatalog170.moveHcatalogIntoHiveService();
  ServiceComponentDesiredStateEntityPK pkHCATInHive=new ServiceComponentDesiredStateEntityPK();
  pkHCATInHive.setComponentName("HCAT");
  pkHCATInHive.setClusterId(clusterEntity.getClusterId());
  pkHCATInHive.setServiceName("HIVE");
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(pkHCATInHive);
  assertNotNull(serviceComponentDesiredStateEntity);
  HostComponentDesiredStateEntityPK hcDesiredStateEntityPk=new HostComponentDesiredStateEntityPK();
  hcDesiredStateEntityPk.setServiceName("HIVE");
  hcDesiredStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcDesiredStateEntityPk.setComponentName("HCAT");
  hcDesiredStateEntityPk.setHostId(hostEntity.getHostId());
  HostComponentDesiredStateEntity hcDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(hcDesiredStateEntityPk);
  assertNotNull(hcDesiredStateEntity);
  HostComponentStateEntityPK hcStateEntityPk=new HostComponentStateEntityPK();
  hcStateEntityPk.setServiceName("HIVE");
  hcStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcStateEntityPk.setComponentName("HCAT");
  hcStateEntityPk.setHostId(hostEntity.getHostId());
  HostComponentStateEntity hcStateEntity=hostComponentStateDAO.findByPK(hcStateEntityPk);
  assertNotNull(hcStateEntity);
}
