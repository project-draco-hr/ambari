{
  UpgradeCatalog170 upgradeCatalog170=injector.getInstance(UpgradeCatalog170.class);
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  injector.getInstance(AmbariMetaInfo.class);
  StackEntity desiredStackEntity=stackDAO.find(DESIRED_STACK.getStackName(),DESIRED_STACK.getStackVersion());
  assertNotNull(desiredStackEntity);
  final ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,desiredStackEntity);
  final ClusterServiceEntity clusterServiceEntityHDFS=upgradeCatalogHelper.addService(injector,clusterEntity,"HDFS",desiredStackEntity);
  final ClusterServiceEntity clusterServiceEntityHIVE=upgradeCatalogHelper.addService(injector,clusterEntity,"HIVE",desiredStackEntity);
  final ClusterServiceEntity clusterServiceEntityHCATALOG=upgradeCatalogHelper.addService(injector,clusterEntity,"HCATALOG",desiredStackEntity);
  final ClusterServiceEntity clusterServiceEntityWEBHCAT=upgradeCatalogHelper.addService(injector,clusterEntity,"WEBHCAT",desiredStackEntity);
  final HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,HOST_NAME);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHDFS,hostEntity,"NAMENODE",desiredStackEntity);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHIVE,hostEntity,"HIVE_SERVER",desiredStackEntity);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityHCATALOG,hostEntity,"HCAT",desiredStackEntity);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityWEBHCAT,hostEntity,"WEBHCAT_SERVER",desiredStackEntity);
  upgradeCatalog170.moveHcatalogIntoHiveService();
  ServiceComponentDesiredStateEntityPK pkHCATInHive=new ServiceComponentDesiredStateEntityPK();
  pkHCATInHive.setComponentName("HCAT");
  pkHCATInHive.setClusterId(clusterEntity.getClusterId());
  pkHCATInHive.setServiceName("HIVE");
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(pkHCATInHive);
  assertNotNull(serviceComponentDesiredStateEntity);
  HostComponentDesiredStateEntityPK hcDesiredStateEntityPk=new HostComponentDesiredStateEntityPK();
  hcDesiredStateEntityPk.setServiceName("HIVE");
  hcDesiredStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcDesiredStateEntityPk.setComponentName("HCAT");
  hcDesiredStateEntityPk.setHostId(hostEntity.getHostId());
  HostComponentDesiredStateEntity hcDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(hcDesiredStateEntityPk);
  assertNotNull(hcDesiredStateEntity);
}
