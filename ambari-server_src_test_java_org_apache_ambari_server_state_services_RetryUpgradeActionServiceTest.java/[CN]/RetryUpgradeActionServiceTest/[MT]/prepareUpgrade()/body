{
  RepositoryVersionEntity repoVersionEntity=new RepositoryVersionEntity();
  repoVersionEntity.setDisplayName("Version to Upgrade To");
  repoVersionEntity.setOperatingSystems("");
  repoVersionEntity.setStack(stackEntity220);
  repoVersionEntity.setVersion("2.2.0.1");
  repoVersionDAO.create(repoVersionEntity);
  helper.getOrCreateRepositoryVersion(stack220,stack220.getStackVersion());
  RequestEntity requestEntity=new RequestEntity();
  requestEntity.setRequestId(upgradeRequestId);
  requestEntity.setClusterId(cluster.getClusterId());
  requestEntity.setStatus(HostRoleStatus.PENDING);
  requestDAO.create(requestEntity);
  StageEntity stageEntity=new StageEntity();
  stageEntity.setRequest(requestEntity);
  stageEntity.setClusterId(cluster.getClusterId());
  stageEntity.setRequestId(upgradeRequestId);
  stageEntity.setStageId(stageId);
  requestEntity.setStages(Collections.singletonList(stageEntity));
  stageDAO.create(stageEntity);
  requestDAO.merge(requestEntity);
  UpgradeEntity upgrade=new UpgradeEntity();
  upgrade.setId(1L);
  upgrade.setRequestId(upgradeRequestId);
  upgrade.setClusterId(cluster.getClusterId());
  upgrade.setUpgradePackage("some-name");
  upgrade.setUpgradeType(UpgradeType.ROLLING);
  upgrade.setDirection(Direction.UPGRADE);
  upgrade.setFromVersion("2.2.0.0");
  upgrade.setToVersion("2.2.0.1");
  upgradeDAO.create(upgrade);
  cluster.setUpgradeEntity(upgrade);
  HostRoleCommandEntity hrc1=new HostRoleCommandEntity();
  hrc1.setStage(stageEntity);
  hrc1.setStatus(HostRoleStatus.COMPLETED);
  hrc1.setRole(Role.ZOOKEEPER_SERVER);
  hrc1.setRoleCommand(RoleCommand.RESTART);
  stageEntity.setHostRoleCommands(new ArrayList<HostRoleCommandEntity>());
  stageEntity.getHostRoleCommands().add(hrc1);
  hostRoleCommandDAO.create(hrc1);
  stageDAO.merge(stageEntity);
}
