def update_config_using_existing_properties(options, type, properties_template, site_properties):
    keys_processed = []
    keys_to_delete = []
    for key in properties_template.keys():
        keys_processed.append(key)
        if (properties_template[key] == DELETE_OLD_TAG):
            keys_to_delete.append(key)
            pass
        if (properties_template[key].find(REPLACE_WITH_TAG) == 0):
            name_to_lookup = key
            if (len(properties_template[key]) > len(REPLACE_WITH_TAG)):
                name_to_lookup = properties_template[key][len(REPLACE_WITH_TAG):]
                keys_processed.append(name_to_lookup)
            value = ''
            if (name_to_lookup in site_properties.keys()):
                value = site_properties[name_to_lookup]
                pass
            else:
                logger.warn(((('Unable to find the equivalent for ' + key) + '. Looked for ') + name_to_lookup))
            properties_template[key] = value
            pass
        pass
    pass
    for key in site_properties.keys():
        if (key not in keys_processed):
            properties_template[key] = site_properties[key]
            pass
        pass
    pass
    for key in keys_to_delete:
        del properties_template[key]
    pass
    update_config(options, properties_template, type)
