{
  setViewStatus(viewDefinition,ViewEntity.ViewStatus.DEPLOYING,"Deploying " + extractedArchiveDirFile + ".");
  String extractedArchiveDirPath=extractedArchiveDirFile.getAbsolutePath();
  LOG.info("Reading view archive " + archiveFile + ".");
  ClassLoader cl=null;
  try {
    cl=extractor.extractViewArchive(viewDefinition,archiveFile,extractedArchiveDirFile);
    ViewConfig viewConfig=archiveUtility.getViewConfigFromExtractedArchive(extractedArchiveDirPath,configuration.isViewValidationEnabled());
    if (viewConfig == null) {
      setViewStatus(viewDefinition,ViewEntity.ViewStatus.ERROR,"View configuration not found");
    }
 else {
      viewDefinition.setConfiguration(viewConfig);
    }
    if (checkViewVersions(viewDefinition,serverVersion)) {
      setupViewDefinition(viewDefinition,cl);
      Set<ViewInstanceEntity> instanceDefinitions=new HashSet<ViewInstanceEntity>();
      List<InstanceConfig> instanceConfigs=viewConfig.getInstances();
      if (instanceConfigs != null) {
        for (        InstanceConfig instanceConfig : instanceConfigs) {
          ViewInstanceEntity instanceEntity=createViewInstanceDefinition(viewConfig,viewDefinition,instanceConfig);
          instanceEntity.setXmlDriven(true);
          instanceDefinitions.add(instanceEntity);
        }
      }
      persistView(viewDefinition,instanceDefinitions);
      setViewStatus(viewDefinition,ViewEntity.ViewStatus.DEPLOYED,"Deployed " + extractedArchiveDirPath + ".");
      LOG.info("View deployed: " + viewDefinition.getName() + ".");
    }
  }
 catch (  Exception e) {
    String msg="Caught exception loading view " + viewDefinition.getName();
    setViewStatus(viewDefinition,ViewEntity.ViewStatus.ERROR,msg + " : " + e.getMessage());
    LOG.error(msg,e);
  }
 finally {
    if (cl instanceof Closeable) {
      try {
        ((URLClassLoader)cl).close();
      }
 catch (      IOException ex) {
      }
    }
  }
}
