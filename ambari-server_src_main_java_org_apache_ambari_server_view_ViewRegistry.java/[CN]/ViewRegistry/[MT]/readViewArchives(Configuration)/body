{
  try {
    File viewDir=configuration.getViewsDir();
    Set<ViewInstanceEntity> instanceDefinitions=new HashSet<ViewInstanceEntity>();
    String extractedArchivesPath=viewDir.getAbsolutePath() + File.separator + EXTRACTED_ARCHIVES_DIR;
    if (ensureExtractedArchiveDirectory(extractedArchivesPath)) {
      File[] files=viewDir.listFiles();
      if (files != null) {
        for (        File archiveFile : files) {
          if (!archiveFile.isDirectory()) {
            try {
              ViewConfig viewConfig=helper.getViewConfigFromArchive(archiveFile);
              String viewName=ViewEntity.getViewName(viewConfig.getName(),viewConfig.getVersion());
              String archivePath=extractedArchivesPath + File.separator + viewName;
              ClassLoader cl=extractViewArchive(archiveFile,helper.getFile(archivePath));
              ViewEntity viewDefinition=installView(viewConfig,configuration,cl,archivePath);
              for (              InstanceConfig instanceConfig : viewConfig.getInstances()) {
                ViewInstanceEntity viewInstanceDefinition=new ViewInstanceEntity(viewDefinition,instanceConfig);
                for (                PropertyConfig propertyConfig : instanceConfig.getProperties()) {
                  viewInstanceDefinition.putProperty(propertyConfig.getKey(),propertyConfig.getValue());
                }
                installViewInstance(viewDefinition,viewInstanceDefinition);
                instanceDefinitions.add(viewInstanceDefinition);
              }
            }
 catch (            Exception e) {
              LOG.error("Caught exception loading view from " + archiveFile.getAbsolutePath(),e);
            }
          }
        }
        instanceDefinitions.addAll(persistViews());
      }
    }
    return instanceDefinitions;
  }
 catch (  Exception e) {
    throw new SystemException("Caught exception reading view archives.",e);
  }
}
