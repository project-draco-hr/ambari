{
  try {
    File viewDir=configuration.getViewsDir();
    Set<ViewInstanceEntity> allInstanceDefinitions=new HashSet<ViewInstanceEntity>();
    String extractedArchivesPath=viewDir.getAbsolutePath() + File.separator + EXTRACTED_ARCHIVES_DIR;
    if (ensureExtractedArchiveDirectory(extractedArchivesPath)) {
      File[] files=viewDir.listFiles();
      if (files != null) {
        for (        File archiveFile : files) {
          if (!archiveFile.isDirectory()) {
            try {
              ViewConfig viewConfig=helper.getViewConfigFromArchive(archiveFile);
              String viewName=ViewEntity.getViewName(viewConfig.getName(),viewConfig.getVersion());
              String archivePath=extractedArchivesPath + File.separator + viewName;
              ClassLoader cl=extractViewArchive(archiveFile,helper.getFile(archivePath));
              viewConfig=helper.getViewConfigFromExtractedArchive(archivePath);
              ViewEntity viewDefinition=createViewDefinition(viewConfig,configuration,cl,archivePath);
              Set<ViewInstanceEntity> instanceDefinitions=new HashSet<ViewInstanceEntity>();
              for (              InstanceConfig instanceConfig : viewConfig.getInstances()) {
                try {
                  ViewInstanceEntity instanceEntity=createViewInstanceDefinition(viewConfig,viewDefinition,instanceConfig);
                  instanceEntity.setXmlDriven(true);
                  instanceDefinitions.add(instanceEntity);
                }
 catch (                Exception e) {
                  LOG.error("Caught exception adding view instance for view " + viewDefinition.getViewName(),e);
                }
              }
              syncView(viewDefinition,instanceDefinitions);
              addDefinition(viewDefinition);
              for (              ViewInstanceEntity instanceEntity : instanceDefinitions) {
                addInstanceDefinition(viewDefinition,instanceEntity);
              }
              allInstanceDefinitions.addAll(instanceDefinitions);
            }
 catch (            Exception e) {
              LOG.error("Caught exception loading view from " + archiveFile.getAbsolutePath(),e);
            }
          }
        }
        removeUndeployedViews();
      }
    }
    return allInstanceDefinitions;
  }
 catch (  Exception e) {
    throw new SystemException("Caught exception reading view archives.",e);
  }
}
