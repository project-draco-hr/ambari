{
  if (!archiveDir.exists()) {
    String archivePath=archiveDir.getAbsolutePath();
    String msg="Creating archive folder " + archivePath + ".";
    LOG.info(msg);
    setViewStatus(viewDefinition,ViewDefinition.ViewStatus.LOADING,msg);
    if (archiveDir.mkdir()) {
      JarFile viewJarFile=helper.getJarFile(viewArchive);
      Enumeration enumeration=viewJarFile.entries();
      msg="Extracting files from " + viewArchive.getName() + ":";
      LOG.info(msg);
      setViewStatus(viewDefinition,ViewDefinition.ViewStatus.LOADING,msg);
      while (enumeration.hasMoreElements()) {
        JarEntry jarEntry=(JarEntry)enumeration.nextElement();
        String entryPath=archivePath + File.separator + jarEntry.getName();
        LOG.info("    " + entryPath);
        File entryFile=helper.getFile(entryPath);
        if (jarEntry.isDirectory()) {
          if (!entryFile.mkdir()) {
            LOG.error("Could not create archive entry directory " + entryPath + ".");
          }
        }
 else {
          InputStream is=viewJarFile.getInputStream(jarEntry);
          try {
            FileOutputStream fos=helper.getFileOutputStream(entryFile);
            try {
              while (is.available() > 0) {
                fos.write(is.read());
              }
            }
  finally {
              fos.close();
            }
          }
  finally {
            is.close();
          }
        }
      }
    }
 else {
      LOG.error("Could not create archive directory " + archivePath + ".");
    }
  }
  return getArchiveClassLoader(archiveDir);
}
