{
  String viewName=view.getName();
  ViewEntity persistedView=viewDAO.findByName(viewName);
  ResourceTypeEntity resourceType=view.getResourceType();
  if (LOG.isDebugEnabled()) {
    LOG.debug("Syncing view " + viewName + ".");
  }
  if (persistedView == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Creating view " + viewName + ".");
    }
    ResourceTypeEntity resourceTypeEntity=resourceTypeDAO.findByName(viewName);
    if (resourceTypeEntity == null) {
      resourceTypeEntity=resourceType;
      if (LOG.isDebugEnabled()) {
        LOG.debug("Creating resource type for " + viewName + ".");
      }
      resourceTypeDAO.create(resourceTypeEntity);
    }
    for (    ViewInstanceEntity instance : view.getInstances()) {
      instance.setResource(createViewInstanceResource(resourceType));
    }
    persistedView=viewDAO.merge(view);
  }
  view.setResourceType(persistedView.getResourceType());
  view.setPermissions(persistedView.getPermissions());
  for (  ViewInstanceEntity persistedInstance : persistedView.getInstances()) {
    String instanceName=persistedInstance.getName();
    ViewInstanceEntity instance=view.getInstanceDefinition(instanceName);
    if (instance == null) {
      if (persistedInstance.isXmlDriven()) {
        instanceDAO.remove(persistedInstance);
      }
 else {
        instanceDAO.merge(persistedInstance);
        bindViewInstance(view,persistedInstance);
        instanceDefinitions.add(persistedInstance);
      }
    }
 else {
      syncViewInstance(instance,persistedInstance);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Syncing view " + viewName + " complete.");
  }
}
