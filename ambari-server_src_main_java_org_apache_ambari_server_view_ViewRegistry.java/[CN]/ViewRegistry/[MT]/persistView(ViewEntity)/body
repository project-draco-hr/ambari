{
  Set<ViewInstanceEntity> instanceDefinitions=new HashSet<ViewInstanceEntity>();
  String viewName=viewDefinition.getName();
  ViewEntity viewEntity=viewDAO.findByName(viewName);
  if (viewEntity == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Creating View " + viewName + ".");
    }
    viewDAO.create(viewDefinition);
  }
 else {
    for (    ViewInstanceEntity viewInstanceEntity : viewEntity.getInstances()) {
      ViewInstanceEntity instanceDefinition=viewDefinition.getInstanceDefinition(viewInstanceEntity.getName());
      if (instanceDefinition == null) {
        viewInstanceEntity.setViewEntity(viewDefinition);
        bindViewInstance(viewDefinition,viewInstanceEntity);
        instanceDefinitions.add(viewInstanceEntity);
      }
 else {
        instanceDefinition.setLabel(viewInstanceEntity.getLabel());
        instanceDefinition.setData(viewInstanceEntity.getData());
        instanceDefinition.setProperties(viewInstanceEntity.getProperties());
        instanceDefinition.setEntities(viewInstanceEntity.getEntities());
      }
    }
  }
  return instanceDefinitions;
}
