{
  StackInfo stack=null;
  try {
    stack=getStackInfo(stackName,stackVersion);
  }
 catch (  AmbariException e) {
    LOG.debug("Cannot load upgrade packs for non-existent stack {}-{}",stackName,stackVersion,e);
    return Collections.emptyMap();
  }
  File folder=new File(stack.getUpgradesFolder());
  if (!folder.exists() || !folder.isDirectory()) {
    LOG.error("Upgrades folder {} no longer exists",stack.getUpgradesFolder());
    return Collections.emptyMap();
  }
  String[] fileNames=folder.list(new FilenameFilter(){
    @Override public boolean accept(    File folder,    String fileName){
      if (fileName.toLowerCase().endsWith(".xml")) {
        return true;
      }
 else {
        return false;
      }
    }
  }
);
  Map<String,UpgradePack> packs=new HashMap<String,UpgradePack>();
  for (  String fileName : fileNames) {
    File f=new File(folder,fileName);
    String packName=FilenameUtils.removeExtension(fileName);
    try {
      UpgradePack up=StackExtensionHelper.unmarshal(UpgradePack.class,f);
      packs.put(packName,up);
    }
 catch (    Exception e) {
      LOG.error("Could not parse {} into an upgrade pack",f.getAbsolutePath());
    }
  }
  return packs;
}
