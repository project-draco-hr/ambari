{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Loading stack information" + ", stackRoot = " + stackRoot.getAbsolutePath());
  }
  if (!stackRoot.isDirectory() && !stackRoot.exists())   throw new IOException("" + Configuration.METADETA_DIR_PATH + " should be a directory with stack"+ ", stackRoot = "+ stackRoot.getAbsolutePath());
  StackExtensionHelper stackExtensionHelper=new StackExtensionHelper(stackRoot);
  List<StackInfo> stacks=stackExtensionHelper.getAllAvailableStacks();
  if (stacks.isEmpty()) {
    throw new AmbariException("Unable to find stack definitions under " + "stackRoot = " + stackRoot.getAbsolutePath());
  }
  for (  StackInfo stack : stacks) {
    LOG.debug("Adding new stack to known stacks" + ", stackName = " + stack.getName() + ", stackVersion = "+ stack.getVersion());
    stacksResult.add(stack);
    File repositoryFolder=new File(stackRoot.getAbsolutePath() + File.separator + stack.getName()+ File.separator+ stack.getVersion()+ File.separator+ REPOSITORY_FOLDER_NAME+ File.separator+ REPOSITORY_FILE_NAME);
    if (repositoryFolder.exists()) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Adding repositories to stack" + ", stackName=" + stack.getName() + ", stackVersion="+ stack.getVersion()+ ", repoFolder="+ repositoryFolder.getPath());
      }
 else {
        LOG.warn("No repository information defined for " + ", stackName=" + stack.getName() + ", stackVersion="+ stack.getVersion()+ ", repoFolder="+ repositoryFolder.getPath());
      }
      List<RepositoryInfo> repositoryInfoList=getRepository(repositoryFolder,stack.getVersion());
      stack.getRepositories().addAll(repositoryInfoList);
    }
    List<ServiceInfo> services=stackExtensionHelper.getAllApplicableServices(stack);
    stack.setServices(services);
  }
}
