{
  String name=(String)properties.get(BLUEPRINT_NAME_PROPERTY_ID);
  if (name == null || name.isEmpty()) {
    throw new IllegalArgumentException("Blueprint name must be provided");
  }
  String stackName=(String)properties.get(STACK_NAME_PROPERTY_ID);
  String stackVersion=(String)properties.get(STACK_VERSION_PROPERTY_ID);
  StackEntity stackEntity=stackDAO.find(stackName,stackVersion);
  BlueprintEntity blueprint=new BlueprintEntity();
  blueprint.setBlueprintName(name);
  blueprint.setStack(stackEntity);
  createHostGroupEntities(blueprint,(HashSet<HashMap<String,Object>>)properties.get(HOST_GROUP_PROPERTY_ID));
  createBlueprintConfigEntities((Collection<Map<String,String>>)properties.get(CONFIGURATION_PROPERTY_ID),blueprint);
  return blueprint;
}
