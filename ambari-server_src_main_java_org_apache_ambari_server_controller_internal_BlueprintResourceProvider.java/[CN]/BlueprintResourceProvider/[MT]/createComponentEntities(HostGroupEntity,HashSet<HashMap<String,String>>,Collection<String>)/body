{
  Collection<HostGroupComponentEntity> components=new ArrayList<HostGroupComponentEntity>();
  String groupName=group.getName();
  group.setComponents(components);
  if (setComponents == null || setComponents.isEmpty()) {
    throw new IllegalArgumentException("Host group '" + groupName + "' must contain at least one component");
  }
  for (  HashMap<String,String> componentProperties : setComponents) {
    HostGroupComponentEntity component=new HostGroupComponentEntity();
    components.add(component);
    String componentName=componentProperties.get(COMPONENT_NAME_PROPERTY_ID);
    if (componentName == null || componentName.isEmpty()) {
      throw new IllegalArgumentException("Host group '" + groupName + "' contains a component with no 'name' property");
    }
    if (!componentNames.contains(componentName)) {
      throw new IllegalArgumentException("The component '" + componentName + "' in host group '"+ groupName+ "' is not valid for the specified stack");
    }
    component.setName(componentName);
    component.setBlueprintName(group.getBlueprintName());
    component.setHostGroupEntity(group);
    component.setHostGroupName(group.getName());
  }
  group.setComponents(components);
}
