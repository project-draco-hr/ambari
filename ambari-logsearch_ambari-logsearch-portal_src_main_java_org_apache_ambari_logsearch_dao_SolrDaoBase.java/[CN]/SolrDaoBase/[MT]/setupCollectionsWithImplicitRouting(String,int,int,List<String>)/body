{
  logger.info("setupCollectionsWithImplicitRouting(). collectionName=" + collectionName + ", numberOfShards="+ numberOfShards);
  boolean returnValue=true;
  List<String> shardsList=new ArrayList<String>();
  for (int i=0; i < numberOfShards; i++) {
    shardsList.add("shard" + i);
  }
  String shardsListStr=StringUtils.join(shardsList,',');
  if (!allCollectionList.contains(collectionName)) {
    logger.info("Creating collection " + collectionName + ", shardsList="+ shardsList+ ", solrDetail="+ solrDetail);
    CollectionAdminRequest.Create collectionCreateRequest=new CollectionAdminRequest.Create();
    collectionCreateRequest.setCollectionName(collectionName);
    collectionCreateRequest.setRouterName("implicit");
    collectionCreateRequest.setShards(shardsListStr);
    collectionCreateRequest.setNumShards(numberOfShards);
    collectionCreateRequest.setReplicationFactor(replicationFactor);
    collectionCreateRequest.setConfigName(configName);
    collectionCreateRequest.setRouterField(ROUTER_FIELD);
    collectionCreateRequest.setMaxShardsPerNode(replicationFactor * numberOfShards);
    CollectionAdminResponse createResponse=collectionCreateRequest.process(solrClient);
    if (createResponse.getStatus() != 0) {
      returnValue=false;
      logger.error("Error creating collection. collectionName=" + collectionName + ", shardsList="+ shardsList+ ", solrDetail="+ solrDetail+ ", response="+ createResponse);
    }
 else {
      logger.info("Created collection " + collectionName + ", shardsList="+ shardsList+ ", solrDetail="+ solrDetail);
    }
  }
 else {
    logger.info("Collection " + collectionName + " is already there. Will check whether it has the required shards");
    Collection<String> existingShards=getShards();
    for (    String shard : shardsList) {
      if (!existingShards.contains(shard)) {
        try {
          logger.info("Going to add Shard " + shard + " to collection "+ collectionName);
          CollectionAdminRequest.CreateShard createShardRequest=new CollectionAdminRequest.CreateShard();
          createShardRequest.setCollectionName(collectionName);
          createShardRequest.setShardName(shard);
          CollectionAdminResponse response=createShardRequest.process(solrClient);
          if (response.getStatus() != 0) {
            logger.error("Error creating shard " + shard + " in collection "+ collectionName+ ", response="+ response+ ", solrDetail="+ solrDetail);
            returnValue=false;
            break;
          }
 else {
            logger.info("Successfully created shard " + shard + " in collection "+ collectionName);
          }
        }
 catch (        Throwable t) {
          logger.error("Error creating shard " + shard + " in collection "+ collectionName+ ", solrDetail="+ solrDetail,t);
          returnValue=false;
          break;
        }
      }
    }
  }
  return returnValue;
}
