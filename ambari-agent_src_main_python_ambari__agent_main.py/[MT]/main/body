def main():
    global config
    default_cfg = {'agent': {'prefix': '/home/ambari', }, }
    config = ConfigParser.RawConfigParser(default_cfg)
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    signal.signal(signal.SIGUSR1, debug)
    if ((len(sys.argv) > 1) and (sys.argv[1] == 'stop')):
        try:
            f = open(pidfile, 'r')
            pid = f.read()
            pid = int(pid)
            f.close()
            os.kill(pid, signal.SIGTERM)
            time.sleep(5)
            if os.path.exists(pidfile):
                raise Exception('PID file still exists.')
            os._exit(0)
        except Exception as err:
            os.kill(pid, signal.SIGKILL)
            os._exit(1)
    if os.path.isfile(pidfile):
        print ('%s already exists, exiting' % pidfile)
        sys.exit(1)
    else:
        pid = str(os.getpid())
        file(pidfile, 'w').write(pid)
    logger.setLevel(logging.INFO)
    formatter = logging.Formatter('%(asctime)s %(filename)s:%(lineno)d - %(message)s')
    rotateLog = logging.handlers.RotatingFileHandler(logfile, 'a', 10000000, 10)
    rotateLog.setFormatter(formatter)
    logger.addHandler(rotateLog)
    credential = None
    try:
        config = AmbariConfig.config
        if os.path.exists('/etc/ambari/ambari.ini'):
            config.read('/etc/ambari/ambari.ini')
            AmbariConfig.setConfig(config)
        else:
            raise Exception('No config found, use default')
    except Exception as err:
        logger.warn(err)
    killstaleprocesses()
    logger.info(('Connecting to Server at: ' + config.get('server', 'url')))
    certMan = CertificateManager(config)
    certMan.initSecurity()
    controller = Controller(config)
    controller.start()
    controller.run()
    logger.info('finished')
