def stop_agent():
    pid = (-1)
    runner = shellRunner()
    try:
        f = open(ProcessHelper.pidfile, 'r')
        pid = f.read()
        pid = int(pid)
        f.close()
        runner.run([AMBARI_SUDO_BINARY, 'kill', '-15', str(pid)])
        time.sleep(5)
        if os.path.exists(ProcessHelper.pidfile):
            raise Exception('PID file still exists.')
        sys.exit(0)
    except Exception as err:
        if (pid == (-1)):
            print 'Agent process is not running'
        else:
            res = runner.run([AMBARI_SUDO_BINARY, 'kill', '-9', str(pid)])
            if (res['exitCode'] != 0):
                raise Exception((('Error while performing agent stop. ' + res['error']) + res['output']))
        sys.exit(0)
