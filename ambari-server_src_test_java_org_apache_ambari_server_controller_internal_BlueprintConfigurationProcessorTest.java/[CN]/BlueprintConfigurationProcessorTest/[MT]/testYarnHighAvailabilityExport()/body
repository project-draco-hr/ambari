{
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  configProperties.put("yarn-site",yarnSiteProperties);
  yarnSiteProperties.put("yarn.log.server.url","http://" + expectedHostName + ":19888/jobhistory/logs");
  yarnSiteProperties.put("yarn.resourcemanager.hostname",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.scheduler.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.admin.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.https.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.ha.enabled","true");
  yarnSiteProperties.put("yarn.resourcemanager.ha.rm-ids","rm1, rm2");
  yarnSiteProperties.put("yarn.resourcemanager.hostname.rm1",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.hostname.rm2",expectedHostNameTwo);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address.rm1",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address.rm2",expectedHostNameTwo + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address.rm1",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address.rm2",expectedHostNameTwo + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.zk-address",expectedHostName + ":" + "2181"+ ","+ expectedHostNameTwo+ ":"+ "2181");
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address",expectedHostName + ":" + "8080");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("APP_TIMELINE_SERVER");
  hgComponents.add("HISTORYSERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("RESOURCEMANAGER");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("RESOURCEMANAGER")).andReturn(new Cardinality("1-2")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForBlueprintExport();
  assertEquals("Yarn Log Server URL was incorrectly updated","http://" + createExportedAddress("19888",expectedHostGroupName) + "/jobhistory/logs",yarnSiteProperties.get("yarn.log.server.url"));
  assertEquals("Yarn ResourceManager hostname was incorrectly updated",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname"));
  assertEquals("Yarn ResourceManager tracker address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.resource-tracker.address"));
  assertEquals("Yarn ResourceManager webapp address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address"));
  assertEquals("Yarn ResourceManager scheduler address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.scheduler.address"));
  assertEquals("Yarn ResourceManager address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.address"));
  assertEquals("Yarn ResourceManager admin address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.admin.address"));
  assertEquals("Yarn ResourceManager timeline-service address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.address"));
  assertEquals("Yarn ResourceManager timeline webapp address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.address"));
  assertEquals("Yarn ResourceManager timeline webapp HTTPS address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.https.address"));
  assertEquals("Yarn ResourceManager rm1 hostname not exported properly",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname.rm1"));
  assertEquals("Yarn ResourceManager rm2 hostname not exported properly",createExportedHostName(expectedHostGroupNameTwo),yarnSiteProperties.get("yarn.resourcemanager.hostname.rm2"));
  assertEquals("Yarn ResourceManager rm1 web address not exported properly",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address.rm1"));
  assertEquals("Yarn ResourceManager rm2 web address not exported properly",createExportedHostName(expectedHostGroupNameTwo,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address.rm2"));
  assertEquals("Yarn ResourceManager rm1 HTTPS address not exported properly",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address.rm1"));
  assertEquals("Yarn ResourceManager rm2 HTTPS address not exported properly",createExportedHostName(expectedHostGroupNameTwo,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address.rm2"));
  assertEquals("Yarn Zookeeper address property not exported properly",createExportedHostName(expectedHostGroupName,"2181") + "," + createExportedHostName(expectedHostGroupNameTwo,"2181"),yarnSiteProperties.get("yarn.resourcemanager.zk-address"));
  assertEquals("Yarn RM webapp address not exported properly",createExportedHostName(expectedHostGroupName,"8080"),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address"));
}
