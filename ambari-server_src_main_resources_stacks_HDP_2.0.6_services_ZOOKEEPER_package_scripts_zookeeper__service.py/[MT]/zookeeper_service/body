def zookeeper_service(action='start'):
    import params
    cmd = format('env ZOOCFGDIR={config_dir} ZOOCFG=zoo.cfg {zk_bin}/zkServer.sh')
    if (action == 'start'):
        daemon_cmd = format('source {config_dir}/zookeeper-env.sh ; {cmd} start')
        no_op_test = format('ls {zk_pid_file} >/dev/null 2>&1 && ps -p `cat {zk_pid_file}` >/dev/null 2>&1')
        Execute(daemon_cmd, not_if=no_op_test, user=params.zk_user)
        if params.security_enabled:
            kinit_cmd = format('{kinit_path_local} -kt {smoke_user_keytab} {smokeuser};')
            Execute(kinit_cmd, user=params.smokeuser)
        create_command = format("echo 'create /zk_test mydata' | {zk_cli_shell}")
        list_command = format("echo 'ls /' | {zk_cli_shell}")
        delete_command = format("echo 'delete /zk_test ' | {zk_cli_shell}")
        '\n    Execute(create_command,\n            user=params.smokeuser)\n    Execute(list_command,\n            user=params.smokeuser)\n    Execute(delete_command,\n            user=params.smokeuser)\n    '
    elif (action == 'stop'):
        daemon_cmd = format('source {config_dir}/zookeeper-env.sh ; {cmd} stop')
        rm_pid = format('rm -f {zk_pid_file}')
        Execute(daemon_cmd, user=params.zk_user)
        Execute(rm_pid)
