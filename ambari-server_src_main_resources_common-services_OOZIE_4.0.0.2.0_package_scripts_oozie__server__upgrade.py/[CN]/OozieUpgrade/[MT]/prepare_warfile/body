@staticmethod
def prepare_warfile():
    "\n    Invokes the 'prepare-war' command in Oozie in order to create the WAR.\n    The prepare-war command uses the input WAR from ${OOZIE_HOME}/oozie.war and\n    outputs the prepared WAR to ${CATALINA_BASE}/webapps/oozie.war - because of this,\n    both of these environment variables must point to the upgraded oozie-server path and\n    not oozie-client since it was not yet updated.\n\n    This method will also perform a kinit if necessary.\n    :return:\n    "
    import params
    if params.security_enabled:
        oozie_principal_with_host = params.oozie_principal.replace('_HOST', params.hostname)
        command = format('{kinit_path_local} -kt {oozie_keytab} {oozie_principal_with_host}')
        Execute(command, user=params.oozie_user, logoutput=True)
    environment = {'CATALINA_BASE': '/usr/hdp/current/oozie-server/oozie-server', 'OOZIE_HOME': '/usr/hdp/current/oozie-server', }
    command = format('{oozie_setup_sh} prepare-war {oozie_secure} -d {oozie_libext_dir}')
    (return_code, oozie_output) = shell.call(command, user=params.oozie_user, logoutput=False, quiet=False, env=environment)
    if (oozie_output is None):
        oozie_output = ''
    if ((return_code != 0) or ('New Oozie WAR file with added'.lower() not in oozie_output.lower())):
        message = 'Unexpected Oozie WAR preparation output {0}'.format(oozie_output)
        Logger.error(message)
        raise Fail(message)
