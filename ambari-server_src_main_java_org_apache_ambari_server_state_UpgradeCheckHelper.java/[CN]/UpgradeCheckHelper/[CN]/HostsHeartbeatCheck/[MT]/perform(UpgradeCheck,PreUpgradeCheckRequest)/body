{
  final String clusterName=request.getClusterName();
  final Cluster cluster=clustersProvider.get().getCluster(clusterName);
  final Map<String,Host> clusterHosts=clustersProvider.get().getHostsForCluster(clusterName);
  for (  Map.Entry<String,Host> hostEntry : clusterHosts.entrySet()) {
    final Host host=hostEntry.getValue();
    if (host.getHealthStatus().getHealthStatus() == HealthStatus.UNKNOWN && host.getMaintenanceState(cluster.getClusterId()) == MaintenanceState.OFF) {
      upgradeCheck.getFailedOn().add(host.getHostName());
    }
  }
  if (!upgradeCheck.getFailedOn().isEmpty()) {
    upgradeCheck.setStatus(UpgradeCheckStatus.FAIL);
    upgradeCheck.setFailReason("Some hosts are not heartbeating with the server");
  }
}
