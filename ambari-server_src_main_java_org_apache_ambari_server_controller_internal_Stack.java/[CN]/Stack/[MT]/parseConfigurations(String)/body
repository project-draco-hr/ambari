{
  Map<String,Map<String,ConfigProperty>> mapServiceConfig=new HashMap<String,Map<String,ConfigProperty>>();
  Map<String,Map<String,ConfigProperty>> mapRequiredServiceConfig=new HashMap<String,Map<String,ConfigProperty>>();
  serviceConfigurations.put(service,mapServiceConfig);
  requiredServiceConfigurations.put(service,mapRequiredServiceConfig);
  Set<StackConfigurationResponse> serviceConfigs=controller.getStackConfigurations(Collections.singleton(new StackConfigurationRequest(name,version,service,null)));
  Set<StackConfigurationResponse> stackLevelConfigs=controller.getStackLevelConfigurations(Collections.singleton(new StackLevelConfigurationRequest(name,version,null)));
  serviceConfigs.addAll(stackLevelConfigs);
  for (  StackConfigurationResponse config : serviceConfigs) {
    String type=config.getType();
    if (type.endsWith(".xml")) {
      type=type.substring(0,type.length() - 4);
    }
    Map<String,ConfigProperty> mapTypeConfig=mapServiceConfig.get(type);
    if (mapTypeConfig == null) {
      mapTypeConfig=new HashMap<String,ConfigProperty>();
      mapServiceConfig.put(type,mapTypeConfig);
    }
    ConfigProperty property=new ConfigProperty(config);
    mapTypeConfig.put(config.getPropertyName(),property);
    if (config.isRequired()) {
      Map<String,ConfigProperty> requiredTypeConfig=mapRequiredServiceConfig.get(type);
      if (requiredTypeConfig == null) {
        requiredTypeConfig=new HashMap<String,ConfigProperty>();
        mapRequiredServiceConfig.put(type,requiredTypeConfig);
      }
      requiredTypeConfig.put(config.getPropertyName(),property);
    }
  }
}
