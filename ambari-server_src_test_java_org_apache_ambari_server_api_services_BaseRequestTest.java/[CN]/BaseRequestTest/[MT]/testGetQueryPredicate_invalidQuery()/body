{
  String uriString="http://localhost.com:8080/api/v1/clusters?&foo|";
  PredicateCompiler compiler=createStrictMock(PredicateCompiler.class);
  UriInfo uriInfo=createMock(UriInfo.class);
  URI uri=new URI(URLEncoder.encode(uriString,"UTF-8"));
  expect(uriInfo.getRequestUri()).andReturn(uri);
  expect(compiler.compile(uriString.substring(uriString.indexOf("?") + 1))).andThrow(new InvalidQueryException("test"));
  replay(uriInfo,compiler);
  Request request=getTestRequest(null,null,uriInfo,compiler);
  try {
    request.getQueryPredicate();
    fail("Expected InvalidQueryException due to invalid query");
  }
 catch (  InvalidQueryException e) {
  }
  verify(uriInfo,compiler);
}
