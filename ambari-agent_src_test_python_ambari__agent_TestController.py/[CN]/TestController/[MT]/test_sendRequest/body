@patch('urllib2.Request')
@patch.object(Controller, 'security')
def test_sendRequest(self, security_mock, requestMock):
    conMock = MagicMock()
    security_mock.CachedHTTPSConnection.return_value = conMock
    url = 'http://ambari.apache.org:8081/agent'
    data = 'data'
    requestMock.return_value = 'request'
    self.controller.cachedconnect = None
    conMock.request.return_value = '{"valid_object": true}'
    actual = self.controller.sendRequest(url, data)
    expected = json.loads('{"valid_object": true}')
    self.assertEqual(actual, expected)
    security_mock.CachedHTTPSConnection.assert_called_once_with(self.controller.config)
    requestMock.called_once_with(url, data, {'Content-Type': 'application/json', })
    conMock.request.return_value = '{invalid_object}'
    actual = self.controller.sendRequest(url, data)
    expected = {'exitstatus': 1, 'log': (('Response parsing failed! Request data: ' + data) + '; Response: {invalid_object}'), }
    self.assertEqual(actual, expected)
    exceptionMessage = 'Connection Refused'
    conMock.request.side_effect = Exception(exceptionMessage)
    actual = self.controller.sendRequest(url, data)
    expected = {'exitstatus': 1, 'log': ((('Request to ' + url) + ' failed due to ') + exceptionMessage), }
    self.assertEqual(actual, expected)
