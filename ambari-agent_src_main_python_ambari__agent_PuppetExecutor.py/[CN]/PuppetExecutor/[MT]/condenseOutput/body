def condenseOutput(self, stdout, stderr, retcode):
    grep = self.grep
    if (stderr == self.NO_ERROR):
        result = grep.tail(stdout, grep.OUTPUT_LAST_LINES)
    else:
        result = grep.grep(stdout, 'fail', grep.ERROR_LAST_LINES_BEFORE, grep.ERROR_LAST_LINES_AFTER)
        result = grep.cleanByTemplate(result, 'warning')
        if (result is None):
            result = grep.grep(stdout, 'err', grep.ERROR_LAST_LINES_BEFORE, grep.ERROR_LAST_LINES_AFTER)
            result = grep.cleanByTemplate(result, 'warning')
    filteredresult = grep.filterMarkup(result)
    return filteredresult
