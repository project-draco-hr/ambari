{
  validateRecommendationRequest(request);
  String hostsJSON=getHostsInformation(request);
  String servicesJSON=getServicesInformation(request);
  try {
    createRequestDirectory();
    FileUtils.writeStringToFile(new File(requestDirectory,"hosts.json"),hostsJSON);
    FileUtils.writeStringToFile(new File(requestDirectory,"services.json"),servicesJSON);
    boolean success=saRunner.runScript(stackAdvisorScript,StackAdvisorCommand.RECOMMEND_COMPONENT_LAYOUT,requestDirectory);
    if (!success) {
      String message="Stack advisor script finished with errors";
      LOG.warn(message);
      throw new StackAdvisorException(message);
    }
    String result=FileUtils.readFileToString(new File(requestDirectory,"component-layout.json"));
    ObjectMapper mapper=new ObjectMapper();
    return mapper.readValue(result,RecommendationResponse.class);
  }
 catch (  Exception e) {
    String message="Error occured during preparing component-layout recommendations";
    LOG.warn(message,e);
    throw new StackAdvisorException(message,e);
  }
}
