{
  String clusterName=(String)requestMap.get(UPGRADE_CLUSTER_NAME);
  String version=(String)requestMap.get(UPGRADE_VERSION);
  String versionForUpgradePack=(String)requestMap.get(UPGRADE_FROM_VERSION);
  boolean skipPrereqChecks=Boolean.parseBoolean((String)requestMap.get(UPGRADE_SKIP_PREREQUISITE_CHECKS));
  boolean failOnCheckWarnings=Boolean.parseBoolean((String)requestMap.get(UPGRADE_FAIL_ON_CHECK_WARNINGS));
  String preferredUpgradePackName=(String)requestMap.get(UPGRADE_PACK);
  final UpgradeType upgradeType=requestMap.containsKey(UPGRADE_TYPE) ? UpgradeType.valueOf(requestMap.get(UPGRADE_TYPE).toString()) : UpgradeType.ROLLING;
  if (null == clusterName) {
    throw new AmbariException(String.format("%s is required",UPGRADE_CLUSTER_NAME));
  }
  if (null == version) {
    throw new AmbariException(String.format("%s is required",UPGRADE_VERSION));
  }
  Cluster cluster=getManagementController().getClusters().getCluster(clusterName);
  UpgradePack pack=s_upgradeHelper.suggestUpgradePack(clusterName,versionForUpgradePack,version,direction,upgradeType,preferredUpgradePackName);
  validatePreRequest(cluster,direction,version,requestMap);
  return pack;
}
