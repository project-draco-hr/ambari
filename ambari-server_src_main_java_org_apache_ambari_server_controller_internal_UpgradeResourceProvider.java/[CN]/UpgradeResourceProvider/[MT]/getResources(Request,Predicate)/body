{
  Set<Resource> results=new HashSet<Resource>();
  Set<String> requestPropertyIds=getRequestPropertyIds(request,predicate);
  for (  Map<String,Object> propertyMap : getPropertyMaps(predicate)) {
    String clusterName=(String)propertyMap.get(UPGRADE_CLUSTER_NAME);
    if (null == clusterName || clusterName.isEmpty()) {
      throw new IllegalArgumentException("The cluster name is required when querying for upgrades");
    }
    Cluster cluster=null;
    try {
      cluster=getManagementController().getClusters().getCluster(clusterName);
    }
 catch (    AmbariException e) {
      throw new NoSuchResourceException(String.format("Cluster %s could not be loaded",clusterName));
    }
    List<UpgradeEntity> upgrades=m_dao.findUpgrades(cluster.getClusterId());
    for (    UpgradeEntity entity : upgrades) {
      results.add(toResource(entity,clusterName,requestPropertyIds));
    }
  }
  return results;
}
