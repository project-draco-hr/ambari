{
  Set<Map<String,Object>> requestMaps=request.getProperties();
  if (requestMaps.size() > 1) {
    throw new SystemException("Can only initiate one upgrade per request.");
  }
  final Map<String,Object> requestMap=requestMaps.iterator().next();
  UpgradeEntity entity=createResources(new Command<UpgradeEntity>(){
    @Override public UpgradeEntity invoke() throws AmbariException {
      UpgradePack up=validateRequest(requestMap);
      return createUpgrade(up,requestMap);
    }
  }
);
  notifyCreate(Resource.Type.Upgrade,request);
  Resource res=new ResourceImpl(Resource.Type.Upgrade);
  res.setProperty(UPGRADE_REQUEST_ID,entity.getRequestId());
  return new RequestStatusImpl(null,Collections.singleton(res));
}
