{
  List<TaskHolder> taskHolders=buildStageStrategy(preUpgrade ? pc.preTasks : pc.postTasks);
  List<StageHolder> stages=new ArrayList<StageHolder>();
  StringBuilder sb=new StringBuilder(preUpgrade ? "Preparing " : "Finalizing ");
  sb.append("%s on %d host(s).  Phase %s/%s");
  String textFormat=sb.toString();
  for (  TaskHolder taskHolder : taskHolders) {
    int i=1;
    for (    Set<String> hostGroup : hostGroups) {
      StageHolder stage=new StageHolder();
      stage.hosts=hostGroup;
      stage.taskHolder=taskHolder;
      stage.upgradeItemEntity=new UpgradeItemEntity();
      stage.upgradeItemEntity.setText(String.format(textFormat,pc.name,Integer.valueOf(hostGroup.size()),Integer.valueOf(i++),Integer.valueOf(hostGroups.size())));
      stages.add(stage);
    }
  }
  return stages;
}
