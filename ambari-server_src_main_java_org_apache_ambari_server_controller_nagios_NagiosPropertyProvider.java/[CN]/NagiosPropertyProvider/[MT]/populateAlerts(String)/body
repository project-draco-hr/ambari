{
  String nagiosHost=null;
  List<NagiosAlert> results=new ArrayList<NagiosAlert>();
  try {
    Cluster cluster=clusters.getCluster(clusterName);
    Service service=cluster.getService("NAGIOS");
    Map<String,ServiceComponentHost> hosts=service.getServiceComponent("NAGIOS_SERVER").getServiceComponentHosts();
    if (!hosts.isEmpty())     nagiosHost=hosts.keySet().iterator().next();
    Collection<Alert> currentAlerts=cluster.getAlerts();
    if (null != currentAlerts) {
      for (      Alert alert : currentAlerts) {
        results.add(new NagiosAlert(alert));
      }
    }
  }
 catch (  AmbariException e) {
    LOG.debug("Cannot find a nagios service.  Skipping alerts.");
  }
  if (null == nagiosHost) {
    return results;
  }
 else {
    String template=NAGIOS_TEMPLATE;
    if (ComponentSSLConfiguration.instance().isNagiosSSL())     template=template.replace("http","https");
    String url=String.format(template,nagiosHost);
    InputStream in=null;
    try {
      in=urlStreamProvider.readFrom(url);
      NagiosAlerts alerts=new Gson().fromJson(IOUtils.toString(in,"UTF-8"),NagiosAlerts.class);
      results.addAll(alerts.alerts);
      Collections.sort(results,new Comparator<NagiosAlert>(){
        @Override public int compare(        NagiosAlert o1,        NagiosAlert o2){
          if (o2.getStatus() != o1.getStatus())           return o2.getStatus() - o1.getStatus();
 else {
            return (int)(o2.getLastStatusTime() - o1.getLastStatusTime());
          }
        }
      }
);
      return results;
    }
 catch (    Exception e) {
      throw new SystemException("Error reading HTTP response for cluster " + clusterName + ", nagios="+ url+ " ("+ e.getMessage()+ ")",e);
    }
 finally {
      if (in != null) {
        try {
          in.close();
        }
 catch (        IOException ioe) {
          LOG.error("Error closing HTTP response stream " + url);
        }
      }
    }
  }
}
