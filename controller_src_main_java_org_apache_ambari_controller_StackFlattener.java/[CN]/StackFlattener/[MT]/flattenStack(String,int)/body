{
  List<Stack> stacks=getStackList(stackName,stackRevision);
  Stack result=new Stack(stacks.get(stacks.size() - 1));
  result.setParentName(null);
  result.setPackageRepositories(flattenRepositories(stacks));
  result.setDefault_user_group(flattenUserGroup(stacks));
  List<Component> components=new ArrayList<Component>();
  result.setComponents(components);
  for (  String componentName : getComponents(stacks)) {
    components.add(flattenComponent(componentName,stacks));
  }
  result.setConfiguration(buildClientConfiguration(stacks));
  for (  Component comp : components) {
    if (comp.getUser_group() == null) {
      comp.setUser_group(result.getDefault_user_group());
    }
  }
  return result;
}
