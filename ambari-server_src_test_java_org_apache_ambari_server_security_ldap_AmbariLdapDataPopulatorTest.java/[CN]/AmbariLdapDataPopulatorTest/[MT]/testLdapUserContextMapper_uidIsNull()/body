{
  LdapServerProperties ldapServerProperties=createNiceMock(LdapServerProperties.class);
  expect(ldapServerProperties.getUsernameAttribute()).andReturn("cn").once();
  DirContextAdapter adapter=createNiceMock(DirContextAdapter.class);
  expect(adapter.getStringAttribute("cn")).andReturn("testUser");
  expect(adapter.getStringAttribute("uid")).andReturn(null);
  expect(adapter.getNameInNamespace()).andReturn("cn=testUser,ou=Ambari,dc=SME,dc=support,dc=com");
  replay(ldapServerProperties,adapter);
  Set<LdapUserDto> userResultSet=new HashSet<LdapUserDto>();
  AmbariLdapDataPopulator.LdapUserContextMapper ldapUserContextMapper=new AmbariLdapDataPopulator.LdapUserContextMapper(userResultSet,ldapServerProperties);
  ldapUserContextMapper.mapFromContext(adapter);
  assertEquals(1,userResultSet.size());
  LdapUserDto userDto=userResultSet.iterator().next();
  assertNull(userDto.getUid());
  assertEquals("testuser",userDto.getUserName());
  assertEquals("cn=testuser,ou=ambari,dc=sme,dc=support,dc=com",userDto.getDn());
}
