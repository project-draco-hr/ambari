{
  server=new Server(CONTROLLER_PORT);
  try {
    Context root=new Context(server,"/",Context.SESSIONS);
    String AMBARI_HOME=System.getenv("AMBARI_HOME");
    root.setBaseResource(new ResourceCollection(new Resource[]{Resource.newResource(AMBARI_HOME + "/webapps/")}));
    ServletHolder rootServlet=root.addServlet(DefaultServlet.class,"/");
    rootServlet.setInitOrder(1);
    ServletHolder sh=new ServletHolder(ServletContainer.class);
    sh.setInitParameter("com.sun.jersey.config.property.resourceConfigClass","com.sun.jersey.api.core.PackagesResourceConfig");
    sh.setInitParameter("com.sun.jersey.config.property.packages","org.apache.ambari.controller.rest.resources");
    sh.setInitParameter("com.sun.jersey.config.property.WadlGeneratorConfig","org.apache.ambari.controller.rest.config.ExtendedWadlGeneratorConfig");
    root.addServlet(sh,"/rest/*");
    sh.setInitOrder(2);
    ServletHolder agent=new ServletHolder(ServletContainer.class);
    agent.setInitParameter("com.sun.jersey.config.property.resourceConfigClass","com.sun.jersey.api.core.PackagesResourceConfig");
    agent.setInitParameter("com.sun.jersey.config.property.packages","org.apache.ambari.controller.rest.agent");
    agent.setInitParameter("com.sun.jersey.config.property.WadlGeneratorConfig","org.apache.ambari.controller.rest.config.PrivateWadlGeneratorConfig");
    root.addServlet(agent,"/agent/*");
    agent.setInitOrder(3);
    server.setStopAtShutdown(true);
    server.start();
  }
 catch (  Exception e) {
    e.printStackTrace();
    LOG.error(ExceptionUtil.getStackTrace(e));
  }
}
