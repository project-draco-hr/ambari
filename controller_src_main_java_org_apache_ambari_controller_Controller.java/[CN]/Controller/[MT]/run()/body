{
  server=new Server(CONTROLLER_PORT);
  try {
    Context root=new Context(server,"/",Context.SESSIONS);
    String AMBARI_HOME=System.getenv("AMBARI_HOME");
    root.setBaseResource(new ResourceCollection(new Resource[]{Resource.newResource(AMBARI_HOME + "/webapps/")}));
    ServletHolder rootServlet=root.addServlet(DefaultServlet.class,"/");
    rootServlet.setInitOrder(1);
    ServletHolder sh=new ServletHolder(ServletContainer.class);
    sh.setInitParameter("com.sun.jersey.config.property.resourceConfigClass","com.sun.jersey.api.core.PackagesResourceConfig");
    sh.setInitParameter("com.sun.jersey.config.property.packages","org.apache.ambari.controller.rest.resources");
    sh.setInitParameter("com.sun.jersey.config.property.WadlGeneratorConfig","org.apache.ambari.controller.rest.config.ExtendedWadlGeneratorConfig");
    root.addServlet(sh,"/v1/*");
    sh.setInitOrder(2);
    Constraint constraint=new Constraint();
    constraint.setName(Constraint.__BASIC_AUTH);
    ;
    constraint.setRoles(new String[]{"user","admin","moderator"});
    constraint.setAuthenticate(true);
    ConstraintMapping cm=new ConstraintMapping();
    cm.setConstraint(constraint);
    cm.setPathSpec("/v1/controller/*");
    SecurityHandler security=new SecurityHandler();
    security.setUserRealm(new HashUserRealm("Controller",System.getenv("AMBARI_CONF_DIR") + "/auth.conf"));
    security.setConstraintMappings(new ConstraintMapping[]{cm});
    root.addHandler(security);
    server.setStopAtShutdown(true);
    server.start();
  }
 catch (  Exception e) {
    LOG.error(ExceptionUtil.getStackTrace(e));
  }
}
