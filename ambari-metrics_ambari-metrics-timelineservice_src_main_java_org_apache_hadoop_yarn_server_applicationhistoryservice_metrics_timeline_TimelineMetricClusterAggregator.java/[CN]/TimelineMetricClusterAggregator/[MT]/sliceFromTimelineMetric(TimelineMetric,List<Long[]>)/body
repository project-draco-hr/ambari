{
  if (timelineMetric.getMetricValues().isEmpty()) {
    return null;
  }
  Map<TimelineClusterMetric,Double> timelineClusterMetricMap=new HashMap<TimelineClusterMetric,Double>();
  for (  Map.Entry<Long,Double> metric : timelineMetric.getMetricValues().entrySet()) {
    if (metric.getValue() == null) {
      continue;
    }
    Long timestamp=getSliceTimeForMetric(timeSlices,Long.parseLong(metric.getKey().toString()));
    if (timestamp != -1) {
      TimelineClusterMetric clusterMetric=new TimelineClusterMetric(timelineMetric.getMetricName(),timelineMetric.getAppId(),timelineMetric.getInstanceId(),timestamp,timelineMetric.getType());
      if (!timelineClusterMetricMap.containsKey(clusterMetric)) {
        timelineClusterMetricMap.put(clusterMetric,metric.getValue());
      }
 else {
        Double oldValue=timelineClusterMetricMap.get(clusterMetric);
        Double newValue=(oldValue + metric.getValue()) / 2;
        timelineClusterMetricMap.put(clusterMetric,newValue);
      }
    }
  }
  return timelineClusterMetricMap;
}
