{
  String name=node.getName();
  Resource r=node.getObject();
  if (r == null) {
    if (name != null) {
      if (node.getParent() == null) {
        m_generator.writeStartObject();
        writeHref(node);
      }
      m_generator.writeArrayFieldStart(name);
    }
  }
 else {
    m_generator.writeStartObject();
    writeHref(node);
    handleResourceProperties(r.getCategories());
  }
  for (  TreeNode<Resource> child : node.getChildren()) {
    processNode(child);
  }
  if (r == null) {
    if (name != null) {
      m_generator.writeEndArray();
      if (node.getParent() == null) {
        m_generator.writeEndObject();
      }
    }
  }
 else {
    m_generator.writeEndObject();
  }
}
