{
  InternalAuthenticationToken token=(InternalAuthenticationToken)authentication;
  if (internalTokenStorage.isValidInternalToken(token.getCredentials())) {
    token.setAuthenticated(true);
  }
 else {
    String message="Bad credentials";
    throw new BadCredentialsException(message);
  }
  return token;
}
