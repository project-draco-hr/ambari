{
  Object principal=authentication.getPrincipal();
  if (principal instanceof UserDetails) {
    UserDetails user=(UserDetails)principal;
    principal=new User(AuthorizationHelper.resolveLoginAliasToUserName(user.getUsername()),user.getPassword(),user.isEnabled(),user.isAccountNonExpired(),user.isCredentialsNonExpired(),user.isAccountNonLocked(),user.getAuthorities());
  }
 else   if (!(principal instanceof Principal) && principal != null) {
    String username=principal.toString();
    principal=AuthorizationHelper.resolveLoginAliasToUserName(username);
  }
 else {
    principal=null;
  }
  return principal;
}
