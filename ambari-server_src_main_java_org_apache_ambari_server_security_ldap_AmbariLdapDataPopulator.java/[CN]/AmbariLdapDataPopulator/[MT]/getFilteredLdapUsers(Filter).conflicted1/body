{
  final Set<LdapUserDto> users=new HashSet<LdapUserDto>();
  final LdapTemplate ldapTemplate=loadLdapTemplate();
  String baseDn=ldapServerProperties.getBaseDN();
  PagedResultsDirContextProcessor processor=createPagingProcessor();
  SearchControls searchControls=new SearchControls();
  searchControls.setSearchScope(SearchControls.SUBTREE_SCOPE);
  LdapUserContextMapper ldapUserContextMapper=new LdapUserContextMapper(ldapServerProperties);
  String encodedFilter=filter.encode();
  do {
    for (    Object dto : ldapTemplate.search(baseDn,encodedFilter,searchControls,ldapUserContextMapper,processor)) {
      if (dto != null) {
        users.add((LdapUserDto)dto);
      }
    }
  }
 while (processor.getCookie().getCookie() != null);
  return users;
}
