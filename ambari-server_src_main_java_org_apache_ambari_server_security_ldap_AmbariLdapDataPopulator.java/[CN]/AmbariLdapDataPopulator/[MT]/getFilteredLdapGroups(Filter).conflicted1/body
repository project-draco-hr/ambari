{
  final Set<LdapGroupDto> groups=new HashSet<LdapGroupDto>();
  final LdapTemplate ldapTemplate=loadLdapTemplate();
  String baseDn=ldapServerProperties.getBaseDN();
  ldapTemplate.search(baseDn,filter.encode(),new ContextMapper(){
    @Override public Object mapFromContext(    Object ctx){
      final DirContextAdapter adapter=(DirContextAdapter)ctx;
      final LdapGroupDto group=new LdapGroupDto();
      final String groupNameAttribute=adapter.getStringAttribute(ldapServerProperties.getGroupNamingAttr());
      if (groupNameAttribute != null) {
        group.setGroupName(groupNameAttribute.toLowerCase());
        final String[] uniqueMembers=adapter.getStringAttributes(ldapServerProperties.getGroupMembershipAttr());
        if (uniqueMembers != null) {
          for (          String uniqueMember : uniqueMembers) {
            group.getMemberAttributes().add(uniqueMember.toLowerCase());
          }
        }
        groups.add(group);
      }
      return null;
    }
  }
);
  return groups;
}
