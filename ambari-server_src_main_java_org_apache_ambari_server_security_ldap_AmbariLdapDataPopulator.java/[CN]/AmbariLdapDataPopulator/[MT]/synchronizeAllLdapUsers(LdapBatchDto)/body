{
  Set<LdapUserDto> externalLdapUserInfo=getExternalLdapUserInfo();
  Map<String,User> internalUsersMap=getInternalUsers();
  for (  LdapUserDto userDto : externalLdapUserInfo) {
    String userName=userDto.getUserName();
    if (internalUsersMap.containsKey(userName)) {
      final User user=internalUsersMap.get(userName);
      if (user != null && !user.isLdapUser()) {
        batchInfo.getUsersToBecomeLdap().add(userName);
      }
      internalUsersMap.remove(userName);
    }
 else {
      batchInfo.getUsersToBeCreated().add(userName);
    }
  }
  for (  Entry<String,User> internalUser : internalUsersMap.entrySet()) {
    if (internalUser.getValue().isLdapUser()) {
      batchInfo.getUsersToBeRemoved().add(internalUser.getValue().getUserName());
    }
  }
  return batchInfo;
}
