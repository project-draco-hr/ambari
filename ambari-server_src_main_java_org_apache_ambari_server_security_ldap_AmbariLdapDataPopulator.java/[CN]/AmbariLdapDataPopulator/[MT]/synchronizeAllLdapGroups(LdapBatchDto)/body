{
  Set<LdapGroupDto> externalLdapGroupInfo=getExternalLdapGroupInfo();
  final Map<String,Group> internalGroupsMap=getInternalGroups();
  final Map<String,User> internalUsersMap=getInternalUsers();
  for (  LdapGroupDto groupDto : externalLdapGroupInfo) {
    String groupName=groupDto.getGroupName();
    if (internalGroupsMap.containsKey(groupName)) {
      final Group group=internalGroupsMap.get(groupName);
      if (!group.isLdapGroup()) {
        batchInfo.getGroupsToBecomeLdap().add(groupName);
      }
      internalGroupsMap.remove(groupName);
    }
 else {
      batchInfo.getGroupsToBeCreated().add(groupName);
    }
    refreshGroupMembers(batchInfo,groupDto,internalUsersMap,null);
  }
  for (  Entry<String,Group> internalGroup : internalGroupsMap.entrySet()) {
    if (internalGroup.getValue().isLdapGroup()) {
      batchInfo.getGroupsToBeRemoved().add(internalGroup.getValue().getGroupName());
    }
  }
  return batchInfo;
}
