{
  PrincipalTypeEntity principalTypeEntity=new PrincipalTypeEntity();
  principalTypeEntity.setName(PrincipalTypeEntity.USER_PRINCIPAL_TYPE_NAME);
  principalTypeDAO.create(principalTypeEntity);
  PrincipalEntity principalEntity=new PrincipalEntity();
  principalEntity.setPrincipalType(principalTypeEntity);
  principalDAO.create(principalEntity);
  RoleEntity role=roleDAO.findByName(users.getUserRole());
  UserEntity ldapUser=new UserEntity();
  ldapUser.setUserName("ldapUser");
  ldapUser.setLdapUser(true);
  ldapUser.setPrincipal(principalEntity);
  userDAO.create(ldapUser);
  UserEntity userEntity=userDAO.findLdapUserByName("ldapUser");
  userEntity.getRoleEntities().add(role);
  role.getUserEntities().add(ldapUser);
  userDAO.merge(ldapUser);
  roleDAO.merge(role);
}
