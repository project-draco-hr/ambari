{
  createLdapUser();
  User ldapUser=users.getLdapUser("ldapUser");
  users.createUser("localadmin","admin");
  User localUser=users.getLocalUser("localadmin");
  users.promoteToAdmin(localUser);
  users.promoteToAdmin(ldapUser);
  ldapUser=users.getLdapUser("ldapUser");
  assertTrue(ldapUser.getRoles().contains(users.getAdminRole()));
  users.demoteAdmin(ldapUser);
  ldapUser=users.getLdapUser("ldapUser");
  assertFalse(ldapUser.getRoles().contains(users.getAdminRole()));
  users.removeUser(ldapUser);
  properties.setProperty(Configuration.LDAP_GROUP_BASE_KEY,"ou=groups,dc=ambari,dc=apache,dc=org");
  createLdapUser();
  try {
    users.promoteToAdmin(ldapUser);
    fail("Not allowed with mapping on");
  }
 catch (  AmbariException e) {
  }
  try {
    users.demoteAdmin(ldapUser);
    fail("Not allowed with mapping on");
  }
 catch (  AmbariException e) {
  }
}
