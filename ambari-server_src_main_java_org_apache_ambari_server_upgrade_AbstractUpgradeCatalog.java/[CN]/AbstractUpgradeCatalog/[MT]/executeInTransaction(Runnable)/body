{
  EntityManager entityManager=getEntityManagerProvider().get();
  if (entityManager.getTransaction().isActive()) {
    func.run();
  }
 else {
    entityManager.getTransaction().begin();
    try {
      func.run();
      entityManager.getTransaction().commit();
    }
 catch (    Exception e) {
      entityManager.getTransaction().rollback();
      throw new RuntimeException(e);
    }
  }
}
