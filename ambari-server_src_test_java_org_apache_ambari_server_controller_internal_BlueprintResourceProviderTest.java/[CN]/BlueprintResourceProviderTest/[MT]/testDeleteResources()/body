{
  Capture<BlueprintEntity> entityCapture=new Capture<BlueprintEntity>();
  ResourceProvider provider=createProvider();
  BlueprintEntity blueprintEntity=((BlueprintResourceProvider)provider).toEntity(getTestProperties().iterator().next());
  expect(dao.findByName(BLUEPRINT_NAME)).andReturn(blueprintEntity);
  dao.remove(capture(entityCapture));
  replay(dao);
  Predicate predicate=new EqualsPredicate<String>(BlueprintResourceProvider.BLUEPRINT_NAME_PROPERTY_ID,BLUEPRINT_NAME);
  AbstractResourceProviderTest.TestObserver observer=new AbstractResourceProviderTest.TestObserver();
  ((ObservableResourceProvider)provider).addObserver(observer);
  provider.deleteResources(predicate);
  ResourceProviderEvent lastEvent=observer.getLastEvent();
  assertNotNull(lastEvent);
  assertEquals(Resource.Type.Blueprint,lastEvent.getResourceType());
  assertEquals(ResourceProviderEvent.Type.Delete,lastEvent.getType());
  assertNotNull(lastEvent.getPredicate());
  verify(dao);
  validateEntity(entityCapture.getValue(),false);
}
