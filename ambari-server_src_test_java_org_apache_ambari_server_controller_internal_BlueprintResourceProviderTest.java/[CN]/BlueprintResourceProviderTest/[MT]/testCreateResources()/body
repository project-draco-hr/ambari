{
  Set<Map<String,Object>> setProperties=getTestProperties();
  Request request=createMock(Request.class);
  Capture<BlueprintEntity> entityCapture=new Capture<BlueprintEntity>();
  expect(request.getProperties()).andReturn(setProperties);
  expect(dao.findByName(BLUEPRINT_NAME)).andReturn(null);
  dao.create(capture(entityCapture));
  replay(dao,request);
  ResourceProvider provider=createProvider();
  AbstractResourceProviderTest.TestObserver observer=new AbstractResourceProviderTest.TestObserver();
  ((ObservableResourceProvider)provider).addObserver(observer);
  provider.createResources(request);
  ResourceProviderEvent lastEvent=observer.getLastEvent();
  assertNotNull(lastEvent);
  assertEquals(Resource.Type.Blueprint,lastEvent.getResourceType());
  assertEquals(ResourceProviderEvent.Type.Create,lastEvent.getType());
  assertEquals(request,lastEvent.getRequest());
  assertNull(lastEvent.getPredicate());
  validateEntity(entityCapture.getValue());
  verify(dao,request);
}
