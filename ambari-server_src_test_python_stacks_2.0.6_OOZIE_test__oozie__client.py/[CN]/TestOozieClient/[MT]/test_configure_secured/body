def test_configure_secured(self):
    self.executeScript('2.0.6/services/OOZIE/package/scripts/oozie_client.py', classname='OozieClient', command='configure', config_file='secured.json')
    oozie_site = self.getConfig()['configurations']['oozie-site'].copy()
    oozie_site['oozie.services.ext'] = ('org.apache.oozie.service.JMSAccessorService,' + oozie_site['oozie.services.ext'])
    self.assertResourceCalled('XmlConfig', 'oozie-site.xml', owner='oozie', group='hadoop', mode=436, conf_dir='/etc/oozie/conf', configurations=oozie_site)
    self.assertResourceCalled('Directory', '/etc/oozie/conf', owner='oozie', group='hadoop')
    self.assertResourceCalled('File', '/etc/oozie/conf/oozie-env.sh', owner='oozie', content=InlineTemplate(self.getConfig()['configurations']['oozie-env']['content']))
    self.assertResourceCalled('File', '/etc/oozie/conf/oozie-log4j.properties', owner='oozie', group='hadoop', mode=420, content='log4jproperties\nline2')
    self.assertResourceCalled('File', '/etc/oozie/conf/adminusers.txt', owner='oozie', group='hadoop')
    self.assertResourceCalled('File', '/etc/oozie/conf/hadoop-config.xml', owner='oozie', group='hadoop')
    self.assertResourceCalled('File', '/etc/oozie/conf/oozie-default.xml', owner='oozie', group='hadoop')
    self.assertResourceCalled('Directory', '/etc/oozie/conf/action-conf', owner='oozie', group='hadoop')
    self.assertResourceCalled('File', '/etc/oozie/conf/action-conf/hive.xml', owner='oozie', group='hadoop')
    self.assertNoMoreResources()
