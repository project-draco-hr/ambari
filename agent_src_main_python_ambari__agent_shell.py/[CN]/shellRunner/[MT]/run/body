def run(self, script, user=None):
    oldUid = os.getuid()
    try:
        if (user != None):
            user = getpwnam(user)[2]
            os.setuid(user)
    except Exception:
        logger.warn('can not switch user for RUN_COMMAND.')
    code = 0
    cmd = ' '
    cmd = cmd.join(script)
    p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True, close_fds=True)
    (out, err) = p.communicate()
    code = p.wait()
    try:
        if (user != None):
            os.setuid(oldUid)
    except Exception:
        logger.warn('can not restore user for RUN_COMMAND.')
    return {'exitCode': code, 'output': out, 'error': err, }
