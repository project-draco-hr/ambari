def test_recommendYARNConfigurations_five_node_manager_llap_configs_updated_6(self):
    services = {'services': [{'StackServices': {'service_name': 'YARN', }, 'Versions': {'stack_version': '2.5', }, 'components': [{'StackServiceComponents': {'component_name': 'NODEMANAGER', 'hostnames': ['c6401.ambari.apache.org', 'c6402.ambari.apache.org', 'c6403.ambari.apache.org', 'c6404.ambari.apache.org', 'c6405.ambari.apache.org'], }, }], }, {'href': '/api/v1/stacks/HDP/versions/2.5/services/HIVE', 'StackServices': {'service_name': 'HIVE', 'service_version': '1.2.1.2.5', 'stack_name': 'HDP', 'stack_version': '2.5', }, 'components': [{'href': '/api/v1/stacks/HDP/versions/2.5/services/HIVE/components/HIVE_SERVER_INTERACTIVE', 'StackServiceComponents': {'advertise_version': 'true', 'bulk_commands_display_name': '', 'bulk_commands_master_component_name': '', 'cardinality': '0-1', 'component_category': 'MASTER', 'component_name': 'HIVE_SERVER_INTERACTIVE', 'custom_commands': ['RESTART_LLAP'], 'decommission_allowed': 'false', 'display_name': 'HiveServer2 Interactive', 'has_bulk_commands_definition': 'false', 'is_client': 'false', 'is_master': 'true', 'reassign_allowed': 'false', 'recovery_enabled': 'false', 'service_name': 'HIVE', 'stack_name': 'HDP', 'stack_version': '2.5', 'hostnames': ['c6401.ambari.apache.org'], }, 'dependencies': [], }, {'StackServiceComponents': {'advertise_version': 'true', 'cardinality': '1+', 'component_category': 'SLAVE', 'component_name': 'NODEMANAGER', 'display_name': 'NodeManager', 'is_client': 'false', 'is_master': 'false', 'hostnames': ['c6401.ambari.apache.org'], }, 'dependencies': [], }], }], 'changed-configurations': [{u'old_value': u'3', u'type': u'hive-interactive-site', u'name': u'hive.server2.tez.sessions.per.default.queue', }], 'configurations': {'capacity-scheduler': {'properties': {'capacity-scheduler': 'yarn.scheduler.capacity.maximum-am-resource-percent=0.2\nyarn.scheduler.capacity.maximum-applications=10000\nyarn.scheduler.capacity.node-locality-delay=40\nyarn.scheduler.capacity.queue-mappings-override.enable=false\nyarn.scheduler.capacity.resource-calculator=org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator\nyarn.scheduler.capacity.root.accessible-node-labels=*\nyarn.scheduler.capacity.root.acl_administer_queue=*\nyarn.scheduler.capacity.root.capacity=100\nyarn.scheduler.capacity.root.default.a.a1.acl_administer_queue=*\nyarn.scheduler.capacity.root.default.a.a1.acl_submit_applications=*\nyarn.scheduler.capacity.root.default.a.a1.capacity=75\nyarn.scheduler.capacity.root.default.a.a1.maximum-capacity=100\nyarn.scheduler.capacity.root.default.a.a1.minimum-user-limit-percent=100\nyarn.scheduler.capacity.root.default.a.a1.ordering-policy=fifo\nyarn.scheduler.capacity.root.default.a.a1.state=RUNNING\nyarn.scheduler.capacity.root.default.a.a1.user-limit-factor=1\nyarn.scheduler.capacity.root.default.a.llap.acl_administer_queue=*\nyarn.scheduler.capacity.root.default.a.llap.acl_submit_applications=*\nyarn.scheduler.capacity.root.default.a.llap.capacity=25\nyarn.scheduler.capacity.root.default.a.llap.maximum-capacity=25\nyarn.scheduler.capacity.root.default.a.llap.minimum-user-limit-percent=100\nyarn.scheduler.capacity.root.default.a.llap.ordering-policy=fifo\nyarn.scheduler.capacity.root.default.a.llap.state=RUNNING\nyarn.scheduler.capacity.root.default.a.llap.user-limit-factor=1\nyarn.scheduler.capacity.root.default.a.acl_administer_queue=*\nyarn.scheduler.capacity.root.default.a.acl_submit_applications=*\nyarn.scheduler.capacity.root.default.a.capacity=0\nyarn.scheduler.capacity.root.default.a.maximum-capacity=0\nyarn.scheduler.capacity.root.default.a.minimum-user-limit-percent=100\nyarn.scheduler.capacity.root.default.a.ordering-policy=fifo\nyarn.scheduler.capacity.root.default.a.queues=a1,llap\nyarn.scheduler.capacity.root.default.a.state=RUNNING\nyarn.scheduler.capacity.root.default.a.user-limit-factor=1\nyarn.scheduler.capacity.root.default.acl_submit_applications=*\nyarn.scheduler.capacity.root.default.b.acl_administer_queue=*\nyarn.scheduler.capacity.root.default.b.acl_submit_applications=*\nyarn.scheduler.capacity.root.default.b.capacity=100\nyarn.scheduler.capacity.root.default.b.maximum-capacity=100\nyarn.scheduler.capacity.root.default.b.minimum-user-limit-percent=100\nyarn.scheduler.capacity.root.default.b.ordering-policy=fifo\nyarn.scheduler.capacity.root.default.b.state=RUNNING\nyarn.scheduler.capacity.root.default.b.user-limit-factor=1\nyarn.scheduler.capacity.root.default.capacity=100\nyarn.scheduler.capacity.root.default.maximum-capacity=100\nyarn.scheduler.capacity.root.default.queues=a,b\nyarn.scheduler.capacity.root.default.state=RUNNING\nyarn.scheduler.capacity.root.default.user-limit-factor=1\nyarn.scheduler.capacity.root.queues=default', }, }, 'hive-interactive-env': {'properties': {'enable_hive_interactive': 'true', 'llap_queue_capacity': '50', }, }, 'hive-interactive-site': {'properties': {'hive.llap.daemon.queue.name': 'default.b', 'hive.server2.tez.sessions.per.default.queue': '1', }, }, 'hive-env': {'properties': {'hive_user': 'hive', }, }, 'yarn-site': {'properties': {'yarn.scheduler.minimum-allocation-mb': '2048', 'yarn.nodemanager.resource.memory-mb': '204800', 'yarn.nodemanager.resource.cpu-vcores': '3', }, }, 'tez-site': {'properties': {'tez.am.resource.memory.mb': '1024', }, }, 'hive-site': {'properties': {'hive.tez.container.size': '1024', }, }, }, }
    clusterData = {'cpu': 4, 'mapMemory': 30000, 'amMemory': 20000, 'reduceMemory': 20560, 'containers': 30, 'ramPerContainer': 512, 'referenceNodeManagerHost': {'total_mem': (10240 * 1024), }, }
    configurations = {}
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services, self.hosts)
    self.assertEqual(configurations['hive-interactive-env']['properties']['num_llap_nodes'], '4')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb'], '10240')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors'], '3')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.threadpool.size'], '3')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size'], '7168')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.enabled'], 'true')
    self.assertEqual(configurations['hive-interactive-env']['properties']['llap_heap_size'], '2457')
    self.assertEqual(configurations['hive-interactive-env']['properties']['slider_am_container_size'], '512')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], {'visible': 'false', })
    self.assertEqual(configurations['tez-interactive-site']['properties']['tez.am.resource.memory.mb'], '512')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb_copy'], '10240')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors_copy'], '3')
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size_copy'], '7168')
    self.assertEqual(configurations['hive-interactive-env']['properties']['num_llap_nodes_copy'], '4')
