def test_recommendAtlasConfigurations(self):
    self.maxDiff = None
    configurations = {'application-properties': {'properties': {'atlas.graph.index.search.solr.zookeeper-url': '', }, }, 'logsearch-solr-env': {'properties': {'logsearch_solr_znode': '/logsearch', }, }, }
    clusterData = {'cpu': 4, 'mapMemory': 3000, 'amMemory': 2000, 'reduceMemory': 2056, 'containers': 3, 'ramPerContainer': 256, }
    expected = {'application-properties': {'properties': {'atlas.graph.index.search.solr.zookeeper-url': '{{zookeeper_quorum}}/logsearch', }, }, 'logsearch-solr-env': {'properties': {'logsearch_solr_znode': '/logsearch', }, }, }
    services = {'services': [{'href': '/api/v1/stacks/HDP/versions/2.2/services/ATLAS', 'StackServices': {'service_name': 'LOGSEARCH', 'service_version': '2.6.0.2.2', 'stack_name': 'HDP', 'stack_version': '2.3', }, 'components': [{'StackServiceComponents': {'advertise_version': 'false', 'cardinality': '1', 'component_category': 'MASTER', 'component_name': 'LOGSEARCH_SOLR', 'display_name': 'solr', 'is_client': 'false', 'is_master': 'true', 'hostnames': [], }, 'dependencies': [], }], }], 'configurations': {'application-properties': {'properties': {'atlas.graph.index.search.solr.zookeeper-url': '', }, }, 'logsearch-solr-env': {'properties': {'logsearch_solr_znode': '/logsearch', }, }, }, 'changed-configurations': [], }
    hosts = {'items': [{'href': '/api/v1/hosts/c6401.ambari.apache.org', 'Hosts': {'cpu_count': 1, 'host_name': 'c6401.ambari.apache.org', 'os_arch': 'x86_64', 'os_type': 'centos6', 'ph_cpu_count': 1, 'public_host_name': 'c6401.ambari.apache.org', 'rack_info': '/default-rack', 'total_mem': 1922680, }, }], }
    self.stackAdvisor.recommendAtlasConfigurations(configurations, clusterData, services, hosts)
    self.assertEquals(configurations, expected)
    services['ambari-server-properties'] = {'java.home': '/usr/jdk64/jdk1.7.3_23', }
    self.stackAdvisor.recommendAtlasConfigurations(configurations, clusterData, services, hosts)
    self.assertEquals(configurations, expected)
    configurations = {}
    yarn_cont_mb_visibility = {'minimum': '682', 'maximum': '682', }
    llap_io_mem_size_visibility = {'minimum': '0', 'maximum': '341', }
    llap_num_executors_visibility = {'minimum': '1', 'maximum': '1', }
    num_llap_nodes_visibility = {'minimum': '1', 'maximum': '1', }
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_13, hosts)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb'], '682')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.yarn.container.mb'], yarn_cont_mb_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors'], '1')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.num.executors'], llap_num_executors_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size'], '341')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.io.memory.size'], llap_io_mem_size_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['num_llap_nodes'], '1')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['num_llap_nodes'], num_llap_nodes_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['llap_heap_size'], '272')
    self.assertEqual(configurations['hive-interactive-env']['properties']['slider_am_container_mb'], '341')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_true)
    configurations = {}
    yarn_cont_mb_visibility = {'minimum': '682', 'maximum': '682', }
    llap_io_mem_size_visibility = {'minimum': '0', 'maximum': '341', }
    llap_num_executors_visibility = {'minimum': '1', 'maximum': '1', }
    num_llap_nodes_visibility = {'minimum': '1', 'maximum': '1', }
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_16, hosts)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb'], '682')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.yarn.container.mb'], yarn_cont_mb_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors'], '1')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.num.executors'], llap_num_executors_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size'], '341')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.io.memory.size'], llap_io_mem_size_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['num_llap_nodes'], '1')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['num_llap_nodes'], num_llap_nodes_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['llap_heap_size'], '272')
    self.assertEqual(configurations['hive-interactive-env']['properties']['slider_am_container_mb'], '341')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_true)
    configurations = {}
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_17, hosts)
    cap_sched_output_dict = convertToDict(configurations['capacity-scheduler']['properties']['capacity-scheduler'])
    cap_sched_expected_dict = convertToDict(expected_capacity_scheduler_llap_Stopped_size_0['properties']['capacity-scheduler'])
    self.assertEqual(cap_sched_output_dict, cap_sched_expected_dict)
    self.assertEquals(configurations['hive-interactive-site']['properties'], expected_hive_interactive_site_default['hive-interactive-site']['properties'])
    self.assertTrue(('hive-interactive-env' not in configurations))
    self.assertTrue(('property_attributes' not in configurations))
    configurations = {}
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_18, hosts)
    self.assertEquals(configurations['capacity-scheduler']['properties'], expected_capacity_scheduler_empty['properties'])
    self.assertEquals(configurations['hive-interactive-site']['properties'], expected_hive_interactive_site_empty['hive-interactive-site']['properties'])
    self.assertTrue(('hive-interactive-env' not in configurations))
    self.assertTrue(('property_attributes' not in configurations))
    configurations = {}
    yarn_cont_mb_visibility = {'minimum': '682', 'maximum': '682', }
    llap_io_mem_size_visibility = {'minimum': '0', 'maximum': '341', }
    llap_num_executors_visibility = {'minimum': '1', 'maximum': '1', }
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_19, hosts)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb'], '682')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.yarn.container.mb'], yarn_cont_mb_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors'], '1')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.num.executors'], llap_num_executors_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size'], '341')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.io.memory.size'], llap_io_mem_size_visibility)
    self.assertTrue(('num_llap_nodes' not in configurations['hive-interactive-env']['properties']))
    self.assertEqual(configurations['hive-interactive-env']['properties']['llap_heap_size'], '272')
    self.assertEqual(configurations['hive-interactive-env']['properties']['slider_am_container_mb'], '341')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_true)
    configurations = {}
    yarn_cont_mb_visibility = {'minimum': '12958', 'maximum': '12958', }
    llap_io_mem_size_visibility = {'minimum': '0', 'maximum': '12617', }
    llap_num_executors_visibility = {'minimum': '1', 'maximum': '8', }
    num_llap_nodes_visibility = {'minimum': '1', 'maximum': '1', }
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_20, hosts)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.yarn.container.mb'], '12958')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.yarn.container.mb'], yarn_cont_mb_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.daemon.num.executors'], '2')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.daemon.num.executors'], llap_num_executors_visibility)
    self.assertEqual(configurations['hive-interactive-site']['properties']['hive.llap.io.memory.size'], '12276')
    self.assertEquals(configurations['hive-interactive-site']['property_attributes']['hive.llap.io.memory.size'], llap_io_mem_size_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['num_llap_nodes'], '1')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['num_llap_nodes'], num_llap_nodes_visibility)
    self.assertEqual(configurations['hive-interactive-env']['properties']['llap_heap_size'], '545')
    self.assertEqual(configurations['hive-interactive-env']['properties']['slider_am_container_mb'], '682')
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_true)
    configurations = {}
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_14, hosts)
    self.assertEquals(configurations['capacity-scheduler']['properties'], expected_capacity_scheduler_empty['properties'])
    self.assertEquals(configurations['hive-interactive-site']['properties'], expected_hive_interactive_site_empty['hive-interactive-site']['properties'])
    self.assertEquals(configurations['hive-interactive-env']['properties'], expected_hive_interactive_env_empty['hive-interactive-env']['properties'])
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_true)
    configurations = {}
    self.stackAdvisor.recommendYARNConfigurations(configurations, clusterData, services_15, hosts)
    self.assertEquals(configurations['capacity-scheduler']['properties'], expected_capacity_scheduler_empty['properties'])
    self.assertEquals(configurations['hive-interactive-site']['properties'], expected_hive_interactive_site_empty['hive-interactive-site']['properties'])
    self.assertEquals(configurations['hive-interactive-env']['properties'], expected_hive_interactive_env_empty['hive-interactive-env']['properties'])
    self.assertEquals(configurations['hive-interactive-env']['property_attributes']['llap_queue_capacity'], expected_visibility_false)
