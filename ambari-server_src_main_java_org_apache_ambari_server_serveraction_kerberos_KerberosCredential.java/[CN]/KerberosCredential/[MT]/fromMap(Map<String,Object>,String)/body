{
  KerberosCredential credential=null;
  if (map != null) {
    Object attribute;
    String principal;
    char[] password;
    String keytab;
    if (prefix == null) {
      prefix="";
    }
    attribute=map.get(prefix + KEY_NAME_PRINCIPAL);
    principal=(attribute == null) ? null : attribute.toString();
    attribute=map.get(prefix + KEY_NAME_PASSWORD);
    if (attribute instanceof char[]) {
      password=(char[])attribute;
    }
 else     if (attribute instanceof String) {
      password=((String)attribute).toCharArray();
    }
 else {
      password=null;
    }
    attribute=map.get(prefix + KEY_NAME_KEYTAB);
    keytab=(attribute == null) ? null : attribute.toString();
    if (((principal != null) && !principal.isEmpty()) || ((password != null) && (password.length > 0)) || ((keytab != null) && !keytab.isEmpty())) {
      credential=new KerberosCredential(principal,password,keytab);
    }
  }
  return credential;
}
