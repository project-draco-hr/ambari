{
  if (resolveReferences) {
    if (identities == null) {
      return Collections.emptyList();
    }
 else {
      List<KerberosIdentityDescriptor> list=new ArrayList<KerberosIdentityDescriptor>();
      for (      KerberosIdentityDescriptor identity : identities) {
        KerberosIdentityDescriptor referencedIdentity;
        try {
          referencedIdentity=getReferencedIdentityDescriptor(identity.getName());
        }
 catch (        AmbariException e) {
          throw new AmbariException(String.format("Invalid Kerberos identity reference: %s",identity.getName()),e);
        }
        identity=new KerberosIdentityDescriptor(identity.toMap());
        if (referencedIdentity != null) {
          KerberosIdentityDescriptor detachedIdentity=new KerberosIdentityDescriptor(referencedIdentity.toMap());
          detachedIdentity.update(identity);
          list.add(detachedIdentity);
        }
 else {
          list.add(identity);
        }
      }
      return list;
    }
  }
 else {
    return identities;
  }
}
