{
  Queue<AgentCommand> q=getQueue(hostname);
  if (q == null) {
    return null;
  }
  List<AgentCommand> l=new ArrayList<AgentCommand>();
synchronized (q) {
    while (true) {
      try {
        AgentCommand cmd=q.remove();
        if (cmd != null) {
          l.add(cmd);
        }
      }
 catch (      NoSuchElementException ex) {
        return l;
      }
    }
  }
}
