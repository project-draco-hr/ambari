{
synchronized (this) {
    Queue<AgentCommand> q=getQueue(hostname);
    if (q == null) {
      addQueue(hostname,new LinkedList<AgentCommand>());
      q=getQueue(hostname);
    }
    LOG.info("Reference to queue for host=" + hostname + " is "+ q);
synchronized (q) {
      if (q.contains(cmd)) {
        LOG.warn("cmd already exists in the queue, not adding again");
        return;
      }
      q.add(cmd);
    }
  }
}
