{
  Queue<AgentCommand> q=getQueue(hostname);
  if (q == null) {
    q=new LinkedList<AgentCommand>();
    addQueue(hostname,q);
  }
synchronized (q) {
    if (q.contains(cmd)) {
      LOG.warn("cmd already exists in the queue, not adding again");
      return;
    }
    q.add(cmd);
  }
}
