@patch('os.path.exists')
def test_hook_default(self, os_path_exists_mock):

    def side_effect(path):
        if (path == '/etc/hadoop/conf'):
            return True
        return False
    os_path_exists_mock.side_effect = side_effect
    self.executeScript('2.0.6/hooks/before-ANY/scripts/hook.py', classname='BeforeAnyHook', command='hook', config_file='default.json')
    self.assertResourceCalled('Group', 'hadoop', ignore_failures=False)
    self.assertResourceCalled('Group', 'nobody', ignore_failures=False)
    self.assertResourceCalled('Group', 'users', ignore_failures=False)
    self.assertResourceCalled('User', 'hive', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'oozie', gid='hadoop', ignore_failures=False, groups=[u'users'])
    self.assertResourceCalled('User', 'nobody', gid='hadoop', ignore_failures=False, groups=[u'nobody'])
    self.assertResourceCalled('User', 'ambari-qa', gid='hadoop', ignore_failures=False, groups=[u'users'])
    self.assertResourceCalled('User', 'flume', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'hdfs', ignore_failures=False, gid='hadoop', groups=[u'hadoop'])
    self.assertResourceCalled('User', 'storm', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'mapred', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'hbase', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'tez', gid='hadoop', ignore_failures=False, groups=[u'users'])
    self.assertResourceCalled('User', 'zookeeper', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'falcon', gid='hadoop', ignore_failures=False, groups=[u'users'])
    self.assertResourceCalled('User', 'sqoop', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'yarn', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('User', 'hcat', gid='hadoop', ignore_failures=False, groups=[u'hadoop'])
    self.assertResourceCalled('File', '/tmp/changeUid.sh', content=StaticFile('changeToSecureUid.sh'), mode=365)
    self.assertResourceCalled('Execute', '/tmp/changeUid.sh ambari-qa /tmp/hadoop-ambari-qa,/tmp/hsperfdata_ambari-qa,/home/ambari-qa,/tmp/ambari-qa,/tmp/sqoop-ambari-qa', not_if='(test $(id -u ambari-qa) -gt 1000) || (false)')
    self.assertResourceCalled('Directory', self.TMP_PATH, owner='hbase', mode=509, recursive=True, cd_access='a')
    self.assertResourceCalled('File', '/tmp/changeUid.sh', content=StaticFile('changeToSecureUid.sh'), mode=365)
    self.assertResourceCalled('Execute', ('/tmp/changeUid.sh hbase /home/hbase,/tmp/hbase,/usr/bin/hbase,/var/log/hbase,' + self.TMP_PATH), not_if='(test $(id -u hbase) -gt 1000) || (false)')
    self.assertResourceCalled('User', 'test_user1', ignore_failures=False)
    self.assertResourceCalled('User', 'test_user2', ignore_failures=False)
    self.assertResourceCalled('Group', 'hdfs', ignore_failures=False)
    self.assertResourceCalled('Group', 'test_group', ignore_failures=False)
    self.assertResourceCalled('User', 'hdfs', groups=[u'hadoop', u'hdfs', u'test_group'], ignore_failures=False)
    self.assertResourceCalled('Directory', '/etc/hadoop', mode=493)
    self.assertResourceCalled('Directory', '/etc/hadoop/conf.empty', owner='root', group='hadoop', recursive=True)
    self.assertResourceCalled('Link', '/etc/hadoop/conf', not_if='ls /etc/hadoop/conf', to='/etc/hadoop/conf.empty')
    self.assertResourceCalled('File', '/etc/hadoop/conf/hadoop-env.sh', content=InlineTemplate(self.getConfig()['configurations']['hadoop-env']['content']), owner='hdfs', group='hadoop')
    self.assertResourceCalled('Directory', '/tmp/AMBARI-artifacts/', recursive=True)
    self.assertResourceCalled('File', '/tmp/jdk-7u67-linux-x64.tar.gz', content=DownloadSource('http://c6401.ambari.apache.org:8080/resources//jdk-7u67-linux-x64.tar.gz'), not_if='test -f /tmp/jdk-7u67-linux-x64.tar.gz')
    self.assertResourceCalled('Directory', '/usr/jdk64')
    self.assertResourceCalled('Execute', ('chmod', 'a+x', u'/usr/jdk64'), sudo=True)
    self.assertResourceCalled('Execute', 'mkdir -p /tmp/jdk && cd /tmp/jdk && tar -xf /tmp/jdk-7u67-linux-x64.tar.gz && ambari-sudo.sh cp -rp /tmp/jdk/* /usr/jdk64')
    self.assertResourceCalled('File', '/usr/jdk64/jdk1.7.0_45/bin/java', mode=493, cd_access='a')
    self.assertResourceCalled('Execute', ('chgrp', '-R', u'hadoop', u'/usr/jdk64/jdk1.7.0_45'), sudo=True)
    self.assertResourceCalled('Execute', ('chown', '-R', 'root', u'/usr/jdk64/jdk1.7.0_45'), sudo=True)
    self.assertNoMoreResources()
