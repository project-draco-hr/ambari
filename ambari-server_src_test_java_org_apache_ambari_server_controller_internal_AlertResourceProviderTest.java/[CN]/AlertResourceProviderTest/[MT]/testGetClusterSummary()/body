{
  expect(m_dao.findCurrentByCluster(captureLong(new Capture<Long>()))).andReturn(getMockEntitiesManyStates()).anyTimes();
  replay(m_dao);
  Request request=PropertyHelper.getReadRequest(AlertResourceProvider.ALERT_ID,AlertResourceProvider.ALERT_NAME,AlertResourceProvider.ALERT_LABEL,AlertResourceProvider.ALERT_STATE,AlertResourceProvider.ALERT_ORIGINAL_TIMESTAMP);
  Predicate predicate=new PredicateBuilder().property(AlertResourceProvider.ALERT_CLUSTER_NAME).equals("c1").toPredicate();
  AlertResourceProvider provider=createProvider();
  Set<Resource> results=provider.getResources(request,predicate);
  verify(m_dao);
  AlertSummaryRenderer renderer=new AlertSummaryRenderer();
  ResultImpl result=new ResultImpl(true);
  TreeNode<Resource> resources=result.getResultTree();
  AtomicInteger alertResourceId=new AtomicInteger(1);
  for (  Resource resource : results) {
    resources.addChild(resource,"Alert " + alertResourceId.getAndIncrement());
  }
  Result summary=renderer.finalizeResult(result);
  Assert.assertNotNull(summary);
  TreeNode<Resource> summaryResultTree=summary.getResultTree();
  TreeNode<Resource> summaryResources=summaryResultTree.getChild("alerts_summary");
  Resource summaryResource=summaryResources.getObject();
  Integer okCount=(Integer)summaryResource.getPropertyValue("alerts_summary/OK/count");
  Integer warningCount=(Integer)summaryResource.getPropertyValue("alerts_summary/WARNING/count");
  Integer criticalCount=(Integer)summaryResource.getPropertyValue("alerts_summary/CRITICAL/count");
  Integer unknownCount=(Integer)summaryResource.getPropertyValue("alerts_summary/UNKNOWN/count");
  Assert.assertEquals(10,okCount.intValue());
  Assert.assertEquals(2,warningCount.intValue());
  Assert.assertEquals(1,criticalCount.intValue());
  Assert.assertEquals(3,unknownCount.intValue());
}
