{
  LOG.info("Context parameters " + context);
  try {
    hostname=InetAddress.getLocalHost().getHostName();
    if ((hostname == null) || (!hostname.contains("."))) {
      hostname=InetAddress.getLocalHost().getCanonicalHostName();
    }
  }
 catch (  UnknownHostException e) {
    LOG.error("Could not identify hostname.");
    throw new FlumeException("Could not identify hostname.",e);
  }
  Configuration configuration=new Configuration("/flume-metrics2.properties");
  timeoutSeconds=Integer.parseInt(configuration.getProperty(METRICS_POST_TIMEOUT_SECONDS,String.valueOf(DEFAULT_POST_TIMEOUT_SECONDS)));
  maxRowCacheSize=Integer.parseInt(configuration.getProperty(MAX_METRIC_ROW_CACHE_SIZE,String.valueOf(TimelineMetricsCache.MAX_RECS_PER_NAME_DEFAULT)));
  metricsSendInterval=Integer.parseInt(configuration.getProperty(METRICS_SEND_INTERVAL,String.valueOf(TimelineMetricsCache.MAX_EVICTION_TIME_MILLIS)));
  metricsCaches=new HashMap<String,TimelineMetricsCache>();
  String collectorHostname=configuration.getProperty(COLLECTOR_HOST_PROPERTY);
  String port=configuration.getProperty(COLLECTOR_PORT_PROPERTY);
  collectorUri="http://" + collectorHostname + ":"+ port+ "/ws/v1/timeline/metrics";
  pollFrequency=Long.parseLong(configuration.getProperty("collectionFrequency"));
  String[] metrics=configuration.getProperty(COUNTER_METRICS_PROPERTY).trim().split(",");
  Collections.addAll(counterMetrics,metrics);
}
