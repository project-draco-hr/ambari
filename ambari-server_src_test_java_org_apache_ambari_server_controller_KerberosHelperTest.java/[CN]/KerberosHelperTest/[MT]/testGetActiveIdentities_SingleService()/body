{
  Map<String,Collection<KerberosIdentityDescriptor>> identities=testGetActiveIdentities("c1",null,"SERVICE1",null,true,SecurityType.KERBEROS);
  Assert.assertNotNull(identities);
  Assert.assertEquals(3,identities.size());
  Collection<KerberosIdentityDescriptor> hostIdentities;
  hostIdentities=identities.get("host1");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(2,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
  hostIdentities=identities.get("host2");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(2,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
}
