{
  Injector injector=createStrictMock(Injector.class);
  Capture<AmbariManagementController> controllerCapture=new Capture<AmbariManagementController>();
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Host host1=createNiceMock(Host.class);
  Host host2=createNiceMock(Host.class);
  HostResponse response=createNiceMock(HostResponse.class);
  HostResponse response2=createNiceMock(HostResponse.class);
  HostRequest request1=new HostRequest("host1","cluster1",Collections.<String,String>emptyMap());
  HostRequest request2=new HostRequest("host2","cluster1",Collections.<String,String>emptyMap());
  HostRequest request3=new HostRequest("host3","cluster1",Collections.<String,String>emptyMap());
  HostRequest request4=new HostRequest("host4","cluster1",Collections.<String,String>emptyMap());
  Set<HostRequest> setRequests=new HashSet<HostRequest>();
  setRequests.add(request1);
  setRequests.add(request2);
  setRequests.add(request3);
  setRequests.add(request4);
  injector.injectMembers(capture(controllerCapture));
  expect(injector.getInstance(Gson.class)).andReturn(null);
  expect(clusters.getCluster("cluster1")).andReturn(cluster).times(4);
  expect(clusters.getHost("host1")).andReturn(host1);
  expect(host1.getHostName()).andReturn("host1").anyTimes();
  expect(clusters.getClustersForHost("host1")).andReturn(Collections.singleton(cluster));
  expect(host1.convertToResponse()).andReturn(response);
  response.setClusterName("cluster1");
  expect(clusters.getHost("host2")).andReturn(host2);
  expect(host2.getHostName()).andReturn("host2").anyTimes();
  expect(clusters.getClustersForHost("host2")).andReturn(Collections.singleton(cluster));
  expect(host2.convertToResponse()).andReturn(response2);
  response2.setClusterName("cluster1");
  expect(clusters.getHost("host3")).andThrow(new HostNotFoundException("host3"));
  expect(clusters.getHost("host4")).andThrow(new HostNotFoundException("host4"));
  replay(injector,clusters,cluster,host1,host2,response,response2);
  AmbariManagementController controller=new AmbariManagementControllerImpl(null,clusters,injector);
  Set<HostResponse> setResponses=getHosts(controller,setRequests);
  assertSame(controller,controllerCapture.getValue());
  assertEquals(2,setResponses.size());
  assertTrue(setResponses.contains(response));
  assertTrue(setResponses.contains(response2));
  verify(injector,clusters,cluster,host1,host2,response,response2);
}
