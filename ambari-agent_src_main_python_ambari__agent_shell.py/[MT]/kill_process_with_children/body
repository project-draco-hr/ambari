def kill_process_with_children(parent_pid):

    def kill_tree_function(pid, signal):
        '\n    Kills process tree starting from a given pid.\n    '
        CMD = ((((('ps xf | awk -v PID=' + str(pid)) + ' \' $1 == PID { P = $1; next } P && /_/ { P = P " " $1;') + 'K=P } P && !/_/ { P="" }  END { print "kill -') + str(signal)) + ' "K }\' | sh ')
        process = subprocess.Popen(CMD, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
        process.communicate()
    run_kill_function(kill_tree_function, parent_pid)
