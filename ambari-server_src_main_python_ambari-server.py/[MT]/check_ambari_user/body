def check_ambari_user():
    try:
        user = read_ambari_user()
        if (user is not None):
            print_info_msg('Detected custom user {0}'.format(user))
        else:
            ok = get_YN_input('Create a separate user for ambari-server daemon [y/n] (n)? ', False)
            if ok:
                (retcode, user) = create_custom_user()
                if (retcode != 0):
                    return retcode
            else:
                user = 'root'
            write_property(NR_USER_PROPERTY, user)
        adjust_directory_permissions(user)
    except OSError:
        print_error_msg(('Failed: %s' % OSError.message))
        return 4
    except Exception as e:
        print_error_msg(('Unexpected error %s' % e.message))
        return 1
    return 0
