def setup(args):
    print 'Checking SELinux...'
    retcode = check_selinux()
    if (not (retcode == 0)):
        print_error_msg('Failed to disable SELinux. Exiting.')
        sys.exit(retcode)
    print 'Checking iptables...'
    (retcode, out) = check_iptables()
    if ((not (retcode == 0)) and (out == IP_TBLS_ENABLED)):
        print_error_msg('Failed to stop iptables. Exiting.')
        sys.exit(retcode)
    print 'Configuring database...'
    prompt_db_properties(args)
    if is_local_database(args):
        print 'Default properties detected. Using built-in database.'
        store_local_properties(args)
        print 'Checking PostgreSQL...'
        retcode = check_postgre_up()
        if (not (retcode == 0)):
            print_error_msg('Unable to start PostgreSQL server. Exiting')
            sys.exit(retcode)
        print 'Configuring database...'
        retcode = setup_db(args)
        if (not (retcode == 0)):
            print_error_msg('Running database init script was failed. Exiting.')
            sys.exit(retcode)
        print 'Configuring PostgreSQL...'
        retcode = configure_postgres()
        if (not (retcode == 0)):
            print_error_msg('Unable to configure PostgreSQL server. Exiting')
            sys.exit(retcode)
    else:
        retcode = store_remote_properties(args)
        if (retcode != 0):
            print_error_msg('Unable to save config file')
            sys.exit(retcode)
        print_warning_msg('Before starting server JDBC driver for {0} should be placed to {1}.'.format(args.database, JAVA_SHARE_PATH))
        print 'Configuring remote database connection properties...'
        retcode = setup_remote_db(args)
        if (not (retcode == 0)):
            print_error_msg('Error while configuring connection properties. Exiting')
            sys.exit(retcode)
        check_jdbc_drivers(args)
    print 'Checking JDK...'
    retcode = download_jdk(args)
    if (not (retcode == 0)):
        print_error_msg('Downloading or installing JDK failed. Exiting.')
        sys.exit(retcode)
    print 'Completing setup...'
    retcode = configure_os_settings()
    if (not (retcode == 0)):
        print_error_msg('Configure of OS settings in ambari.properties failed. Exiting.')
        sys.exit(retcode)
    if args.warnings:
        print "Ambari Server 'setup' finished with warnings:"
        for warning in args.warnings:
            print warning
    else:
        print "Ambari Server 'setup' finished successfully"
