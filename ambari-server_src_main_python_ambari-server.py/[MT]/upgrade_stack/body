def upgrade_stack(args, stack_id):
    if (not is_root()):
        err = 'Ambari-server upgradestack should be run with root-level privileges'
        raise FatalException(4, err)
    configure_database_username_password(args)
    dbname = args.database_name
    file = args.upgrade_stack_script_file
    (stack_name, stack_version) = stack_id.split(STACK_NAME_VER_SEP)
    command = UPGRADE_STACK_CMD[:]
    command[(-1)] = command[(-1)].format(file, stack_name, stack_version)
    (retcode, outdata, errdata) = run_os_command(command)
    if (not (retcode == 0)):
        raise FatalException(retcode, errdata)
    return retcode
