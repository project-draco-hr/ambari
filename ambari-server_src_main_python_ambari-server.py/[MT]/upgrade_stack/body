def upgrade_stack(args, stack_id, repo_url=None, repo_url_os=None):
    if (not is_root()):
        err = 'Ambari-server upgradestack should be run with root-level privileges'
        raise FatalException(4, err)
    check_database_name_property()
    local_repo_check_commamd = ''
    if (OS_FAMILY == OSConst.DEBIAN_FAMILY):
        raise FatalException(3, '"upgradestack" command not supported yet for Debian OS\'es family.')
    elif (OS_FAMILY == OSConst.REDHAT_FAMILY):
        local_repo_check_commamd = 'yum repolist | grep "{0} "'
    elif (OS_FAMILY == OSConst.SUSE_FAMILY):
        local_repo_check_commamd = 'zypper repos | grep "{0} "'
    command = local_repo_check_commamd.format(stack_id)
    (retcode, stdout, stderr) = run_in_shell(command)
    if ((not (retcode == 0)) and (repo_url is None)):
        raise FatalException(retcode, (('Repository for ' + stack_id) + ' is not existed'))
    (stack_name, stack_version) = stack_id.split(STACK_NAME_VER_SEP)
    (retcode, stdout, stderr) = run_stack_upgrade(stack_name, stack_version, repo_url, repo_url_os)
    if (not (retcode == 0)):
        raise FatalException(retcode, ('Error executing stack upgrade. ' + stderr))
