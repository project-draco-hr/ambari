def configure_postgres():
    if os.path.isfile(PG_HBA_CONF_FILE):
        if (not os.path.isfile(PG_HBA_CONF_FILE_BACKUP)):
            shutil.copyfile(PG_HBA_CONF_FILE, PG_HBA_CONF_FILE_BACKUP)
        else:
            print 'Backup for pg_hba found, reconfiguration not required'
            return 0
    configure_pg_hba_postgres_user()
    configure_pg_hba_ambaridb_users()
    os.chmod(PG_HBA_CONF_FILE, 420)
    configure_postgresql_conf()
    pg_status = get_postgre_status()
    if (pg_status == PG_STATUS_RUNNING):
        print 'restarting PostgreSQL'
        (retcode, out, err) = run_os_command(PG_RESTART_CMD)
        return retcode
    return 0
