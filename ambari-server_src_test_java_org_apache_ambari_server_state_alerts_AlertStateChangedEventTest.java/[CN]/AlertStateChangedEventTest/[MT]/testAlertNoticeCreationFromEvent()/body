{
  AlertHistoryEntity history=EasyMock.createNiceMock(AlertHistoryEntity.class);
  AlertStateChangeEvent event=EasyMock.createNiceMock(AlertStateChangeEvent.class);
  EasyMock.expect(event.getNewHistoricalEntry()).andReturn(history).atLeastOnce();
  EasyMock.replay(history,event);
  eventPublisher.publish(event);
  Thread.sleep(2000);
  EasyMock.verify(dispatchDao,history,event);
}
