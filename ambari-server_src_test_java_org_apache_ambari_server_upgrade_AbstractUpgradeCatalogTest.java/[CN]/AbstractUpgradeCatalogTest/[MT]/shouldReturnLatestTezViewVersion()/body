{
  Configuration configuration=createNiceMock(Configuration.class);
  ViewArchiveUtility archiveUtility=createNiceMock(ViewArchiveUtility.class);
  File viewDirectory=createNiceMock(File.class);
  File viewJarFile=createNiceMock(File.class);
  ViewConfig viewConfig=createNiceMock(ViewConfig.class);
  expect(configuration.getViewsDir()).andReturn(viewDirectory).anyTimes();
  expect(viewDirectory.listFiles(anyObject(FilenameFilter.class))).andReturn(new File[]{viewJarFile}).anyTimes();
  expect(archiveUtility.getViewConfigFromArchive(viewJarFile)).andReturn(viewConfig).anyTimes();
  expect(viewConfig.getVersion()).andReturn("2.2").anyTimes();
  replay(configuration,archiveUtility,viewDirectory,viewJarFile,viewConfig);
  upgradeCatalog.archiveUtility=archiveUtility;
  upgradeCatalog.configuration=configuration;
  assertEquals("2.2",upgradeCatalog.getLatestTezViewVersion("2.1"));
  assertEquals("http://ambari:8080/#/main/views/TEZ/2.2/TEZ_CLUSTER_INSTANCE",upgradeCatalog.getUpdatedTezHistoryUrlBase("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE"));
  assertEquals("http://ambari:8080/#/main/views/TEZ/2.2/tezView",upgradeCatalog.getUpdatedTezHistoryUrlBase("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/tezView"));
  reset(viewDirectory,archiveUtility);
  expect(viewDirectory.listFiles(anyObject(FilenameFilter.class))).andReturn(new File[]{viewJarFile}).anyTimes();
  expect(archiveUtility.getViewConfigFromArchive(viewJarFile)).andThrow(new IOException()).anyTimes();
  replay(viewDirectory,archiveUtility);
  assertEquals("2.1",upgradeCatalog.getLatestTezViewVersion("2.1"));
  assertEquals("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE",upgradeCatalog.getUpdatedTezHistoryUrlBase("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE"));
  reset(viewDirectory);
  expect(viewDirectory.listFiles(anyObject(FilenameFilter.class))).andReturn(null).anyTimes();
  replay(viewDirectory);
  assertEquals("2.1",upgradeCatalog.getLatestTezViewVersion("2.1"));
  assertEquals("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE",upgradeCatalog.getUpdatedTezHistoryUrlBase("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE"));
  reset(viewDirectory);
  expect(viewDirectory.listFiles(anyObject(FilenameFilter.class))).andReturn(new File[]{}).anyTimes();
  replay(viewDirectory);
  assertEquals("2.1",upgradeCatalog.getLatestTezViewVersion("2.1"));
  assertEquals("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE",upgradeCatalog.getUpdatedTezHistoryUrlBase("http://ambari:8080/#/main/views/TEZ/0.7.0.2.5.0.0-665/TEZ_CLUSTER_INSTANCE"));
}
