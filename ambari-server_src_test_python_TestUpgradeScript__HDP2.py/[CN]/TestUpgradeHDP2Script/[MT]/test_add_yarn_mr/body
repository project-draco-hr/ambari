@patch.object(UpgradeHelper_HDP2, 'read_mapping')
@patch.object(logging, 'FileHandler')
@patch.object(UpgradeHelper_HDP2, 'backup_file')
@patch.object(UpgradeHelper_HDP2, 'curl')
@patch('optparse.OptionParser')
def test_add_yarn_mr(self, option_parser_mock, curl_mock, backup_file_mock, file_handler_mock, read_mapping_mock):
    file_handler_mock.return_value = logging.FileHandler('')
    opm = option_parser_mock.return_value
    options = self.get_mock_options()
    args = ['add-yarn-mr2']
    opm.parse_args.return_value = (options, args)
    curl_mock.return_value = ''
    read_mapping_mock.return_value = {'TASKTRACKER': ['c6401', 'c6402'], 'JOBTRACKER': ['c6401'], 'HISTORYSERVER': ['c6402'], 'MAPREDUCE_CLIENT': ['c6403'], }
    UpgradeHelper_HDP2.main()
    expected_curl_calls = [call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/YARN'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/MAPREDUCE2'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/MAPREDUCE2/components/HISTORYSERVER'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/MAPREDUCE2/components/MAPREDUCE2_CLIENT'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/YARN/components/NODEMANAGER'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/YARN/components/YARN_CLIENT'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/services/YARN/components/RESOURCEMANAGER'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/hosts/c6401/host_components/NODEMANAGER'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/hosts/c6402/host_components/NODEMANAGER'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/hosts/c6403/host_components/YARN_CLIENT'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/hosts/c6403/host_components/MAPREDUCE2_CLIENT'), call(False, '-u', 'admin:admin', '-H', 'X-Requested-By: ambari', '-X', 'POST', 'http://localhost:8080/api/v1/clusters/c1/hosts/c6401/host_components/RESOURCEMANAGER')]
    curl_mock.assert_has_calls(expected_curl_calls, any_order=True)
    pass
