@patch.object(UpgradeHelper_HDP2, 'get_config')
@patch.object(UpgradeHelper_HDP2, 'read_mapping')
@patch.object(logging, 'FileHandler')
@patch.object(UpgradeHelper_HDP2, 'backup_file')
@patch.object(UpgradeHelper_HDP2, 'curl')
@patch('optparse.OptionParser')
def test_update_configs(self, option_parser_mock, curl_mock, backup_file_mock, file_handler_mock, read_mapping_mock, get_config_mock):
    file_handler_mock.return_value = logging.FileHandler('')
    opm = option_parser_mock.return_value
    options = MagicMock()
    args = ['update-configs']
    opm.parse_args.return_value = (options, args)
    options.logfile = 'logfile'
    options.user = 'admin'
    options.password = 'admin'
    options.hostname = 'localhost'
    options.clustername = 'c1'
    curl_mock.side_effect = ['', '', '', '', '', '', '']
    read_mapping_mock.return_value = {'TASKTRACKER': ['c6401', 'c6402'], 'JOBTRACKER': ['c6401'], 'MAPREDUCE_CLIENT': ['c6403'], }
    get_config_mock.return_value = {'mapred.hosts': 'an_old_value', 'mapred.hosts.exclude': 'an_old_value', 'mapred.jobtracker.maxtasks.per.job': 'an_old_value', 'mapred.jobtracker.taskScheduler': 'an_old_value', 'mapred.task.tracker.task-controller': 'an_old_value', 'mapred.userlog.retain.hours': 'will_not_be_stored', 'global1': 'global11', }
    UpgradeHelper_HDP2.GLOBAL = {'global2': 'REPLACE_WITH_global1', }
    UpgradeHelper_HDP2.HDFS_SITE = {'global2': 'REPLACE_WITH_global1', }
    UpgradeHelper_HDP2.CORE_SITE = {'global2': 'REPLACE_WITH_global1', }
    UpgradeHelper_HDP2.main()
    self.validate_update_config_call(curl_mock.call_args_list[0], 'capacity-scheduler')
    self.validate_update_config_call(curl_mock.call_args_list[1], 'yarn-site')
    self.validate_update_config_call(curl_mock.call_args_list[3], 'mapred-site')
    self.validate_update_config_call(curl_mock.call_args_list[2], 'global')
    self.validate_config_replacememt(curl_mock.call_args_list[1], 'yarn-site')
    self.validate_config_replacememt(curl_mock.call_args_list[3], 'mapred-site')
    self.validate_config_replacememt(curl_mock.call_args_list[2], 'global')
    pass
