{
  if (request.getClusterName() == null || request.getClusterName().isEmpty()) {
    throw new AmbariException("Invalid arguments, cluster name" + " cannot be null");
  }
  String clusterName=request.getClusterName();
  final Cluster cluster;
  try {
    cluster=clusters.getCluster(clusterName);
  }
 catch (  ObjectNotFoundException e) {
    throw new ParentObjectNotFoundException("Parent Cluster resource doesn't exist",e);
  }
  Set<ServiceResponse> response=new HashSet<ServiceResponse>();
  if (request.getServiceName() != null) {
    Service s=cluster.getService(request.getServiceName());
    response.add(s.convertToResponse());
    return response;
  }
  boolean checkDesiredState=false;
  State desiredStateToCheck=null;
  if (request.getDesiredState() != null && !request.getDesiredState().isEmpty()) {
    desiredStateToCheck=State.valueOf(request.getDesiredState());
    if (!desiredStateToCheck.isValidDesiredState()) {
      throw new IllegalArgumentException("Invalid arguments, invalid desired" + " state, desiredState=" + desiredStateToCheck);
    }
    checkDesiredState=true;
  }
  for (  Service s : cluster.getServices().values()) {
    if (checkDesiredState && (desiredStateToCheck != s.getDesiredState())) {
      continue;
    }
    response.add(s.convertToResponse());
  }
  return response;
}
