{
  if (request.getClusterName() == null || request.getClusterName().isEmpty()) {
    throw new AmbariException("Invalid arguments");
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Received a createService request" + ", clusterName=" + request.getClusterName() + ", serviceName="+ request.getServiceName()+ ", request="+ request);
  }
  final Cluster cluster=clusters.getCluster(request.getClusterName());
  Service s=null;
  try {
    s=cluster.getService(request.getServiceName());
    if (s != null) {
      throw new AmbariException("Service already exists within cluster" + ", clusterName=" + cluster.getClusterName() + ", clusterId="+ cluster.getClusterId()+ ", serviceName="+ s.getName());
    }
  }
 catch (  AmbariException e) {
  }
  Map<String,Config> configs=new HashMap<String,Config>();
  s=serviceFactory.createNew(cluster,request.getServiceName());
  if (request.getDesiredState() != null && !request.getDesiredState().isEmpty()) {
    State state=State.valueOf(request.getDesiredState());
    if (!state.isValidDesiredState() || state != State.INIT) {
      throw new AmbariException("Invalid desired state");
    }
    s.setDesiredState(state);
  }
  s.updateConfigs(configs);
  s.setDesiredStackVersion(cluster.getDesiredStackVersion());
  cluster.addService(s);
  s.persist();
  return null;
}
