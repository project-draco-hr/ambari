{
  if (requestStages == null) {
    requestStages=new RequestStageContainer(actionManager.getNextRequestId(),null,requestFactory,actionManager);
  }
  List<Stage> stages=doStageCreation(requestStages,cluster,changedServices,changedComponents,changedHosts,requestParameters,requestProperties,runSmokeTest,reconfigureClients);
  requestStages.addStages(stages);
  updateServiceStates(changedServices,changedComponents,changedHosts,ignoredHosts);
  return requestStages;
}
