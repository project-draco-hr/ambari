{
  if (requestStages == null) {
    requestStages=new RequestStageContainer(actionManager.getNextRequestId(),null,requestFactory,actionManager);
  }
  List<Stage> stages=doStageCreation(requestStages,cluster,changedServices,changedComponents,changedHosts,requestParameters,requestProperties.get(REQUEST_CONTEXT_PROPERTY),runSmokeTest,reconfigureClients);
  requestStages.addStages(stages);
  updateServiceStates(changedServices,changedComponents,changedHosts,ignoredHosts);
  return requestStages;
}
