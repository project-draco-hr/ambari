{
  if (requestStages == null) {
    requestStages=new RequestStageContainer(actionManager.getNextRequestId(),null,requestFactory,actionManager);
  }
  List<Stage> stages=doStageCreation(requestStages,cluster,changedServices,changedComponents,changedHosts,requestParameters,requestProperties,runSmokeTest,reconfigureClients);
  LOG.debug("Created {} stages",((stages != null) ? stages.size() : 0));
  requestStages.addStages(stages);
  updateServiceStates(changedServices,changedComponents,changedHosts,ignoredHosts);
  return requestStages;
}
