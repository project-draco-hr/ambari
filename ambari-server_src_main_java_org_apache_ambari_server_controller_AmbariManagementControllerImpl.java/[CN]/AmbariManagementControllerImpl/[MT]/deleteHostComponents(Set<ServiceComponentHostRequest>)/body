{
  Set<ServiceComponentHostRequest> expanded=new HashSet<ServiceComponentHostRequest>();
  for (  ServiceComponentHostRequest request : requests) {
    if (null == request.getComponentName()) {
      if (null == request.getClusterName() || request.getClusterName().isEmpty() || null == request.getHostname() || request.getHostname().isEmpty()) {
        throw new IllegalArgumentException("Cluster name and hostname must be specified.");
      }
      Cluster cluster=clusters.getCluster(request.getClusterName());
      for (      ServiceComponentHost sch : cluster.getServiceComponentHosts(request.getHostname())) {
        ServiceComponentHostRequest schr=new ServiceComponentHostRequest(request.getClusterName(),sch.getServiceName(),sch.getServiceComponentName(),sch.getHostName(),null,null);
        expanded.add(schr);
      }
    }
 else {
      expanded.add(request);
    }
  }
  Map<ServiceComponent,Set<ServiceComponentHost>> safeToRemoveSCHs=new HashMap<ServiceComponent,Set<ServiceComponentHost>>();
  for (  ServiceComponentHostRequest request : expanded) {
    validateServiceComponentHostRequest(request);
    Cluster cluster=clusters.getCluster(request.getClusterName());
    if (StringUtils.isEmpty(request.getServiceName())) {
      request.setServiceName(findServiceName(cluster,request.getComponentName()));
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("Received a hostComponent DELETE request" + ", clusterName=" + request.getClusterName() + ", serviceName="+ request.getServiceName()+ ", componentName="+ request.getComponentName()+ ", hostname="+ request.getHostname()+ ", request="+ request);
    }
    Service service=cluster.getService(request.getServiceName());
    ServiceComponent component=service.getServiceComponent(request.getComponentName());
    ServiceComponentHost componentHost=component.getServiceComponentHost(request.getHostname());
    if (!componentHost.canBeRemoved()) {
      throw new AmbariException("Host Component cannot be removed" + ", clusterName=" + request.getClusterName() + ", serviceName="+ request.getServiceName()+ ", componentName="+ request.getComponentName()+ ", hostname="+ request.getHostname()+ ", request="+ request);
    }
    if (!component.isClientComponent() && !componentHost.getState().isRemovableState()) {
      throw new AmbariException("To remove master or slave components they must be in " + "MAINTENANCE/INIT/INSTALLED/INSTALL_FAILED/UNKNOWN state. Current=" + componentHost.getState() + ".");
    }
    if (!safeToRemoveSCHs.containsKey(component)) {
      safeToRemoveSCHs.put(component,new HashSet<ServiceComponentHost>());
    }
    safeToRemoveSCHs.get(component).add(componentHost);
  }
  for (  Entry<ServiceComponent,Set<ServiceComponentHost>> entry : safeToRemoveSCHs.entrySet()) {
    for (    ServiceComponentHost componentHost : entry.getValue()) {
      entry.getKey().deleteServiceComponentHosts(componentHost.getHostName());
    }
  }
  return null;
}
