{
  String user="ambari";
  ClusterEntity clusterEntity=clusterDAO.findById(cluster.getClusterId());
  Long now=System.currentTimeMillis();
  Long clusterId=cluster.getClusterId();
  if (widgetLayouts != null) {
    for (    WidgetLayout widgetLayout : widgetLayouts) {
      List<WidgetLayoutEntity> existingEntities=widgetLayoutDAO.findByName(clusterId,widgetLayout.getLayoutName(),user);
      if (existingEntities == null || existingEntities.isEmpty()) {
        WidgetLayoutEntity layoutEntity=new WidgetLayoutEntity();
        layoutEntity.setClusterEntity(clusterEntity);
        layoutEntity.setClusterId(clusterId);
        layoutEntity.setLayoutName(widgetLayout.getLayoutName());
        layoutEntity.setDisplayName(widgetLayout.getDisplayName());
        layoutEntity.setSectionName(widgetLayout.getSectionName());
        layoutEntity.setScope(WidgetLayoutResourceProvider.SCOPE.CLUSTER.name());
        layoutEntity.setUserName(user);
        List<WidgetLayoutUserWidgetEntity> widgetLayoutUserWidgetEntityList=new LinkedList<WidgetLayoutUserWidgetEntity>();
        int order=0;
        for (        WidgetLayoutInfo layoutInfo : widgetLayout.getWidgetLayoutInfoList()) {
          WidgetEntity widgetEntity=new WidgetEntity();
          widgetEntity.setClusterId(clusterId);
          widgetEntity.setClusterEntity(clusterEntity);
          widgetEntity.setScope(WidgetResourceProvider.SCOPE.CLUSTER.name());
          widgetEntity.setWidgetName(layoutInfo.getWidgetName());
          widgetEntity.setDisplayName(layoutInfo.getDisplayName());
          widgetEntity.setAuthor(user);
          widgetEntity.setDescription(layoutInfo.getDescription());
          widgetEntity.setTimeCreated(now);
          widgetEntity.setWidgetType(layoutInfo.getType());
          widgetEntity.setMetrics(gson.toJson(layoutInfo.getMetricsInfo()));
          widgetEntity.setProperties(gson.toJson(layoutInfo.getProperties()));
          widgetEntity.setWidgetValues(gson.toJson(layoutInfo.getValues()));
          widgetDAO.create(widgetEntity);
          if (layoutInfo.isVisible()) {
            List<WidgetEntity> createdEntities=widgetDAO.findByName(clusterId,layoutInfo.getWidgetName(),user);
            if (createdEntities != null && !createdEntities.isEmpty()) {
              if (createdEntities.size() > 1) {
                LOG.error("Skipping layout entry for widget. Multiple widgets " + "found with name = " + layoutInfo.getWidgetName() + ", cluster = "+ cluster.getClusterName()+ ", user = "+ user);
              }
 else {
                WidgetLayoutUserWidgetEntity widgetLayoutUserWidgetEntity=new WidgetLayoutUserWidgetEntity();
                widgetLayoutUserWidgetEntity.setWidget(widgetEntity);
                widgetLayoutUserWidgetEntity.setWidgetOrder(order++);
                widgetLayoutUserWidgetEntity.setWidgetLayout(layoutEntity);
                widgetLayoutUserWidgetEntityList.add(widgetLayoutUserWidgetEntity);
              }
            }
          }
        }
        layoutEntity.setListWidgetLayoutUserWidgetEntity(widgetLayoutUserWidgetEntityList);
        widgetLayoutDAO.create(layoutEntity);
      }
    }
  }
}
