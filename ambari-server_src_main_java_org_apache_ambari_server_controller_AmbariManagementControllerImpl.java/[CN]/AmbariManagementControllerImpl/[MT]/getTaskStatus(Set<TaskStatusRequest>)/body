{
  Map<Long,Collection<Long>> idMap=new HashMap<Long,Collection<Long>>();
  for (  TaskStatusRequest request : requests) {
    Long requestId=request.getRequestId();
    Collection<Long> ids=idMap.get(requestId);
    if (ids == null) {
      ids=new ArrayList<Long>();
      idMap.put(requestId,ids);
    }
    Long taskId=request.getTaskId();
    if (taskId == null) {
      List<HostRoleCommand> hostRoleCommands=actionManager.getRequestTasks(requestId);
      for (      HostRoleCommand hostRoleCommand : hostRoleCommands) {
        ids.add(hostRoleCommand.getTaskId());
      }
    }
 else {
      ids.add(taskId);
    }
  }
  Set<TaskStatusResponse> responses=new HashSet<TaskStatusResponse>();
  for (  Entry<Long,Collection<Long>> entry : idMap.entrySet()) {
    Collection<Long> ids=entry.getValue();
    if (ids == null || ids.isEmpty()) {
      continue;
    }
    for (    HostRoleCommand hostRoleCommand : actionManager.getTasks(ids)) {
      responses.add(new TaskStatusResponse(entry.getKey(),hostRoleCommand));
    }
  }
  return responses;
}
