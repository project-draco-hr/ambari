{
  ldapSyncInProgress=true;
  try {
    final LdapBatchDto batchInfo=new LdapBatchDto();
    if (users != null) {
      ldapDataPopulator.synchronizeLdapUsers(users,batchInfo);
    }
 else {
      ldapDataPopulator.synchronizeAllLdapUsers(batchInfo);
    }
    if (groups != null) {
      ldapDataPopulator.synchronizeLdapGroups(groups,batchInfo);
    }
 else {
      ldapDataPopulator.synchronizeAllLdapGroups(batchInfo);
    }
    this.users.processLdapSync(batchInfo);
    return batchInfo;
  }
  finally {
    ldapSyncInProgress=false;
  }
}
