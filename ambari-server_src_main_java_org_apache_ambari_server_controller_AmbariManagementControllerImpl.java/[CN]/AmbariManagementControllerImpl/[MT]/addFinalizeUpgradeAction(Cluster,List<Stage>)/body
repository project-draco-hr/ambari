{
  Stage lastStage=stages.get(stages.size() - 1);
  Stage newStage=createNewStage(cluster,lastStage.getRequestId(),"finalize upgrade");
  newStage.setStageId(lastStage.getStageId() + 1);
  String hostName=lastStage.getOrderedHostRoleCommands().get(0).getHostName();
  Map<String,String> payload=new HashMap<String,String>();
  payload.put(ServerAction.PayloadName.CLUSTER_NAME,cluster.getClusterName());
  payload.put(ServerAction.PayloadName.CURRENT_STACK_VERSION,cluster.getDesiredStackVersion().getStackId());
  ServiceComponentHostUpgradeEvent event=new ServiceComponentHostUpgradeEvent(Role.AMBARI_SERVER_ACTION.toString(),hostName,System.currentTimeMillis(),cluster.getDesiredStackVersion().getStackId());
  newStage.addServerActionCommand(ServerAction.Command.FINALIZE_UPGRADE,Role.AMBARI_SERVER_ACTION,RoleCommand.EXECUTE,cluster.getClusterName(),event,hostName);
  ExecutionCommand execCmd=newStage.getExecutionCommandWrapper(hostName,Role.AMBARI_SERVER_ACTION.toString()).getExecutionCommand();
  execCmd.setCommandParams(payload);
  stages.add(newStage);
}
