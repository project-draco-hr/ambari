{
  Set<UserResponse> responses=new HashSet<UserResponse>();
  for (  UserRequest r : requests) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Received a getUsers request" + ", userRequest=" + r.toString());
    }
    if (null == r.getUsername()) {
      for (      User u : users.getAllUsers()) {
        UserResponse resp=new UserResponse(u.getUserName(),u.isLdapUser());
        resp.setRoles(new HashSet<String>(u.getRoles()));
        responses.add(resp);
      }
    }
 else {
      User u=users.getAnyUser(r.getUsername());
      if (null == u) {
        throw new AmbariException("Cannot find user '" + r.getUsername() + "'");
      }
      UserResponse resp=new UserResponse(u.getUserName(),u.isLdapUser());
      resp.setRoles(new HashSet<String>(u.getRoles()));
      responses.add(resp);
    }
  }
  return responses;
}
