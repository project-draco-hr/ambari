{
  Set<UserResponse> responses=new HashSet<UserResponse>();
  for (  UserRequest r : requests) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Received a getUsers request" + ", userRequest=" + r.toString());
    }
    if (null == r.getUsername()) {
      for (      User u : users.getAllUsers()) {
        UserResponse resp=new UserResponse(u.getUserName(),u.isLdapUser(),u.isActive());
        resp.setRoles(new HashSet<String>(u.getRoles()));
        resp.setGroups(new HashSet<String>(u.getGroups()));
        responses.add(resp);
      }
    }
 else {
      User u=users.getAnyUser(r.getUsername());
      if (null == u) {
        if (requests.size() == 1) {
          throw new ObjectNotFoundException("Cannot find user '" + r.getUsername() + "'");
        }
      }
 else {
        UserResponse resp=new UserResponse(u.getUserName(),u.isLdapUser(),u.isActive());
        resp.setRoles(new HashSet<String>(u.getRoles()));
        resp.setGroups(new HashSet<String>(u.getGroups()));
        responses.add(resp);
      }
    }
  }
  return responses;
}
