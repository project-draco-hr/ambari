{
  if (request.getClusterName() == null || request.getClusterName().isEmpty()) {
    throw new IllegalArgumentException("Invalid arguments, cluster name" + " should not be null");
  }
  LOG.info("Received a updateCluster request" + ", clusterName=" + request.getClusterName() + ", request="+ request);
  final Cluster cluster=clusters.getCluster(request.getClusterName());
  if (null != request.getDesiredConfig()) {
    ConfigurationRequest cr=request.getDesiredConfig();
    if (null != cr.getProperties() && cr.getProperties().size() > 0) {
      LOG.info(MessageFormat.format("Applying configuration with tag ''{0}'' to cluster ''{1}''",cr.getVersionTag(),request.getClusterName()));
      cr.setClusterName(cluster.getClusterName());
      createConfiguration(cr);
    }
    Config baseConfig=cluster.getConfig(cr.getType(),cr.getVersionTag());
    if (null != baseConfig) {
      Config oldConfig=cluster.getDesiredConfigByType(cr.getType());
      String authName=getAuthName();
      if (cluster.addDesiredConfig(authName,baseConfig)) {
        Logger logger=LoggerFactory.getLogger("configchange");
        logger.info("cluster '" + request.getClusterName() + "' "+ "changed by: '"+ authName+ "'; "+ "type='"+ baseConfig.getType()+ "' "+ "tag='"+ baseConfig.getVersionTag()+ "'"+ (null == oldConfig ? "" : " from='" + oldConfig.getVersionTag() + "'"));
      }
    }
  }
  StackId currentVersion=cluster.getCurrentStackVersion();
  StackId desiredVersion=cluster.getDesiredStackVersion();
  if (currentVersion == null) {
    cluster.setCurrentStackVersion(desiredVersion);
  }
  boolean requiresHostListUpdate=request.getHostNames() != null && !request.getHostNames().isEmpty();
  if (requiresHostListUpdate) {
    clusters.mapHostsToCluster(request.getHostNames(),request.getClusterName());
  }
  return null;
}
