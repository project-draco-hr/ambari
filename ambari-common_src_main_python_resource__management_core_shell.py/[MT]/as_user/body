def as_user(command, user, env=SUDO_ENVIRONMENT_PLACEHOLDER):
    if isinstance(command, (list, tuple)):
        command = string_cmd_from_args_list(command)
    if (env != SUDO_ENVIRONMENT_PLACEHOLDER):
        env = reduce((lambda str, x: '{0} {1}={2}'.format(str, x, quote_bash_args(env[x]))), env, '')
    export_command = 'export {0} ; '.format(env)
    result_command = '/usr/bin/sudo -Hi su - {0} -s /bin/bash -c {1}'.format(user, quote_bash_args((export_command + command)))
    return result_command
