{
  StackUpgradeUtil stackUpgradeUtil=injector.getInstance(StackUpgradeUtil.class);
  String stackName="HDP";
  String stackVersion="1.3.0";
  String localRepoUrl="http://foo.bar";
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,null);
  MetainfoDAO dao=injector.getInstance(MetainfoDAO.class);
  Collection<MetainfoEntity> entities=dao.findAll();
  Assert.assertTrue(entities.size() > 0);
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
  reset(stackName,stackVersion);
  entities=dao.findAll();
  Assert.assertTrue(0 == entities.size());
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,"centos6");
  entities=dao.findAll();
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos6"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
  reset(stackName,stackVersion);
  entities=dao.findAll();
  Assert.assertTrue(0 == entities.size());
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,"centos6,centos5");
  entities=dao.findAll();
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos6") || entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos5"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
}
