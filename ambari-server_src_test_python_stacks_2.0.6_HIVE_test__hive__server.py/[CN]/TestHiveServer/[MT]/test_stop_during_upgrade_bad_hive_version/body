@patch('hive_server.HiveServer.pre_rolling_restart')
@patch('hive_server.HiveServer.start')
@patch('subprocess.Popen')
def test_stop_during_upgrade_bad_hive_version(self, process_mock, hive_server_start_mock, hive_server_pre_rolling_mock):
    process_output = 'BAD VERSION'
    process = MagicMock()
    process.communicate.return_value = [process_output]
    process.returncode = 0
    process_mock.return_value = process
    try:
        self.executeScript((self.COMMON_SERVICES_PACKAGE_DIR + '/scripts/hive_server.py'), classname='HiveServer', command='restart', config_file='hive-upgrade.json', hdp_stack_version=self.UPGRADE_STACK_VERSION, target=RMFTestCase.TARGET_COMMON_SERVICES)
        self.fail('Invalid hive version should have caused an exception')
    except:
        pass
    self.assertNoMoreResources()
