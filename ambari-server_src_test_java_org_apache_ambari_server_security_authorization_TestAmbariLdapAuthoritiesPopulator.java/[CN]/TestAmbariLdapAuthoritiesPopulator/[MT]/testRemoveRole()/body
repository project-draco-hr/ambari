{
  int userId=123;
  AmbariLdapAuthoritiesPopulator populator=new AmbariLdapAuthoritiesPopulator(configuration,helper,userDAO,roleDAO,principalDAO,principalTypeDAO,memberDAO,privilegeDAO);
  RoleEntity roleEntity=createMock(RoleEntity.class);
  Set<UserEntity> userEntities=createMock(Set.class);
  Set<RoleEntity> roleEntities=createMock(Set.class);
  expect(userEntity.getUserId()).andReturn(userId);
  expect(userDAO.findByPK(userId)).andReturn(userEntity);
  expect(roleDAO.findByName(adminRole)).andReturn(roleEntity);
  expect(userEntity.getRoleEntities()).andReturn(roleEntities);
  expect(roleEntities.contains(roleEntity)).andReturn(true);
  expect(userEntity.getUserName()).andReturn(username);
  expect(userEntity.getRoleEntities()).andReturn(roleEntities);
  expect(roleEntity.getUserEntities()).andReturn(userEntities);
  expect(userEntities.remove(userEntity)).andReturn(true);
  expect(roleEntities.remove(roleEntity)).andReturn(true);
  expect(userDAO.merge(userEntity)).andReturn(userEntity);
  expect(roleDAO.merge(roleEntity)).andReturn(roleEntity);
  replayAll();
  populator.removeRole(userEntity,adminRole);
  verifyAll();
}
