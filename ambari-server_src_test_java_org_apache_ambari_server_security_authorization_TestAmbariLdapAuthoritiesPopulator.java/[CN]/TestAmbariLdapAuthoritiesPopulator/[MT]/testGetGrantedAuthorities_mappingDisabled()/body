{
  String username="user";
  AmbariLdapAuthoritiesPopulator populator=createMockBuilder(AmbariLdapAuthoritiesPopulator.class).addMockedMethod("createLdapUser").withConstructor(configuration,helper,userDAO,roleDAO,principalDAO,principalTypeDAO).createMock();
  expect(ldapServerProperties.isGroupMappingEnabled()).andReturn(false).atLeastOnce();
  expect(configuration.getLdapServerProperties()).andReturn(ldapServerProperties).atLeastOnce();
  expect(userEntity.getRoleEntities()).andReturn(roleSetStub);
  populator.createLdapUser(username);
  expectLastCall();
  expect(userDAO.findLdapUserByName(username)).andReturn(null).andReturn(userEntity);
  replayAll();
  populator.getGrantedAuthorities(userData,username);
  verifyAll();
}
