{
  AmbariLdapAuthoritiesPopulator populator=createMockBuilder(AmbariLdapAuthoritiesPopulator.class).addMockedMethod("addRole").addMockedMethod("removeRole").withConstructor(configuration,helper,userDAO,roleDAO).createMock();
  Capture<UserEntity> createEntity=new Capture<UserEntity>();
  Capture<UserEntity> addRoleEntity=new Capture<UserEntity>();
  userDAO.create(capture(createEntity));
  expectLastCall();
  populator.addRole(capture(addRoleEntity),eq(userRole));
  expectLastCall();
  replayAll();
  populator.createLdapUser(username);
  verifyAll();
  UserEntity capturedCreateEntity=createEntity.getValue();
  UserEntity capturedAddRoleEntity=addRoleEntity.getValue();
  assertTrue(capturedCreateEntity.getLdapUser());
  assertEquals(username,capturedCreateEntity.getUserName());
  assertEquals(capturedCreateEntity,capturedAddRoleEntity);
}
