{
  TestClusterImpl clusterImpl=new TestClusterImpl(services,roles);
  c.put("cluster1",clusterImpl);
  RoleFSM roleFsm=clusterImpl.getServices().get(0).getRoles().get(0);
  heartbeat.setInstallScriptHash(scriptHash);
  List<AgentRoleState> installedRoleStates=new ArrayList<AgentRoleState>();
  AgentRoleState roleState=new AgentRoleState();
  roleState.setRoleName(roles[0]);
  roleState.setClusterDefinitionRevision(-1);
  roleState.setClusterId("cluster1");
  roleState.setComponentName("comp1");
  installedRoleStates.add(roleState);
  heartbeat.setInstalledRoleStates(installedRoleStates);
  HeartbeatHandler handler=new HeartbeatHandler(clusters,nodes);
  ControllerResponse response=handler.processHeartBeat(heartbeat);
  checkActions(response,true);
  int i=0;
  while (i++ < 10) {
    if (roleFsm.getRoleState() == RoleState.ACTIVE) {
      break;
    }
    Thread.sleep(1000);
  }
  assert(roleFsm.getRoleState() == RoleState.ACTIVE);
}
