{
  TestClusterImpl clusterImpl=new TestClusterImpl(services,roles);
  c.put("cluster1",clusterImpl);
  heartbeat.setInstallScriptHash(scriptHash);
  ServiceFSM serviceImpl=clusterImpl.getServices().get(0);
  ((TestServiceImpl)serviceImpl).setServiceState(ServiceState.PRESTART);
  ActionResult actionResult=new ActionResult();
  actionResult.setKind(Kind.RUN_ACTION);
  ClusterNameAndRev clusterNameAndRev=new ClusterNameAndRev("cluster1",-1);
  String checkActionId=HeartbeatHandler.getSpecialActionID(clusterNameAndRev,"comp1","abc",SpecialServiceIDs.SERVICE_PRESTART_CHECK_ID);
  actionResult.setId(checkActionId);
  actionResult.setClusterId("cluster1");
  actionResult.setClusterDefinitionRevision(-1);
  CommandResult commandResult=new CommandResult(0,"","");
  actionResult.setCommandResult(commandResult);
  List<ActionResult> actionResults=new ArrayList<ActionResult>();
  actionResults.add(actionResult);
  heartbeat.setActionResults(actionResults);
  HeartbeatHandler handler=new HeartbeatHandler(clusters,nodes);
  handler.processHeartBeat(heartbeat);
  int i=0;
  while (i++ < 10) {
    if (serviceImpl.getServiceState() == ServiceState.STARTING) {
      break;
    }
    Thread.sleep(1000);
  }
  assert(serviceImpl.getServiceState() == ServiceState.STARTING);
}
