{
  ReadWriteLock readWriteLock=new ReentrantReadWriteLock();
  this.readLock=readWriteLock.readLock();
  this.writeLock=readWriteLock.writeLock();
  this.stateMachine=stateMachineFactory.make(this);
  List<ServiceFSM> serviceImpls=new ArrayList<ServiceFSM>();
  for (  String service : cluster.getClusterDefinition(revision).getEnabledServices()) {
    if (hasActiveRoles(cluster,service)) {
      ServiceImpl serviceImpl=new ServiceImpl(cluster.getComponentDefinition(service).getActiveRoles(),this,service);
      serviceImpls.add(serviceImpl);
    }
  }
  this.cls=cluster;
  this.services=serviceImpls;
}
