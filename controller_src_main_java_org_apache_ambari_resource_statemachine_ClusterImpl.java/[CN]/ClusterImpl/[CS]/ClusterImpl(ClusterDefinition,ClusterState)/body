{
  this.cluster=cluster;
  ReadWriteLock readWriteLock=new ReentrantReadWriteLock();
  this.readLock=readWriteLock.readLock();
  this.writeLock=readWriteLock.writeLock();
  this.stateMachine=stateMachineFactory.make(this);
  List<ServiceFSM> serviceImpls=new ArrayList<ServiceFSM>();
  for (  String service : cluster.getActiveServices()) {
    ServiceImpl serviceImpl=new ServiceImpl(this,service);
    serviceImpls.add(serviceImpl);
  }
  this.services=serviceImpls;
}
