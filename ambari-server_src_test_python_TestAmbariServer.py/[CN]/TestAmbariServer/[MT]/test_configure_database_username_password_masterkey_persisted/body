@patch.object(_ambari_server_, 'decrypt_password_for_alias')
@patch.object(_ambari_server_, 'is_alias_string')
@patch.object(_ambari_server_, 'get_ambari_properties')
def test_configure_database_username_password_masterkey_persisted(self, get_ambari_properties_method, is_alias_string_method, decrypt_password_for_alias_method):
    out = StringIO.StringIO()
    sys.stdout = out
    configs = {_ambari_server_.JDBC_USER_NAME_PROPERTY: 'fakeuser', _ambari_server_.JDBC_PASSWORD_PROPERTY: '${alias=somealias}', _ambari_server_.JDBC_DATABASE_NAME_PROPERTY: 'fakedbname', _ambari_server_.SECURITY_KEY_IS_PERSISTED: 'True', }
    get_ambari_properties_method.return_value = configs
    is_alias_string_method.return_value = True
    decrypt_password_for_alias_method.return_value = 'falepasswd'
    args = MagicMock()
    args.master_key = None
    _ambari_server_.configure_database_username_password(args)
    self.assertTrue(decrypt_password_for_alias_method.called)
    self.assertTrue(is_alias_string_method.called)
    self.assertEquals('fakeuser', args.database_username)
    self.assertEquals('falepasswd', args.database_password)
    sys.stdout = sys.__stdout__
