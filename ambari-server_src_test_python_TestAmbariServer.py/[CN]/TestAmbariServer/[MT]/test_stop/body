@patch('__builtin__.open')
@patch('os.path.exists')
@patch('os.remove')
@patch('os.killpg')
@patch('os.getpgid')
@patch.object(ambari_server, 'print_info_msg')
def test_stop(self, print_info_msg_mock, gpidMock, removeMock, killMock, pexistsMock, openMock):
    pexistsMock.return_value = True
    f = MagicMock()
    f.readline.return_value = '42'
    openMock.return_value = f
    ambari_server.stop(None)
    self.assertTrue(f.readline.called)
    self.assertTrue(killMock.called)
    self.assertTrue(killMock.called)
    self.assertTrue(f.close.called)
    self.assertTrue(removeMock.called)
