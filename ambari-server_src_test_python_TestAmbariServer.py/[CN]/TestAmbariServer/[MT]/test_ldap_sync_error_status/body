@patch('urllib2.urlopen')
@patch.object(_ambari_server_, 'get_validated_string_input')
@patch.object(_ambari_server_, 'get_ambari_properties')
@patch.object(_ambari_server_, 'is_server_runing')
@patch.object(_ambari_server_, 'is_root')
def test_ldap_sync_error_status(self, is_root_method, is_server_runing_mock, get_ambari_properties_mock, get_validated_string_input_mock, urlopen_mock):
    is_root_method.return_value = True
    is_server_runing_mock.return_value = (True, 0)
    properties = _ambari_server_.Properties()
    properties.process_pair(_ambari_server_.IS_LDAP_CONFIGURED, 'true')
    get_ambari_properties_mock.return_value = properties
    get_validated_string_input_mock.side_effect = ['admin', 'admin']
    response = MagicMock()
    response.getcode.side_effect = [201, 200]
    response.read.side_effect = ['{"resources" : [{"href" : "http://c6401.ambari.apache.org:8080/api/v1/ldap_sync_events/16","Event" : {"id" : 16}}]}', '{"Event":{"status" : "ERROR","status_detail" : "Error!!","summary" : {"groups" : {"created" : 0,"removed" : 0,"updated" : 0},"memberships" : {"created" : 0,"removed" : 0},"users" : {"created" : 0,"removed" : 0,"updated" : 0}}}}']
    urlopen_mock.return_value = response
    try:
        _ambari_server_.sync_ldap()
        self.fail('Should fail with exception')
    except FatalException as e:
        pass
