@patch.object(FirewallChecks, 'run_os_command')
@patch.object(OSCheck, 'get_os_family')
@patch.object(OSCheck, 'get_os_type')
@patch.object(OSCheck, 'get_os_major_version')
@patch.object(ambari_server, 'is_jdbc_user_changed')
@patch.object(ambari_server, 'verify_setup_allowed')
@patch.object(ambari_server, 'get_YN_input')
@patch.object(ambari_server, 'configure_os_settings')
@patch.object(ambari_server, 'download_jdk')
@patch.object(ambari_server, 'configure_postgres')
@patch.object(ambari_server, 'check_postgre_up')
@patch.object(ambari_server, 'check_ambari_user')
@patch.object(ambari_server, 'check_jdbc_drivers')
@patch.object(ambari_server, 'check_selinux')
@patch.object(ambari_server, 'is_local_database')
@patch.object(ambari_server, 'is_root')
@patch.object(ambari_server, 'setup_db')
@patch.object(ambari_server, 'get_is_secure')
@patch.object(ambari_server, 'store_password_file')
@patch.object(ambari_server, 'extract_views')
@patch.object(ambari_server, 'adjust_directory_permissions')
@patch('sys.exit')
@patch('__builtin__.raw_input')
def test_ambariServerSetupWithCustomDbName(self, raw_input, exit_mock, adjust_dirs_mock, extract_views_mock, store_password_file_mock, get_is_secure_mock, setup_db_mock, is_root_mock, is_local_database_mock, check_selinux_mock, check_jdbc_drivers_mock, check_ambari_user_mock, check_postgre_up_mock, configure_postgres_mock, download_jdk_mock, configure_os_settings_mock, get_YN_input, verify_setup_allowed_method, is_jdbc_user_changed_mock, get_os_major_version_mock, get_os_type_mock, get_os_family_mock, run_os_command_mock):
    args = MagicMock()
    raw_input.return_value = ''
    get_YN_input.return_value = False
    verify_setup_allowed_method.return_value = 0
    is_root_mock.return_value = True
    check_selinux_mock.return_value = 0
    check_ambari_user_mock.return_value = 0
    check_jdbc_drivers_mock.return_value = 0
    check_postgre_up_mock.return_value = ('running', 0, '', '')
    is_local_database_mock.return_value = True
    configure_postgres_mock.return_value = (0, '', '')
    download_jdk_mock.return_value = 0
    configure_os_settings_mock.return_value = 0
    is_jdbc_user_changed_mock.return_value = False
    setup_db_mock.return_value = (0, None, None)
    get_is_secure_mock.return_value = False
    store_password_file_mock.return_value = 'password'
    extract_views_mock.return_value = 0
    get_os_type_mock.return_value = ''
    get_os_family_mock.return_value = OSConst.REDHAT_FAMILY
    run_os_command_mock.return_value = (3, '', '')
    new_db = 'newDBName'
    args.dbms = 'postgres'
    args.database_name = new_db
    args.postgres_schema = new_db
    args.database_username = 'user'
    args.database_password = 'password'
    args.jdbc_driver = None
    args.jdbc_db = None
    tempdir = tempfile.gettempdir()
    prop_file = os.path.join(tempdir, 'ambari.properties')
    with open(prop_file, 'w') as f:
        f.write('server.jdbc.database_name=oldDBName')
    f.close()
    os.environ[ambari_server.AMBARI_CONF_VAR] = tempdir
    try:
        result = ambari_server.setup(args)
    except FatalException as ex:
        self.fail('Setup should be successful')
    properties = ambari_server.get_ambari_properties()
    self.assertTrue((ambari_server.JDBC_DATABASE_NAME_PROPERTY in properties.keys()))
    value = properties[ambari_server.JDBC_DATABASE_NAME_PROPERTY]
    self.assertEqual(value, new_db)
    del os.environ[ambari_server.AMBARI_CONF_VAR]
    os.remove(prop_file)
