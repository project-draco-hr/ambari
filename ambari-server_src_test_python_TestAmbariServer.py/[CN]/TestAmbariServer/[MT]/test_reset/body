@patch.object(_ambari_server_, 'get_remote_script_line')
@patch.object(_ambari_server_, 'is_server_runing')
@patch.object(_ambari_server_, 'get_YN_input')
@patch.object(_ambari_server_, 'setup_db')
@patch.object(_ambari_server_, 'print_info_msg')
@patch.object(_ambari_server_, 'run_os_command')
@patch.object(_ambari_server_, 'configure_database_username_password')
@patch.object(_ambari_server_, 'parse_properties_file')
@patch.object(_ambari_server_, 'is_root')
@patch.object(_ambari_server_, 'check_database_name_property')
def test_reset(self, check_database_name_property_mock, is_root_mock, parse_properties_file_mock, configure_database_username_password_mock, run_os_command_mock, print_info_msg_mock, setup_db_mock, get_YN_inputMock, is_server_running_mock, get_remote_script_line_mock):
    parse_properties_file_mock.return_value = 0
    args = MagicMock()
    args.persistence_type = 'local'
    get_YN_inputMock.return_value = False
    is_server_running_mock.return_value = (False, 0)
    setup_db_mock.side_effect = [(0, None, None), (0, None, "ERROR: database 'ambari' is being accessed by other users"), (0, None, "ERROR: user 'mapred' already exist")]
    is_root_mock.return_value = False
    try:
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except FatalException as fe:
        self.assertTrue(('root-level' in fe.reason))
        pass
    is_root_mock.return_value = True
    try:
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except FatalException as fe:
        self.assertFalse(('root-level' in fe.reason))
        pass
    get_YN_inputMock.return_value = True
    run_os_command_mock.return_value = (1, None, None)
    try:
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except FatalException:
        pass
    run_os_command_mock.return_value = (0, None, None)
    _ambari_server_.reset(args)
    self.assertTrue(setup_db_mock.called)
    is_server_running_mock.side_effect = [(True, 123), (False, 0), (False, 0), (False, 0), (False, 0)]
    try:
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except FatalException:
        pass
    try:
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except NonFatalException:
        pass
    get_remote_script_line_mock.return_value = None
    try:
        args.persistence_type = 'remote'
        _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except NonFatalException:
        pass
    get_remote_script_line_mock.reset_mock()
    get_remote_script_line_mock.side_effect = ['drop', 'create']
    try:
        args.persistence_type = 'remote'
        rcode = _ambari_server_.reset(args)
        self.fail('Should throw exception')
    except NonFatalException:
        self.assertTrue(get_remote_script_line_mock.called)
        pass
