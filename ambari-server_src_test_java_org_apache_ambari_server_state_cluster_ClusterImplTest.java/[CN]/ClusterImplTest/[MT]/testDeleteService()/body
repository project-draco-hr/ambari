{
  String serviceToDelete="TEZ";
  String clusterName="TEST_CLUSTER";
  String hostName1="HOST1", hostName2="HOST2";
  clusters.addCluster(clusterName,new StackId("HDP-2.1.1"));
  Cluster cluster=clusters.getCluster(clusterName);
  clusters.addHost(hostName1);
  clusters.addHost(hostName2);
  Host host1=clusters.getHost(hostName1);
  host1.setHostAttributes(ImmutableMap.of("os_family","centos","os_release_version","6.0"));
  Host host2=clusters.getHost(hostName2);
  host2.setHostAttributes(ImmutableMap.of("os_family","centos","os_release_version","6.0"));
  clusters.mapHostsToCluster(Sets.newHashSet(hostName1,hostName2),clusterName);
  Service hdfs=cluster.addService("HDFS");
  hdfs.persist();
  ServiceComponent nameNode=hdfs.addServiceComponent("NAMENODE");
  nameNode.persist();
  nameNode.addServiceComponentHost(hostName1).persist();
  ServiceComponent dataNode=hdfs.addServiceComponent("DATANODE");
  dataNode.persist();
  dataNode.addServiceComponentHost(hostName1).persist();
  dataNode.addServiceComponentHost(hostName2).persist();
  ServiceComponent hdfsClient=hdfs.addServiceComponent("HDFS_CLIENT");
  hdfsClient.persist();
  hdfsClient.addServiceComponentHost(hostName1).persist();
  hdfsClient.addServiceComponentHost(hostName2).persist();
  Service tez=cluster.addService(serviceToDelete);
  tez.persist();
  ServiceComponent tezClient=tez.addServiceComponent("TEZ_CLIENT");
  tezClient.persist();
  ServiceComponentHost tezClientHost1=tezClient.addServiceComponentHost(hostName1);
  tezClientHost1.persist();
  ServiceComponentHost tezClientHost2=tezClient.addServiceComponentHost(hostName2);
  tezClientHost2.persist();
  cluster.deleteService(serviceToDelete);
  assertFalse("Deleted service should be removed from the service collection !",cluster.getServices().containsKey(serviceToDelete));
  assertEquals("All components of the deleted service should be removed from all hosts",0,cluster.getServiceComponentHosts(serviceToDelete,null).size());
  boolean checkHost1=!cluster.getServiceComponentHosts(hostName1).contains(tezClientHost1);
  boolean checkHost2=!cluster.getServiceComponentHosts(hostName2).contains(tezClientHost2);
  assertTrue("All components of the deleted service should be removed from all hosts",checkHost1 && checkHost2);
}
