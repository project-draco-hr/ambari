{
  ServiceConfigEntity serviceConfigEntity=new ServiceConfigEntity();
  serviceConfigEntity.setServiceName(serviceName);
  serviceConfigEntity.setClusterEntity(clusterEntity);
  serviceConfigEntity.setVersion(configVersionHelper.getNextVersion(serviceName));
  serviceConfigEntity.setUser(user);
  serviceConfigEntity.setNote(note);
  if (configGroup != null) {
    Collection<Config> configs=configGroup.getConfigurations().values();
    List<ClusterConfigEntity> configEntities=new ArrayList<ClusterConfigEntity>(configs.size());
    for (    Config config : configs) {
      configEntities.add(clusterDAO.findConfig(getClusterId(),config.getType(),config.getVersion()));
    }
    serviceConfigEntity.setClusterConfigEntities(configEntities);
    serviceConfigEntity.setHostNames(new ArrayList<String>(configGroup.getHosts().keySet()));
  }
 else {
    List<ClusterConfigEntity> configEntities=getClusterConfigEntitiesByService(serviceName);
    serviceConfigEntity.setClusterConfigEntities(configEntities);
  }
  serviceConfigDAO.create(serviceConfigEntity);
  ServiceConfigVersionResponse response=new ServiceConfigVersionResponse();
  response.setUserName(user);
  response.setClusterName(getClusterName());
  response.setVersion(serviceConfigEntity.getVersion());
  response.setServiceName(serviceConfigEntity.getServiceName());
  response.setCreateTime(serviceConfigEntity.getCreateTimestamp());
  response.setUserName(serviceConfigEntity.getUser());
  response.setNote(serviceConfigEntity.getNote());
  response.setGroupId(serviceConfigEntity.getGroupId());
  response.setHosts(serviceConfigEntity.getHostNames());
  response.setGroupName(configGroup != null ? configGroup.getName() : null);
  return response;
}
