{
  clusterGlobalLock.readLock().lock();
  try {
    readWriteLock.writeLock().lock();
    try {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Changing DesiredStackVersion of Cluster" + ", clusterName=" + getClusterName() + ", clusterId="+ getClusterId()+ ", currentDesiredStackVersion="+ desiredStackVersion+ ", newDesiredStackVersion="+ stackVersion);
      }
      desiredStackVersion=stackVersion;
      clusterEntity.setDesiredStackVersion(gson.toJson(stackVersion));
      clusterDAO.merge(clusterEntity);
      loadServiceConfigTypes();
    }
  finally {
      readWriteLock.writeLock().unlock();
    }
  }
  finally {
    clusterGlobalLock.readLock().unlock();
  }
}
