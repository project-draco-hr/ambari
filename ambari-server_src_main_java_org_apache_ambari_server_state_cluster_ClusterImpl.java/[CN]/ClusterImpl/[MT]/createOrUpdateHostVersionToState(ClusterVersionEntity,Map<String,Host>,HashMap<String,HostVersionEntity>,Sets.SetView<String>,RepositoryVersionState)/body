{
  for (  String hostname : hosts.keySet()) {
    Host host=hosts.get(hostname);
    if (host.getMaintenanceState(getClusterId()) != MaintenanceState.OFF) {
      continue;
    }
    if (hostsMissingRepoVersion.contains(hostname)) {
      HostEntity hostEntity=hostDAO.findByName(hostname);
      HostVersionEntity hostVersionEntity=new HostVersionEntity(hostEntity,sourceClusterVersion.getRepositoryVersion(),newState);
      hostVersionDAO.create(hostVersionEntity);
    }
 else {
      HostVersionEntity hostVersionEntity=existingHostStackVersions.get(hostname);
      hostVersionEntity.setState(newState);
      hostVersionDAO.merge(hostVersionEntity);
    }
  }
}
