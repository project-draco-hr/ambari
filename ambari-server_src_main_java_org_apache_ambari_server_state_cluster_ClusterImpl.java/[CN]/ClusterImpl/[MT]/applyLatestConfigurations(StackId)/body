{
  clusterGlobalLock.writeLock().lock();
  try {
    Collection<ClusterConfigMappingEntity> configMappingEntities=clusterEntity.getConfigMappingEntities();
    for (    ClusterConfigMappingEntity e : configMappingEntities) {
      e.setSelected(0);
    }
    List<ClusterConfigEntity> clusterConfigsToMakeSelected=clusterDAO.getLatestConfigurations(clusterEntity.getClusterId(),stackId);
    for (    ClusterConfigEntity clusterConfigToMakeSelected : clusterConfigsToMakeSelected) {
      for (      ClusterConfigMappingEntity configMappingEntity : configMappingEntities) {
        String tag=configMappingEntity.getTag();
        String type=configMappingEntity.getType();
        if (clusterConfigToMakeSelected.getTag().equals(tag) && clusterConfigToMakeSelected.getType().equals(type)) {
          configMappingEntity.setSelected(1);
        }
      }
    }
    clusterDAO.merge(clusterEntity);
    cacheConfigurations();
  }
  finally {
    clusterGlobalLock.writeLock().unlock();
  }
}
