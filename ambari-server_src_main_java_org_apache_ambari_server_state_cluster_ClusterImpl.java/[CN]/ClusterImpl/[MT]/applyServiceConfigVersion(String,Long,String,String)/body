{
  ServiceConfigEntity serviceConfigEntity=serviceConfigDAO.findByServiceAndVersion(serviceName,serviceConfigVersion);
  if (serviceConfigEntity == null) {
    throw new ObjectNotFoundException("Service config version with serviceName={} and version={} not found");
  }
  Collection<String> configTypes=serviceConfigTypes.get(serviceName);
  for (  ClusterConfigMappingEntity entity : clusterEntity.getConfigMappingEntities()) {
    if (configTypes.contains(entity.getType()) && entity.isSelected() > 0) {
      entity.setSelected(0);
    }
  }
  clusterDAO.merge(clusterEntity);
  for (  ClusterConfigEntity configEntity : serviceConfigEntity.getClusterConfigEntities()) {
    selectConfig(configEntity.getType(),configEntity.getTag(),user);
  }
  ServiceConfigEntity serviceConfigEntityClone=new ServiceConfigEntity();
  serviceConfigEntityClone.setCreateTimestamp(System.currentTimeMillis());
  serviceConfigEntityClone.setUser(user);
  serviceConfigEntityClone.setServiceName(serviceName);
  serviceConfigEntityClone.setClusterEntity(clusterEntity);
  serviceConfigEntityClone.setClusterConfigEntities(serviceConfigEntity.getClusterConfigEntities());
  serviceConfigEntityClone.setClusterId(serviceConfigEntity.getClusterId());
  serviceConfigEntityClone.setNote(serviceConfigVersionNote);
  serviceConfigEntityClone.setVersion(configVersionHelper.getNextVersion(serviceName));
  serviceConfigDAO.create(serviceConfigEntityClone);
}
