def test_build(self):
    config = AmbariConfig.AmbariConfig()
    config.set('agent', 'prefix', 'tmp')
    config.set('agent', 'cache_dir', '/var/lib/ambari-agent/cache')
    config.set('agent', 'tolerate_download_failures', 'true')
    dummy_controller = MagicMock()
    dummy_controller.recovery_manager.recovery_timestamp = (-1)
    actionQueue = ActionQueue(config, dummy_controller)
    heartbeat = Heartbeat(actionQueue)
    result = heartbeat.build(100)
    print ('Heartbeat: ' + str(result))
    self.assertEquals((result['hostname'] != ''), True, 'hostname should not be empty')
    self.assertEquals(result['responseId'], 100)
    self.assertEquals((result['componentStatus'] is not None), True, 'Heartbeat should contain componentStatus')
    self.assertEquals((result['reports'] is not None), True, 'Heartbeat should contain reports')
    self.assertEquals((result['timestamp'] >= 1353679373880L), True)
    self.assertEquals(result['recoveryTimestamp'], (-1))
    self.assertEquals(len(result['nodeStatus']), 2)
    self.assertEquals(result['nodeStatus']['cause'], 'NONE')
    self.assertEquals(result['nodeStatus']['status'], 'HEALTHY')
    self.assertEquals(((len(result) is 7) or (len(result) is 8)), True)
    self.assertEquals((not heartbeat.reports), True, 'Heartbeat should not contain task in progress')
