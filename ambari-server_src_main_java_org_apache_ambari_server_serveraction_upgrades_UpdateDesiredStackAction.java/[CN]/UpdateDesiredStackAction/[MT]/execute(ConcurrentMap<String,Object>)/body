{
  Map<String,String> commandParams=getExecutionCommand().getCommandParams();
  StackId originalStackId=new StackId(commandParams.get(COMMAND_PARAM_ORIGINAL_STACK));
  StackId targetStackId=new StackId(commandParams.get(COMMAND_PARAM_TARGET_STACK));
  Direction direction=Direction.UPGRADE;
  if (commandParams.containsKey(COMMAND_PARAM_DIRECTION) && "downgrade".equals(commandParams.get(COMMAND_PARAM_DIRECTION).toLowerCase())) {
    direction=Direction.DOWNGRADE;
  }
  String version=commandParams.get(COMMAND_PARAM_VERSION);
  String upgradePackName=commandParams.get(COMMAND_PARAM_UPGRADE_PACK);
  String clusterName=getExecutionCommand().getClusterName();
  UpgradePack upgradePack=ambariMetaInfo.getUpgradePacks(originalStackId.getStackName(),originalStackId.getStackVersion()).get(upgradePackName);
  return updateDesiredStack(clusterName,originalStackId,targetStackId,version,direction,upgradePack);
}
