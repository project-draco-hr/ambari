@patch('time.sleep')
@patch('subprocess.Popen')
def test_post_rolling_restart_bad_returncode(self, process_mock, time_mock):
    process = MagicMock()
    process.communicate.return_value = ['some']
    process.returncode = 999
    process_mock.return_value = process
    try:
        self.executeScript((self.COMMON_SERVICES_PACKAGE_DIR + '/scripts/datanode.py'), classname='DataNode', command='post_rolling_restart', config_file='default.json', hdp_stack_version=self.STACK_VERSION, target=RMFTestCase.TARGET_COMMON_SERVICES)
        self.fail('Invalid return code should cause a failure')
    except Fail as fail:
        self.assertTrue(process_mock.called)
        self.assertEqual(process_mock.call_count, 12)
