def run(self):
    ' Copy files and run commands on remote hosts '
    ret1 = self.checkSudoPackage()
    logging.info("Checking 'sudo' package finished")
    ret2 = 0
    ret3 = 0
    if self.hasPassword():
        ret2 = self.copyPasswordFile()
        logging.info('Copying password file finished')
        ret3 = self.changePasswordFileModeOnHost()
        logging.info('Change password file mode on host finished')
    ret4 = self.copyNeededFiles()
    logging.info('Copying files finished')
    ret5 = self.runSetupAgent()
    logging.info('Running ssh command finished')
    ret6 = 0
    if (self.hasPassword() and (self.hostlist_to_remove_password_file is not None)):
        ret6 = self.deletePasswordFile()
        logging.info('Deleting password file finished')
    retcode = max(ret1, ret2, ret3, ret4, ret5, ret6)
    self.createDoneFiles()
    return retcode
    pass
