{
  HostEntity hostEntity=createNiceMock(HostEntity.class);
  HostStateEntity hostStateEntity=createNiceMock(HostStateEntity.class);
  HostDAO hostDAO=createNiceMock(HostDAO.class);
  Injector injector=createNiceMock(Injector.class);
  HostStateDAO hostStateDAO=createNiceMock(HostStateDAO.class);
  Gson gson=new Gson();
  expect(injector.getInstance(Gson.class)).andReturn(gson).anyTimes();
  expect(injector.getInstance(HostDAO.class)).andReturn(hostDAO).anyTimes();
  expect(injector.getInstance(HostStateDAO.class)).andReturn(hostStateDAO).anyTimes();
  expect(hostEntity.getHostAttributes()).andReturn("{\"foo\": \"aaa\", \"bar\":\"bbb\"}").anyTimes();
  expect(hostEntity.getHostId()).andReturn(1L).anyTimes();
  expect(hostEntity.getHostName()).andReturn("host1").anyTimes();
  expect(hostEntity.getHostStateEntity()).andReturn(hostStateEntity).anyTimes();
  expect(hostDAO.findById(1L)).andReturn(hostEntity).once();
  expect(hostStateDAO.findByHostId(1L)).andReturn(hostStateEntity).once();
  replay(hostEntity,hostStateEntity,injector,hostDAO);
  HostImpl host=new HostImpl(hostEntity,false,injector);
  Map<String,String> hostAttributes=host.getHostAttributes();
  assertEquals("aaa",hostAttributes.get("foo"));
  assertEquals("bbb",hostAttributes.get("bar"));
  host=new HostImpl(hostEntity,true,injector);
  hostAttributes=host.getHostAttributes();
  assertEquals("aaa",hostAttributes.get("foo"));
  assertEquals("bbb",hostAttributes.get("bar"));
  verify(hostEntity,hostStateEntity,injector,hostDAO);
}
