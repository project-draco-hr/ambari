{
  Result queryResult=getReadHandler().handleRequest(request);
  if (queryResult.getStatus().isErrorState() || queryResult.getResultTree().getChildren().isEmpty()) {
    return queryResult;
  }
  Map<Resource.Type,Set<Map<String,Object>>> mapProperties;
  try {
    mapProperties=buildCreateSet(request,queryResult);
  }
 catch (  IllegalArgumentException e) {
    return createInvalidRequestResult(e.getMessage());
  }
  if (mapProperties.size() != 1) {
    return createInvalidRequestResult(mapProperties.size() == 0 ? "A minimum of one sub-resource must be specified for creation." : "Multiple sub-resource types may not be created in the same request.");
  }
  Map.Entry<Resource.Type,Set<Map<String,Object>>> entry=mapProperties.entrySet().iterator().next();
  ResourceInstance createResource=getResourceFactory().createResource(entry.getKey(),request.getResource().getIds());
  return persist(createResource,entry.getValue());
}
