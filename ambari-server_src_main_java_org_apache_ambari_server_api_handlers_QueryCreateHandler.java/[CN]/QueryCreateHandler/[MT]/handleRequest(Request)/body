{
  ResourceInstance resource=request.getResource();
  Query query=resource.getQuery();
  query.setUserPredicate(request.getQueryPredicate());
  Result queryResult;
  try {
    queryResult=query.execute();
  }
 catch (  AmbariException e) {
    throw new RuntimeException("An exception occurred executing the query portion of the request: " + e,e);
  }
  Resource.Type createType=getCreateType(request.getHttpBody(),resource);
  Set<Map<String,Object>> setProperties=buildCreateSet(request,queryResult,createType);
  ResourceInstance createResource=getResourceFactory().createResource(createType,request.getResource().getIds());
  return super.handleRequest(request.getPersistenceManager(),createResource,setProperties,request.getURI());
}
