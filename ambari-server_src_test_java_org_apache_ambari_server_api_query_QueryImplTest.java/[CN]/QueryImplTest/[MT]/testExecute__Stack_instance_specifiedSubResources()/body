{
  ResourceDefinition resourceDefinition=new StackResourceDefinition();
  Map<Resource.Type,String> mapIds=new HashMap<Resource.Type,String>();
  mapIds.put(Resource.Type.Stack,"HDP");
  QueryImpl instance=new TestQuery(mapIds,resourceDefinition);
  instance.addProperty("versions/*",null);
  instance.addProperty("versions/operating_systems/*",null);
  instance.addProperty("versions/operating_systems/repositories/*",null);
  Result result=instance.execute();
  TreeNode<Resource> tree=result.getResultTree();
  Assert.assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> stackNode=tree.getChild("Stack:1");
  Assert.assertEquals("Stack:1",stackNode.getName());
  Assert.assertEquals(Resource.Type.Stack,stackNode.getObject().getType());
  Assert.assertEquals(1,stackNode.getChildren().size());
  TreeNode<Resource> versionsNode=stackNode.getChild("versions");
  Assert.assertEquals(3,versionsNode.getChildren().size());
  TreeNode<Resource> versionNode=versionsNode.getChild("StackVersion:1");
  Assert.assertEquals("StackVersion:1",versionNode.getName());
  Assert.assertEquals(Resource.Type.StackVersion,versionNode.getObject().getType());
  Assert.assertEquals(6,versionNode.getChildren().size());
  TreeNode<Resource> opSystemsNode=versionNode.getChild("operating_systems");
  Assert.assertEquals(3,opSystemsNode.getChildren().size());
  TreeNode<Resource> opSystemNode=opSystemsNode.getChild("OperatingSystem:1");
  Assert.assertEquals("OperatingSystem:1",opSystemNode.getName());
  Assert.assertEquals(Resource.Type.OperatingSystem,opSystemNode.getObject().getType());
  Assert.assertEquals(1,opSystemNode.getChildren().size());
  TreeNode<Resource> repositoriesNode=opSystemNode.getChild("repositories");
  Assert.assertEquals(2,repositoriesNode.getChildren().size());
  TreeNode<Resource> repositoryNode=repositoriesNode.getChild("Repository:1");
  Assert.assertEquals("Repository:1",repositoryNode.getName());
  Resource repositoryResource=repositoryNode.getObject();
  Assert.assertEquals(Resource.Type.Repository,repositoryResource.getType());
  Assert.assertEquals("repo1",repositoryResource.getPropertyValue("Repositories/repo_id"));
  Assert.assertEquals("centos5",repositoryResource.getPropertyValue("Repositories/os_type"));
  Assert.assertEquals("1.2.1",repositoryResource.getPropertyValue("Repositories/stack_version"));
  Assert.assertEquals("HDP",repositoryResource.getPropertyValue("Repositories/stack_name"));
  TreeNode<Resource> artifactsNode=versionNode.getChild("artifacts");
  Assert.assertEquals(1,artifactsNode.getChildren().size());
  TreeNode<Resource> artifactNode=artifactsNode.getChild("StackArtifact:1");
  Assert.assertEquals("StackArtifact:1",artifactNode.getName());
  Assert.assertEquals(Resource.Type.StackArtifact,artifactNode.getObject().getType());
}
