{
  RequestBodyParser parser=new JsonRequestBodyParser();
  String queryBody="{ \"RequestInfo\" : { \"query\" : \"foo=bar\" }, \"Body\":" + queryPostJson + "}";
  RequestBody body=parser.parse(queryBody);
  Set<NamedPropertySet> setProperties=body.getPropertySets();
  assertEquals("foo=bar",body.getQueryString());
  assertEquals(3,setProperties.size());
  boolean contains1=false;
  boolean contains2=false;
  boolean contains3=false;
  for (  NamedPropertySet ps : setProperties) {
    assertEquals("services",ps.getName());
    Map<String,Object> mapProps=ps.getProperties();
    String serviceName=(String)mapProps.get("ServiceInfo/service_name");
    if (serviceName.equals("unitTestService1")) {
      assertEquals(1,mapProps.size());
      contains1=true;
    }
 else     if (serviceName.equals("unitTestService2")) {
      assertEquals("prop1Value",mapProps.get("ServiceInfo/property1"));
      assertEquals(2,mapProps.size());
      contains2=true;
    }
 else     if (serviceName.equals("unitTestService3")) {
      assertEquals("prop2Value",mapProps.get("ServiceInfo/Category/property2"));
      assertEquals(2,mapProps.size());
      contains3=true;
    }
 else {
      fail("Unexpected service name");
    }
  }
  assertTrue(contains1);
  assertTrue(contains2);
  assertTrue(contains3);
  String b=body.getBody();
  assertEquals("{\"services\":[{\"ServiceInfo\":{" + "\"service_name\":\"unitTestService1\"}},{\"ServiceInfo\":{" + "\"service_name\":\"unitTestService2\",\"property1\":\"prop1Value\"}},{\"ServiceInfo\":{"+ "\"service_name\":\"unitTestService3\",\"Category\":{\"property2\":\"prop2Value\"}}}]}",b);
  body=parser.parse(b);
  Set<NamedPropertySet> setProps2=body.getPropertySets();
  assertEquals(3,setProps2.size());
  assertEquals(setProperties,setProps2);
}
