{
  RequestBodyParser parser=new JsonRequestBodyParser();
  String queryBody="{ \"RequestInfo\" : { \"query\" : \"foo=bar\" }, \"Body\":" + serviceJson + "}";
  RequestBody body=parser.parse(queryBody);
  Set<NamedPropertySet> setProps=body.getPropertySets();
  assertEquals(1,setProps.size());
  Map<String,Object> mapExpected=new HashMap<String,Object>();
  mapExpected.put(PropertyHelper.getPropertyId("Services","service_name"),"HDFS");
  mapExpected.put(PropertyHelper.getPropertyId("Services","display_name"),"HDFS");
  mapExpected.put(PropertyHelper.getPropertyId("ServiceInfo","cluster_name"),"tbmetrictest");
  mapExpected.put(PropertyHelper.getPropertyId("Services","description"),"Apache Hadoop Distributed File System");
  mapExpected.put(PropertyHelper.getPropertyId("ServiceInfo","state"),"STARTED");
  mapExpected.put(PropertyHelper.getPropertyId("OuterCategory","propName"),"100");
  mapExpected.put(PropertyHelper.getPropertyId("OuterCategory/nested1/nested2","innerPropName"),"innerPropValue");
  mapExpected.put(PropertyHelper.getPropertyId(null,"topLevelProp"),"value");
  assertEquals(mapExpected,setProps.iterator().next().getProperties());
  assertEquals("foo=bar",body.getQueryString());
  String b=body.getBody();
  body=parser.parse(b);
  Set<NamedPropertySet> setProps2=body.getPropertySets();
  assertEquals(mapExpected,setProps2.iterator().next().getProperties());
}
