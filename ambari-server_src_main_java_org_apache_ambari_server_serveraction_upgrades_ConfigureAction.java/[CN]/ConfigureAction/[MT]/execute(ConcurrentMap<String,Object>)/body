{
  Map<String,String> commandParameters=getCommandParameters();
  if (null == commandParameters || commandParameters.isEmpty()) {
    return createCommandReport(0,HostRoleStatus.FAILED,"{}","","Unable to change configuration values without command parameters");
  }
  String clusterName=commandParameters.get("clusterName");
  String key=commandParameters.get(ConfigureTask.PARAMETER_KEY);
  String value=commandParameters.get(ConfigureTask.PARAMETER_VALUE);
  String configType=commandParameters.get(ConfigureTask.PARAMETER_CONFIG_TYPE);
  if (null == configType && null == key) {
    return createCommandReport(0,HostRoleStatus.COMPLETED,"{}","","Skipping configuration task");
  }
  if (null == clusterName || null == configType || null == key) {
    String message="cluster={0}, type={1}, key={2}";
    message=MessageFormat.format(message,clusterName,configType,key);
    return createCommandReport(0,HostRoleStatus.FAILED,"{}","",message);
  }
  Cluster cluster=m_clusters.getCluster(clusterName);
  Map<String,DesiredConfig> desiredConfigs=cluster.getDesiredConfigs();
  DesiredConfig desiredConfig=desiredConfigs.get(configType);
  Config config=cluster.getConfig(configType,desiredConfig.getTag());
  StackId currentStack=cluster.getCurrentStackVersion();
  StackId targetStack=cluster.getDesiredStackVersion();
  StackId configStack=config.getStackId();
  String oldValue=config.getProperties().get(key);
  if (null != oldValue && value.equals(oldValue)) {
    if (currentStack.equals(targetStack)) {
      return createCommandReport(0,HostRoleStatus.COMPLETED,"{}",MessageFormat.format("{0}/{1} for cluster {2} would not change, skipping setting",configType,key,clusterName),"");
    }
  }
  Map<String,String> propertiesToChange=new HashMap<String,String>();
  propertiesToChange.put(key,value);
  config.updateProperties(propertiesToChange);
  if (!targetStack.equals(currentStack) && targetStack.equals(configStack)) {
    config.persist(false);
    return createCommandReport(0,HostRoleStatus.COMPLETED,"{}",MessageFormat.format("Updated ''{0}'' with ''{1}={2}''",configType,key,value),"");
  }
  String serviceVersionNote="Stack Upgrade";
  String auditName=getExecutionCommand().getRoleParams().get(ServerAction.ACTION_USER_NAME);
  if (auditName == null) {
    auditName=configuration.getAnonymousAuditName();
  }
  m_configHelper.createConfigType(cluster,m_controller,configType,config.getProperties(),auditName,serviceVersionNote);
  String message="Updated ''{0}'' with ''{1}={2}''";
  message=MessageFormat.format(message,configType,key,value);
  return createCommandReport(0,HostRoleStatus.COMPLETED,"{}",message,"");
}
