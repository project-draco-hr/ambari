{
  ActionMetadata actionMetadata=createNiceMock(ActionMetadata.class);
  OsFamily osFamily=createNiceMock(OsFamily.class);
  replay(actionMetadata);
  try {
    String stacksCycle1="./src/test/resources/stacks_with_cycle/";
    if (System.getProperty("os.name").contains("Windows")) {
      stacksCycle1=ClassLoader.getSystemClassLoader().getResource("stacks_with_cycle").getPath();
    }
    new StackManager(new File(stacksCycle1),new StackContext(null,actionMetadata,osFamily));
    fail("Expected exception due to cyclic stack");
  }
 catch (  AmbariException e) {
    assertEquals("Cycle detected while parsing stack definition",e.getMessage());
  }
  try {
    String stacksCycle2="./src/test/resources/stacks_with_cycle2/";
    if (System.getProperty("os.name").contains("Windows")) {
      stacksCycle2=ClassLoader.getSystemClassLoader().getResource("stacks_with_cycle2").getPath();
    }
    new StackManager(new File(stacksCycle2),new StackContext(null,actionMetadata,osFamily));
    fail("Expected exception due to cyclic stack");
  }
 catch (  AmbariException e) {
    assertEquals("Cycle detected while parsing stack definition",e.getMessage());
  }
}
