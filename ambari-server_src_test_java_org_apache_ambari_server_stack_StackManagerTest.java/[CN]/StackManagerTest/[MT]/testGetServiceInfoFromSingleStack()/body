{
  dao=createNiceMock(MetainfoDAO.class);
  actionMetadata=createNiceMock(ActionMetadata.class);
  osFamily=createNiceMock(OsFamily.class);
  actionMetadata.addServiceCheckAction("HDFS");
  replay(dao,actionMetadata,osFamily);
  String singleStack="./src/test/resources/single_stack";
  if (System.getProperty("os.name").contains("Windows")) {
    singleStack=ClassLoader.getSystemClassLoader().getResource("single_stack").getPath();
  }
  StackManager stackManager=new StackManager(new File(singleStack.replace("/",File.separator)),new StackContext(dao,actionMetadata,osFamily));
  Collection<StackInfo> stacks=stackManager.getStacks();
  assertEquals(1,stacks.size());
  assertNotNull(stacks.iterator().next().getService("HDFS"));
  verify(dao,actionMetadata,osFamily);
}
