{
  try {
    dao=createNiceMock(MetainfoDAO.class);
    actionMetadata=createNiceMock(ActionMetadata.class);
    Configuration config=createNiceMock(Configuration.class);
    expect(config.getSharedResourcesDirPath()).andReturn(ClassLoader.getSystemClassLoader().getResource("").getPath()).anyTimes();
    replay(config);
    osFamily=new OsFamily(config);
    replay(dao,actionMetadata);
    StackManager stackManager=new StackManager(new File(stackRoot),null,new StackContext(dao,actionMetadata,osFamily));
    return stackManager;
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
