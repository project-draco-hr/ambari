{
  metaInfoDao=createNiceMock(MetainfoDAO.class);
  stackDao=createNiceMock(StackDAO.class);
  actionMetadata=createNiceMock(ActionMetadata.class);
  Configuration config=createNiceMock(Configuration.class);
  expect(config.getSharedResourcesDirPath()).andReturn(ClassLoader.getSystemClassLoader().getResource("").getPath()).anyTimes();
  replay(config,metaInfoDao,stackDao,actionMetadata);
  osFamily=new OsFamily(config);
  StackManager stackManager=new StackManager(new File(stackRoot),null,osFamily,metaInfoDao,actionMetadata,stackDao);
  verify(config,metaInfoDao,stackDao,actionMetadata);
  return stackManager;
}
