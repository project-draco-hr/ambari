{
  try {
    dao=createNiceMock(MetainfoDAO.class);
    actionMetadata=createNiceMock(ActionMetadata.class);
    Configuration config=createNiceMock(Configuration.class);
    if (System.getProperty("os.name").contains("Windows")) {
      expect(config.getSharedResourcesDirPath()).andReturn(ClassLoader.getSystemClassLoader().getResource("").getPath()).anyTimes();
    }
 else {
      expect(config.getSharedResourcesDirPath()).andReturn("./src/test/resources").anyTimes();
    }
    replay(config);
    osFamily=new OsFamily(config);
    replay(dao,actionMetadata);
    return new StackManager(new File(stackRoot),new StackContext(dao,actionMetadata,osFamily));
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
}
