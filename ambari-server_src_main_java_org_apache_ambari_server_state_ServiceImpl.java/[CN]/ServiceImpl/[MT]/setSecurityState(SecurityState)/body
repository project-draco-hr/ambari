{
  if (!securityState.isEndpoint())   throw new AmbariException("The security state must be an endpoint state");
  clusterGlobalLock.readLock().lock();
  try {
    readWriteLock.writeLock().lock();
    try {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Setting DesiredSecurityState of Service" + ", clusterName=" + cluster.getClusterName() + ", clusterId="+ cluster.getClusterId()+ ", serviceName="+ getName()+ ", oldDesiredSecurityState="+ getSecurityState()+ ", newDesiredSecurityState="+ securityState);
      }
      serviceDesiredStateEntity.setSecurityState(securityState);
      saveIfPersisted();
    }
  finally {
      readWriteLock.writeLock().unlock();
    }
  }
  finally {
    clusterGlobalLock.readLock().unlock();
  }
}
