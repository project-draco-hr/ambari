{
  clusterGlobalLock.readLock().lock();
  try {
    readWriteLock.readLock().lock();
    try {
      Map<String,Config> map=new HashMap<String,Config>();
      for (      Entry<String,String> entry : desiredConfigs.entrySet()) {
        Config config=cluster.getConfig(entry.getKey(),entry.getValue());
        if (null != config) {
          map.put(entry.getKey(),config);
        }
 else {
          throw new RuntimeException("Found an invalid config" + ", clusterName=" + getCluster().getClusterName() + ", serviceName="+ getName()+ ", configType="+ entry.getKey()+ ", configVersionTag="+ entry.getValue());
        }
      }
      return Collections.unmodifiableMap(map);
    }
  finally {
      readWriteLock.readLock().unlock();
    }
  }
  finally {
    clusterGlobalLock.readLock().unlock();
  }
}
