@patch('time.time')
@patch.object(utils, 'pid_exists')
@patch('time.sleep')
@patch('ambari_server.serverConfiguration.get_ambari_properties')
@patch('socket.socket')
@patch('__builtin__.open')
def test_wait_for_pid(self, open_mock, socket_mock, get_properties_mock, sleep_mock, pid_exists_mock, time_mock):
    pid_exists_mock.return_value = True
    time_mock.side_effect = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 51]
    s = socket_mock.return_value
    s.connect = MagicMock()
    out = StringIO.StringIO()
    sys.stdout = out
    live_pids = utils.wait_for_pid([{'pid': '111', 'exe': '', 'cmd': '', }, {'pid': '222', 'exe': '', 'cmd': '', }], 5, 40, 10, '', '', get_properties_mock)
    self.assertEqual('.\nServer started listening on 8080\n\nDB consistency check: no errors were found.\nWaiting for 10 seconds, for server WEB UI initialization\n........', out.getvalue())
    sys.stdout = sys.__stdout__
    self.assertEquals(2, live_pids)
