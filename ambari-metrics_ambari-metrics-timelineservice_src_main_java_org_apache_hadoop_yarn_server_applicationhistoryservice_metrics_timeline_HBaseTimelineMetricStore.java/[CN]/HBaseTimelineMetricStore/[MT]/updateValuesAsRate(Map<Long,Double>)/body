{
  Long prevTime=null;
  Double prevVal=null;
  long step;
  Double diff;
  for (  Map.Entry<Long,Double> timeValueEntry : metricValues.entrySet()) {
    Long currTime=timeValueEntry.getKey();
    Double currVal=timeValueEntry.getValue();
    if (prevTime != null) {
      step=currTime - prevTime;
      diff=currVal - prevVal;
      Double rate=diff / TimeUnit.MILLISECONDS.toSeconds(step);
      timeValueEntry.setValue(rate);
    }
 else {
      timeValueEntry.setValue(0.0);
    }
    prevTime=currTime;
    prevVal=currVal;
  }
  return metricValues;
}
