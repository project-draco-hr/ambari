{
  if (!isInitialized) {
    hBaseAccessor=new PhoenixHBaseAccessor(hbaseConf,metricsConf);
    hBaseAccessor.initMetricSchema();
    metricMetadataManager=new TimelineMetricMetadataManager(hBaseAccessor,metricsConf);
    metricMetadataManager.initializeMetadata();
    hBaseAccessor.initPoliciesAndTTL();
    if (Boolean.parseBoolean(metricsConf.get(USE_GROUPBY_AGGREGATOR_QUERIES,"true"))) {
      LOG.info("Using group by aggregators for aggregating host and cluster metrics.");
    }
    TimelineMetricAggregator secondClusterAggregator=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hBaseAccessor,metricsConf,metricMetadataManager);
    scheduleAggregatorThread(secondClusterAggregator);
    TimelineMetricAggregator minuteClusterAggregator=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorMinute(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(minuteClusterAggregator);
    TimelineMetricAggregator hourlyClusterAggregator=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(hourlyClusterAggregator);
    TimelineMetricAggregator dailyClusterAggregator=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorDaily(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(dailyClusterAggregator);
    TimelineMetricAggregator minuteHostAggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorMinute(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(minuteHostAggregator);
    TimelineMetricAggregator hourlyHostAggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorHourly(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(hourlyHostAggregator);
    TimelineMetricAggregator dailyHostAggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorDaily(hBaseAccessor,metricsConf);
    scheduleAggregatorThread(dailyHostAggregator);
    if (!configuration.isTimelineMetricsServiceWatcherDisabled()) {
      int initDelay=configuration.getTimelineMetricsServiceWatcherInitDelay();
      int delay=configuration.getTimelineMetricsServiceWatcherDelay();
      executorService.scheduleWithFixedDelay(new TimelineMetricStoreWatcher(this,configuration),initDelay,delay,TimeUnit.SECONDS);
      LOG.info("Started watchdog for timeline metrics store with initial " + "delay = " + initDelay + ", delay = "+ delay);
    }
    isInitialized=true;
  }
}
