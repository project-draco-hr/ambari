{
  if (metricNames == null || metricNames.isEmpty()) {
    throw new IllegalArgumentException("No metric name filter specified.");
  }
  if (applicationId == null || applicationId.trim().length() == 0) {
    throw new IllegalArgumentException("No applicationID filter specified.");
  }
  if ((startTime == null && endTime != null) || (startTime != null && endTime == null)) {
    throw new IllegalArgumentException("Open ended query not supported ");
  }
  if (limit != null && limit > PhoenixHBaseAccessor.RESULTSET_LIMIT) {
    throw new IllegalArgumentException("Limit too big");
  }
  Map<String,List<Function>> metricFunctions=parseMetricNamesToAggregationFunctions(metricNames);
  Condition condition=new DefaultCondition(new ArrayList<String>(metricFunctions.keySet()),hostname,applicationId,instanceId,startTime,endTime,precision,limit,groupedByHosts);
  if (hostname == null) {
    TimelineMetrics metrics=hBaseAccessor.getAggregateMetricRecords(condition,metricFunctions);
    return postProcessMetrics(metrics);
  }
  return postProcessMetrics(hBaseAccessor.getMetricRecords(condition,metricFunctions));
}
