{
  if (metricNames == null || metricNames.isEmpty()) {
    throw new IllegalArgumentException("No metric name filter specified.");
  }
  if ((startTime == null && endTime != null) || (startTime != null && endTime == null)) {
    throw new IllegalArgumentException("Open ended query not supported ");
  }
  if (limit != null && limit > PhoenixHBaseAccessor.RESULTSET_LIMIT) {
    throw new IllegalArgumentException("Limit too big");
  }
  Map<String,List<Function>> metricFunctions=parseMetricNamesToAggregationFunctions(metricNames);
  Condition condition=new DefaultCondition(new ArrayList<String>(metricFunctions.keySet()),hostnames,applicationId,instanceId,startTime,endTime,precision,limit,groupedByHosts);
  TimelineMetrics metrics;
  if (hostnames == null || hostnames.isEmpty()) {
    metrics=hBaseAccessor.getAggregateMetricRecords(condition,metricFunctions);
  }
 else {
    metrics=hBaseAccessor.getMetricRecords(condition,metricFunctions);
  }
  return postProcessMetrics(metrics);
}
