{
  try {
    String stackName=(String)getRequestProperty(request,STACK_NAME_PROPERTY_ID);
    String stackVersion=(String)getRequestProperty(request,STACK_VERSION_PROPERTY_ID);
    List<String> hosts=(List<String>)getRequestProperty(request,HOST_PROPERTY);
    List<String> services=(List<String>)getRequestProperty(request,SERVICES_PROPERTY);
    Map<String,Set<String>> componentHostsMap=calculateComponentHostsMap(request);
    StackAdvisorRequest saRequest=StackAdvisorRequestBuilder.forStack(stackName,stackVersion).forHosts(hosts).forServices(services).withComponentHostsMap(componentHostsMap).build();
    return saRequest;
  }
 catch (  Exception e) {
    LOG.warn("Error occured during preparation of stack advisor request",e);
    Response response=Response.status(Status.BAD_REQUEST).entity("Request body is not correct").build();
    throw new WebApplicationException(response);
  }
}
