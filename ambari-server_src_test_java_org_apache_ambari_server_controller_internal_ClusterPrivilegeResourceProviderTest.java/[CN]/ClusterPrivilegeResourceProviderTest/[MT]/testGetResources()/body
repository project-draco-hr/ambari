{
  List<PrivilegeEntity> privilegeEntities=new LinkedList<PrivilegeEntity>();
  PrivilegeEntity privilegeEntity=createNiceMock(PrivilegeEntity.class);
  ClusterEntity clusterEntity=createNiceMock(ClusterEntity.class);
  ResourceEntity resourceEntity=createNiceMock(ResourceEntity.class);
  UserEntity userEntity=createNiceMock(UserEntity.class);
  PrincipalEntity principalEntity=createNiceMock(PrincipalEntity.class);
  PrincipalTypeEntity principalTypeEntity=createNiceMock(PrincipalTypeEntity.class);
  PermissionEntity permissionEntity=createNiceMock(PermissionEntity.class);
  List<PrincipalEntity> principalEntities=new LinkedList<PrincipalEntity>();
  principalEntities.add(principalEntity);
  List<UserEntity> userEntities=new LinkedList<UserEntity>();
  userEntities.add(userEntity);
  privilegeEntities.add(privilegeEntity);
  expect(privilegeDAO.findAll()).andReturn(privilegeEntities);
  expect(privilegeEntity.getResource()).andReturn(resourceEntity).anyTimes();
  expect(privilegeEntity.getPrincipal()).andReturn(principalEntity).anyTimes();
  expect(privilegeEntity.getPermission()).andReturn(permissionEntity).anyTimes();
  expect(resourceEntity.getId()).andReturn(20L).anyTimes();
  expect(principalEntity.getId()).andReturn(20L).anyTimes();
  expect(userEntity.getPrincipal()).andReturn(principalEntity).anyTimes();
  expect(userEntity.getUserName()).andReturn("joe").anyTimes();
  expect(permissionEntity.getPermissionName()).andReturn("CLUSTER.ADMINISTRATOR").anyTimes();
  expect(principalEntity.getPrincipalType()).andReturn(principalTypeEntity).anyTimes();
  expect(principalTypeEntity.getName()).andReturn("USER").anyTimes();
  expect(clusterEntity.getResource()).andReturn(resourceEntity);
  List<ClusterEntity> clusterEntities=new LinkedList<ClusterEntity>();
  clusterEntities.add(clusterEntity);
  expect(clusterDAO.findAll()).andReturn(clusterEntities);
  expect(userDAO.findUsersByPrincipal(principalEntities)).andReturn(userEntities);
  expect(groupDAO.findGroupsByPrincipal(principalEntities)).andReturn(Collections.<GroupEntity>emptyList());
  expect(permissionDAO.findById(2)).andReturn(permissionEntity);
  expect(permissionDAO.findById(3)).andReturn(permissionEntity);
  replay(privilegeDAO,userDAO,groupDAO,principalDAO,permissionDAO,resourceDAO,clusterDAO,privilegeEntity,clusterEntity,resourceEntity,userEntity,principalEntity,permissionEntity,principalTypeEntity);
  PrivilegeResourceProvider provider=new ClusterPrivilegeResourceProvider();
  Set<Resource> resources=provider.getResources(PropertyHelper.getReadRequest(),null);
  Assert.assertEquals(1,resources.size());
  Resource resource=resources.iterator().next();
  Assert.assertEquals("CLUSTER.ADMINISTRATOR",resource.getPropertyValue(AmbariPrivilegeResourceProvider.PERMISSION_NAME_PROPERTY_ID));
  Assert.assertEquals("joe",resource.getPropertyValue(AmbariPrivilegeResourceProvider.PRINCIPAL_NAME_PROPERTY_ID));
  Assert.assertEquals("USER",resource.getPropertyValue(AmbariPrivilegeResourceProvider.PRINCIPAL_TYPE_PROPERTY_ID));
  verify(privilegeDAO,userDAO,groupDAO,principalDAO,permissionDAO,resourceDAO,clusterDAO,privilegeEntity,resourceEntity,clusterEntity,userEntity,principalEntity,permissionEntity,principalTypeEntity);
  reset(privilegeDAO,userDAO,groupDAO,principalDAO,permissionDAO,resourceDAO,clusterDAO);
}
