@patch.object(resource_management.core.Environment, 'backup_file')
@patch('resource_management.core.providers.system._ensure_metadata')
@patch('__builtin__.open')
@patch.object(os.path, 'exists')
@patch.object(os.path, 'isdir')
def test_attribute_backup(self, isdir_mock, exists_mock, open_mock, ensure_mock, backup_file_mock):
    "\n    Tests 'backup' attribute\n    "
    isdir_mock.side_effect = [False, True, False, True]
    open_mock.return_value = MagicMock()
    exists_mock.return_value = True
    with Environment('/') as env:
        File('/directory/file', action='create', mode=511, backup=False, content='new-content')
    self.assertEqual(backup_file_mock.call_count, 0)
    with Environment('/') as env:
        File('/directory/file', action='create', mode=511, backup=True, content='new-content')
    self.assertEqual(backup_file_mock.call_count, 1)
    backup_file_mock.assert_called_with('/directory/file')
