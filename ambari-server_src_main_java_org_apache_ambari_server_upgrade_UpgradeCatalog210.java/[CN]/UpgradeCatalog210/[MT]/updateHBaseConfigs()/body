{
  AmbariManagementController ambariManagementController=injector.getInstance(AmbariManagementController.class);
  Clusters clusters=ambariManagementController.getClusters();
  if (clusters != null) {
    Map<String,Cluster> clusterMap=clusters.getClusters();
    if (clusterMap != null && !clusterMap.isEmpty()) {
      for (      final Cluster cluster : clusterMap.values()) {
        if (cluster.getDesiredConfigByType("hbase-site") != null) {
          Map<String,String> hbaseEnvProps=new HashMap<String,String>();
          Map<String,String> hbaseSiteProps=cluster.getDesiredConfigByType("hbase-site").getProperties();
          if (hbaseSiteProps.containsKey("hbase.region.server.rpc.scheduler.factory.class") && "org.apache.phoenix.hbase.index.ipc.PhoenixIndexRpcSchedulerFactory".equals(hbaseSiteProps.get("hbase.region.server.rpc.scheduler.factory.class"))) {
            hbaseEnvProps.put("phoenix_sql_enabled","true");
          }
          updateConfigurationPropertiesForCluster(cluster,"hbase-env",hbaseEnvProps,true,false);
        }
      }
    }
  }
}
