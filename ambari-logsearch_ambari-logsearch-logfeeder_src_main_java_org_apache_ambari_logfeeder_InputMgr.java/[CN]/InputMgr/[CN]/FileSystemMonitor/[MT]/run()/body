{
  try {
    WatchKey key=folderWatcher.take();
    while (key != null) {
      Path dir=(Path)key.watchable();
      for (      WatchEvent<?> event : key.pollEvents()) {
        if (!event.kind().equals(ENTRY_CREATE)) {
          logger.info("Ignoring event.kind=" + event.kind());
          continue;
        }
        logger.info("Received " + event.kind() + " event for file "+ event.context());
        File newFile=new File(dir.toFile(),event.context().toString());
        Input rolledOverInput=filesToMonitor.get(newFile.getAbsolutePath());
        if (rolledOverInput == null) {
          logger.info("Input not found for file " + newFile);
        }
 else {
          rolledOverInput.rollOver();
        }
      }
      if (!key.reset()) {
        logger.error("Error while key.reset(). Will have to abort watching files. Rollover will not work.");
        break;
      }
      key=folderWatcher.take();
    }
  }
 catch (  InterruptedException e) {
    logger.info("Stop request for thread");
  }
  logger.info("Exiting FileSystemMonitor thread.");
}
