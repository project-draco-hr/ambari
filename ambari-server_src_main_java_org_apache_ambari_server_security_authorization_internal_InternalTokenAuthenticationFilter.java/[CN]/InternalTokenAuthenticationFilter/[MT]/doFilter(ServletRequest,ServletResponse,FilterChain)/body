{
  HttpServletRequest httpRequest=(HttpServletRequest)request;
  HttpServletResponse httpResponse=(HttpServletResponse)response;
  SecurityContext context=SecurityContextHolder.getContext();
  if (context.getAuthentication() == null || !context.getAuthentication().isAuthenticated()) {
    String token=httpRequest.getHeader(INTERNAL_TOKEN_HEADER);
    if (token != null) {
      context.setAuthentication(new InternalAuthenticationToken(token));
    }
  }
  chain.doFilter(request,response);
}
