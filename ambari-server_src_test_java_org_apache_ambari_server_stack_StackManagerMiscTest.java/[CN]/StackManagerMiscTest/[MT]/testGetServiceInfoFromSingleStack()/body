{
  MetainfoDAO dao=createNiceMock(MetainfoDAO.class);
  ActionMetadata actionMetadata=createNiceMock(ActionMetadata.class);
  OsFamily osFamily=createNiceMock(OsFamily.class);
  actionMetadata.addServiceCheckAction("HDFS");
  replay(dao,actionMetadata,osFamily);
  String singleStack=ClassLoader.getSystemClassLoader().getResource("single_stack").getPath();
  StackManager stackManager=new StackManager(new File(singleStack.replace(StackManager.PATH_DELIMITER,File.separator)),null,new StackContext(dao,actionMetadata,osFamily));
  Collection<StackInfo> stacks=stackManager.getStacks();
  assertEquals(1,stacks.size());
  assertNotNull(stacks.iterator().next().getService("HDFS"));
  verify(dao,actionMetadata,osFamily);
}
