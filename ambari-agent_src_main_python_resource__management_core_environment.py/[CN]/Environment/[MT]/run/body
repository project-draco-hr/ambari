def run(self):
    with self:
        while self.resource_list:
            resource = self.resource_list.pop(0)
            self.log.debug(('Running resource %r' % resource))
            if resource.initial_wait:
                time.sleep(resource.initial_wait)
            if ((resource.not_if is not None) and self._check_condition(resource.not_if)):
                self.log.debug(('Skipping %s due to not_if' % resource))
                continue
            if ((resource.only_if is not None) and (not self._check_condition(resource.only_if))):
                self.log.debug(('Skipping %s due to only_if' % resource))
                continue
            for action in resource.action:
                if (not resource.ignore_failures):
                    self.run_action(resource, action)
                else:
                    try:
                        self.run_action(resource, action)
                    except Exception:
                        pass
        while self.delayed_actions:
            (action, resource) = self.delayed_actions.pop()
            self.run_action(resource, action)
