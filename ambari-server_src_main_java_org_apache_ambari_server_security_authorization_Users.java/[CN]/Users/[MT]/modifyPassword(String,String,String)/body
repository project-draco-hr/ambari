{
  UserEntity userEntity=userDAO.findLocalUserByName(userName);
  if (userEntity != null) {
    if (passwordEncoder.matches(oldPassword,userEntity.getUserPassword())) {
      userEntity.setUserPassword(passwordEncoder.encode(newPassword));
      userDAO.merge(userEntity);
    }
 else {
      throw new AmbariException("Wrong password provided");
    }
  }
 else {
    userEntity=userDAO.findLdapUserByName(userName);
    if (userEntity != null) {
      throw new AmbariException("Password of LDAP user cannot be modified");
    }
 else {
      throw new AmbariException("User " + userName + " not found");
    }
  }
}
