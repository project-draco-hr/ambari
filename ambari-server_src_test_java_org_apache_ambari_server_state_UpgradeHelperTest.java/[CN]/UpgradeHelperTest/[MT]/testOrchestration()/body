{
  Map<String,UpgradePack> upgrades=ambariMetaInfo.getUpgradePacks("foo","bar");
  assertTrue(upgrades.isEmpty());
  upgrades=ambariMetaInfo.getUpgradePacks("HDP","2.1.1");
  assertTrue(upgrades.containsKey("upgrade_test"));
  UpgradePack upgrade=upgrades.get("upgrade_test");
  assertNotNull(upgrade);
  Cluster cluster=makeCluster();
  UpgradeHelper helper=new UpgradeHelper();
  List<UpgradeGroupHolder> groups=helper.createUpgrade(cluster,upgrade);
  assertEquals(5,groups.size());
  assertEquals("PRE_CLUSTER",groups.get(0).name);
  assertEquals("ZOOKEEPER",groups.get(1).name);
  assertEquals("CORE_MASTER",groups.get(2).name);
  assertEquals("CORE_SLAVES",groups.get(3).name);
  assertEquals("POST_CLUSTER",groups.get(4).name);
  assertEquals(6,groups.get(1).items.size());
  assertEquals(2,groups.get(2).items.size());
  assertEquals(6,groups.get(3).items.size());
}
