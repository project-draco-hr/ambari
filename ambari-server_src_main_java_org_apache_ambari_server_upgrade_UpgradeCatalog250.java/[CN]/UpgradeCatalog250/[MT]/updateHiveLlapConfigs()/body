{
  AmbariManagementController ambariManagementController=injector.getInstance(AmbariManagementController.class);
  Clusters clusters=ambariManagementController.getClusters();
  if (clusters != null) {
    Map<String,Cluster> clusterMap=clusters.getClusters();
    if (clusterMap != null && !clusterMap.isEmpty()) {
      for (      final Cluster cluster : clusterMap.values()) {
        Set<String> installedServices=cluster.getServices().keySet();
        if (installedServices.contains("HIVE")) {
          Config hiveSite=cluster.getDesiredConfigByType("hive-interactive-site");
          if (hiveSite != null) {
            Map<String,String> hiveSiteProperties=hiveSite.getProperties();
            String schedulerDelay=hiveSiteProperties.get("hive.llap.task.scheduler.locality.delay");
            if (schedulerDelay != null) {
              if (schedulerDelay.length() != 0) {
                try {
                  int schedulerDelayInt=Integer.parseInt(schedulerDelay);
                  if (schedulerDelayInt == -1) {
                    updateConfigurationProperties("hive-interactive-site",Collections.singletonMap("hive.llap.task.scheduler.locality.delay","8000"),true,false);
                  }
                }
 catch (                NumberFormatException e) {
                  updateConfigurationProperties("hive-interactive-site",Collections.singletonMap("hive.llap.task.scheduler.locality.delay","8000"),true,false);
                }
              }
            }
            updateConfigurationProperties("hive-interactive-site",Collections.singletonMap("hive.mapjoin.hybridgrace.hashtable","true"),true,false);
          }
        }
      }
    }
  }
}
