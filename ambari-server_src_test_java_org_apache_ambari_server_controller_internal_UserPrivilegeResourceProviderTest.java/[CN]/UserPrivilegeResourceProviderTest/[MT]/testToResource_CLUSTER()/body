{
  PermissionEntity permissionEntity=createMock(PermissionEntity.class);
  expect(permissionEntity.getPermissionName()).andReturn("CLUSTER.ADMINISTRATOR").atLeastOnce();
  expect(permissionEntity.getPermissionLabel()).andReturn("Cluster Administrator").atLeastOnce();
  PrincipalTypeEntity principalTypeEntity=createMock(PrincipalTypeEntity.class);
  expect(principalTypeEntity.getName()).andReturn("USER").atLeastOnce();
  PrincipalEntity principalEntity=createMock(PrincipalEntity.class);
  expect(principalEntity.getPrincipalType()).andReturn(principalTypeEntity).atLeastOnce();
  ClusterEntity clusterEntity=createMock(ClusterEntity.class);
  expect(clusterEntity.getClusterName()).andReturn("TestCluster").atLeastOnce();
  ResourceTypeEntity resourceTypeEntity=createMock(ResourceTypeEntity.class);
  expect(resourceTypeEntity.getName()).andReturn("CLUSTER").atLeastOnce();
  ResourceEntity resourceEntity=createMock(ResourceEntity.class);
  expect(resourceEntity.getId()).andReturn(1L).atLeastOnce();
  expect(resourceEntity.getResourceType()).andReturn(resourceTypeEntity).atLeastOnce();
  PrivilegeEntity privilegeEntity=createMock(PrivilegeEntity.class);
  expect(privilegeEntity.getId()).andReturn(1).atLeastOnce();
  expect(privilegeEntity.getPermission()).andReturn(permissionEntity).atLeastOnce();
  expect(privilegeEntity.getPrincipal()).andReturn(principalEntity).atLeastOnce();
  expect(privilegeEntity.getResource()).andReturn(resourceEntity).atLeastOnce();
  UserEntity userEntity=createMock(UserEntity.class);
  expect(userEntity.getUserName()).andReturn("jdoe").atLeastOnce();
  ClusterDAO clusterDAO=createMock(ClusterDAO.class);
  expect(clusterDAO.findByResourceId(1L)).andReturn(clusterEntity).atLeastOnce();
  GroupDAO groupDAO=createMock(GroupDAO.class);
  ViewInstanceDAO viewInstanceDAO=createMock(ViewInstanceDAO.class);
  UserDAO userDAO=createMock(UserDAO.class);
  expect(userDAO.findUserByPrincipal(anyObject(PrincipalEntity.class))).andReturn(userEntity).anyTimes();
  PrivilegeDAO privilegeDAO=createNiceMock(PrivilegeDAO.class);
  replayAll();
  UserPrivilegeResourceProvider.init(userDAO,clusterDAO,groupDAO,viewInstanceDAO,privilegeDAO);
  UserPrivilegeResourceProvider provider=new UserPrivilegeResourceProvider();
  Resource resource=provider.toResource(privilegeEntity,"jdoe",provider.getPropertyIds());
  Assert.assertEquals("TestCluster",resource.getPropertyValue(ClusterPrivilegeResourceProvider.PRIVILEGE_CLUSTER_NAME_PROPERTY_ID));
  Assert.assertEquals(ResourceType.CLUSTER.name(),resource.getPropertyValue(UserPrivilegeResourceProvider.PRIVILEGE_TYPE_PROPERTY_ID));
  verifyAll();
}
