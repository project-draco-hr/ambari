{
  UpgradeCatalog200 upgradeCatalog200=injector.getInstance(UpgradeCatalog200.class);
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  ClusterServiceDAO clusterServiceDao=injector.getInstance(ClusterServiceDAO.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  injector.getInstance(AmbariMetaInfo.class);
  StackEntity stackEntity=stackDAO.find(DESIRED_STACK.getStackName(),DESIRED_STACK.getStackVersion());
  assertNotNull(stackEntity);
  final ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,stackEntity);
  final ClusterServiceEntity clusterServiceEntityNagios=upgradeCatalogHelper.addService(injector,clusterEntity,"NAGIOS",stackEntity);
  final HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,HOST_NAME);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityNagios,hostEntity,"NAGIOS_SERVER",stackEntity);
  ServiceComponentDesiredStateEntityPK pkNagiosServer=new ServiceComponentDesiredStateEntityPK();
  pkNagiosServer.setComponentName("NAGIOS_SERVER");
  pkNagiosServer.setClusterId(clusterEntity.getClusterId());
  pkNagiosServer.setServiceName("NAGIOS");
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(pkNagiosServer);
  assertNotNull(serviceComponentDesiredStateEntity);
  HostComponentDesiredStateEntityPK hcDesiredStateEntityPk=new HostComponentDesiredStateEntityPK();
  hcDesiredStateEntityPk.setServiceName("NAGIOS");
  hcDesiredStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcDesiredStateEntityPk.setComponentName("NAGIOS_SERVER");
  hcDesiredStateEntityPk.setHostId(hostEntity.getHostId());
  HostComponentDesiredStateEntity hcDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(hcDesiredStateEntityPk);
  assertNotNull(hcDesiredStateEntity);
  HostComponentStateEntity hcStateEntity=hostComponentStateDAO.findByIndex(clusterEntity.getClusterId(),"NAGIOS","NAGIOS_SERVER",hostEntity.getHostId());
  assertNotNull(hcStateEntity);
  ClusterServiceEntity clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  upgradeCatalog200.removeNagiosService();
  clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  assertNull(clusterService);
}
