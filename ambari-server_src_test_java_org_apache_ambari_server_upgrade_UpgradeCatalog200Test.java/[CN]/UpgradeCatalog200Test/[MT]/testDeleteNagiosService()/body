{
  final ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,DESIRED_STACK_VERSION);
  final ClusterServiceEntity clusterServiceEntityNagios=upgradeCatalogHelper.addService(injector,clusterEntity,"NAGIOS",DESIRED_STACK_VERSION);
  final HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,HOST_NAME);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityNagios,hostEntity,"NAGIOS_SERVER",DESIRED_STACK_VERSION);
  UpgradeCatalog200 upgradeCatalog200=injector.getInstance(UpgradeCatalog200.class);
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  ServiceComponentDesiredStateEntityPK pkNagiosServer=new ServiceComponentDesiredStateEntityPK();
  pkNagiosServer.setComponentName("NAGIOS_SERVER");
  pkNagiosServer.setClusterId(clusterEntity.getClusterId());
  pkNagiosServer.setServiceName("NAGIOS");
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(pkNagiosServer);
  assertNotNull(serviceComponentDesiredStateEntity);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentDesiredStateEntityPK hcDesiredStateEntityPk=new HostComponentDesiredStateEntityPK();
  hcDesiredStateEntityPk.setServiceName("NAGIOS");
  hcDesiredStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcDesiredStateEntityPk.setComponentName("NAGIOS_SERVER");
  hcDesiredStateEntityPk.setHostName(HOST_NAME);
  HostComponentDesiredStateEntity hcDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(hcDesiredStateEntityPk);
  assertNotNull(hcDesiredStateEntity);
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  HostComponentStateEntityPK hcStateEntityPk=new HostComponentStateEntityPK();
  hcStateEntityPk.setServiceName("NAGIOS");
  hcStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcStateEntityPk.setComponentName("NAGIOS_SERVER");
  hcStateEntityPk.setHostName(HOST_NAME);
  HostComponentStateEntity hcStateEntity=hostComponentStateDAO.findByPK(hcStateEntityPk);
  assertNotNull(hcStateEntity);
  ClusterServiceDAO clusterServiceDao=injector.getInstance(ClusterServiceDAO.class);
  ClusterServiceEntity clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  upgradeCatalog200.removeNagiosService();
  clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  assertNull(clusterService);
}
