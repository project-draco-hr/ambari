{
  if (!isOpen()) {
    throw new KerberosOperationException("This operation handler has not be opened");
  }
  if ((principal == null) || principal.isEmpty()) {
    throw new KerberosOperationException("Failed to set password - no principal specified");
  }
 else   if ((password == null) || password.isEmpty()) {
    throw new KerberosOperationException("Failed to set password - no password specified");
  }
 else {
    try {
      invokeKAdmin(String.format("change_password -pw %s %s",password,principal));
    }
 catch (    KerberosOperationException e) {
      LOG.error(String.format("Failed to set password for %s",principal),e);
      throw e;
    }
    return getKeyNumber(principal);
  }
}
