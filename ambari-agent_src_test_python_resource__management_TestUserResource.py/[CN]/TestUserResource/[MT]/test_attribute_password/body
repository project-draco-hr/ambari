@patch.object(subprocess, 'Popen')
@patch.object(pwd, 'getpwnam')
def test_attribute_password(self, getpwnam_mock, popen_mock):
    subproc_mock = MagicMock()
    subproc_mock.returncode = 0
    popen_mock.return_value = subproc_mock
    getpwnam_mock.return_value = 1
    with Environment('/') as env:
        user = User('mapred', action='create', password='secure', shell='/bin/bash')
    popen_mock.assert_called_with(['/bin/bash', '--login', '-c', "/usr/bin/sudo -s <<< 'usermod -s /bin/bash -p secure mapred'"], shell=False, preexec_fn=None, stderr=(-2), stdout=(-1), env=None, cwd=None)
    self.assertEqual(popen_mock.call_count, 1)
