{
  SignCertResponse response=new SignCertResponse();
  LOG.info("Signing of agent certificate");
  LOG.info("Verifying passphrase");
  String passphraseSrvr=configs.getConfigsMap().get(Configuration.PASSPHRASE_KEY);
  LOG.info("Pass phrase Server " + passphraseSrvr);
  LOG.info("Pass Phrase Agent" + passphraseAgent);
  if (!passphraseSrvr.equals(passphraseAgent)) {
    LOG.warn("Incorrect passphrase from agent");
    response.setResult(SignCertResponse.ERROR_STATUS);
    response.setMessage("Incorrect passphrase from agent");
    return response;
  }
  Map<String,String> configsMap=configs.getConfigsMap();
  String srvrKstrDir=configsMap.get(Configuration.SRVR_KSTR_DIR_KEY);
  String srvrCrtPass=configsMap.get(Configuration.SRVR_CRT_PASS_KEY);
  String srvrCrtName=configsMap.get(Configuration.SRVR_CRT_NAME_KEY);
  String srvrKeyName=configsMap.get(Configuration.SRVR_KEY_NAME_KEY);
  String agentCrtReqName=agentHostname + ".csr";
  String agentCrtName=agentHostname + ".crt";
  File agentCrtReqFile=new File(srvrKstrDir + File.separator + agentCrtReqName);
  try {
    FileUtils.writeStringToFile(agentCrtReqFile,agentCrtReqContent);
  }
 catch (  IOException e1) {
    e1.printStackTrace();
  }
  Object[] scriptArgs={srvrKstrDir,agentCrtReqName,agentCrtName,srvrCrtPass,srvrKeyName,srvrCrtName};
  String command=MessageFormat.format(SIGN_AGENT_CRT,scriptArgs);
  LOG.debug(command);
  int commandExitCode=runCommand(command);
  if (commandExitCode != 0) {
    response.setResult(SignCertResponse.ERROR_STATUS);
    response.setMessage(ShellCommandUtil.getOpenSslCommandResult(command,commandExitCode));
    return response;
  }
  File agentCrtFile=new File(srvrKstrDir + File.separator + agentCrtName);
  String agentCrtContent="";
  try {
    agentCrtContent=FileUtils.readFileToString(agentCrtFile);
  }
 catch (  IOException e) {
    e.printStackTrace();
    LOG.error("Error reading signed agent certificate");
    response.setResult(SignCertResponse.ERROR_STATUS);
    response.setMessage("Error reading signed agent certificate");
    return response;
  }
  response.setResult(SignCertResponse.OK_STATUS);
  response.setSignedCa(agentCrtContent);
  return response;
}
