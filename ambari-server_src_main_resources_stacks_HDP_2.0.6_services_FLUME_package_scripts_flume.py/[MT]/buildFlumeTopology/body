def buildFlumeTopology(content):
    import ConfigParser
    import StringIO
    config = StringIO.StringIO()
    config.write('[dummy]\n')
    config.write(content)
    config.seek(0, os.SEEK_SET)
    cp = ConfigParser.ConfigParser()
    cp.readfp(config)
    result = {}
    agent_names = []
    for item in cp.items('dummy'):
        key = item[0]
        part0 = key.split('.')[0]
        if key.endswith('.sources'):
            agent_names.append(part0)
        if (not result.has_key(part0)):
            result[part0] = {}
        result[part0][key] = item[1]
    for k in result.keys():
        if (not (k in agent_names)):
            del result[k]
    return result
