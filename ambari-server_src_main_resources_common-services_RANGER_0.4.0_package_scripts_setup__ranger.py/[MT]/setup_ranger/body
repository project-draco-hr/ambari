def setup_ranger():
    import params
    if check_db_connnection():
        File(params.downloaded_custom_connector, content=DownloadSource(params.driver_curl_source))
        if (not os.path.isfile(params.driver_curl_target)):
            Execute(('cp', '--remove-destination', params.downloaded_custom_connector, params.driver_curl_target), path=['/bin', '/usr/bin/'], sudo=True)
        file_path = format('{ranger_home}/install.properties')
        bk_file_path = format('{ranger_home}/install-bk.properties')
        File(bk_file_path, content=StaticFile(file_path))
        write_properties_to_file(file_path, admin_properties())
        if ((params.db_flavor.lower() == 'oracle') and params.oracle_home):
            env_dict = {'JAVA_HOME': params.java_home, 'ORACLE_HOME': params.oracle_home, 'LD_LIBRARY_PATH': params.oracle_home, }
        else:
            env_dict = {'JAVA_HOME': params.java_home, }
        setup_sh = (format('cd {ranger_home} && ') + as_sudo([format('{ranger_home}/setup.sh')]))
        try:
            Execute(setup_sh, environment=env_dict, logoutput=True)
        except Fail as e:
            if os.path.isfile(bk_file_path):
                File(file_path, action='delete')
                Execute(('mv', bk_file_path, file_path), sudo=True)
            raise Fail('Ranger installation Failed, {0}'.format(str(e)))
        do_post_installation()
        if os.path.isfile(bk_file_path):
            File(file_path, action='delete')
            Execute(('mv', bk_file_path, file_path), sudo=True)
        else:
            raise Fail('Ranger admin install.properties backup file doesnot exist')
