{
  if (getPropertyIds().isEmpty()) {
    return true;
  }
  String componentName=(String)resource.getPropertyValue(componentNamePropertyId);
  String gangliaClusterName=GANGLIA_CLUSTER_NAMES.get(componentName);
  Map<PropertyId,String> metrics=componentMetrics.get(componentName);
  if (metrics == null || gangliaClusterName == null) {
    return true;
  }
  String hostName=hostNamePropertyId == null ? null : PropertyHelper.fixHostName((String)resource.getPropertyValue(hostNamePropertyId));
  Set<PropertyId> ids=PropertyHelper.getRequestPropertyIds(getPropertyIds(),request,predicate);
  for (  PropertyId propertyId : ids) {
    String metricName=metrics.get(propertyId);
    if (metricName != null) {
      boolean temporal=propertyId.isTemporal();
      String spec=getSpec(gangliaClusterName,hostName,metricName,temporal ? request.getTemporalInfo(propertyId) : null);
      try {
        List<GangliaMetric> properties=new ObjectMapper().readValue(streamProvider.readFrom(spec),new TypeReference<List<GangliaMetric>>(){
        }
);
        if (properties != null) {
          resource.setProperty(propertyId,getValue(properties.get(0),temporal));
        }
      }
 catch (      IOException e) {
        throw new AmbariException("Can't get metric : " + metricName,e);
      }
    }
  }
  return true;
}
