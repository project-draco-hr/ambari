{
  HdfsApi hdfsApi=createNiceMock(HdfsApi.class);
  expect(hdfsApi.copy(eq("/tmp/script.pig"),startsWith("/tmp/.pigjobs/"))).andReturn(true);
  ByteArrayOutputStream do_stream=new ByteArrayOutputStream();
  FSDataOutputStream stream=new FSDataOutputStream(do_stream);
  expect(hdfsApi.create(anyString(),eq(true))).andReturn(stream);
  replay(hdfsApi);
  HdfsApi.setInstance(context,hdfsApi);
  TempletonApi api=createNiceMock(TempletonApi.class);
  jobService.getResourceManager().setTempletonApi(api);
  TempletonApi.JobData data=api.new JobData();
  expect(api.runPigQuery((File)anyObject(),anyString(),eq("-useHCatalog"))).andReturn(data);
  replay(api);
  thrown.expect(BadRequestFormattedException.class);
  doCreateJob(null,"/tmp/1.pig","-useHCatalog",jobService);
}
