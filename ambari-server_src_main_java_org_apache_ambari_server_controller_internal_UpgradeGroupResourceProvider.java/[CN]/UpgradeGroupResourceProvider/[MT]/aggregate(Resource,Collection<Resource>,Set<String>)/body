{
  Double total=new Double(0d);
  Integer count=new Integer(0);
  Map<HostRoleStatus,Integer> counters=new HashMap<HostRoleStatus,Integer>();
  for (  HostRoleStatus hostRoleStatus : HostRoleStatus.values()) {
    counters.put(hostRoleStatus,new Integer(0));
  }
  for (  Resource stage : stages) {
    String status=(String)stage.getPropertyValue(StageResourceProvider.STAGE_STATUS);
    Double percent=(Double)stage.getPropertyValue(StageResourceProvider.STAGE_PROGRESS_PERCENT);
    if (null != percent) {
      total+=percent;
      count++;
    }
    if (null != status) {
      HostRoleStatus hrs=HostRoleStatus.valueOf(status);
      counters.put(hrs,counters.get(hrs) + 1);
    }
  }
  if (count > 0) {
    setResourceProperty(upgradeGroup,UPGRADE_GROUP_PROGRESS_PERCENT,total / count,requestedIds);
  }
  HostRoleStatus summary=RequestResourceProvider.calculateSummaryStatus(counters,counters.size());
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_STATUS,summary,requestedIds);
}
