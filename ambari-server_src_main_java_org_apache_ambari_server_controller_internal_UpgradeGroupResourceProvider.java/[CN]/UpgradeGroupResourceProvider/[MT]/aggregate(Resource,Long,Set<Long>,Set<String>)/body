{
  List<StageEntity> stages=stageDAO.findByStageIds(requestId,stageIds);
  List<HostRoleCommandEntity> tasks=new ArrayList<HostRoleCommandEntity>();
  for (  StageEntity stage : stages) {
    tasks.addAll(stage.getHostRoleCommands());
  }
  Map<HostRoleStatus,Integer> counts=CalculatedStatus.calculateTaskEntityStatusCounts(tasks);
  Integer inProgress=0;
  Integer completed=0;
  for (  Entry<HostRoleStatus,Integer> entry : counts.entrySet()) {
    if (entry.getKey().isCompletedState()) {
      completed+=entry.getValue();
    }
 else     if (entry.getKey().isInProgress()) {
      inProgress+=entry.getValue();
    }
  }
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_TOTAL_TASKS,tasks.size(),requestedIds);
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_IN_PROGRESS_TASKS,inProgress,requestedIds);
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_COMPLETED_TASKS,completed,requestedIds);
  CalculatedStatus status=CalculatedStatus.statusFromStageEntities(stages);
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_STATUS,status.getStatus(),requestedIds);
  setResourceProperty(upgradeGroup,UPGRADE_GROUP_PROGRESS_PERCENT,status.getPercent(),requestedIds);
}
