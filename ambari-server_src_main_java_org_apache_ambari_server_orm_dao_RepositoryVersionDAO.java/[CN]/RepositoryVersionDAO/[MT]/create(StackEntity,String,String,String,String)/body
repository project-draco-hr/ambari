{
  if (stackEntity == null || version == null || version.isEmpty() || displayName == null || displayName.isEmpty()) {
    throw new AmbariException("At least one of the required properties is null or empty");
  }
  RepositoryVersionEntity existingByDisplayName=findByDisplayName(displayName);
  if (existingByDisplayName != null) {
    throw new AmbariException("Repository version with display name '" + displayName + "' already exists");
  }
  RepositoryVersionEntity existingByStackAndVersion=findByStackAndVersion(stackEntity,version);
  if (existingByStackAndVersion != null) {
    throw new AmbariException("Repository version for stack " + stackEntity + " and version "+ version+ " already exists");
  }
  RepositoryVersionEntity newEntity=new RepositoryVersionEntity(stackEntity,version,displayName,upgradePack,operatingSystems);
  this.create(newEntity);
  return newEntity;
}
