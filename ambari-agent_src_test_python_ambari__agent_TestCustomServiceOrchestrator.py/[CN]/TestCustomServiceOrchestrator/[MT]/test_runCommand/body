@patch.object(CustomServiceOrchestrator, 'resolve_script_path')
@patch.object(FileCache, 'get_service_base_dir')
@patch.object(CustomServiceOrchestrator, 'dump_command_to_json')
@patch.object(PythonExecutor, 'run_file')
def test_runCommand(self, run_file_mock, dump_command_to_json_mock, get_service_base_dir_mock, resolve_script_path_mock):
    command = {'role': 'REGION_SERVER', 'hostLevelParams': {'stack_name': 'HDP', 'stack_version': '2.0.7', }, 'commandParams': {'script_type': 'PYTHON', 'script': 'scripts/hbase_regionserver.py', 'command_timeout': '600', 'service_metadata_folder': 'HBASE', }, 'taskId': '3', 'roleCommand': 'INSTALL', }
    get_service_base_dir_mock.return_value = '/basedir/'
    resolve_script_path_mock.return_value = '/basedir/scriptpath'
    orchestrator = CustomServiceOrchestrator(self.config)
    run_file_mock.return_value = {'stdout': 'sss', 'stderr': 'eee', 'exitcode': 0, }
    ret = orchestrator.runCommand(command, 'out.txt', 'err.txt')
    self.assertEqual(ret['exitcode'], 0)
    self.assertTrue(run_file_mock.called)
    run_file_mock.reset_mock()
    command['commandParams']['script_type'] = 'PUPPET'
    ret = orchestrator.runCommand(command, 'out.txt', 'err.txt')
    self.assertEqual(ret['exitcode'], 1)
    self.assertFalse(run_file_mock.called)
    self.assertTrue(('Unknown script type' in ret['stdout']))
    pass
