def compute_actual_version(self):
    '\n    After packages are installed, determine what the new actual version is, in order to save it.\n    '
    Logger.info('Attempting to determine actual version with build number.')
    Logger.info('Old versions: {0}'.format(self.old_versions))
    new_versions = get_hdp_versions()
    Logger.info('New versions: {0}'.format(new_versions))
    deltas = (set(new_versions) - set(self.old_versions))
    Logger.info('Deltas: {0}'.format(deltas))
    normalized_repo_version = self.repository_version.split('-')[0]
    if (1 == len(deltas)):
        self.actual_version = next(iter(deltas)).strip()
        self.structured_output['actual_version'] = self.actual_version
        self.put_structured_out(self.structured_output)
        write_actual_version_to_history_file(normalized_repo_version, self.actual_version)
    else:
        Logger.info('Cannot determine a new actual version installed by using the delta method.')
        self.actual_version = read_actual_version_from_history_file(normalized_repo_version)
        if (self.actual_version is not None):
            self.actual_version = self.actual_version.strip()
            self.structured_output['actual_version'] = self.actual_version
            self.put_structured_out(self.structured_output)
            Logger.info('Found actual version {0} by parsing file {1}'.format(self.actual_version, REPO_VERSION_HISTORY_FILE))
        elif (self.repo_version_with_build_number is None):
            msg = 'Could not determine actual version installed. Try reinstalling packages again.'
            raise Fail(msg)
