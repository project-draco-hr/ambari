def actionexecute(self, env):
    num_errors = 0
    config = Script.get_config()
    repo_rhel_suse = config['configurations']['cluster-env']['repo_suse_rhel_template']
    repo_ubuntu = config['configurations']['cluster-env']['repo_ubuntu_template']
    template = (repo_rhel_suse if (OSCheck.is_redhat_family() or OSCheck.is_suse_family()) else repo_ubuntu)
    signal.signal(signal.SIGTERM, self.abort_handler)
    signal.signal(signal.SIGINT, self.abort_handler)
    try:
        self.repository_version = config['roleParams']['repository_version']
        base_urls = json.loads(config['roleParams']['base_urls'])
        package_list = json.loads(config['roleParams']['package_list'])
        stack_id = config['roleParams']['stack_id']
    except KeyError:
        self.repository_version = config['commandParams']['repository_version']
        base_urls = json.loads(config['commandParams']['base_urls'])
        package_list = json.loads(config['commandParams']['package_list'])
        stack_id = config['commandParams']['stack_id']
    stack_name = None
    self.stack_root_folder = None
    if (stack_id and ('-' in stack_id)):
        stack_split = stack_id.split('-')
        if (len(stack_split) == 2):
            stack_name = stack_split[0].upper()
            if (stack_name in self.STACK_TO_ROOT_FOLDER):
                self.stack_root_folder = self.STACK_TO_ROOT_FOLDER[stack_name]
    if (self.stack_root_folder is None):
        raise Fail("Cannot determine the stack's root directory by parsing the stack_id property, {0}".format(str(stack_id)))
    self.repository_version = self.repository_version.strip()
    installed_repositories = []
    self.current_repositories = []
    self.current_repo_files = set()
    if OSCheck.is_suse_family():
        self.current_repositories.append('base')
    elif OSCheck.is_ubuntu_family():
        self.current_repo_files.add('base')
    Logger.info('Will install packages for repository version {0}'.format(self.repository_version))
    try:
        append_to_file = False
        for url_info in base_urls:
            (repo_name, repo_file) = self.install_repository(url_info, append_to_file, template)
            self.current_repositories.append(repo_name)
            self.current_repo_files.add(repo_file)
            append_to_file = True
        installed_repositories = list_ambari_managed_repos()
    except Exception as err:
        Logger.logger.exception('Cannot distribute repositories. Error: {0}'.format(str(err)))
        num_errors += 1
    self.structured_output = {'ambari_repositories': installed_repositories, 'installed_repository_version': self.repository_version, 'stack_id': stack_id, 'package_installation_result': 'FAIL', }
    self.put_structured_out(self.structured_output)
    if (num_errors > 0):
        raise Fail('Failed to distribute repositories/install packages')
    self.actual_version = None
    if self.repository_version:
        m = re.search('[\\d\\.]+-\\d+', self.repository_version)
        if m:
            self.repo_version_with_build_number = self.repository_version
            self.structured_output['actual_version'] = self.repo_version_with_build_number
            self.put_structured_out(self.structured_output)
        else:
            self.repo_version_with_build_number = None
    self.old_versions = get_hdp_versions()
    try:
        ret_code = self.install_packages(package_list)
        if (ret_code == 0):
            self.structured_output['package_installation_result'] = 'SUCCESS'
            self.put_structured_out(self.structured_output)
        else:
            num_errors += 1
    except Exception as err:
        num_errors += 1
        Logger.logger.exception('Could not install packages. Error: {0}'.format(str(err)))
    if (num_errors > 0):
        raise Fail('Failed to distribute repositories/install packages')
    if (('package_installation_result' in self.structured_output) and ('actual_version' in self.structured_output) and (self.structured_output['package_installation_result'] == 'SUCCESS')):
        conf_select.create_config_links(stack_id, self.structured_output['actual_version'])
