def actionexecute(self, env):
    delayed_fail = False
    package_install_result = False
    config = Script.get_config()
    try:
        repository_version = config['roleParams']['repository_version']
        base_urls = json.loads(config['roleParams']['base_urls'])
        package_list = json.loads(config['roleParams']['package_list'])
    except KeyError:
        repository_version = config['commandParams']['repository_version']
        base_urls = json.loads(config['commandParams']['base_urls'])
        package_list = json.loads(config['commandParams']['package_list'])
    installed_repositories = []
    current_repositories = ['base']
    try:
        for url_info in base_urls:
            repo_name = self.install_repository(url_info, repository_version)
            current_repositories.append(repo_name)
        installed_repositories = list_ambari_managed_repos()
    except Exception as err:
        print 'Can not distribute repositories.'
        print traceback.format_exc()
        delayed_fail = True
    if (not delayed_fail):
        try:
            for package in package_list:
                Package(package['name'], use_repos=current_repositories)
            package_install_result = True
        except Exception as err:
            print 'Can not install packages.'
            print traceback.format_exc()
            delayed_fail = True
    structured_output = {'ambari_repositories': installed_repositories, 'installed_repository_version': repository_version, 'package_installation_result': ('SUCCESS' if package_install_result else 'FAIL'), }
    self.put_structured_out(structured_output)
    if delayed_fail:
        raise Fail('Failed to distribute repositories/install packages')
