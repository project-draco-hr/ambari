{
  ActionManager actionManager=createNiceMock(ActionManager.class);
  Predicate predicate=new PredicateBuilder().property(StageResourceProvider.STAGE_STAGE_ID).equals(2L).and().property(StageResourceProvider.STAGE_REQUEST_ID).equals(1L).toPredicate();
  Request request=PropertyHelper.getReadRequest();
  List<StageEntity> entities=getStageEntities(HostRoleStatus.HOLDING);
  expect(dao.findAll(request,predicate)).andReturn(entities);
  expect(managementController.getActionManager()).andReturn(actionManager).anyTimes();
  actionManager.cancelRequest(eq(1L),anyObject(String.class));
  replay(dao,clusters,cluster,actionManager,managementController);
  StageResourceProvider.updateStageStatus(1L,2L,HostRoleStatus.ABORTED,managementController);
  verify(dao,clusters,cluster,actionManager,managementController);
}
